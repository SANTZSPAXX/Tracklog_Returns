(self.webpackChunkappsheet_app=self.webpackChunkappsheet_app||[]).push([["scripts__shared_models_datalayer_AppModel_ts"],{238435:e=>{e.exports='"use strict";\n\n// http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerwithlabel/docs/reference.html\n\n/* eslint-disable */\nfunction inherits(e, t) {\n  function i() {}\n\n  i.prototype = t.prototype, e.superClass_ = t.prototype, e.prototype = new i(), e.prototype.constructor = e;\n}\n\nfunction MarkerLabel_(e, t, i) {\n  this.marker_ = e, this.handCursorURL_ = e.handCursorURL, this.labelDiv_ = document.createElement("div"), this.labelDiv_.style.cssText = "position: absolute; overflow: hidden;", this.eventDiv_ = document.createElement("div"), this.eventDiv_.style.cssText = this.labelDiv_.style.cssText, this.eventDiv_.setAttribute("onselectstart", "return false;"), this.eventDiv_.setAttribute("ondragstart", "return false;"), this.crossDiv_ = MarkerLabel_.getSharedCross(t);\n}\n\nfunction MarkerWithLabel(e) {\n  e = e || {}, e.labelContent = e.labelContent || "", e.labelAnchor = e.labelAnchor || new google.maps.Point(0, 0), e.labelClass = e.labelClass || "markerLabels", e.labelStyle = e.labelStyle || {}, e.labelInBackground = e.labelInBackground || !1, "undefined" == typeof e.labelVisible && (e.labelVisible = !0), "undefined" == typeof e.raiseOnDrag && (e.raiseOnDrag = !0), "undefined" == typeof e.clickable && (e.clickable = !0), "undefined" == typeof e.draggable && (e.draggable = !1), "undefined" == typeof e.optimized && (e.optimized = !1), e.crossImage = e.crossImage || "http" + ("https:" === document.location.protocol ? "s" : "") + "://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png", e.handCursor = e.handCursor || "http" + ("https:" === document.location.protocol ? "s" : "") + "://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur", e.optimized = !1, this.label = new MarkerLabel_(this, e.crossImage, e.handCursor), google.maps.Marker.apply(this, arguments);\n}\n\ninherits(MarkerLabel_, google.maps.OverlayView), MarkerLabel_.getSharedCross = function (e) {\n  var t;\n  return "undefined" == typeof MarkerLabel_.getSharedCross.crossDiv && (t = document.createElement("img"), t.style.cssText = "position: absolute; z-index: 1000002; display: none;", t.style.marginLeft = "-8px", t.style.marginTop = "-9px", t.src = e, MarkerLabel_.getSharedCross.crossDiv = t), MarkerLabel_.getSharedCross.crossDiv;\n}, MarkerLabel_.prototype.onAdd = function () {\n  var e,\n      t,\n      i,\n      s,\n      a,\n      r,\n      o,\n      l = this,\n      n = !1,\n      g = !1,\n      p = 20,\n      _ = "url(" + this.handCursorURL_ + ")",\n      h = function h(e) {\n    e.preventDefault && e.preventDefault(), e.cancelBubble = !0, e.stopPropagation && e.stopPropagation();\n  },\n      v = function v() {\n    l.marker_.setAnimation(null);\n  };\n\n  this.getPanes().overlayImage.appendChild(this.labelDiv_), this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_), "undefined" == typeof MarkerLabel_.getSharedCross.processed && (this.getPanes().overlayImage.appendChild(this.crossDiv_), MarkerLabel_.getSharedCross.processed = !0), this.listeners_ = [google.maps.event.addDomListener(this.eventDiv_, "mouseover", function (e) {\n    (l.marker_.getDraggable() || l.marker_.getClickable()) && (this.style.cursor = "pointer", google.maps.event.trigger(l.marker_, "mouseover", e));\n  }), google.maps.event.addDomListener(this.eventDiv_, "mouseout", function (e) {\n    !l.marker_.getDraggable() && !l.marker_.getClickable() || g || (this.style.cursor = l.marker_.getCursor(), google.maps.event.trigger(l.marker_, "mouseout", e));\n  }), google.maps.event.addDomListener(this.eventDiv_, "mousedown", function (e) {\n    g = !1, l.marker_.getDraggable() && (n = !0, this.style.cursor = _), (l.marker_.getDraggable() || l.marker_.getClickable()) && (google.maps.event.trigger(l.marker_, "mousedown", e), h(e));\n  }), google.maps.event.addDomListener(document, "mouseup", function (t) {\n    var i;\n\n    if (n && (n = !1, l.eventDiv_.style.cursor = "pointer", google.maps.event.trigger(l.marker_, "mouseup", t)), g) {\n      if (a) {\n        i = l.getProjection().fromLatLngToDivPixel(l.marker_.getPosition()), i.y += p, l.marker_.setPosition(l.getProjection().fromDivPixelToLatLng(i));\n\n        try {\n          l.marker_.setAnimation(google.maps.Animation.BOUNCE), setTimeout(v, 1406);\n        } catch (r) {}\n      }\n\n      l.crossDiv_.style.display = "none", l.marker_.setZIndex(e), s = !0, g = !1, t.latLng = l.marker_.getPosition(), google.maps.event.trigger(l.marker_, "dragend", t);\n    }\n  }), google.maps.event.addListener(l.marker_.getMap(), "mousemove", function (s) {\n    var _;\n\n    n && (g ? (s.latLng = new google.maps.LatLng(s.latLng.lat() - t, s.latLng.lng() - i), _ = l.getProjection().fromLatLngToDivPixel(s.latLng), a && (l.crossDiv_.style.left = _.x + "px", l.crossDiv_.style.top = _.y + "px", l.crossDiv_.style.display = "", _.y -= p), l.marker_.setPosition(l.getProjection().fromDivPixelToLatLng(_)), a && (l.eventDiv_.style.top = _.y + p + "px"), google.maps.event.trigger(l.marker_, "drag", s)) : (t = s.latLng.lat() - l.marker_.getPosition().lat(), i = s.latLng.lng() - l.marker_.getPosition().lng(), e = l.marker_.getZIndex(), r = l.marker_.getPosition(), o = l.marker_.getMap().getCenter(), a = l.marker_.get("raiseOnDrag"), g = !0, l.marker_.setZIndex(1e6), s.latLng = l.marker_.getPosition(), google.maps.event.trigger(l.marker_, "dragstart", s)));\n  }), google.maps.event.addDomListener(document, "keydown", function (e) {\n    g && 27 === e.keyCode && (a = !1, l.marker_.setPosition(r), l.marker_.getMap().setCenter(o), google.maps.event.trigger(document, "mouseup", e));\n  }), google.maps.event.addDomListener(this.eventDiv_, "click", function (e) {\n    (l.marker_.getDraggable() || l.marker_.getClickable()) && (s ? s = !1 : (google.maps.event.trigger(l.marker_, "click", e), h(e)));\n  }), google.maps.event.addDomListener(this.eventDiv_, "dblclick", function (e) {\n    (l.marker_.getDraggable() || l.marker_.getClickable()) && (google.maps.event.trigger(l.marker_, "dblclick", e), h(e));\n  }), google.maps.event.addListener(this.marker_, "dragstart", function (e) {\n    g || (a = this.get("raiseOnDrag"));\n  }), google.maps.event.addListener(this.marker_, "drag", function (e) {\n    g || a && (l.setPosition(p), l.labelDiv_.style.zIndex = 1e6 + (this.get("labelInBackground") ? -1 : 1));\n  }), google.maps.event.addListener(this.marker_, "dragend", function (e) {\n    g || a && l.setPosition(0);\n  }), google.maps.event.addListener(this.marker_, "position_changed", function () {\n    l.setPosition();\n  }), google.maps.event.addListener(this.marker_, "zindex_changed", function () {\n    l.setZIndex();\n  }), google.maps.event.addListener(this.marker_, "visible_changed", function () {\n    l.setVisible();\n  }), google.maps.event.addListener(this.marker_, "labelvisible_changed", function () {\n    l.setVisible();\n  }), google.maps.event.addListener(this.marker_, "title_changed", function () {\n    l.setTitle();\n  }), google.maps.event.addListener(this.marker_, "labelcontent_changed", function () {\n    l.setContent();\n  }), google.maps.event.addListener(this.marker_, "labelanchor_changed", function () {\n    l.setAnchor();\n  }), google.maps.event.addListener(this.marker_, "labelclass_changed", function () {\n    l.setStyles();\n  }), google.maps.event.addListener(this.marker_, "labelstyle_changed", function () {\n    l.setStyles();\n  })];\n}, MarkerLabel_.prototype.onRemove = function () {\n  var e;\n\n  for (this.labelDiv_.parentNode.removeChild(this.labelDiv_), this.eventDiv_.parentNode.removeChild(this.eventDiv_), e = 0; e < this.listeners_.length; e++) {\n    google.maps.event.removeListener(this.listeners_[e]);\n  }\n}, MarkerLabel_.prototype.draw = function () {\n  this.setContent(), this.setTitle(), this.setStyles();\n}, MarkerLabel_.prototype.setContent = function () {\n  var e = this.marker_.get("labelContent");\n  "undefined" == typeof e.nodeType ? (this.labelDiv_.innerHTML = e, this.eventDiv_.innerHTML = this.labelDiv_.innerHTML) : (this.labelDiv_.innerHTML = "", this.labelDiv_.appendChild(e), e = e.cloneNode(!0), this.eventDiv_.appendChild(e));\n}, MarkerLabel_.prototype.setTitle = function () {\n  this.eventDiv_.title = this.marker_.getTitle() || "";\n}, MarkerLabel_.prototype.setStyles = function () {\n  var e, t;\n  this.labelDiv_.className = this.marker_.get("labelClass"), this.eventDiv_.className = this.labelDiv_.className, this.labelDiv_.style.cssText = "", this.eventDiv_.style.cssText = "", t = this.marker_.get("labelStyle");\n\n  for (e in t) {\n    t.hasOwnProperty(e) && (this.labelDiv_.style[e] = t[e], this.eventDiv_.style[e] = t[e]);\n  }\n\n  this.setMandatoryStyles();\n}, MarkerLabel_.prototype.setMandatoryStyles = function () {\n  this.labelDiv_.style.position = "absolute", this.labelDiv_.style.overflow = "hidden", "undefined" != typeof this.labelDiv_.style.opacity && "" !== this.labelDiv_.style.opacity && (this.labelDiv_.style.MsFilter = \'"progid:DXImageTransform.Microsoft.Alpha(opacity=\' + 100 * this.labelDiv_.style.opacity + \')"\', this.labelDiv_.style.filter = "alpha(opacity=" + 100 * this.labelDiv_.style.opacity + ")"), this.eventDiv_.style.position = this.labelDiv_.style.position, this.eventDiv_.style.overflow = this.labelDiv_.style.overflow, this.eventDiv_.style.opacity = .01, this.eventDiv_.style.MsFilter = \'"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"\', this.eventDiv_.style.filter = "alpha(opacity=1)", this.setAnchor(), this.setPosition(), this.setVisible();\n}, MarkerLabel_.prototype.setAnchor = function () {\n  var e = this.marker_.get("labelAnchor");\n  this.labelDiv_.style.marginLeft = -e.x + "px", this.labelDiv_.style.marginTop = -e.y + "px", this.eventDiv_.style.marginLeft = -e.x + "px", this.eventDiv_.style.marginTop = -e.y + "px";\n}, MarkerLabel_.prototype.setPosition = function (e) {\n  var t = this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());\n  "undefined" == typeof e && (e = 0), this.labelDiv_.style.left = Math.round(t.x) + "px", this.labelDiv_.style.top = Math.round(t.y - e) + "px", this.eventDiv_.style.left = this.labelDiv_.style.left, this.eventDiv_.style.top = this.labelDiv_.style.top, this.setZIndex();\n}, MarkerLabel_.prototype.setZIndex = function () {\n  var e = this.marker_.get("labelInBackground") ? -1 : 1;\n  "undefined" == typeof this.marker_.getZIndex() ? (this.labelDiv_.style.zIndex = parseInt(this.labelDiv_.style.top, 10) + e, this.eventDiv_.style.zIndex = this.labelDiv_.style.zIndex) : (this.labelDiv_.style.zIndex = this.marker_.getZIndex() + e, this.eventDiv_.style.zIndex = this.labelDiv_.style.zIndex);\n}, MarkerLabel_.prototype.setVisible = function () {\n  this.marker_.get("labelVisible") ? this.labelDiv_.style.display = this.marker_.getVisible() ? "block" : "none" : this.labelDiv_.style.display = "none", this.eventDiv_.style.display = this.labelDiv_.style.display;\n}, inherits(MarkerWithLabel, google.maps.Marker), MarkerWithLabel.prototype.setMap = function (e) {\n  google.maps.Marker.prototype.setMap.apply(this, arguments), this.label.setMap(e);\n};\n/* eslint-enable */\n// need this explicitly because use-strict prevents $.globalEval from modifying global namespace\n\nwindow.google.maps.MarkerWithLabel = MarkerWithLabel;'},368142:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(627424)),i=a(n(856690)),o=a(n(689728)),l=a(n(861655)),u=a(n(994993)),s=a(n(73808)),c=a(n(496486)),d=a(n(667294)),f=a(n(236377)),p=a(n(152200)),h=a(n(593186)),v=a(n(190644)),m=n(365914),g=a(n(571524)),y=a(n(498967)),b=n(46239),T=n(166089),S=n(235049);function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,u.default)(this,n)}}var E=!1,w=b.ImageMapType.CACHE_MAX_ZOOM-1,C={"far fa-search":"fal fa-search"},O=function(e){(0,l.default)(n,e);var t=A(n);function n(e){var a;return(0,i.default)(this,n),(a=t.call(this,e)).onMount=function(e){a.domNode=e},a.repaint=function(){var e=p.default.getMapInstance(a.state.mountId);e&&e.repaint()},a.onCustomMapReady=function(e){null==e&&a.setState(a.state)},a.onMountCallback=function(e){e.map&&!c.default.isEmpty(e.map.mapTypes)&&a.updateMap(e)},a.state={mountId:Math.random()},a}return(0,o.default)(n,[{key:"name",get:function(){return"ClusterMapPane"}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.repaint),this.componentDidUpdate()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.repaint),this.stopWatchingLocation(),p.default.unmountMap(this.state.mountId)}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.showMap,n=e.table,a=e.mapColumn,r=e.customMapType;if(!1!==t&&this.domNode){var i=n&&n.name(),o=this.onMountCallback;p.default.mountMap(this.domNode,this.state.mountId,{tableName:i,mapColumn:a,callback:o,isXY:!!r})}else this.componentWillUnmount()}},{key:"render",value:function(){var e;return this.props.blockLinkToMaps&&(e=d.default.createElement("div",{className:"GoogleMapPane__link-blocker"})),d.default.createElement("div",{className:"GoogleMapPane"},d.default.createElement("div",{className:"GoogleMapPane__map-parent",ref:this.onMount}),e)}},{key:"updateMarkerClustererOptions",value:function(e){var t=this.props,n=t.mapMode,a=t.minimumClusterSize,r=t.customMapType;e.zoomOnClick_="fixed"!==n,r?e.setMaxZoom(w):e.setMaxZoom(18),a&&e.getMinClusterSize()!==a&&(e.setMinClusterSize(a),e.resetViewport())}},{key:"updateMap",value:function(e){var t=this,n=e.map,a=p.default.api;this.repaint();var r=this.props,i=r.appModel,o=r.table,l=r.mapColumn,u=r.customMapType,s=r.hidePointsOfInterest,d=r.selectedItem,f=r.draggablePinCoordinates,h=this.props,y=h.zoom,A=h.minimumClusterSize;if(i&&o){this.mapInstance=e;var w,C=this.props.layers||[],O=this.props.mapEventHandlers||{},k=this.props.items||[],R=this.props.mapType||a.maps.MapTypeId.ROADMAP,I=this.props.mapOptions,N=o.name(),M={disableDefaultUI:!!d,draggableCursor:null};1===A&&(A=2),null!=A&&A<1&&(A=1e6),u?(w=u.id(),n.mapTypes.set(w,u.definition(a)),u.isReady()||u.whenReady(this.onCustomMapReady)):w=p.default.normalizeMapType(R),n.mapTypeId!==w&&(M.mapTypeId=w),s&&(M.styles=[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"on"}]}]);var D=o&&l&&o.tableSchema.findAttributeByName(l);D&&D.auxData()&&D.auxData().KMLFileUrl?(e.kmlLayer&&e.kmlLayer.url!==D.auxData().KMLFileUrl&&(e.kmlLayer.setMap(null),e.kmlLayer=null),e.kmlLayer||(e.kmlLayer=new a.maps.KmlLayer(D.auxData().KMLFileUrl,{suppressInfoWindows:!1,preserveViewport:!0,map:n}))):e.kmlLayer&&(e.kmlLayer.setMap(null),e.kmlLayer=null),e.clearListeners();var P,G,x=function(t){var r=O[t],i=n.addListener(t,(function(e){r(e,n,a)}));e.registerListener(i)};for(var F in O)x(F);for(var V=!1,U=0,B=c.default.concat(k,c.default.flatMap(C,(function(e){return e.mapItems})));null==P||null==G;){switch(U){case 0:P=v.default.normalizeLatOrLng(this.props.centerLat),G=v.default.normalizeLatOrLng(this.props.centerLng);break;case 1:d&&(P=v.default.normalizeLatOrLng(d.Latitude),G=v.default.normalizeLatOrLng(d.Longitude));break;case 2:B.length>0&&(P=B[0].Latitude,G=B[0].Longitude,V=B.length>1);break;case 3:null==v.default.lastPosition||u||(P=v.default.lastPosition.coords.latitude,G=v.default.lastPosition.coords.longitude,V=B.length>1);break;case 4:P=p.default.defaultLat,G=p.default.defaultLng,null!=y&&y>2&&(y=2);break;default:P=0,G=0}U++}var H=p.default.getMountedPins(e.id);E;var W=T.AppGlobals.ViewManager.theme.getThemeColor("themeMainColor"),j={tableName:N,mapColumn:l,mapItems:k,defaultFormatting:{color:_(W,-.2),scale:6,noMarkerWithLabel:!0}},Y=V;this.filterAndSortLayerItems(j,P,G,Y);var q=this.updatePins(H,j),K=q.pinsToAdd,z=q.pinsToShow,J=q.selectedPin,Q=W;C.forEach((function(e){e.defaultFormatting={color:_(Q,.3),scale:6,noMarkerWithLabel:!0},Q=e.defaultFormatting.color,t.filterAndSortLayerItems(e,P,G,Y);var n=t.updatePins(H,e);J=J||n.selectedPin,K=c.default.union(K,n.pinsToAdd),z=c.default.union(z,n.pinsToShow)}));var $=c.default.values(H);E,p.default.unmountPins(e.id,H);var X=c.default.union(K,z);setTimeout((function(){var n,a;t.showPins(X),t.hidePins($),(n={pinsToAdd:K,pinsToHide:$,pinsToShow:z},a=new m.NestedStore,c.default.keys(n).forEach((function(e){n[e].forEach((function(t){var n=L(t);a.for(n).push(e,t)}))})),a).forEach((function(n,a){var r=e.initMarkerClusterer(n);t.updateMarkerClustererOptions(r);var i=a.toSimpleObject(),o=i.pinsToAdd,l=void 0===o?[]:o,u=i.pinsToHide,s=void 0===u?[]:u,c=i.pinsToShow,d=void 0===c?[]:c;r.getTotalMarkers()!==d.length+s.length?(r.clearMarkers(),r.addMarkers(l),r.addMarkers(d)):(s.length||l.length)&&(r.removeMarkers(s),r.addMarkers(l))}))}),0);var Z=e.state.activePin;if(null!=J?null!=Z?Z.map===n&&Z.position===J.position||Z.setOptions({position:J.position,map:n}):Z=new a.maps.Marker({map:n,position:J.position,draggable:!1}):null!=Z&&Z.setMap(null),e.setState({activePin:Z}),V){var ee=new a.maps.LatLngBounds;X.map((function(e){return e.position})).forEach((function(e){return ee.extend(e)}));var te=ee.getNorthEast();!te||te.equals(ee.getSouthWest())?V=!1:n.fitBounds(ee)}if(V||(M.center={lat:P,lng:G},null!=y&&y!==n.getZoom()&&(M.zoom=y)),g.default.InMobileWebView()&&i.AppTemplate.Behavior.FullOfflineCaching){var ne=!navigator.onLine||!(0,S.isConnected)();M.maxZoom=ne&&u?b.ImageMapType.CACHE_MAX_ZOOM:u?b.ImageMapType.MAX_ZOOM:22}this.updateCurrentLocation(e),f&&this.updateDraggablePins(f,e),this.updateDraggablePin(e),n.setOptions(c.default.extend(M,I))}}},{key:"maxPins",value:function(e){var t=e.maxPins;if(null==t){try{t=e.appModel.AppTemplate.Presentation.MapPinMax}catch(e){h.default.ReportErrorOnce({errorMessage:"null reference from nextProps.appModel.AppTemplate.Presentation.MapPinMax"})}null==t&&(t=g.default.InMobileWebView()?250:1e3)}return t}},{key:"hidePins",value:function(e){null!=e&&(e=null!=e.length?e:[e]).forEach((function(e){null!=e&&null!=e.map&&"function"==typeof e.setVisible&&e.setVisible(!1)}))}},{key:"showPins",value:function(e){var t=this,n=this.mapInstance.map;if(null!=e&&null!=n){var a=this.props.selectedItem;(e=null!=e.length?e:[e]).forEach((function(e){t.formatPin(e),a&&a.Id===e.appsheetItem.Id?e.setVisible(!1):e.visible||e.setVisible(!0)}))}}},{key:"formatPin",value:function(e){var t=L(e),n=function(e){var t=e.appsheetFormatting;return t&&t.icon&&t.icon[0]}(e);null==e.icon&&(n?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3?arguments[3]:void 0,r=[e,n,t].join(", "),i=D[r];if(null==i){E,D[r]=[a];var o=new Image,l=M(t,n);o.src=l,o.onload=function(){var t=document.createElement("i");e.match(/^fa[rls]?\s/)||(e="fas "+e),e=C[e]||e,t.className=e,document.body.appendChild(t);var a=window.getComputedStyle(t,":before"),i=a.content.replace(/'|"/g,"").charCodeAt(0),l=a.fontWeight;document.body.removeChild(t);var u=o.height,s=R(n,u),c=s.getContext("2d");c.drawImage(o,0,0,n,u),c.fillStyle="white",c.font="".concat(l,' 9px "Font Awesome 5 Pro"'),c.textAlign="center",c.fillText(String.fromCharCode(i),.5*n,.51*u);var d=s.toDataURL(),f=new p.default.api.maps.Size(n,u),h={url:d,size:f,scaledSize:f},v=D[r];Array.isArray(v)&&v.forEach((function(e){return e(h)})),D[r]=h},o.onerror=function(){var e=D[r];Array.isArray(e)&&e.forEach((function(e){return e(l)})),D[r]=l}}else Array.isArray(i)?i.push(a):a(i)}(n,t,20,(function(t){return e.setIcon(t)})):e.setIcon(M(t,12)))}},{key:"stopWatchingLocation",value:function(){null!=this.locationUpdateListener&&(v.default.removeListener(this.locationUpdateListener),this.locationUpdateListener=null)}},{key:"updateCurrentLocation",value:function(e){var t=e.state.currentLocMarker,n=e.map,a=this.props;if(a.showCurrentLocation){null==t&&(t=new p.default.api.maps.Marker({icon:{path:p.default.api.maps.SymbolPath.CIRCLE,scale:7,fillOpacity:1,fillColor:"#2B6FF6",strokeColor:"white",strokeWeight:2},draggable:!1,map:n}),e.setState({currentLocMarker:t}));var r=function(e,a){var r=t.position;t.map!==n&&t.setOptions({map:n}),null!=r&&r.lat()===e&&r.lng()===a||t.setOptions({position:new p.default.api.maps.LatLng(e,a)}),p.default.getCenterLat(n)===p.default.defaultLat&&p.default.getCenterLng(n)===p.default.defaultLng&&n.setCenter(new p.default.api.maps.LatLng(e,a))};"High"===a.locationMode?this.locationUpdateListener||(this.locationUpdateListener=v.default.addListener({interval:200,maximumAge:200,enableHighAccuracy:!0,callback:function(e){return r(e.coords.latitude,e.coords.longitude)}})):(v.default.fetchLatLong(r),this.stopWatchingLocation())}else null!=t&&t.setMap(null)}},{key:"updateDraggablePins",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.props,a=t.state.pendingPins||[],i=n.draggablePinEventHandlers||{},o=[];c.default.zip(e,a).forEach((function(e,a){var l=(0,r.default)(e,2),u=l[0],s=l[1];u?function(){var e=c.default.extend({draggable:!0,map:t.map,position:u},n.draggablePinOptions),r=s||new p.default.api.maps.Marker;r.setOptions(e),p.default.api.maps.event.clearInstanceListeners(r);var l=function(e){var n=i[e],o=r.addListener(e,(function(e){n(e,r,t.map,p.default.api,a)}));t.registerListener(o)};for(var d in n.draggablePinEventHandlers)l(d);o.push(r)}():s.setMap(null)})),t.setState({pendingPins:o})}},{key:"updateDraggablePin",value:function(e){var t=this.props,n=e.state.draggablePin,a=t.draggablePinEventHandlers,r=t.draggablePinCoordinates,i=t.draggablePinOptions||{},o=e.map;if(a&&!r){if(null==n){var l={url:"https://www.appsheet.com/content/img/pageart/draggable-pin-white-2x.png",size:new p.default.api.maps.Size(44,78),scaledSize:new p.default.api.maps.Size(33,58.5),anchor:new p.default.api.maps.Point(16.5,58.5)};n=new p.default.api.maps.Marker({icon:l,animation:p.default.api.maps.Animation.BOUNCE,position:o.center,draggable:!0,map:o}),e.setState({draggablePin:n})}null!=i.latitude&&null!=i.longitude&&n.setPosition(new p.default.api.maps.LatLng(i.latitude,i.longitude));var u=function(t){var r=a[t],i=n.addListener(t,(function(e){r(e,n,o,p.default.api)}));e.registerListener(i)};for(var s in a)u(s)}else null!=n&&(n.setMap(null),e.setState({draggablePin:null}),n=null)}},{key:"filterAndSortLayerItems",value:function(e,t,n){var a,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(c.default.get(e,"mapItems.length"),new Map);if(!r){var o=this.mapInstance.map.getBounds(),l=o.getNorthEast();a=1.5*k(t,n,l.lat(),l.lng())}e.mapItems=e.mapItems.filter((function(e){var r=k(t,n,e.Latitude,e.Longitude);return(!a||r<a)&&(i.set(e,r),!0)}));var u=function(e,t){var n=i.get(e),a=i.get(t);return n>a?1:n<a?-1:0};y.default.sort(e.mapItems,u)}},{key:"updatePins",value:function(e,t){for(var n=this,a=this.props,r=a.appModel||T.AppGlobals.AppModel,i=t.tableName,o=t.mapColumn,l=t.mapItems,u=t.defaultFormatting,s=r&&r.findTableCollection(i).table,d=a.selectedItem,h=d?d.Id:null,m=a.pinEventHandlers||{},g={},y={},b=0;b<l.length&&b<this.maxPins(a);b++){var S=l[b];g[S.Id]=S;var A=void 0;S.Hash in y&&(A=y[S.Hash]||(0,f.default)(S.Hash),S.Latitude+=3e-4*(A()-.5),S.Longitude+=3e-4*(A()-.5),S.Hash=v.default.hashLatLng(S.Latitude,S.Longitude)),y[S.Hash]=A}var E,w=[],C=[],O=a.selectedTable||(a.table?a.table.name():""),_=a.selectedColumn||a.mapColumn,k=function(t){var a=g[t],r=s&&s.lookupTableRow(t),l=r&&r.getColumnFormatting(o),d=c.default.extend({},u,l),f=v.default.normalizeLatOrLng(a.Latitude),y=v.default.normalizeLatOrLng(a.Longitude),b=p.default.makePinCacheKey(i,o,t,d),T=e[b];if(T)delete e[b],w.push(T);else{var S=p.default.getPin(d,a);T=S.pin,S.created,p.default.cacheMountedPin(n.mapInstance.id,b,T),C.push(T)}null==f||null==y||null!=T.position&&T.position.lat()===f&&T.position.lng()===y||T.setPosition({lat:f,lng:y});var A=function(e){var t=m[e],a=T.addListener(e,(function(e){t(e,T,p.default.api)}));n.mapInstance.registerListener(a)};for(var k in m)A(k);T.appsheetItem=a,null!=h&&h===t&&O===i&&_===o&&(E=T)};for(var R in g)k(R);return{pinsToAdd:C,pinsToShow:w,selectedPin:E}}}]),n}(d.default.Component);function _(e,t){var n=parseInt(e.slice(1),16),a=t<0?0:255,r=t<0?-1*t:t,i=n>>16,o=n>>8&255,l=255&n;return"#"+(16777216+65536*(Math.round((a-i)*r)+i)+256*(Math.round((a-o)*r)+o)+(Math.round((a-l)*r)+l)).toString(16).slice(1)}function k(e,t,n,a){var r=Math.abs(a-t),i=Math.min(r,360-r);return Math.pow(n-e,2)+Math.pow(i,2)}function R(e,t,n){if(!n){var a=document.createElement("canvas").getContext("2d");n=(window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1)}var r=document.createElement("canvas");return r.width=e*n,r.height=t*n,r.style.width=e+"px",r.style.height=t+"px",r.getContext("2d").setTransform(n,0,0,n,0,0),r}function I(e,t){return"data:image/svg+xml;base64,"+window.btoa('\n        <svg\n        xmlns:dc="http://purl.org/dc/elements/1.1/"\n        xmlns:cc="http://creativecommons.org/ns#"\n        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n        xmlns:svg="http://www.w3.org/2000/svg"\n        xmlns="http://www.w3.org/2000/svg"\n        id="svg8"\n        version="1.1"\n        viewBox="0 0 5.2916665 7.2680725"\n        height="'.concat(1.373494*t,'"\n        width="').concat(t,'">\n        <defs id="defs2">\n        </defs>\n        <g\n            transform="translate(-99.991578,-200.12094)"\n            id="layer1">\n    <path\n       d="m 103.704,205.33857 c 0.63411,-0.57806 1.35611,-1.33382 1.35611,-2.41032 0,-1.40729 -1.08027,-2.54809 -2.42268,-2.54809 -1.34243,0 -2.4227,1.1408 -2.4227,2.54809 0,1.0765 0.722,1.83226 1.35611,2.41032 1.10843,1.01046 0.62534,1.81113 1.06659,1.81113 0.44124,0 -0.0418,-0.80067 1.06657,-1.81113 z"\n       style="opacity:1;fill:').concat(e,';fill-opacity:0.98016998;stroke:#ffffff;stroke-width:0.26;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       id="path879" />\n        </g>\n        </svg>\n    '))}O.defaultProps={labelSize:22,mapOptions:{},showCurrentLocation:!0};var N={};function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=t+e;return N[n]=N[n]||I(e,t),N[n]}var D={};function L(e){var t=e.appsheetFormatting;return t?t.highlightColor||t.textColor||t.color:T.AppGlobals.ViewManager.theme.getThemeColor("actionIcon")}var P=O;t.default=P},685650:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.preloadForOffline=function(){d.default.whenReady((function(){v||(v=new f.default({state:{appModel:p.AppGlobals.AppModel,appState:p.AppGlobals.AppState},render:function(e){return s.default.createElement(m,e)}}),setTimeout((function(){v.setState({showMap:!0})}),1e3),setTimeout((function(){v.setState({showMap:!1})}),3e3),$("body").append(v.$el))}))};var r=a(n(856690)),i=a(n(689728)),o=a(n(861655)),l=a(n(994993)),u=a(n(73808)),s=a(n(667294)),c=a(n(368142)),d=a(n(152200)),f=a(n(523930)),p=n(166089);function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,l.default)(this,n)}}var v,m=function(e){(0,o.default)(n,e);var t=h(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,i.default)(n,[{key:"render",value:function(){return s.default.createElement("div",{className:"PreloadGoogleMap"},s.default.createElement(c.default,Object.assign({},this.props,{showCurrentLocation:!1})))}}]),n}(s.default.Component)},50295:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.Toasts=t.MLKitWarningToast=t.MLKitUnsupportedToast=t.DeprecationWarningToast=void 0;var r=a(n(667294)),i=n(902770),o=a(n(572063)),l=a(n(21870)),u=n(202079),s=n(56749),c=n(400078),d=a(n(571524)),f=a(n(587191)),p=n(351101),h=function(){return d.default.InAndroidWebView()?"https://play.google.com/store/apps/details?id=x1Trackmaster.x1Trackmaster":d.default.InIOSWebView()?"https://apps.apple.com/us/app/appsheet/id732548900":""},v=(0,i.makeStyles)({alert:{padding:"8px 32px 16px 16px",width:"480px",maxWidth:"90vw",fontSize:"0.9rem"},header:{fontSize:"1.2rem"},alertDialog:{width:"320px",maxWidth:"90vw",fontSize:"0.9rem"},alertDialogCenterColumn:{display:"flex",flexDirection:"column",height:"100%",marginTop:"8px"},alertDialogContent:{flexGrow:1,padding:"8px 0px"}});function m(e){var t=e.children,n=e.isOpen,a=e.close,o=e.autoHideDuration,l=e.anchorOrigin;return r.default.createElement(s.ASThemeProvider,null,r.default.createElement(i.Snackbar,{anchorOrigin:l,open:n,autoHideDuration:o,onClose:a},t))}var g=(0,u.observer)((function(){var e=v();if(l.default.toasts.length){var t=l.default.toasts[0],n=t.config,a=t.contentProps,i=void 0===a?{}:a,o=n.autoHideDuration,u=n.anchorOrigin,s=n.renderContent;return r.default.createElement(m,{isOpen:!0,close:l.default.dismissToast,autoHideDuration:o,anchorOrigin:u},s(i,e))}return r.default.createElement(m,{isOpen:!1})}));function y(e){var t=e.title,n=e.content,a=e.onClick,i=void 0===a?l.default.dismissToast:a,u=v();return r.default.createElement(c.Alert,{className:u.alert,severity:"error",icon:r.default.createElement(o.default,{fontSize:"large"}),onClick:i},t&&r.default.createElement(c.AlertTitle,{className:u.header},t),n)}t.Toasts=g;var b={config:{anchorOrigin:{vertical:"top",horizontal:"center"},renderContent:function(){var e=r.default.createElement(r.default.Fragment,null,"Your barcode scanner will stop working within a few days. To continue using the scanner ",r.default.createElement(i.Link,{underline:"always",href:h()},"please update AppSheet"),"."),t=d.default.IsWhitelabelBrowser()?"Your barcode scanner will stop working within a few days. To avoid this, please reach out to the admin of this app to get an update.":e;return r.default.createElement(y,{title:"You are using an outdated app version.",content:t})}}};t.MLKitWarningToast=b;var T={config:{anchorOrigin:{vertical:"top",horizontal:"center"},renderContent:function(){var e=r.default.createElement(r.default.Fragment,null,"Your barcode scanner is no longer supported. To continue using the scanner ",r.default.createElement(i.Link,{underline:"always",href:h()},"please update AppSheet"),"."),t=d.default.IsWhitelabelBrowser()?"Your barcode scanner is no longer supported. To continue using the scanner, please reach out to the admin of this app to get an update.":e;return r.default.createElement(y,{title:"You are using an outdated app version.",content:t})}}};t.MLKitUnsupportedToast=T;var S={config:{anchorOrigin:{vertical:"top",horizontal:"center"},renderContent:function(e,t){var n=(0,p.mapActionName)("App update available"),a=(0,p.mapActionName)("You're using an older version of the app. To update the app, contact the app owner."),o=(0,p.mapActionName)("A new version of AppSheet is available");return r.default.createElement("div",null,r.default.createElement(c.Alert,{className:t.alertDialog,severity:"warning",icon:r.default.createElement(f.default,{fontSize:"large"})},r.default.createElement("div",{className:t.alertDialogCenterColumn},r.default.createElement(c.AlertTitle,{className:t.header},n),r.default.createElement(i.DialogContent,{className:t.alertDialogContent},d.default.IsWhitelabelBrowser()?a:o),r.default.createElement(i.DialogActions,null,d.default.IsWhitelabelBrowser()?r.default.createElement(i.Button,{onClick:l.default.dismissToast},"OK"):r.default.createElement(r.default.Fragment,null,r.default.createElement(i.Button,{onClick:l.default.dismissToast},"Not now"),r.default.createElement(i.Button,{onClick:function(){return window.InputHandler.switchToUrl(h(),!0)}},"Update"))))))}}};t.DeprecationWarningToast=S},646514:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GOOGLE_THEME_ERROR_DARK_HOVER_OR_FOCUS=t.GOOGLE_THEME_ERROR_DARK=t.GOOGLE_SURFACE_LIGHT=t.GOOGLE_SURFACE_DARK=t.GOOGLE_RED_900=t.GOOGLE_RED_800=t.GOOGLE_RED_700=t.GOOGLE_RED_600=t.GOOGLE_RED_500=t.GOOGLE_RED_50=t.GOOGLE_RED_400=t.GOOGLE_RED_300=t.GOOGLE_RED_200=t.GOOGLE_RED_100=t.GOOGLE_RED=t.GOOGLE_PURPLE_900=t.GOOGLE_PURPLE_800=t.GOOGLE_PURPLE_700=t.GOOGLE_PURPLE_600=t.GOOGLE_PURPLE_500=t.GOOGLE_PURPLE_50=t.GOOGLE_PURPLE_400=t.GOOGLE_PURPLE_300=t.GOOGLE_PURPLE_200=t.GOOGLE_PURPLE_100=t.GOOGLE_PINK_900=t.GOOGLE_PINK_800=t.GOOGLE_PINK_700=t.GOOGLE_PINK_600=t.GOOGLE_PINK_500=t.GOOGLE_PINK_50=t.GOOGLE_PINK_400=t.GOOGLE_PINK_300=t.GOOGLE_PINK_200=t.GOOGLE_PINK_100=t.GOOGLE_ORANGE_900=t.GOOGLE_ORANGE_800=t.GOOGLE_ORANGE_700=t.GOOGLE_ORANGE_600=t.GOOGLE_ORANGE_500=t.GOOGLE_ORANGE_50=t.GOOGLE_ORANGE_400=t.GOOGLE_ORANGE_300=t.GOOGLE_ORANGE_200=t.GOOGLE_ORANGE_100=t.GOOGLE_GREY_900=t.GOOGLE_GREY_800=t.GOOGLE_GREY_700=t.GOOGLE_GREY_600=t.GOOGLE_GREY_500=t.GOOGLE_GREY_50=t.GOOGLE_GREY_400=t.GOOGLE_GREY_300=t.GOOGLE_GREY_200=t.GOOGLE_GREY_100=t.GOOGLE_GREEN_900=t.GOOGLE_GREEN_800=t.GOOGLE_GREEN_700=t.GOOGLE_GREEN_600=t.GOOGLE_GREEN_500=t.GOOGLE_GREEN_50=t.GOOGLE_GREEN_400=t.GOOGLE_GREEN_300=t.GOOGLE_GREEN_200=t.GOOGLE_GREEN_100=t.GOOGLE_GREEN=t.GOOGLE_DARK_ELEVATION4=t.GOOGLE_DARK_ELEVATION3=t.GOOGLE_DARK_ELEVATION2=t.GOOGLE_DARK_ELEVATION=t.GOOGLE_CYAN_900=t.GOOGLE_CYAN_800=t.GOOGLE_CYAN_700=t.GOOGLE_CYAN_600=t.GOOGLE_CYAN_500=t.GOOGLE_CYAN_50=t.GOOGLE_CYAN_400=t.GOOGLE_CYAN_300=t.GOOGLE_CYAN_200=t.GOOGLE_CYAN_100=t.GOOGLE_BLUE_900=t.GOOGLE_BLUE_800=t.GOOGLE_BLUE_700=t.GOOGLE_BLUE_600=t.GOOGLE_BLUE_500=t.GOOGLE_BLUE_50=t.GOOGLE_BLUE_400=t.GOOGLE_BLUE_300=t.GOOGLE_BLUE_200=t.GOOGLE_BLUE_100=t.GOOGLE_BLUE=t.GOOGLE_BLACK=t.DARK_STATE_HOVER_SELECTED=t.DARK_STATE_HOVER=t.DARK_STATE_FOCUS=t.DARK_ELEVATION4=t.DARK_ELEVATION3=t.DARK_ELEVATION2=t.DARK_ELEVATION=t.BLACK=void 0,t.SURFACE_DARK=t.STATE_HOVER_SELECTED=t.STATE_HOVER=t.STATE_FOCUS=t.SECONDARY_TEXT_COLOR=t.LIGHT_GREY=t.LIGHT_ELEVATION4=t.LIGHT_ELEVATION3=t.LIGHT_ELEVATION2=t.LIGHT_ELEVATION=t.GOOGLE_YELLOW_900=t.GOOGLE_YELLOW_800=t.GOOGLE_YELLOW_700=t.GOOGLE_YELLOW_600=t.GOOGLE_YELLOW_500=t.GOOGLE_YELLOW_50=t.GOOGLE_YELLOW_400=t.GOOGLE_YELLOW_300=t.GOOGLE_YELLOW_200=t.GOOGLE_YELLOW_100=t.GOOGLE_YELLOW=t.GOOGLE_WHITE=t.GOOGLE_THEME_WARNING_LIGHT=t.GOOGLE_THEME_WARNING_DARK=t.GOOGLE_THEME_INFO_LIGHT=t.GOOGLE_THEME_INFO_DARK=t.GOOGLE_THEME_ERROR_LIGHT_HOVER_OR_FOCUS=t.GOOGLE_THEME_ERROR_LIGHT=void 0;t.GOOGLE_BLUE_50="#e8f0fe";t.GOOGLE_BLUE_100="#d2e3fc";t.GOOGLE_BLUE_200="#aecbfa";t.GOOGLE_BLUE_300="#8ab4f8";t.GOOGLE_BLUE_400="#669df6";t.GOOGLE_BLUE_500="#4285f4";var n="#1a73e8";t.GOOGLE_BLUE_600=n;t.GOOGLE_BLUE_700="#1967d2";t.GOOGLE_BLUE_800="#185abc";t.GOOGLE_BLUE_900="#174ea6";t.GOOGLE_BLUE="#1a73e8";t.GOOGLE_RED_50="#fce8e6";t.GOOGLE_RED_100="#fad2cf";t.GOOGLE_RED_200="#f6aea9";t.GOOGLE_RED_300="#f28b82";t.GOOGLE_RED_400="#ee675c";t.GOOGLE_RED_500="#ea4335";var a="#d93025";t.GOOGLE_RED_600=a;t.GOOGLE_RED_700="#c5221f";t.GOOGLE_RED_800="#b31412";t.GOOGLE_RED_900="#a50e0e";t.GOOGLE_RED="#d93025";t.GOOGLE_YELLOW_50="#fef7e0";t.GOOGLE_YELLOW_100="#feefc3";t.GOOGLE_YELLOW_200="#fde293";t.GOOGLE_YELLOW_300="#fdd663";t.GOOGLE_YELLOW_400="#fcc934";t.GOOGLE_YELLOW_500="#fbbc04";var r="#f9ab00";t.GOOGLE_YELLOW_600=r;t.GOOGLE_YELLOW_700="#f29900";t.GOOGLE_YELLOW_800="#ea8600";t.GOOGLE_YELLOW_900="#e37400";t.GOOGLE_YELLOW="#f9ab00";t.GOOGLE_GREEN_50="#e6f4ea";t.GOOGLE_GREEN_100="#ceead6";t.GOOGLE_GREEN_200="#a8dab5";t.GOOGLE_GREEN_300="#81c995";t.GOOGLE_GREEN_400="#5bb974";t.GOOGLE_GREEN_500="#34a853";var i="#1e8e3e";t.GOOGLE_GREEN_600=i;t.GOOGLE_GREEN_700="#188038";t.GOOGLE_GREEN_800="#137333";t.GOOGLE_GREEN_900="#0d652d";t.GOOGLE_GREEN="#1e8e3e";var o="#fff";t.GOOGLE_WHITE=o;var l="#f8f9fa";t.GOOGLE_GREY_50=l;t.GOOGLE_GREY_100="#f1f3f4";t.GOOGLE_GREY_200="#e8eaed";t.GOOGLE_GREY_300="#dadce0";t.GOOGLE_GREY_400="#bdc1c6";t.GOOGLE_GREY_500="#9aa0a6";t.GOOGLE_GREY_600="#80868b";t.GOOGLE_GREY_700="#5f6368";t.GOOGLE_GREY_800="#3c4043";var u="#202124";t.GOOGLE_GREY_900=u;t.LIGHT_GREY="#E1E3E1";t.GOOGLE_BLACK="#202124";t.BLACK="#000";t.GOOGLE_ORANGE_50="#feefe3";t.GOOGLE_ORANGE_100="#fedfc8";t.GOOGLE_ORANGE_200="#fdc69c";t.GOOGLE_ORANGE_300="#fcad70";t.GOOGLE_ORANGE_400="#fa903e";t.GOOGLE_ORANGE_500="#fa7b17";t.GOOGLE_ORANGE_600="#e8710a";t.GOOGLE_ORANGE_700="#d56e0c";t.GOOGLE_ORANGE_800="#c26401";t.GOOGLE_ORANGE_900="#b06000";t.GOOGLE_PINK_50="#fde7f3";t.GOOGLE_PINK_100="#fdcfe8";t.GOOGLE_PINK_200="#fba9d6";t.GOOGLE_PINK_300="#ff8bcb";t.GOOGLE_PINK_400="#ff63b8";t.GOOGLE_PINK_500="#f439a0";t.GOOGLE_PINK_600="#e52592";t.GOOGLE_PINK_700="#c92786";t.GOOGLE_PINK_800="#b80672";t.GOOGLE_PINK_900="#9c166b";t.GOOGLE_PURPLE_50="#f3e8fd";t.GOOGLE_PURPLE_100="#e9d2fd";t.GOOGLE_PURPLE_200="#d7aefb";t.GOOGLE_PURPLE_300="#c58af9";t.GOOGLE_PURPLE_400="#af5cf7";t.GOOGLE_PURPLE_500="#a142f4";t.GOOGLE_PURPLE_600="#9334e6";t.GOOGLE_PURPLE_700="#8430ce";t.GOOGLE_PURPLE_800="#7627bb";t.GOOGLE_PURPLE_900="#681da8";t.GOOGLE_CYAN_50="#e4f7fb";t.GOOGLE_CYAN_100="#cbf0f8";t.GOOGLE_CYAN_200="#a1e4f2";t.GOOGLE_CYAN_300="#78d9ec";t.GOOGLE_CYAN_400="#4ecde6";t.GOOGLE_CYAN_500="#24c1e0";t.GOOGLE_CYAN_600="#12b5cb";t.GOOGLE_CYAN_700="#129eaf";t.GOOGLE_CYAN_800="#098591";t.GOOGLE_CYAN_900="#007b83";t.STATE_HOVER="rgba(95, 99, 104, 0.04)";t.STATE_FOCUS="rgba(95, 99, 104, 0.12)";t.STATE_HOVER_SELECTED="rgba(95, 99, 104, 0.18)";t.DARK_STATE_HOVER="rgb(241, 243, 244, 0.04)";t.DARK_STATE_FOCUS="rgba(241, 243, 244, 0.12)";t.DARK_STATE_HOVER_SELECTED="rgba(241, 243, 244, 0.18)";t.GOOGLE_SURFACE_LIGHT="#f8f9fa";t.LIGHT_ELEVATION="#fff";t.LIGHT_ELEVATION2="#fff";t.LIGHT_ELEVATION3="#fff";t.LIGHT_ELEVATION4="#fff";t.GOOGLE_SURFACE_DARK="#202124";t.GOOGLE_DARK_ELEVATION="#292a2d";t.GOOGLE_DARK_ELEVATION2="#2f3034";t.GOOGLE_DARK_ELEVATION3="#35373a";t.GOOGLE_DARK_ELEVATION4="#37393c";t.SURFACE_DARK="#121212";t.DARK_ELEVATION="#1d1d1d";t.DARK_ELEVATION2="#252525";t.DARK_ELEVATION3="#2c2c2c";t.DARK_ELEVATION4="#2e2e2e";t.GOOGLE_THEME_INFO_LIGHT="#e8f4fd";t.GOOGLE_THEME_WARNING_LIGHT="#fff4e5";t.GOOGLE_THEME_ERROR_LIGHT="#fdecea";t.GOOGLE_THEME_ERROR_LIGHT_HOVER_OR_FOCUS="#fad7d2";t.GOOGLE_THEME_INFO_DARK="rgba(100, 181, 246, .24)";t.GOOGLE_THEME_WARNING_DARK="rgba(255, 213, 79, .24)";t.GOOGLE_THEME_ERROR_DARK="rgba(229, 115, 115, .24)";t.GOOGLE_THEME_ERROR_DARK_HOVER_OR_FOCUS="rgba(229, 115, 115, .20)";t.SECONDARY_TEXT_COLOR="rgba(0, 0, 0, 0.54)"},343611:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var r=a(n(600861)),i=a(n(856690)),o=a(n(689728)),l=a(n(627424)),u=a(n(888861)),s=n(740127);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var f=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function p(e,t){var n=(0,l.default)(e,3),a=n[1],r=n[2],i=t.findAttributeByName(a),o=(0,s.getFilterForAttribute)(i);if(null===o)return null;var u={filterType:o,attribute:i,tableSchema:t,state:r};return Object.freeze(u),u}var h=function(){function e(t,n){if((0,i.default)(this,e),this.tableSchema=n,n){this.filters=[];var a,r=c(t);try{for(r.s();!(a=r.n()).done;){var o=a.value;if(Array.isArray(o)){var l=p(o,n);null!==l&&this.filters.push(l)}else this.filters.push(o)}}catch(e){r.e(e)}finally{r.f()}}else this.filters=[];Object.freeze(this.filters),Object.freeze(this)}return(0,o.default)(e,[{key:"toExpression",value:function(){return this.tableSchema?u.default.createAnd.apply(u.default,(0,r.default)(this.filters.map((function(e){var t=e.filterType,n=f(e,["filterType"]);return t.toExpression(n)})))):null}},{key:"serialize",value:function(){return this.tableSchema?this.filters.filter((function(e){var t=e.filterType,n=f(e,["filterType"]);return!t.isEmpty(n)})).map((function(e){var t=e.attribute,n=e.state;return["attribute",t.name(),n]})):[]}},{key:"cloneAndRemoveEmptyFilters",value:function(){if(!this.tableSchema)return this;var e=this.filters.filter((function(e){var t=e.filterType,n=f(e,["filterType"]);return!t.isEmpty(n)}));return this.clone(e)}},{key:"clone",value:function(t){return new e(t,this.tableSchema)}},{key:"withFilterApplied",value:function(e,t){var n=this.tableSchema;if(!n)return this;var a=e.name(),r=(0,s.getFilterForAttribute)(e);if(null===r)throw new Error("cannot filter unsupported attribute ".concat(a));var i,o={filterType:r,attribute:e,tableSchema:n,state:t},l=[],u=!1,d=c(this.filters);try{for(d.s();!(i=d.n()).done;){var f=i.value;f.attribute.name()!==a?l.push(f):(l.push(o),u=!0)}}catch(e){d.e(e)}finally{d.f()}return u||l.push(o),this.clone(l)}}]),e}();t.Query=h},740127:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeMap=void 0,t.getFilterForAttribute=function(e){return p(e.type())},t.getFilterForType=p;var a=n(469255),r=n(278036),i=n(287291),o=n(768609),l=n(497629),u=n(896197),s=n(550372),c=n(984213),d=n(34650),f={Text:u.TextFilter,Enum:i.EnumFilter,EnumList:o.EnumListFilter,LongText:u.TextFilter,Name:u.TextFilter,ChangeCounter:s.NumericFilter,Number:s.NumericFilter,PostalCode:u.TextFilter,Address:u.TextFilter,LatLong:c.LatLongFilter,ChangeLocation:c.LatLongFilter,DateTime:d.DateTimeFilter,ChangeTimestamp:d.DateTimeFilter,Percent:s.NumericFilter,Decimal:s.NumericFilter,Price:s.NumericFilter,Url:u.TextFilter,File:l.FileFilter,Image:l.FileFilter,Drawing:l.FileFilter,Signature:l.FileFilter,Thumbnail:l.FileFilter,Video:l.FileFilter,Date:d.DateTimeFilter,Time:d.DateTimeFilter,Email:u.TextFilter,Phone:u.TextFilter,Color:i.EnumFilter,Progress:i.EnumFilter,Ref:r.RefFilter,"Yes/No":a.BooleanFilter};function p(e){return f[e]||null}t.TypeMap=f},319598:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.HIDE_FILTERS_FOR_VIEWS=void 0,t.getFilterQuery=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{if(t&&!l.has(e||"")){var a=(0,i.getAppModel)(),u=(null==a?void 0:a.findTableCollection(t))||{},s=u.tableSchema;return new o.Query(n,s)}}catch(e){r.default.ReportError({errorMessage:"Error in getFilterQuery",error:e})}return new o.Query([])};var r=a(n(593186)),i=n(351101),o=n(343611),l=new Set(["dashboard","detail","form","search"]);t.HIDE_FILTERS_FOR_VIEWS=l},469255:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.BooleanFilter=void 0;var r=a(n(385857)),i=n(351101),o=n(287291),l=Object.assign(Object.assign({},o.EnumFilter),{labelValue:function(e){var t=e.attribute,n=e.tableSchema,a=e.value,o=(0,i.getAppModel)(),l=new r.default(o,n),u=t.booleanTypeLabels(l),s=t.valueFromWireFormat(a);return!0===s?u.yesLabel:!1===s?u.noLabel:null===s?(0,i.mapActionName)("(empty)"):a},stateKeyToRealValue:function(e){return"true"===e?"TRUE":"false"===e?"FALSE":"null"===e?"":e}});t.BooleanFilter=l},740365:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ContinuousFilter=void 0;var r=a(n(238416)),i=a(n(918698)),o=a(n(667294)),l=n(902770),u=a(n(888861)),s=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},c=function(){throw new Error("unimplemented abstract static method")},d={valueIsValid:c,ValueEditor:c,valueToNumber:Number,valueToString:function(e,t){return t.localizeWireValue(e)},valueToExpression:function(e,t){return u.default.createConstantValue(e,t.type(),t.auxData())},initialState:function(){return{}},isValid:function(e){var t=e.state,n=e.attribute;return"object"===(0,i.default)(t)&&!Array.isArray(t)&&Object.keys(t).every((function(e){return"start"===e||"end"===e}))&&Object.keys(t).length<=2&&(void 0===t.start||this.valueIsValid(t.start,n))&&(void 0===t.end||this.valueIsValid(t.end,n))&&!(void 0!==t.start&&void 0!==t.end&&this.valueIsValid(t.start,n)&&this.valueIsValid(t.end,n)&&this.valueToNumber(t.end,n)<this.valueToNumber(t.start,n))},isEmpty:function(e){var t=e.state;return void 0===t.start&&void 0===t.end},toExpression:function(e){var t=e.state,n=e.tableSchema,a=e.attribute,r=[],i=u.default.createColumnLookup(n,a);return void 0!==t.start&&r.push(u.default.create({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"GreaterThanOrEquals",IsAtomic:!0,Children:[i.model,this.valueToExpression(t.start,a).model]})),void 0!==t.end&&r.push(u.default.create({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"LessThanOrEquals",IsAtomic:!0,Children:[i.model,this.valueToExpression(t.end,a).model]})),u.default.createAnd.apply(u.default,r)},activeFilterValues:function(e){var t=e.state,n=e.attribute,a="",r=void 0!==t.start?this.valueToString(t.start,n):null,i=void 0!==t.end?this.valueToString(t.end,n):null;return null!==r&&null!==i?a="".concat(r," – ").concat(i):null!==r?a="≥ ".concat(r):null!==i&&(a="≤ ".concat(i)),[a]},Summary:function(e){var t=e.self,n=s(e,["self"]),a=t.activeFilterValues(n).toString();return o.default.createElement(o.default.Fragment,null,a)},Editor:function(e){var t=e.self,n=e.state,a=e.onChange,i=e.onClose,u=e.attribute,s=t.ValueEditor,c=function(e){return function(t){return a(Object.assign(Object.assign({},n),(0,r.default)({},e,t)))}};return o.default.createElement(l.Grid,{container:!0,spacing:2},o.default.createElement(s,{bound:"start",value:n.start,onChange:c("start"),onClose:i,attribute:u}),o.default.createElement(s,{bound:"end",value:n.end,onChange:c("end"),onClose:i,attribute:u}))}};t.ContinuousFilter=d},34650:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimeFilter=void 0;var r=a(n(667294)),i=n(101225),o=a(n(775916)),l=n(740365),u=n(902770),s=a(n(365914)),c=n(351101);function d(e,t){switch(t.type()){case"Time":return s.default.toLocaleTimeString(e,!0);case"Date":return s.default.toLocaleDateString(e,!1);case"DateTime":case"ChangeTimestamp":return s.default.localizeDateTime(e,!0,!1)}return""}var f=Object.assign(Object.assign({},l.ContinuousFilter),{valueIsValid:function(e,t){return!isNaN(this.valueToNumber(e,t))},valueToNumber:function(e,t){return t.valueFromWireFormat(e).getTime()},valueToString:function(e,t){return d(t.valueFromWireFormat(e),t)},Summary:function(e){var t=e.self,n=e.state,a=e.attribute,i="",o=void 0!==n.start?t.valueToString(n.start,a):null,l=void 0!==n.end?t.valueToString(n.end,a):null;return null!==o&&null!==l?i="".concat(o," – ").concat(l):null!==o?i="after ".concat(o):null!==l&&(i="before ".concat(l)),r.default.createElement(r.default.Fragment,null,i)},ValueEditor:function(e){var t,n,a=e.bound,l=e.value,s=e.onChange,f=e.attribute,p=f.type();"Date"===p?(t=i.DatePicker,n=!1):"Time"===p?(t=i.TimePicker,n=!1):(t=i.DateTimePicker,n=!0);var h,v=(0,c.mapActionName)(("start"===a?"Start":"End")+" "+("Time"===p?"time":"date"));return r.default.createElement(u.Grid,{item:!0,xs:n?12:6},r.default.createElement(i.MuiPickersUtilsProvider,{utils:o.default},r.default.createElement(t,{inputVariant:"outlined",labelFunc:function(e){return e?d(e.toDate(),f):""},value:l?f.valueFromWireFormat(l):null,onChange:function(e){return s(e?f.valueToWireFormat(e.toDate()):void 0)},label:v,initialFocusedDate:(h=new Date,h.setHours(12),h.setMinutes(0),h.setSeconds(0),h.setMilliseconds(0),h),cancelLabel:(0,c.mapActionName)("Cancel"),clearLabel:(0,c.mapActionName)("Clear"),okLabel:(0,c.mapActionName)("OK"),todayLabel:(0,c.mapActionName)("Today"),clearable:!0,fullWidth:!0})))}});t.DateTimeFilter=f},287291:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.EnumFilter=void 0,t.checkboxChangeHandler=y;var i=a(n(627424)),o=a(n(600861)),l=a(n(918698)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(667294)),s=a(n(3674)),c=n(902770),d=a(n(888861)),f=n(351101),p=n(240684);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var g=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function y(e,t,n){return function(a){var r=Object.assign({},e);if(a.target.checked){var i,o=v(n);try{for(o.s();!(i=o.n()).done;){r[i.value]=!0}}catch(e){o.e(e)}finally{o.f()}}else{var l,u=v(n);try{for(u.s();!(l=u.n()).done;){delete r[l.value]}}catch(e){u.e(e)}finally{u.f()}}t(r)}}var b={allowedValues:function(e){var t,n,a,r=e.attribute,i=e.tableSchema,o=i.sourceTableName(),l=null===(t=(0,f.getAppModel)())||void 0===t?void 0:t.findTableCollection(o).table,u=null===(n=null==l?void 0:l.indexedTableRows())||void 0===n?void 0:n.getIndex(r),s={},c=v(((null==u?void 0:u.distinctValues())||[]).map((function(e){var t=u.lookup(e).allRows()[0],n=null==t?void 0:t.values[r.name()];return null!=n?n:e})));try{for(c.s();!(a=c.n()).done;){var d=a.value,p=this.labelValue({attribute:r,tableSchema:i,value:d});s[p]=s[p]||[],s[p].push(d)}}catch(e){c.e(e)}finally{c.f()}return s},labelValue:p.getLabelValueFromRefRow,isEmpty:function(e){var t=e.state,n=e.tableSchema,a=e.attribute,r=this.allowedValues({attribute:a,tableSchema:n}),i=Object.keys(r).length,o=Object.values(t).filter((function(e){return!0===e})).length;return!(o>0&&o!==i)},initialState:function(){return{}},isValid:function(e){var t=e.state;return"object"===(0,l.default)(t)&&null!==t&&Object.values(t).every((function(e){return"boolean"==typeof e}))},stateKeyToRealValue:function(e){return e},toExpression:function(e){var t=this,n=e.state,a=e.tableSchema,r=e.attribute;return this.isEmpty(e)?null:d.default.createOr.apply(d.default,(0,o.default)(Object.keys(n).filter((function(e){return n[e]})).map((function(e){return d.default.createColFilter(t.stateKeyToRealValue(e),a,r)}))))},activeFilterValues:function(e){for(var t=e.state,n=e.attribute,a=e.tableSchema,r=this.allowedValues({attribute:n,tableSchema:a}),o={},l=0,u=Object.entries(r);l<u.length;l++){var c,d=(0,i.default)(u[l],2),f=d[0],p=v(d[1]);try{for(p.s();!(c=p.n()).done;){var h=c.value;o[h]=f}}catch(e){p.e(e)}finally{p.f()}}return Array.from(new Set((0,s.default)(t).filter((function(e){return t[e]})).map((function(e){return o[e]}))))},Summary:function(e){var t=e.self,n=g(e,["self"]),a=t.activeFilterValues(n).join(", ");return u.default.createElement(u.default.Fragment,null,a)},Editor:function(e){var t,n,a=e.self,r=e.state,l=e.attribute,s=e.tableSchema,d=e.onChange,p=(0,u.useState)(""),h=(0,i.default)(p,2),v=h[0],m=h[1],g=a.allowedValues({attribute:l,tableSchema:s}),b=Object.keys(g).length>10?u.default.createElement(c.TextField,{variant:"outlined",label:(0,f.mapActionName)("Search"),value:v,onChange:function(e){m(e.target.value)}}):null;return v?(t=Object.entries(g).filter((function(e){var t=(0,i.default)(e,2),n=t[0],a=t[1];return[n].concat((0,o.default)(a)).some((function(e){return e.toLowerCase().startsWith(v.toLowerCase())}))})).sort((function(e,t){var n=(0,i.default)(e,2),a=(n[0],n[1]),r=(0,i.default)(t,2),o=(r[0],r[1]);return a.length-o.length})),n=(0,f.mapActionName)("No results")):(t=Object.entries(g),n=(0,f.mapActionName)("No available values")),u.default.createElement(c.FormGroup,null,b,t.map((function(e){var t=(0,i.default)(e,2),n=t[0],a=t[1];return u.default.createElement(c.FormControlLabel,{key:n,control:u.default.createElement(c.Checkbox,{checked:a.some((function(e){return r[e]}))||!1,onChange:y(r,d,a)}),label:n})})),0===t.length?n:null)}};t.EnumFilter=b},768609:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.EnumListFilter=void 0;var r=a(n(600861)),i=a(n(888861)),o=n(287291),l=n(351101),u=n(240684);function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var d=Object.assign(Object.assign({},o.EnumFilter),{toExpression:function(e){var t=this,n=e.state,a=e.tableSchema,o=e.attribute;return this.isEmpty(e)?null:i.default.createAnd.apply(i.default,(0,r.default)(Object.keys(n).filter((function(e){return n[e]})).map((function(e){return i.default.createColFilter(t.stateKeyToRealValue(e),a,o)}))))},labelValue:u.getLabelValueFromRefRow,allowedValues:function(e){var t,n,a,r=e.attribute,i=e.tableSchema,o=i.sourceTableName(),u=null===(t=(0,l.getAppModel)())||void 0===t?void 0:t.findTableCollection(o).table,c=null===(n=null==u?void 0:u.indexedTableRows())||void 0===n?void 0:n.getIndex(r),d=(null==c?void 0:c.distinctValues())||[],f=new Set,p=s(d);try{for(p.s();!(a=p.n()).done;){var h,v=a.value,m=c.lookup(v).allRows()[0],g=null==m?void 0:m.values[r.name()],y=s((null!=g?g:v)?r.splitEnumListValue(null!=g?g:v):[""]);try{for(y.s();!(h=y.n()).done;){var b=h.value;f.add(b)}}catch(e){y.e(e)}finally{y.f()}}}catch(e){p.e(e)}finally{p.f()}var T,S={},A=s(f);try{for(A.s();!(T=A.n()).done;){var E=T.value,w=this.labelValue({attribute:r,tableSchema:i,value:E});S[w]=S[w]||[],S[w].push(E)}}catch(e){A.e(e)}finally{A.f()}return S}});t.EnumListFilter=d},497629:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.FileFilter=void 0;var r=a(n(238416)),i=n(351101),o=a(n(888861)),l=n(287291),u=Object.assign(Object.assign({},l.EnumFilter),{allowedValues:function(){var e;return e={},(0,r.default)(e,(0,i.mapActionName)("Has attachment"),["hasAttachment"]),(0,r.default)(e,(0,i.mapActionName)("No attachment"),["noAttachment"]),e},toExpression:function(e){var t=e.state,n=e.tableSchema,a=e.attribute;if(this.isEmpty(e))return null;var r=o.default.createIsBlank(o.default.createColumnLookup(n,a));return t.hasAttachment?o.default.createNot(r):r}});t.FileFilter=u},984213:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.LatLongFilter=void 0;var r,i,o=a(n(918698)),l=a(n(238416)),u=a(n(667294)),s=n(902770),c=n(888861),d=n(240684),f=n(351101),p=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};!function(e){e.Feet="ft",e.Kilometers="km",e.Meters="m",e.Miles="mi",e.Yards="yd"}(i||(i={}));var h=30.48,v=(r={},(0,l.default)(r,i.Feet,h),(0,l.default)(r,i.Yards,91.44),(0,l.default)(r,i.Miles,160934.4),(0,l.default)(r,i.Meters,100),(0,l.default)(r,i.Kilometers,1e5),r),m=i.Feet,g=(0,s.makeStyles)({distanceTextField:{paddingRight:0},distanceInput:{border:"0 !important"},inputAdornment:{marginLeft:0}}),y=(0,s.withStyles)((function(e){return{root:{padding:e.spacing(1)},input:{"&:focus":{backgroundColor:"transparent"}}}}))(s.InputBase),b={initialState:function(){return{mode:"null"}},isValid:function(e){var t=e.state;return"object"===(0,o.default)(t)&&!Array.isArray(t)&&("null"===t.mode&&1===Object.keys(t).length||"distance"===t.mode&&"number"==typeof t.distance&&t.unit in i)},isEmpty:function(e){var t=e.state;return"null"===t.mode||"distance"===t.mode&&null===t.distance},toExpression:function(e){var t=e.state,n=e.tableSchema,a=e.attribute;if("null"===t.mode)return null;if("distance"===t.mode){var r=t.distance,o=t.unit;if(!r)return null;var l=(0,c.create)({ResultType:"LatLong",EvalType:"FUNCTION",FunctionName:"HERE"}).model,u=(0,c.createColumnLookup)(n,a).model,s=(0,c.create)({ResultType:"Decimal",EvalType:"FUNCTION",FunctionName:"DISTANCE",IsPure:!0,Children:[l,u]}).model,d=(0,c.createConstantValueNative)(r*v[o]/v[i.Kilometers],"Number").model;return(0,c.create)({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"LessThanOrEquals",IsAtomic:!0,Children:[s,d]})}return null},activeFilterValues:function(e){var t=e.state;return"distance"!==t.mode?[]:["within ".concat(t.distance," ").concat(t.unit)]},Summary:function(e){var t=e.self,n=p(e,["self"]),a=t.activeFilterValues(n).join(", ");return u.default.createElement(u.default.Fragment,null,a)},Editor:function(e){var t=e.state,n=e.onChange,a=e.onClose,r=g(),o=function(e,t){n({mode:"distance",distance:e,unit:t})},l=null,c=i.Feet;return"distance"===t.mode&&(l=t.distance,c=t.unit),u.default.createElement(s.Grid,{container:!0,spacing:2},u.default.createElement(s.Grid,{item:!0,xs:12},u.default.createElement(s.TextField,Object.assign({type:"number",label:(0,f.mapActionName)("From current location"),variant:"outlined",autoFocus:!0,value:l||"",onChange:function(e){return function(e){o(Number(e),"distance"===t.mode?t.unit:m)}(e.target.value)}},(0,d.getPressEnterProps)(a),{InputProps:{classes:{root:r.distanceTextField,input:r.distanceInput},endAdornment:u.default.createElement(s.InputAdornment,{position:"end",classes:{root:r.inputAdornment}},u.default.createElement(s.Select,{value:c,onChange:function(e){return function(e){o("distance"===t.mode?t.distance:null,e)}(e.target.value)},input:u.default.createElement(y,null)},Object.values(i).map((function(e){return u.default.createElement(s.MenuItem,{key:e,value:e},e)}))))}}))))}};t.LatLongFilter=b},550372:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.NumericFilter=void 0;var r=a(n(667294)),i=n(902770),o=n(740365),l=n(240684),u=n(351101),s=Object.assign(Object.assign({},o.ContinuousFilter),{valueIsValid:function(e){return"number"==typeof e&&!isNaN(e)},ValueEditor:function(e){var t,n,a=e.attribute,o=e.bound,s=e.value,c=e.onChange,d=e.onClose,f=!0;return"Price"===a.type()&&(t=a.currencySymbol(),f=!1),"Percent"===a.type()&&(n="%",void 0!==s&&(s*=100)),r.default.createElement(i.Grid,{item:!0,xs:f?6:12},r.default.createElement(i.TextField,{type:"number",label:(0,u.mapActionName)("start"===o?"Min":"Max"),variant:"outlined",value:void 0===s?"":s,onChange:function(e){if(""===e.target.value)c(void 0);else{var t=Number(e.target.value);"Percent"===a.type()&&(t/=100),c(t)}},autoFocus:"start"===o,inputProps:(0,l.getPressEnterProps)(d),InputProps:{startAdornment:t?r.default.createElement(i.InputAdornment,{position:"start"},t):null,endAdornment:n?r.default.createElement(i.InputAdornment,{position:"end"},n):null},fullWidth:!0}))}});t.NumericFilter=s},278036:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefFilter=void 0;var a=n(240684),r=n(287291),i=Object.assign(Object.assign({},r.EnumFilter),{labelValue:a.getLabelValueFromRefRow});t.RefFilter=i},896197:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.TextFilter=void 0;var r=a(n(667294)),i=n(902770),o=a(n(888861)),l=n(240684),u=n(351101),s=(0,i.makeStyles)({multiline:{minHeight:"4rem"}}),c=new Set(["LongText","Address"]),d={initialState:function(){return""},isValid:function(e){return e.state.length>0},isEmpty:function(e){return 0===e.state.trim().length},toExpression:function(e){if(this.isEmpty(e))return null;var t=e.tableSchema,n=e.attribute,a=e.state,r=o.default.createColumnLookup(t,n).model,i=o.default.createConstantValue(a,"Text",n.auxData()).model;return o.default.create({ResultType:"Yes/No",EvalType:"FUNCTION",FunctionName:"CONTAINS",Children:[r,i]})},activeFilterValues:function(e){return[e.state]},Summary:function(e){var t,n=e.state;return r.default.createElement(r.default.Fragment,null,null===(t=(0,u.getAppModel)())||void 0===t?void 0:t.MapActionName("Contains")," ",n)},Editor:function(e){var t=e.attribute,n=e.state,a=e.onChange,o=e.onClose,d=s(),f=(0,u.getAppModel)(),p=c.has(t.type()),h=p?{className:d.multiline}:(0,l.getPressEnterProps)(o);return r.default.createElement(i.TextField,{variant:"outlined",label:null==f?void 0:f.MapActionName("Search"),value:n,onChange:function(e){a(e.target.value)},inputProps:h,multiline:p,fullWidth:!0,autoFocus:!0})}};t.TextFilter=d},178314:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLabelValueFromRefRow=function(e){var t,n=e.attribute,l=e.value,u=function(e){var t,n,i,l=a.get(e);if(!l){var u=e.referencedTable()||(null===(t=e.nestedAttribute())||void 0===t?void 0:t.referencedTable()),s=null===(n=null==u?void 0:u.tableSchema.labelBasicAttribute())||void 0===n?void 0:n.name(),c=null==u?void 0:u.keyAttribute();l={index:c&&(null===(i=null==u?void 0:u.indexedTableRows())||void 0===i?void 0:i.getIndex(c)),labelAttributeName:s},a.set(e,l)}return clearTimeout(r),r=setTimeout(o,1e3),l}(n),s=u.index,c=u.labelAttributeName;if(""===l)return(0,i.mapActionName)("(empty)");return(null===(t=null==s?void 0:s.lookup(l).allRows()[0])||void 0===t?void 0:t.get(c))||l};var a,r,i=n(351101);function o(){a=new WeakMap}o()},157614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPressEnterProps=function(e){return{onKeyPress:function(t){"Enter"===t.key&&e()}}}},240684:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getLabelValueFromRefRow",{enumerable:!0,get:function(){return a.getLabelValueFromRefRow}}),Object.defineProperty(t,"getPressEnterProps",{enumerable:!0,get:function(){return r.getPressEnterProps}});var a=n(178314),r=n(157614)},957831:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppState=o,t.getViewSpecificUIState=l,t.useTableSchema=function(){return(0,r.useMemo)(u,[o().CurrentUIState])};var a=n(166089),r=n(667294),i=n(351101);function o(){return a.AppGlobals.AppState}function l(){var e=o();return e.CurrentUIState?e.GetSpecificState(e.CurrentUIState):null}function u(){var e=(0,i.getAppModel)(),t=l(),n=null==t?void 0:t.TableName;return((null==e?void 0:e.findTableCollection(n))||{}).tableSchema}},606610:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.actionTypes=void 0;var i=a(n(627424)),o=a(n(496486)),l=a(n(280129)),u=a(n(687714)),s=a(n(130778)),c=a(n(730381)),d=a(n(962553)),f=a(n(150198)),p=a(n(385857)),h=a(n(593186)),v=a(n(571524)),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=R(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(365914)),g=n(957831),y=n(263198),b=n(635672),T=n(646317),S=n(84690),A=n(166089),E=n(149313),w=n(557310),C=n(783252),O=a(n(819433)),_=n(250617),k=n(29827);function R(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(R=function(e){return e?n:t})(e)}var I,N=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},M="USER_CANCELED";function D(e){return w.ReactRootUIConfig.isReactRoot()?e:(e(),!0)}function L(e){var t="string"==typeof e?e:null==e?void 0:e.responseText;if(o.default.startsWith(t,"{")&&o.default.endsWith(t,"}"))try{var n=JSON.parse(t),a="";return n.Message&&(a+="Message: "+n.Message+"\r\n\r\n"),n.ExceptionType&&(a+="ExceptionType: "+n.ExceptionType+"\r\n\r\n"),n.ExceptionMessage&&(a+="ExceptionMessage: "+n.ExceptionMessage+"\r\n\r\n"),n.ErrorDescription&&(a+="ErrorDescription: "+n.ErrorDescription+"\r\n\r\n"),a}catch(e){var r=e;h.default.ReportErrorOnce({errorMessage:"Error in handleJsonError",error:r})}return null!=t?t:"Failure"}var P=function(e){e!==M&&(h.default.warnToDevConsole("Action Failed: ",e),A.AppGlobals.ViewManager.ShowInfoDialog("Action Failed",e))},G=function(e,t){return t&&t.rootTable()===e?t:e};var x={DELETE_RECORD:{requireValueEvalTree:!1,bulkRunnable:!0,requireDeletePermission:!0,requireUpdatePermission:!1,modifiesData:!0,navigatesApp:!0,navigatesExternal:!1,runAsync:function(e,t,n){var a=n.appModel,r=n.table,i=n.transaction;return new Promise((function(e){var n,l,u,s,c,d=!1,f=!1,p=new Set;t.forEach((function(e){var t=i.delete(r.name(),e);d=d||null!=t,p.add(e)}));var h=null===(l=null===(n=null===window||void 0===window?void 0:window.AppState)||void 0===n?void 0:n.CurrentUIState)||void 0===l?void 0:l.SlideshowUIState;if(h&&p.has(h.RowKey))if(a.ShouldDelaySync()||A.AppGlobals.AppState.IsTopLevel()){var v=A.AppGlobals.ViewManager.KnownHandlers.detail||A.AppGlobals.ViewManager.KnownHandlers.slideshow,m=null===(c=null===(s=null===(u=null==v?void 0:v.RootPage())||void 0===u?void 0:u.data("reactView"))||void 0===s?void 0:s.component)||void 0===c?void 0:c.nearbyRowKey();if(null==m)f=function(){return A.AppGlobals.AppState.ChoosePreviousState()};else{var g=o.default.extend(A.AppGlobals.AppState.CurrentUIState,{SlideshowUIState:o.default.extend(A.AppGlobals.AppState.CurrentUIState.SlideshowUIState,{RowKey:m})});f=function(){return A.AppGlobals.AppState.ReplaceState(g)}}}else f=function(){return A.AppGlobals.AppState.ChoosePreviousState()};e({actionModifiedData:d,actionNavigatedExternal:!1,actionNavigatedApp:f})}))}},EDIT_RECORD:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!0,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,run:function(e,t,n){var a,r=t.table,i=t.sourceTable,o=t.rowId,u=G(r,i),s=null===(a=e.action.ActionDefinition)||void 0===a?void 0:a.DesktopEditBehavior;if(w.ReactRootUIConfig.isInDesktopExperience()&&("Edit in place"===s||null==s)&&n&&function(e,t){if(e){var n=(0,O.default)().getState();return(0,k.createViewStateSelector)(e,k.getViewType)(n)===t}return!1}(n,"detail"))return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:function(){(0,O.default)().dispatch((0,_.mutateViewInEditMode)(n))}};var c="#".concat(l.default.stringify({table:u.name(),row:o,page:"form"}));return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:D((function(){return A.AppGlobals.StateChangeHandler.SwitchApp(c,void 0,void 0,n)}))}}},ADD_RECORD:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,requireAddPermission:!0,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,run:function(e,t,n){var a=t.table,r=t.sourceTable,i=t.defaultValues,o=G(a,r),u="#".concat(l.default.stringify({table:o.name(),page:"form",defaults:i&&JSON.stringify(i)}));return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:D((function(){A.AppGlobals.StateChangeHandler.SwitchApp(u,void 0,void 0,n)}))}}},SET_COLUMN_VALUE:{requireValueEvalTree:!1,bulkRunnable:!0,requireDeletePermission:!1,requireUpdatePermission:!0,modifiesData:!0,navigatesApp:!1,navigatesExternal:!1,runAsync:function(e,t,n,a){var r=n.appModel,l=n.table,u=n.tableSchema,c=n.transaction,d=n.inputParameterValues;return new Promise((function(n){var f,p=!1,v=o.default.compact(t.map((function(e){return l.lookupTableRow(e,c)})));v.length!==t.length&&h.default.warnToDevConsole("some rows were missing",t,v);var m=e.assignments();if(m.length&&v.length){var g=r&&r.inRollout("promptUserAction"),y=o.default.partition(m,(function(e){var t,n,a,r;return g&&!e.valueEvalTree||"PARAM"===(null===(n=null===(t=e.valueEvalTree)||void 0===t?void 0:t.model)||void 0===n?void 0:n.EvalType)&&(!d||void 0===d[null===(r=null===(a=e.valueEvalTree.model)||void 0===a?void 0:a.Name)||void 0===r?void 0:r.toLowerCase()])})),b=(0,i.default)(y,2),T=b[0],S=b[1],E=function(){for(var e,t=0;t<v.length;t++){var n=void 0,r=!1,i=l.getPendingRow(v[t],c),o=i.dataContext.augmentWith(a,c),s=o.inputParameterValues;o.inputParameterValues=d,S.length>1&&c.startGroup();for(var f=0;f<S.length;f++){var h=S[f],m=h.valueEvalTree,g=h.ColumnToEdit,y=u.findAttributeByName(g);if(y){var b=m?m.run(o):"";b=y.coerceValue(b),b=y.valueToWireFormat(b),c.update(l.name(),i.stableId,g,b,"action")&&(r=!0)}}S.length>1&&c.endGroup(),r&&((n=n||c.validate([i]).message)?(e=n,c.undo()):p=!0),o.inputParameterValues=s}return e};if(T.length){var w=T.map((function(e){return e.ColumnToEdit})),C=A.AppGlobals.ViewManager.modalForm,O=(0,s.default)(n);return void C.setState({open:!0,errorMessage:null,rowIds:t,columns:w,transaction:c,tableName:l.rootName(),title:e.displayName(r),onCancel:function(){C.setState({open:!1}),O({error:M,actionModifiedData:p,actionNavigatedExternal:!1,actionNavigatedApp:!1})},onSave:function(){var e=E();e?C.setState({errorMessage:e}):(C.setState({open:!1}),O({error:f,actionModifiedData:!0,actionNavigatedExternal:!1,actionNavigatedApp:!1}))}})}var _=E();f=_||f}n({error:f,actionModifiedData:p,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}},ADD_RECORD_TO:{requireValueEvalTree:!1,bulkRunnable:!0,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!0,navigatesApp:!1,navigatesExternal:!1,runAsync:function(e,t,n,a){var r=n.appModel,i=n.table,o=n.transaction;return new Promise((function(n){var l,u,s,c=!1,d=r.findTableCollection(e.referencedTable()).table;if(d)for(var f=function(n){var r=void 0,f=i.lookupTableRow(t[n],o),p=i.getPendingRow(f,o).dataContext.augmentWith(a,o),h={};e.assignments().forEach((function(e){var t=e.ColumnToEdit,n=e.valueEvalTree,a=d.tableSchema.findAttributeByName(t),r=n.run(p);r=a.coerceValue(r,a.type(),a.auxData()),r=a.valueToWireFormat(r),h[t]=r}));var v=o.create(d.name(),h);if(v){c=!0;var m=v.invalidatesRow;if(m){var g=null===(l=null==m?void 0:m.invalid)||void 0===l?void 0:l[0],y=null===(u=null==m?void 0:m.missingRequired)||void 0===u?void 0:u[0];r=m.message||"Could not create row because "+(g?"".concat(g," would be invalid"):"".concat(y," is required"))}r&&(s=r,o.undo())}},p=0;p<t.length;p++)f(p);n({error:s,actionModifiedData:c,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}},REF_ACTION:{requireValueEvalTree:!1,bulkRunnable:!1,runAsync:function(e,t,n,a){var r=n.appModel,i=n.table,o=n.actionRunInvocationId,l=n.transaction;return new Promise((function(n){var u,s,c=i.rootTable().lookupTableRow(t[0],l),d=null!==(u=null==c?void 0:c.dataContext.augmentWith(a,l))&&void 0!==u?u:r.dataContext().augmentWith(a,l),f=e.referencedTable(),p=r.findTableCollection(f).table,h=r.appTemplate.actions().findByName(f,e.referencedAction()),v=null==p?void 0:p.keyAttribute(),m=(null==v?void 0:v.valuesToWireFormat((null===(s=e.referencedRowsEvalTree())||void 0===s?void 0:s.run(d))||[]))||[],g=I.getInputParamValues(e,d);I.run(h,{appModel:r,rowIds:m,sourceLocationName:e.name(),sourceTable:p,inputParameterValues:g,actionRunInvocationId:o},(function(e){if("error"in(r=e)&&r.error){var t=e.error,a=N(e,["error"]);P(t),n(a)}else n(e);var r}),a)}))}},NAVIGATE_URL:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,tableScopeWhenStatic:!0,run:function(e,t){var n=t.appModel,a=t.tableSchema,r=t.row,i=new p.default(n,a,r),o=e.valueEvalTree().run(i),l=(0,S.sanitizeHref)(o.url||o||""),u=e.launchExternal(),s=v.default.InMobileWebView()&&!u?f.default.toHttpsUrl(l):f.default.normalizeUrlValue(l),c=!1;return s&&(c=!0,InputHandler.switchToUrl(s,u)),{actionModifiedData:!1,actionNavigatedExternal:c,actionNavigatedApp:!1}}},IMPORT_FILE:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!0,requireAddPermission:!0,modifiesData:!0,navigatesApp:!1,navigatesExternal:!1,runAsync:function(e,t,n){var a=n.appModel,r=n.table;return new Promise((function(t){var n=document.createElement("input");n.accept=".csv",n.type="file",n.addEventListener("change",(function(){var i=e.csvLocale(a);if(null!=i&&""!==i){var o;o="Uploading records to table: ".concat(r.name(),"\r\n")+"Locale: ".concat(i,"\r\n\r\n")+"This may take a while.\r\nWe will let you know when it completes.",A.AppGlobals.ViewManager.ShowInfoDialog("Import CSV Started",o,"OK");var l=n.files[0],u=new FormData;u.append("file",l),u.append("userSettings",JSON.stringify(a.GetUserSettings())),u.append("options",JSON.stringify({CsvLocale:i})),(0,b.ajaxPost)("/api/template/".concat(a.AppTemplate.Id,"/table/").concat(r.name(),"/importCsv"),u,{processData:!1,contentType:!1,dataType:"json"}).then((function(e){!function(e){e!==M&&A.AppGlobals.ViewManager.ShowInfoDialog("Import CSV Succeeded",e,"OK")}(e?e.ImportCsvResult:"Success"),A.AppGlobals.StateChangeHandler.RefreshAppData({initiatedBy:"PushedChanges"}),t({actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})})).catch((function(e){t({error:L(e),actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}else t({error:"Importing records to table: "+r.name()+" failed because CSV file locale is missing.",actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})})),n.click()}))}},EXPORT_VIEW:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,requireAddPermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,runAsync:function(e,t,a,r){var i=a.appModel,l=a.sourceTable;return new Promise((function(t){var a,u,s=n(673275).getUIStateByKey,d=r?s(r):A.AppGlobals.AppState.CurrentUIState,f=Object.assign({},d);if("DashboardUIState"in f){(0,E.$TSFixMeMaybeNull)(null===(a=f.DashboardUIState)||void 0===a?void 0:a.viewEntries);var p=null===(u=f.DashboardUIState)||void 0===u?void 0:u.viewEntries.reduce((function(e,t){return e.add(t.ViewName)}),new Set),v=l.name(),m=i.appTemplate.viewControls().filter((function(e){return e.TableOrFolderName===v&&"detail"!==e.Action&&p.has(e.Name)}));if(0===m.length&&(m=i.appTemplate.viewControls().filter((function(e){return e.TableOrFolderName===v&&p.has(e.Name)}))),m.length>0){var y=m[0];f.ControlName=y.Name,(0,E.$TSFixMeMaybeNull)(y.Action),f.Root=y.Action}}var b,T=A.AppGlobals.AppState.ComputeHash(f),S=e.csvLocale(i);null!=S&&""!==S?(b="Exporting records from view: ".concat(l.name(),"\r\n")+"Locale: ".concat(S,"\r\n\r\n")+"This may take a while.\r\nWe will let you know when it completes.",A.AppGlobals.ViewManager.ShowInfoDialog("Export CSV Started",b,"OK"),i.MakeGetAppTemplateParams(i.appTemplate.model.Id,!1,(function(e){var n,a,l,u="/api/template/".concat(i.appTemplate.model.Id,"/exportView");try{l=null!=r?null===(n=d[C.SPECIFIC_STATE_NAME_MAP[d.Root]])||void 0===n?void 0:n.FilterExpr:null===(a=(0,g.getViewSpecificUIState)())||void 0===a?void 0:a.FilterExpr}catch(e){var s=e;h.default.ReportErrorOnce({errorMessage:"Error getting filter expression for CSV export",error:s})}var f=o.default.pickBy({appLink:T,version:e.version,localVersion:e.localVersion,tzOffset:e.tzOffset,settings:e.settings,location:e.location,locale:e.locale,csvLocale:S,FilterExpr:null==l?void 0:l.toJSON()});$.postJSON(u,f,(function(e){!function(e){e!==M&&A.AppGlobals.ViewManager.ShowInfoDialog("Export CSV Succeeded",e,"OK")}("Success");var n=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download="AppSheet.ViewData.".concat((0,c.default)().format("YYYY-MM-DD"),".csv"),r.click(),URL.revokeObjectURL(a),t({actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}),(function(e){t({error:L(e),actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}))):t({error:"Exporting records from table: "+l.name()+" to a CSV file failed because CSV file locale is missing.",actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1})}))}},NAVIGATE_APP:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,tableScopeWhenStatic:!0,run:function(e,t,n){var a=t.appModel,r=t.tableSchema,i=t.row,o=t.sourceTable,l=t.filterExpr,u=t.defaultValues,s=new p.default(a,r,i),c=e.valueEvalTree().run(s),d=!1;if(c){if(c.toLowerCase()==="#control=_PARENTVIEW".toLowerCase())return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:y.JeeneeBrowserAPI.navigateBack()};if(e.isAutoCreated())try{var f=A.AppGlobals.AppState.ParseHash(c),v=!1;if(f.table&&o&&o.isSlice()&&o.rootTable().name()===f.table){var m=r.findAttributeByName(e.columnToEdit());"Address"!==m.type()&&"LatLong"!==m.type()||(f.table=o.name(),v=!0)}l&&!f.filterExpr&&(f.filter=JSON.stringify(l.model),v=!0),u&&!f.defaults&&(f.defaults=JSON.stringify(u),v=!0),v&&(c="#"+$.param(f))}catch(e){h.default.warnToDevConsole(e)}d=D((function(){return A.AppGlobals.StateChangeHandler.SwitchApp(c,void 0,void 0,n)}))}return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:d}}},NAVIGATE_BACK:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,tableScopeWhenStatic:!0,run:function(){return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:y.JeeneeBrowserAPI.navigateBack()}}},COPY_EDIT_ROW:{requireValueEvalTree:!1,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!0,navigatesExternal:!1,run:function(e,t,n){var a=t.table,r=t.tableSchema,i=t.row,l=t.sourceTable,u=r.keyAttributes().map((function(e){return e.name()})),s=o.default.omit(i,u),c=a.name();try{l&&l.isSlice()&&l.rootTable().name()===a.name()&&(c=l.name())}catch(e){h.default.warnToDevConsole(e)}var d="#table=".concat(encodeURIComponent(c))+"&page=form"+"&defaults=".concat(encodeURIComponent(JSON.stringify(s)));return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:D((function(){return A.AppGlobals.StateChangeHandler.SwitchApp(d,void 0,void 0,n)}))}}},COMPOSITE:{requireValueEvalTree:!1,bulkRunnable:!1,run:function(){throw new Error("Composite action should not be run directly")}},OPEN_FILE:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,tableScopeWhenStatic:!0,run:function(e,t){var n=t.appModel,a=t.table,r=t.tableSchema,i=t.row,o=new p.default(n,r,i),l=e.valueEvalTree().run(o),u=A.AppGlobals.AppModel.ResolveFile(l,a.rootName()),s=!1;return u&&(s=!0,InputHandler.switchToUrl(u)),{actionModifiedData:!1,actionNavigatedExternal:s,actionNavigatedApp:!1}}},EMAIL:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,run:function(e,t){var n=t.appModel,a=t.tableSchema,r=t.row,i=n&&n.IsWhitelabelApp(),o=new p.default(n,a,r),l=e.valueEvalTree().run(o),u=e.messageSubjectEvalTree(),s=u?u.run(o):" ",c=e.messageBodyEvalTree(),d=c?c.run(o):" ",f=m.default.mailToUrl(l,s,d,i),h=!1;return f&&(h=!0,InputHandler.switchToUrl(f)),{actionModifiedData:!1,actionNavigatedExternal:h,actionNavigatedApp:!1}}},CALL:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,run:function(e,t){var n=t.appModel,a=t.tableSchema,r=t.row,i=new p.default(n,a,r),o=e.valueEvalTree().run(i),l=m.default.phoneUrl(o),u=!1;return l&&(u=!0,InputHandler.switchToUrl(l)),{actionModifiedData:!1,actionNavigatedExternal:u,actionNavigatedApp:!1}}},SMS:{requireValueEvalTree:!0,bulkRunnable:!1,requireDeletePermission:!1,requireUpdatePermission:!1,modifiesData:!1,navigatesApp:!1,navigatesExternal:!0,run:function(e,t){var n=t.appModel,a=t.tableSchema,r=t.row,i=new p.default(n,a,r),o=e.valueEvalTree().run(i),l=e.messageBodyEvalTree(),u=l?l.run(i):null,s=m.default.smsUrl(o,u),c=!1;return s&&(c=!0,InputHandler.switchToUrl(s)),{actionModifiedData:!1,actionNavigatedExternal:c,actionNavigatedApp:!1}}},TRIGGER_PROCESS:{requireValueEvalTree:!1,bulkRunnable:!1,runAsync:function(e,t,n){var a,r=n.appModel,i=n.table,o=n.transaction,l=t[0],u=null===(a=i.lookupTableRow(l,o))||void 0===a?void 0:a.values;if(!u)return Promise.resolve({actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1,error:"Could not find row with id '".concat(l,"' in table '").concat(i.name(),"'")});var s=JSON.stringify(u),c=m.default.makeGuid();return(0,b.ajaxPost)("/api/apps/".concat(r.AppTemplate.Id,"/userAppEvent"),{appTemplateId:r.AppTemplate.Id,appTemplateVersion:r.AppTemplate.Version,eventID:e.triggerEventId(),eventInstanceId:c,tableName:i.name(),payload:s,triggerCondition:"UPDATE"},{dataType:"json",contentType:"application/json"}).then((function(){return{actionModifiedData:!0,actionNavigatedExternal:!1,actionNavigatedApp:!1}})).catch((function(e){return{actionModifiedData:!1,actionNavigatedExternal:!1,actionNavigatedApp:!1,error:e.message}}))}}};var F=null,V=new Map,U=function(e){var t=V.get(e);return null==t&&(t={runsStarted:0,runsFinished:0,averageTime:0,maxTime:0},V.set(e,t)),t},B=function(e){return{id:(0,T.makeGuid)(),actionName:e.name(),actionType:e.type(),timestamp:Date.now(),needsConfirmation:e.needsConfirmation(),awaitingConfirmation:!1}};var H=I={confirmAction:function(e,t,n,a,r,i){var o;if(e.needsConfirmation()){var l=r.dataManager.currentTransaction,u=1===(null==t?void 0:t.length)?null===(o=n.lookupTableRow(t[0],l))||void 0===o?void 0:o.values:null,s=e.confirmationMessage(r,a,u),c=Date.now(),d={name:e.displayName(r,a,u),callback:function(){return i(!0,Date.now()-c)},classes:"btn-danger",dismiss:!0},f={name:r.MapActionName("No"),callback:function(){return i(!1,Date.now()-c)},dismiss:!0},p=r.MapActionName("Confirm"),h=[f,d];setTimeout((function(){A.AppGlobals.ViewManager.ShowDynamicReactModal({title:p,message:s,buttons:h})}),200)}else i(!0,0)},run:function(e,t,n,a){var r=t.appModel,i=void 0===r?A.AppGlobals.AppModel:r,l=t.rowId,s=t.rowIds,c=t.sourceLocationName,f=t.sourceTable,v=t.defaultValues,g=t.filterExpr,y=t.inputParameterValues,b=t.actionRunInvocationId;null!=l&&null!=s&&h.default.warnToDevConsole("ActionRunner run was given rowId and rowIds");var T=!0;null!=l&&(s=[l],T=!1);var S=null==l&&null==s&&e.dynamicTableScope();s=s||[];var E,w,C,O,_=[e],k=(E=e.name(),U(E).runsStarted+=1,Date.now());if(null==F)F=w=B(e);else if(F.id!==b){var R=F.timestamp-k,N=U(e.name());h.default.ReportErrorOnce(Object.assign({errorMessage:"Transaction Error: Attempting to run a new action when the previous one did not complete",newActionName:e.name(),newActionType:e.type(),lastActionName:F.actionName,lastActionType:F.actionType,timeSinceLastInvocation:R,withinAverage:R<N.averageTime},N)),F=w=B(e)}else w=F;h.default.AddTraceContext("DataAction Triggered",{"Action Location":c,"Action Source Table Name":f&&"function"==typeof f.name?f.name():null,"Action Type":e.type(),"Action Name":e.name(),"Action Nested Types":"COMPOSITE"===e.type()?_.map((function(e){return e.type()})).join(", "):null,"Action Bulk Mode":T,"Action Row Count":s.length,"Action Created By":e.createdBy()});var M=!1,D=!1,L=!1,G=null,V=!1,H=0;(0,u.default)((function(e){e(void 0,!(D||V||G||_.length<1))}),(function(t){var n,r=_.shift();try{n=function(e,t){if(null==t)throw new Error("ActionRunner requires an appModel");var n=d.default.findByName(e.table(),t),a=n.table,r=n.tableSchema;if(null==a||null==r)throw new Error("Error running action, unknown table:"+e.table());var i=x[e.type()];if(null==i)throw new Error("Unknown action type:"+e.type());return{actionRunner:i,table:a,tableSchema:r}}(r,i)}catch(e){return G=e.message,void h.default.errorToDevConsole(G)}var l=n,u=l.actionRunner,c=l.table,m=l.tableSchema,b=c.rootTable();if(b){var T=function(e,t,n,a,r,i,o){var l=t.dataManager.currentTransaction,u=new p.default(t,i,null,void 0,void 0,void 0,o?{viewStateKey:o}:void 0,l),s=a.filter((function(t){var n,a=null===(n=r.lookupTableRow(t,l))||void 0===n?void 0:n.values;return a?(u.replaceRowData(a),e.isValidForRow(a,u)):(h.default.errorToDevConsole({rowId:t,error:"Unable to find row ".concat(t," in target table ").concat(r.name())}),!1)}));return s}(r,i,0,s,b,m,a);if(r.tableScope()||S||0!==T.length){if("COMPOSITE"===r.type()){var A=e.nestedActions(i);_=A.concat(_)}w.awaitingConfirmation=!0,I.confirmAction(r,T,b,m,i,(function(e,n){if(H=n,w.awaitingConfirmation=!1,!e)return V=!0,void t();if("COMPOSITE"!==r.type()){var l=c.rootTable();if(!l)return h.default.warnToDevConsole("Unable to find root table for slice ".concat(c.name())),void t();if(u.navigatesExternal&&L)t();else{(C=i.dataManager.currentTransaction).closed&&h.default.ReportErrorOnce({errorMessage:"Transaction Error: transaction already closed on action confirmation"}),(O=!C.started)&&C.start();var s,d={appModel:i,table:c,tableSchema:m,sourceTable:f,transaction:C,defaultValues:v,filterExpr:g,rowIds:T,inputParameterValues:y,actionRunInvocationId:w.id},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G=e.error||G,M=e.actionModifiedData||M,D=e.actionNavigatedApp||D,L=e.actionNavigatedExternal||L},b=function(){G&&P(G),O?C.commit((function(e){e&&(C.abort(),G=e.message,P(G),"function"==typeof D&&(D=!1)),t()})):t()};"runAsync"in(s=u)&&"function"==typeof s.runAsync?r.tableScope()||S||u.bulkRunnable?(h.default.logToDevConsole("running async",r.name()),u.runAsync(r,T,d,a).then(p).then(b)):Promise.all(T.map((function(e){return u.runAsync(r,[e],d,a).then(p)}))).then(b):(r.tableScope()||S?p(u.run(r,d,a)):T.forEach((function(e){var t,n=null===(t=l.lookupTableRow(e,C))||void 0===t?void 0:t.values;p(u.run(r,o.default.extend({},d,{row:n,rowId:e}),a))})),b())}}else t()}))}else t()}else h.default.warnToDevConsole("Unable to find root table for slice ".concat(c.name()))}),(function(){null!=b||w!==F||(F=null),function(e,t,n){var a=Date.now()-t-n,r=U(e),i=r.runsFinished,o=i+1;r.averageTime=(i*r.averageTime+a)/o,r.runsFinished=o,r.maxTime=Math.max(r.maxTime,a)}(e.name(),k,H),"function"==typeof D&&(D(),D=!0),"function"==typeof n?n({actionModifiedData:M,actionNavigatedApp:D,actionNavigatedExternal:L,error:G}):M&&(!i.ShouldDelaySync()||(0,m.isMonitoringApp)(i.appTemplate.id())&&"Select This App to Monitor"===e.action.Name)?window.InputHandler.ProcessSync():D||A.AppGlobals.StateChangeHandler.ShowUIState(!0),h.default.logToDevConsole("all actions have finished for rootAction",e.name())}))},getInputParamValues:function(e,t){var n={},a=e.action.ActionDefinition.InputAssignments;if(null!=a)for(var r=0;r<a.length;r++){var i=a[r],o=e.inputParameterValueEvalTree(r);null!=o&&(n[i.InputName.toLowerCase()]=o.run(t))}return n}};t.default=H;var W=x;t.actionTypes=W},440587:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=function(){function e(t,n){(0,r.default)(this,e),this.url=t||"",this.linkText=n||""}return(0,i.default)(e,[{key:"toString",value:function(){return this.url?String(this.url):""}}],[{key:"from",value:function(t){return new e(null==t?void 0:t.Url,null==t?void 0:t.LinkText)}}]),e}();t.default=o},302443:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLatLong=t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(190644)),l=function(){function e(t,n){(0,r.default)(this,e),this.latitude=parseFloat(t||0),this.longitude=parseFloat(n||0)}return(0,i.default)(e,[{key:"toString",value:function(){return this.latitude.toFixed(6)+", "+this.longitude.toFixed(6)}}],[{key:"fromString",value:function(t){if(!t)return null;if("string"!=typeof t)return null;var n=t.split(", ");return 2===n.length&&o.default.isValidLatLng(n[0],n[1])?new e(n[0],n[1]):null}}]),e}(),u=Object.freeze(new l(0,0));t.defaultLatLong=u;var s=l;t.default=s},523930:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(973935)),u=n(44617),s=n(714067),c=function(){function e(t){(0,r.default)(this,e),this.state=t.state||{},this.initialState=o.default.clone(this.state),this.$parent=t.parent?$(t.parent):null,this.renderCb=t.render,this.dispose=t.dispose,this.$el=$("<div >"),this.$el.addClass("WidgetHelperRoot"),u.dynamicRollouts.includeByUserId("ShowVFEEmulatorOverlay")&&this.$el.addClass("WidgetHelperRootVFE"),this.$parent&&this.$parent.append(this.$el),this.$el.data("widget",this),this.$bus=$(this),this.render()}return(0,i.default)(e,[{key:"on",value:function(e,t){this.$bus.on(e,t)}},{key:"_trigger",value:function(e){this.$bus.trigger(e)}},{key:"updateHandler",value:function(){var e=this,t=o.default.toArray(arguments);return function(){for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];t.forEach((function(t,n){e.state[t]=a[n]})),e.render(),e._trigger("change")}}},{key:"render",value:function(){function t(){var t=this;this.reactElement=this.renderCb(this.state);var n=function(){t.component=l.default.render(t.reactElement,t.$el[0])};e.deferMode?e._queuedRenders.push(n):n()}if(location.host.indexOf("appsheet.com")>=0)try{t.call(this)}catch(e){var n=e;if(-1===n.toString().indexOf("parentNode"))throw n}else t.call(this)}},{key:"replaceState",value:function(e){this.state=e,this.render()}},{key:"setState",value:function(e){o.default.extend(this.state,e),this.render()}},{key:"getState",value:function(){return this.state}},{key:"unmount",value:function(){return null!=this.dispose&&this.dispose(),l.default.unmountComponentAtNode(this.$el[0])}},{key:"reinitializeComponent",value:function(e){if(this.component){var t;t=this.component.getInitialState?this.component.getInitialState():this.component.initialState?this.component.initialState():{},this.component.state=t;var n=o.default.clone(this.initialState);n.refreshId=Math.random(),this.state=o.default.extend(n,e||{})}}}],[{key:"fromEl",value:function(e){return e.data("widget")}},{key:"startBatch",value:function(){window.Common.RunningInTestFramework||(e.deferMode=!0)}},{key:"clearBatch",value:function(){e._queuedRenders=[]}},{key:"flush",value:function(t){if(t){var n=e._queuedRenders.splice(0,100);for(e.deferMode=!1;n.length;){n.pop()()}e._queuedRenders.length&&setTimeout((function(){e.flush(!0)}),100)}else setTimeout((function(){e.flush(!0)}),s.FADE_OUT_DURATION_MS)}}]),e}();t.default=c,c._queuedRenders=[]},304878:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=function(){function e(t,n){(0,r.default)(this,e),this.x=parseFloat(t||0),this.y=parseFloat(n||0)}return(0,i.default)(e,[{key:"toString",value:function(){return this.x.toFixed(6)+", "+this.y.toFixed(6)}}],[{key:"isValidXOrY",value:function(e){var t=Number(e);return null!=e&&""!==e&&!isNaN(t)&&t>=0&&t<=100}},{key:"fromString",value:function(t){if(!t)return null;if("string"!=typeof t)return null;var n=t.split(", ");return 2===n.length&&e.isValidXOrY(n[0])&&e.isValidXOrY(n[1])?new e(n[0],n[1]):null}}]),e}();t.default=o},852468:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ZERO_RESULTS=t.REQUEST_DENIED=t.OVER_QUERY_LIMIT=t.OK=t.INVALID_REQUEST=void 0;var r=a(n(856690)),i=a(n(689728));t.OK="OK";var o="OVER_QUERY_LIMIT";t.OVER_QUERY_LIMIT=o;t.ZERO_RESULTS="ZERO_RESULTS";t.REQUEST_DENIED="REQUEST_DENIED";t.INVALID_REQUEST="INVALID_REQUEST";var l=function(){function e(){(0,r.default)(this,e),this.BASE_MAX_CALL_RATE=1e3,this.maxCallRateMs=this.BASE_MAX_CALL_RATE,this.queue=[],this.timer=null,this.maxQueueLength=0}return(0,i.default)(e,[{key:"queueApiCall",value:function(e){var t=this,n=e.address,a=e.lat,r=e.lng,i=e.region,l=e.interactive,u=function(e){l?t.queue.unshift(e):t.queue.push(e),t.flush()};return new Promise((function(e){u((function l(){return t.makeApiCall({address:n,lat:a,lng:r,region:i}).then((function(n){var a=n.results,r=n.status;if("OK"===(r=t.normalizeStatus(r,a))&&a&&a.length)a=t.normalizeResults(a),e({results:a});else if(r===o){var i=2*t.maxCallRateMs;console.log("\nQuery limit hit after "+(t.maxQueueLength-t.queue.length)+" with remaining queue length "+t.queue.length),console.log("increasing timeout to "+i),t.maxQueueLength=t.queue.length,t.maxCallRateMs=i,clearInterval(t.timer),t.timer=null,u(l)}else e({status:r})}))}))}))}},{key:"flush",value:function(){var e=this;this.queue.length>this.maxQueueLength&&(this.maxQueueLength=this.queue.length),null==this.timer&&(this.timer=setInterval((function(){var t=e.queue.shift();t?t():(clearInterval(e.timer),e.timer=null,console.log("queue finished"),e.maxCallRateMs=e.BASE_MAX_CALL_RATE,e.maxQueueLength=0)}),this.maxCallRateMs))}}]),e}();t.default=l},431335:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.CSV=void 0;var r=a(n(757460)),i=a(n(571524)),o=a(n(593186)),l="__dummyHeader",u={parse:function(e){var t;i.default.IsChromeBrowser()&&(t=function(e){return(" "+e).substr(1)});var n=r.default.parse(e,{header:!0,skipEmptyLines:!0,delimiter:",",transform:t}),a=n.data,l=!1;if(n.errors.length){l=!0;try{var u="q12i65o6a3530q5s9p",s=new RegExp(u,"g");if(!e.match(u)){var c=e.replace(/\r(?!\n)/g,u),d=r.default.parse(c,{header:!0,skipEmptyLines:!0});if(!d.errors.length){var f=[];d.data.forEach((function(e){var t={};for(var n in e)e[n]&&"function"==typeof e[n].replace?t[n]=e[n].replace(s,"\r"):t[n]=e[n];f.push(t)})),a=f,l=!1}}}catch(e){o.default.ReportErrorOnce({error:e,errorMessage:"Error trying to fix CSV input"})}}return l&&n.errors.forEach((function(e){o.default.ReportErrorOnce({errorMessage:"Unfixable error parsing CSV",error:e})})),a},stringify:function(e){var t;if(Array.isArray(e))t=e;else for(var n in t=[],e)e.hasOwnProperty(n)&&t.push(e[n]);var a="";if(t.length>0){var r="";for(var i in t[0])if(t[0].hasOwnProperty(i)){if(l===i)continue;""!==r&&(r+=","),r+=i}a+=r+"\r\n"}for(var o=0;o<t.length;o++)if(!t[o].hasOwnProperty(l)){var u="";for(var s in t[o])t[o].hasOwnProperty(s)&&(""!==u&&(u+=","),u+='"'+t[o][s]+'"');a+=u+"\r\n"}return a}};t.CSV=u},56749:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ASThemeProvider=void 0,t.cacheMuiTheme=c,t.themeColor=function(e){var t,n=null===(t=i.AppGlobals.ViewManager)||void 0===t?void 0:t.theme;return n?n.getThemeColor(e):null};var r=n(902770),i=n(166089),o=a(n(496486)),l=a(n(667294)),u=n(557310),s=(0,r.createTheme)({typography:{useNextVariants:!0,fontSize:18,fontFamily:"inherit"}});function c(e){var t=new WeakMap;return function(){var n,a,l=null===(a=null===(n=i.AppGlobals.ViewManager)||void 0===n?void 0:n.theme)||void 0===a?void 0:a.themeData;if(!l)return s;var c,d=t.get(l);if(d)return d;var f=i.AppGlobals.ViewManager.theme.getMuiThemeOptions();c=e?o.default.merge({},f,e(f)):f;var p=(0,r.createTheme)(Object.assign(Object.assign({},c),u.ReactRootUIConfig.isInDesktopExperience()&&{props:{MuiButton:{disableElevation:!0}}}));return t.set(l,p),p}}var d,f=c(),p=c((function(){var e=i.AppGlobals.ViewManager.theme.getHeaderMuiThemeOptions();return d?o.default.merge({},e,d(e)):e})),h=(0,r.createGenerateClassName)({disableGlobal:!0,seed:"h"}),v=(0,r.createGenerateClassName)({disableGlobal:!0,seed:"m"});t.ASThemeProvider=function(e){var t=e.header,n=e.children,a=t?p():f(),i=t?h:v;return l.default.createElement(r.StylesProvider,{generateClassName:i},l.default.createElement(r.MuiThemeProvider,{theme:a},n))}},469534:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.maybeSubscribeToPunctual=function(e){try{var t=function(){if(!window.getPunctualClient)return{v:void 0};if(y(),s.dynamicRollouts.includeByOwnerId("DisableNotificationSync"))return{v:void 0};if(!(null==e?void 0:e.Id))return{v:void 0};T=e.Id;for(var t=function(e){var t,n=((null===(t=null==e?void 0:e.AppData)||void 0===t?void 0:t.DataSets)||[]).filter((function(e){return"native"!==e.ProviderName}));return n.length>0&&u.default.every(n,(function(e){return"google_tables"===e.ProviderName}))}(e),n=function(e,t){var n=[];if(!(null==e?void 0:e.Id))return n;n.push({name:"DATA_ONLY_".concat(e.Id.replace(/-/g,"_")),rootId:"topics"}),t&&n.push.apply(n,(0,o.default)(function(e){var t,n=[];if(!(null==e?void 0:e.Id))return n;var a=((null===(t=null==e?void 0:e.AppData)||void 0===t?void 0:t.DataSets)||[]).filter((function(e){return"google_tables"===(null==e?void 0:e.ProviderName)})).map((function(e){var t;return{name:"tuples-"+h(null!==(t=e.Source)&&void 0!==t?t:""),rootId:"tables"}})).filter((function(e){return!!e.name}));return n.push.apply(n,(0,o.default)(a)),n}(e)));return n}(e,t),a=function(e){l.default.logToDevConsole("Subscribing notifications for ",n[e].rootId,n[e].name),r=window.getPunctualClient().subscribe(n[e].name,(function(e){!function(e,t){if(s.dynamicRollouts.includeByOwnerId("DisableNotificationSync"))return;if(l.default.logToDevConsole("DATA NOTIFICATION RECEIVED : ",e),t&&function(e){var t,n,a;if(!e)return!1;if("tables"!==(null===(t=e.objectId)||void 0===t?void 0:t[0]))return!1;if(!(null===(a=null===(n=e.objectId)||void 0===n?void 0:n[1])||void 0===a?void 0:a.startsWith("tuples-")))return!1;return!0}(e))return void v();if(!e.payload)return;try{var n=JSON.parse((new TextDecoder).decode(e.payload));if("ProviderCache"===n.messageType)m(n);else g()}catch(e){l.default.ReportErrorOnce({errorMessage:"Failed to parse data notification",error:e})}}(e,t)}),(function(e){l.default.ReportError({errorMessage:"Error processing message from punctual. Updates for this app will halt.",error:e}),y()}),(function(){l.default.logToDevConsole("Unsubscribed notifications for ",n[e].rootId,n[e].name)}),n[e].rootId,(function(e){b=+new Date}))},i=0;i<n.length;i++)a(i)}();if("object"===(0,i.default)(t))return t.v}catch(e){l.default.ReportError({errorMessage:"Error subscribing to punctual",error:e})}};var r,i=a(n(918698)),o=a(n(600861)),l=a(n(593186)),u=a(n(496486)),s=n(44617),c=n(354632),d=n(166089),f=n(609464),p=n(92177);function h(e){var t;return(t=e.match(/^(?:ID=)?tables\/([^/]+)$/))||(t=e.match(/^(?:ID=)?base\/[^/]+\/tables\/([^/]+)$/))?t[1]:""}var v=u.default.throttle((function(){var e,t;c.syncCountMetric.record({Visibility:"Hidden",InitiatedBy:"Notification",NotificationType:"TablesOnlyApp"}),null===(t=null===(e=d.AppGlobals.AppModel)||void 0===e?void 0:e.startBackgroundSync)||void 0===t||t.call(e,{initiatedBy:"Notification"})}),Math.ceil(2e3+5e3*Math.random())),m=u.default.throttle((function(e){var t;null===(t=d.AppGlobals.AppModel)||void 0===t||t.startBackgroundSync({initiatedBy:"Notification",notification:e})}),Math.ceil(2e3+5e3*Math.random())),g=u.default.throttle((function(){s.dynamicRollouts.includeByOwnerId("SendDataNotificationsOnChangeRollout")&&(c.syncCountMetric.record({Visibility:"Hidden",InitiatedBy:"Notification",NotificationType:"DataChange"}),(0,f.deltaNotificationInstance)().checkChanges().catch((function(e){l.default.ReportError({errorMessage:"Error processing data change notification",error:e})})))}),Math.ceil(200+1e3*Math.random()));function y(){try{r&&r.unsubscribe(),r=void 0}catch(e){l.default.ReportError({errorMessage:"Ignoring error while unsubscribing to punctual",error:e})}}var b=0,T="";var S=0,A="";setInterval((function(){var e,t,n;(null===navigator||void 0===navigator?void 0:navigator.onLine)&&b&&b<S&&r&&(p.dataNotificationStatusMetric.record({Status:"Disconnected"}),A!==T&&(l.default.logToDevConsole("Punctual disconnect detected. AppId:".concat(T,": User:").concat(null!==(n=null===(t=null===(e=d.AppGlobals.AppState)||void 0===e?void 0:e.UserInformation)||void 0===t?void 0:t.Id)&&void 0!==n?n:0,": PunctualTs:").concat(b,": LogTs:").concat(S)),A=T)),S=+new Date}),6e4)},609464:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DeltaNotificationClient=void 0,t.deltaNotificationInstance=function(){b||(b=new T);return b};var r=a(n(364687)),i=a(n(856690)),o=a(n(689728)),l=a(n(593186)),u=n(635672),s=a(n(962553)),c=a(n(496486)),d=n(166089),f=a(n(385857)),p=n(354632),h=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))};function v(e,t){return e.sliceDefinition?function(e,t){for(var n={},a=0;a<e.Columns.length;a++){var r=e.Columns[a];null!=r&&null!=t[a]&&(n[r]=t[a])}return n}(e.sliceDefinition,t):function(e,t){for(var n={},a=e.allAttributes(),r=0;r<a.length;r++){var i=a[r];null!=i&&i.isValid()&&null!=t[r]&&!i.isVirtual()&&(n[i.name()]=t[r])}return n}(e,t)}function m(e,t){var n=e.keyAttribute().name();return c.default.trim(t[n])}function g(e){var t=d.AppGlobals.AppModel.AppTemplate;if(t&&e.Id===t.Id&&e.Version===t.Version){var n=function(e,t,n){for(var a=[],r=0;r<t.Changes.length;r++)for(var i=t.Changes[r],o=s.default.findByName(i.TableName).tableSchema,l=new f.default(d.AppGlobals.AppModel,o,void 0),u=0;u<i.Changes.length;u++){var c=i.Changes[u],p=v(o,c.ChangedValues);l.rowData=p,l.recomputeVirtualColumns({recomputeKey:!0});var h={tableName:i.TableName,row:p,appName:e.Name,appId:e.Id,appVersion:e.Version,userSettings:n,mechanism:"Notification"};if("Insert"===c.Type){var g=Object.assign({actionType:"AddTableRow",type:"AddTableRow"},h);a.push(g)}else if("Update"===c.Type){var y=Object.assign({actionType:"UpdateTableRow",type:"UpdateTableRow"},h);a.push(y)}else if("Delete"===c.Type){var b=Object.assign(Object.assign({actionType:"DeleteTableRow",type:"DeleteTableRow"},h),{rowKey:m(o,h.row)});a.push(b)}}return a}(t,e,d.AppGlobals.AppModel.GetUserSettings());d.AppGlobals.AppModel.AddDeleteOrUpdateTableRows(n,(function(t){l.default.logToDevConsole("DELTA_NOTIFICATION: SUCCESS ".concat(e.Timestamp))}),(function(t){l.default.logToDevConsole("DELTA_NOTIFICATION: FAILURE ".concat(e.Timestamp))}),{skipWriteTables:!0,usedTransactions:!1,bypassSubmitToServer:!0})}else l.default.logToDevConsole("DELTA_NOTIFICATION: IGNORING ".concat(e.Id,"|").concat(e.Version," != ").concat(t.Id,"|").concat(t.Version))}function y(e){for(var t=0;t<e.length;t++)g(e[t])}var b,T=function(){function e(){(0,i.default)(this,e),this.latestSyncToken$=Promise.resolve(""),this.appId="",this.appVersion=""}return(0,o.default)(e,[{key:"setLatestWatermark",value:function(e,t){return this.latestSyncToken$=Promise.resolve(t||""),this.appId=e.Id,this.appVersion=e.Version,l.default.logToDevConsole("DELTA_NOTIFICATION: ".concat(this.appId,"|").concat(this.appVersion,"|").concat(t)),this}},{key:"checkChanges",value:function(){return h(this,void 0,void 0,r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.latestSyncToken$=this.checkChangesImpl(),e.next=3,this.latestSyncToken$;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"checkChangesImpl",value:function(){return h(this,void 0,void 0,r.default.mark((function e(){var t,n,a,i,o;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appId){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,this.latestSyncToken$;case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return","");case 7:if(!d.AppGlobals.AppModel){e.next=11;break}if(!d.AppGlobals.AppModel.NumDelayedActions()&&!d.AppGlobals.AppModel.NumProcessingActions()){e.next=11;break}return l.default.logToDevConsole("Ignoring delta notification, pending queue items"),e.abrupt("return",t);case 11:return e.prev=11,n="/api/app/notifications/".concat(this.appId,"?version=").concat(this.appVersion),a={contentType:"application/json"},i={DeltaNotificationSyncToken:t,UserSettings:JSON.stringify(d.AppGlobals.AppModel.GetUserSettings())},e.next=17,(0,u.ajaxPost)(n,i,a);case 17:if(o=e.sent,t=o.DeltaNotificationSyncToken,!d.AppGlobals.AppModel){e.next=23;break}if(!d.AppGlobals.AppModel.NumDelayedActions()&&!d.AppGlobals.AppModel.NumProcessingActions()){e.next=23;break}return l.default.logToDevConsole("Ignoring delta notification after fetch, pending queue items"),e.abrupt("return",t);case 23:l.default.logToDevConsole("DELTA_NOTIFICATION: ".concat(this.appId,"|").concat(this.appVersion,"|").concat(t,"|").concat(o)),y(o.Changes),StateReflector.ShowUIState(!0),l.default.logToDevConsole("Processed changes ".concat(JSON.stringify(o))),p.deltaNotificationReceivedClientMetric.record({Status:"Success"}),e.next=34;break;case 30:e.prev=30,e.t0=e.catch(11),p.deltaNotificationReceivedClientMetric.record({Status:"Failure"}),l.default.logToDevConsole({errorMessage:"Error processing updates from notification queue",error:e.t0});case 34:return e.abrupt("return",t);case 35:case"end":return e.stop()}}),e,this,[[11,30]])})))}}]),e}();t.DeltaNotificationClient=T},386350:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.EDITOR_IFRAME_PREVIEW_SOURCE=void 0,t.onEditorIframePreviewMessage=function(e){var t=function(e){return function(t){var n=t.data||{},a=n.source,i=n.event,o=n.data;t.isTrusted&&(t.origin===r.WindowWrapper.location.origin||window.APPSHEET_TEST_CONTEXT)&&a===l&&e(i||"",o||{})}}(e);return window.addEventListener("message",t,!1),function(){window.removeEventListener("message",t)}},t.sendEditorMessage=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.default.maybeLog("sendEditorMessage",e,n),i.default.IsEditorIFramePreview()&&(null===(t=window.parent)||void 0===t?void 0:t.postMessage)&&window.parent.postMessage({source:l,event:e,data:n},"*")};var r=n(892148),i=a(n(571524)),o=a(n(890468)),l="editor-iframe-preview";t.EDITOR_IFRAME_PREVIEW_SOURCE=l},315847:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(249e3)),i=a(n(881052)),o=n(351101),l={BAD_GEO_VALUE:181,get disabled(){var e;return!0===(null===(e=(0,o.getAppModel)())||void 0===e?void 0:e.appTemplate.isGoogleMapsDisabled)},region:function(e){var t="US";if(e=e||r.default.language()){var n=e.match(/^\w{2}-(\w{2})$/),a=null==n?void 0:n[1];a&&(t=a.toLowerCase())}return t},_knownAddresses:{},addressHasBeenQueued:function(e){return l._knownAddresses[e]},geocodeAddress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.region,a=t.interactive;return l.disabled?Promise.reject(new Error("geocodeAddress requested but geocoding is disabled")):(l._knownAddresses[e]=!0,i.default.queueApiCall({address:e,region:n,interactive:a}))},lookupAddress:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.region,r=n.interactive;return l.disabled?Promise.reject(new Error("lookupAddress requested but geocoding is disabled")):i.default.queueApiCall({lat:e,lng:t,region:a,interactive:r})}},u=l;t.default=u},190644:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.GeolocationClass=t.Geolocation=void 0;var r=a(n(689728)),i=a(n(856690)),o=a(n(496486)),l=a(n(112368)),u=a(n(593186)),s=n(891666),c=n(44617),d=a(n(571524)),f=n(892148);function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var v=function(e){return e*(Math.PI/180)},m=2e4,g=1e3,y=6e4;function b(e){var t={};for(var n in e.coords)t[n]=e.coords[n];return{timestamp:Date.now(),coords:t}}var T=(0,r.default)((function e(t){var n=this;(0,i.default)(this,e),this.options=t,this.id=-1,this.status="stopped",this.stop=function(){"stopped"!==n.status&&(u.default.logToDevConsole("stopped watching position",n),n.status="stopped",navigator.geolocation.clearWatch(n.id))},this.start=function(){if("watching"!==n.status){u.default.logToDevConsole("started watching position",n),n.status="watching";var e=n.options,t=e.callback,a=void 0===t?function(){}:t,r=e.failureCallback,i=void 0===r?function(){}:r;n.id=navigator.geolocation.watchPosition((function(e){return a(b(e))}),(function(e){n.stop(),i(new Error(e.message))}),n.options)}},this.start()})),S=(0,r.default)((function e(){var t=this;(0,i.default)(this,e),this.available=null,this.pending=!1,this.lastPosition=null,this.history=[],this._activeWatchers=new Set,this.pauseAllWatchers=function(){var e,n=p(t._activeWatchers);try{for(n.s();!(e=n.n()).done;){(0,e.value.stop)()}}catch(e){n.e(e)}finally{n.f()}},this.resumeAllWatchers=function(){var e,n=p(t._activeWatchers);try{for(n.s();!(e=n.n()).done;){(0,e.value.start)()}}catch(e){n.e(e)}finally{n.f()}},this.getPollingUpdateInterval=function(){if(!1===t.available)return m;if(t.history.length>=2){var e=t.history[0],n=Math.min(e.kmph,130),a=o.default.meanBy(t.history.filter((function(e){return null!=e.kmph})),(function(e){return e.kmph}));n=Math.max(n,a);var r=Math.floor(m-1900*Math.pow(n/130,.05)*10);return isNaN(r)?m:Math.min(Math.max(r,g),m)}return g},this.kmDistance=function(e,t,n,a){var r=v(n-e),i=v(a-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(v(e))*Math.cos(v(n))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},this.ifAvailable=function(e,n){return!0===t.available?"function"==typeof e?e():null:!1===t.available?"function"==typeof n?n():null:(null===t.available&&(t.pending?f.WindowWrapper.setTimeout((function(){t.ifAvailable(e,n)}),3e3):t.fetchLatLong(e,n,{enableHighAccuracy:!1})),null)},this.lastPositionAge=function(){return t.lastPosition&&t.lastPosition.timestamp?Date.now()-t.lastPosition.timestamp:1/0},this.logNewPosition=function(e){var n,a=Object.assign(Object.assign({},e),{timestamp:null!==(n=e.timestamp)&&void 0!==n?n:Date.now()}),r=t.history[0];if(r){t.history=t.history.filter((function(e){return a.timestamp-e.timestamp<18e4}));var i=a.timestamp-r.timestamp;if(i>5e3){var o=t.kmDistance(r.coords.latitude,r.coords.longitude,a.coords.latitude,a.coords.longitude);isNaN(o)||(a.kmph=Math.floor(o/(i/1e3/3600)),t.history.unshift(a))}}t.lastPosition=a},this.supportsNativeLocation=function(){var e;return c.dynamicRollouts.includeByUserId("ClientAndroidNativeLocation")&&"function"==typeof(null===(e=window.JeeneeAndroid)||void 0===e?void 0:e.startLocationUpdates)&&l.default.IsAndroidAppWithMinVersion(14)||c.dynamicRollouts.includeByUserId("ClientIOSNativeLocation")&&d.default.InIOSWebView()&&l.default.IsIOSAppWithMinVersion(14.6)},this.onPositionResult=function(e){u.default.logToDevConsole("Geolocation.onPositionResult",e),t.available=!0,t.pending=!1,t.logNewPosition(e)},this.onErrorResult=function(e){u.default.logToDevConsole("Geolocation.onErrorResult",e),t.available=!1,t.pending=!1},this.fetchLatLong=function(e,n,a){var r;if(null!=(null===(r=window.navigator)||void 0===r?void 0:r.geolocation)||t.supportsNativeLocation()){t.pending=!0,null==(a=a||{enableHighAccuracy:!0,maximumAge:2e4}).timeout&&(a.timeout=5e4);var i,o=!1,l=function(e){if(!o){clearTimeout(i);var a=e instanceof Error?e:new Error(e.message);t.onErrorResult(a),t.resumeAllWatchers(),"function"==typeof n&&n(a)}};t.pauseAllWatchers(),(t.supportsNativeLocation()?s.nativeGeolocationManager:navigator.geolocation).getCurrentPosition((function(n){return function(n){if(!o){clearTimeout(i),t.onPositionResult(n),t.resumeAllWatchers();var a=n.coords,r=a.latitude,l=a.longitude;"function"==typeof e&&e(r,l)}}(b(n))}),l,a),i=f.WindowWrapper.setTimeout((function(){l(new Error("getCurrentLocation timed out")),o=!0,t.resumeAllWatchers()}),a.timeout+1e3)}else t.available=!1},this.fetchAccurateLatLong=function(e,n,a,r){var i;if(u.default.logToDevConsole("Geolocation.fetchAccurateLatLong"),null!=(null===navigator||void 0===navigator?void 0:navigator.geolocation)||t.supportsNativeLocation()){var o;t.pending=!0;var l,c,d,p=0,h=function(n){t.pending=!1,t.available=!0,t.logNewPosition(n),e(n)},v=function(){clearTimeout(c),t.supportsNativeLocation()?s.nativeGeolocationManager.removeListener(d):navigator.geolocation.clearWatch(l)},m=function(e){var t,n=null===(t=null==o?void 0:o.coords)||void 0===t?void 0:t.accuracy;(null==n||e.coords.accuracy<=n)&&(o=e,p+=1,null!=(null==r?void 0:r.desiredAccuracy)&&e.coords.accuracy<=r.desiredAccuracy&&p>1?(v(),h(e)):a(e))},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.abort,n=void 0!==t&&t;v(),o&&!n&&h(o)},T=function(e){v(),t.pending=!1,t.available=!1,"function"==typeof n&&n(new Error(e.message))},S=(r=r||{}).timeout,A=void 0===S?y:S;if(null==r.desiredAccuracy&&(r.desiredAccuracy=5),t.supportsNativeLocation()){var E={callback:m,failureCallback:T,enableHighAccuracy:!0,interval:null!==(i=r.interval)&&void 0!==i?i:5e3};return d=s.nativeGeolocationManager.addListener(E),c=f.WindowWrapper.setTimeout(g,A),g}return r.maximumAge=0,r.enableHighAccuracy=!0,l=navigator.geolocation.watchPosition((function(e){return m(b(e))}),T,r),c=f.WindowWrapper.setTimeout(g,A),g}return t.available=!1,null},this.watchPosition=function(e){var n,a=e.callback,r=void 0===a?function(){}:a,i=e.failureCallback,o=void 0===i?function(){}:i,l=e.interval,u=void 0===l?y:l,s=e.maximumAge,c=void 0===s?u:s,d=e.enableHighAccuracy,f=void 0===d||d;if(null!=(null===(n=window.navigator)||void 0===n?void 0:n.geolocation)){t.pending=!0;var p=new T({enableHighAccuracy:f,maximumAge:c,callback:function(e){t.onPositionResult(e),r(e)},failureCallback:function(e){t.onErrorResult(e),o(e),t.removeListener(p)}});return t._activeWatchers.add(p),p}},this.isValidLatLng=function(e,n){return t.isValidLatOrLng(e)&&t.isValidLatOrLng(n)},this.isValidLatOrLng=function(e){var t=Number(e);return null!=e&&""!==e&&!isNaN(t)&&t>-181&&t<181},this.normalizeLatOrLng=function(e){if(null!=e&&""!==e){var t=Number(e);if(!isNaN(t)&&t>-181&&t<181)return t}return null},this.stringifyLatOrLng=function(e,n){if(null==n&&(n=6),t.isValidLatOrLng(e)){var a=(Math.round(1e6*Number(e))/1e6).toString(),r=a.match(/^-?\d+(\.\d+)?/);if(r){r[1]?n-=r[1].length-1:a+=".";for(var i=0;i<n;i++)a+="0";return a}}return null},this.stringifyLatLng=function(e,n){return t.stringifyLatOrLng(e)+", "+t.stringifyLatOrLng(n)},this.hashLatLng=function(e,t){var n=e>=0?2*e:-2*e-1,a=t>=0?2*t:-2*t-1,r=(n>=a?n*n+n+a:n+a*a)/2;return e<0&&t<0||e>=0&&t>=0?r:-r-1},this.addListener=function(e){var n;return u.default.logToDevConsole("Geolocation.addListener",e),t.lastPositionAge()<y&&(null===(n=e.callback)||void 0===n||n.call(e,t.lastPosition)),t.supportsNativeLocation()?s.nativeGeolocationManager.addListener(Object.assign(Object.assign({},e),{callback:function(n){var a;t.onPositionResult(n),null===(a=e.callback)||void 0===a||a.call(e,n)},failureCallback:function(n){var a;t.onErrorResult(n),null===(a=e.failureCallback)||void 0===a||a.call(e,n)}})):t.watchPosition(e)},this.removeListener=function(e){u.default.logToDevConsole("Geolocation.removeListener",e),e instanceof T?(e.stop(),t._activeWatchers.delete(e)):"NativeGeolocationManager"===(null==e?void 0:e.type)&&s.nativeGeolocationManager.removeListener(e)},this.removeAllListeners=function(){var e,n=p(t._activeWatchers);try{for(n.s();!(e=n.n()).done;){var a=e.value;t.removeListener(a)}}catch(e){n.e(e)}finally{n.f()}s.nativeGeolocationManager.removeAllListeners()}}));t.GeolocationClass=S;var A=new S;t.Geolocation=A;var E=A;t.default=E},881052:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(856690)),o=a(n(689728)),l=a(n(861655)),u=a(n(994993)),s=a(n(73808)),c=a(n(152200)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(852468));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,u.default)(this,n)}}var h=new(function(e){(0,l.default)(n,e);var t=p(n);function n(){return(0,i.default)(this,n),t.apply(this,arguments)}return(0,o.default)(n,[{key:"makeApiCall",value:function(e){var t,n=e.address,a=e.region,r=e.lat,i=e.lng;return null==n&&null!=r&&null!=i&&(t={lat:r,lng:i}),new Promise((function(e){c.default.whenReady((function(){return c.default.geocoder.geocode({address:n,region:a,location:t},(function(t,n){e({results:t,status:n})}))}))}))}},{key:"normalizeStatus",value:function(e){var t,n,a,r,i,o,l,u,s,f,p,h,v,m,g;switch(e){case null===(a=null===(n=null===(t=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===t?void 0:t.maps)||void 0===n?void 0:n.GeocoderStatus)||void 0===a?void 0:a.OK:return d.OK;case null===(o=null===(i=null===(r=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===r?void 0:r.maps)||void 0===i?void 0:i.GeocoderStatus)||void 0===o?void 0:o.OVER_QUERY_LIMIT:return d.OVER_QUERY_LIMIT;case null===(s=null===(u=null===(l=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===l?void 0:l.maps)||void 0===u?void 0:u.GeocoderStatus)||void 0===s?void 0:s.INVALID_REQUEST:return d.INVALID_REQUEST;case null===(h=null===(p=null===(f=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===f?void 0:f.maps)||void 0===p?void 0:p.GeocoderStatus)||void 0===h?void 0:h.REQUEST_DENIED:return d.REQUEST_DENIED;case null===(g=null===(m=null===(v=null===c.default||void 0===c.default?void 0:c.default.api)||void 0===v?void 0:v.maps)||void 0===m?void 0:m.GeocoderStatus)||void 0===g?void 0:g.ZERO_RESULTS:return d.ZERO_RESULTS;default:return e}}},{key:"normalizeResults",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((function(e){return{latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng(),formattedAddress:e.formatted_address,lowQuality:!1}}))}}]),n}(d.default));t.default=h},787146:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=$("<div >");t.addClass("GoogleMapDomNode");$();var n=$(),a=[],p=!1,h=!1,v={};this.map=null,this.id=Math.random(),this.isXY=e,this.initialState=function(){return{pins:[],pinsById:{},tableName:null,mapColumn:null,activePin:null,currentLocMarker:null}},this.state=this.initialState(),this.matches=function(e,t){return this.state.tableName===e&&this.state.mapColumn===t},this.repaint=function(){this.map&&u.default.api.maps.event.trigger(this.map,"resize")},this.registerListener=function(e){p?setTimeout(function(){this.registerListener(e)}.bind(this),500):a.push(e)},this.clearListeners=function(){if(u.default.api){var e;for(p=!0;a.length;)e=a.pop(),u.default.api.maps.event.removeListener(e);p=!1}},this.setState=function(e){r.default.extend(this.state,e)},this.mountTo=function(e,a){var i=this;n.off("scroll.mapDomNode"),$(e).append(t[0]),t.css({position:"absolute"});var d=t.parents().filter((function(){var e=$(this);return e[0].scrollHeight>e.innerHeight()&&r.default.includes(["auto","scroll"],e.css("overflow"))}));d.length>0&&(d.on("scroll.mapDomNode",(function(){$(window).height()-t.offset().top>t.height()&&(t.hide().show(0),d.off("scroll.mapDomNode"))})),n=d),null!=this.map||h?a&&a(this):(h=!0,u.default.whenReady((function(e){var n,r;c++;var d=7;if((null===(r=null===(n=s.AppGlobals.AppModel)||void 0===n?void 0:n.AppTemplate)||void 0===r?void 0:r.OwnerInPremiumPlan)&&(d=10),c>d)l.default.IsIFrameAuthPreview()||o.default.ReportErrorOnce({errorMessage:"Attempted to exceed map limit for app",mapLimit:d}),h=!1;else{var f={center:{lat:u.default.defaultLat,lng:u.default.defaultLng},zoom:15,zoomControlOptions:{position:e.maps.ControlPosition.LEFT_BOTTOM},controlSize:32,streetViewControl:!0,streetViewControlOptions:{position:e.maps.ControlPosition.LEFT_BOTTOM},gestureHandling:"greedy"};i.map=new e.maps.Map(t[0],f),e.maps.event.addListenerOnce(i.map,"idle",(function(){h=!1,o.default.logToDevConsole("\nCreated new Google Map"),a&&a(i)}))}})))},this.unmount=function(){t.detach(),$(),this.clearListeners(),this.clearMarkerClusterers(),this.setState(this.initialState),n.off("scroll.mapDomNode")},this.initMarkerClusterer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.AppGlobals.ViewManager.theme.getThemeColor("actionIcon"),t=v[e];return t||(v[e]=t=new i.default(this.map,[],{maxZoom:16,zoomOnClick:!0,minimumClusterSize:5})),t.setStyles(d.map((function(t){return{url:f(e,t),height:t,width:t,textColor:"white"}}))),t},this.clearMarkerClusterers=function(){r.default.values(v).forEach((function(e){return e.clearMarkers()}))}};var r=a(n(496486)),i=a(n(304820)),o=a(n(593186)),l=a(n(571524)),u=a(n(152200)),s=n(166089),c=0,d=[20,25,30],f=function(e,t){return"data:image/svg+xml;base64,"+window.btoa('\n        <svg\n            xmlns:dc="http://purl.org/dc/elements/1.1/"\n            xmlns:cc="http://creativecommons.org/ns#"\n            xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n            xmlns:svg="http://www.w3.org/2000/svg"\n            xmlns="http://www.w3.org/2000/svg"\n            id="svg8"\n            version="1.1"\n            viewBox="0 0 5.2916665 5.4239602"\n            height="'.concat(t,'"\n            width="').concat(t,'">\n            <defs\n                id="defs2" />\n            <g\n                transform="translate(-99.867724,-198.60313)"\n                id="layer1">\n                <circle\n                r="2.5135417"\n                style="opacity:1;fill:').concat(e,';fill-opacity:1;stroke:#ffffff;stroke-width:0.26458332;stroke-miterlimit:4;stroke-dasharray:none"\n                id="circle821"\n                cx="102.51356"\n                cy="201.20000" />\n            </g>\n        </svg>\n    '))}},152200:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i,o=a(n(459400)),l=a(n(238435)),u=a(n(496486)),s=a(n(190644)),c=n(46239),d=a(n(787146)),f=a(n(385857)),p=a(n(888861)),h=n(504674),v=n(351101),m=a(n(429815)),g=n(166089),y=n(268547),b=n(555792),T=!1,S=[],A=[],E=[],w={},C={mounted:{},unmounted:{}},O={},_={_api:null,geocoder:null,defaultLat:0,defaultLng:0,getStaticImageURLMultipleLatLongs:function(e,t,n){var a,r,i;if(this.disabled)return"";var o="";e.forEach((function(e){o+="&markers=color:red%7Clabel:"+e.name.charAt(0)+"%7C"+encodeURIComponent(e.value)}));var l=(null===(i=null===(r=null===(a=null===window||void 0===window?void 0:window.AppModel)||void 0===a?void 0:a.AppTemplate)||void 0===r?void 0:r.Behavior)||void 0===i?void 0:i.GoogleMapsKey)||h.GOOGLE;return"https://maps.googleapis.com/maps/api/staticmap?markers="+o+"&size="+t+"x"+n+"&key="+l},getStaticImageURL:function(e,t,n){var a,r,i;return this.disabled?"":"https://maps.googleapis.com/maps/api/staticmap?center="+e+"&zoom=12&size="+t+"x"+n+"&key="+((null===(i=null===(r=null===(a=null===window||void 0===window?void 0:window.AppModel)||void 0===a?void 0:a.AppTemplate)||void 0===r?void 0:r.Behavior)||void 0===i?void 0:i.GoogleMapsKey)||h.GOOGLE)},mountMap:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.callback,r=n.tableName,i=n.mapColumn,o=n.isXY;if(t in w){var l=w[t];return a?a(l):l}var s,c=o?E:A;return r&&i&&(s=c.filter((function(e){return e.matches(r,i)}))[0],s&&u.default.pull(c,s)),s||(s=c.pop()||new d.default(o)),s.mountTo(e,a),w[t]=s,s},getMapInstance:function(e){return w[e]},unmountMap:function(e){var t=this.getMapInstance(e);t&&(t.unmount(),(t.isXY?E:A).push(t));delete w[e]},getMountedPins:function(e){return u.default.clone(C.mounted[e])||{}},getPin:function(e,t){var n,a=JSON.stringify(e),r=C.unmounted[a]||[],i=!1;return r.length?n=r.pop():(n=_.createPin(t,e),i=!0),n.setTitle(Common.RunningInTestFramework?t.Id:t.Label),n.appsheetItem=t,n.appsheetFormatting=e,n.appsheetFormatString=a,{pin:n,created:i}},createPin:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=_.api,r=!!(null===(t=null==n?void 0:n.icon)||void 0===t?void 0:t[0]),i=r&&!n.noMarkerWithLabel?a.maps.MarkerWithLabel:a.maps.Marker,o=new i({draggable:!1});return o},makePinCacheKey:function(e,t,n,a){return JSON.stringify([e,t,n,a])},cacheMountedPin:function(e,t,n){var a=C.mounted[e]||{};a[t]=n,C.mounted[e]=a},unmountPins:function(e,t){var n=C.mounted[e]||{},a=C.unmounted;u.default.keys(t).forEach((function(e){var r=t[e];delete n[e];var i=a[r.appsheetFormatString]||[];i.push(r),a[r.appsheetFormatString]=i}))},get disabled(){var e;return!0===(null===(e=(0,v.getAppModel)())||void 0===e?void 0:e.appTemplate.isGoogleMapsDisabled)},get api(){return this.disabled?null:this._api},shouldBeUnloaded:function(e){var t=m.default.getExternalServiceSettings(e).EnableMapsAndGeocoding;return!(!T&&null==this._api||t)},ready:function(){return null!=this.api},init:function(){var e,t,n,a=this;if(!this.disabled&&!T&&null==this.api){T=!0,window.mapReadyCallback=function(){if(a._api=window.google,a.geocoder=new window.google.maps.Geocoder,T=!1,!window.APPSHEET_TEST_CONTEXT){var e=(0,y.scriptSafeByReview)(l.default,"MarkerWithLabelRaw is static");$.globalEval(e)}for(;S.length;){var t=S.shift();"function"==typeof t.callback&&(t.callback(a.api),delete t.callback)}};var i=document.createElement("script"),u=(null===(n=null===(t=null===(e=null===window||void 0===window?void 0:window.AppModel)||void 0===e?void 0:e.AppTemplate)||void 0===t?void 0:t.Behavior)||void 0===n?void 0:n.GoogleMapsKey)||h.GOOGLE,s=(0,b.trustedResourceUrl)(r||(r=(0,o.default)(["https://maps.googleapis.com/maps/api/js?key=","&callback=mapReadyCallback"])),u);i.setAttribute("src",s),i.setAttribute("type","text/javascript"),i.setAttribute("async","async"),i.setAttribute("defer","defer"),document.head.appendChild(i)}},whenReady:function(e,t){if(this.ready())return e(this.api),!1;if(T||this.init(),null==t){var n={callback:e};return S.push(n),n}return t.callback=e,t},zoomScaling:{20:1128.49722,19:2256.99444,18:4513.98888,17:9027.977761,16:18055.95552,15:36111.91104,14:72223.82209,13:144447.6442,12:288895.2884,11:577790.5767,10:1155581.153,9:2311162.307,8:4622324.614,7:9244649.227,6:18489298.45,5:36978596.91,4:73957193.82,3:147914387.6,2:295828775.3,1:591657550.5},normalizeMapType:function(e){var t;switch(e){case"Road":case"Automatic":t="roadmap";break;case"Aerial":t="hybrid";break;default:t=e}return t},getMapItems:function(e,t,n,a,r,i,o,l,u){var s=[],c=null;if(null!=n){var d=n.tableSchema.findAttributeByName(e),h=new f.default(a,n.tableSchema);if(d&&l){var v=p.default.createFilter(l,d.baseImageEvalTree());r&&v?r=p.default.createAnd(r,v):v&&(r=v)}var m=n.queryRowValues({searchQuery:o,filterExpr:r,filterDefaults:i,transaction:u});if(null!=m&&(s=m.filter((function(e){var t=!0;return a.AppTemplate.Presentation.RespectShowIfEverywhere&&d&&d.showIfEvalTree()&&(h.replaceRowData(e),t=d.showIfEvalTree().run(h)),t})).map((function(t){return _.getMapItem(t,n,n.tableSchema,e)})).filter((function(e){return null!=e})),null!=t))for(var g=0;g<s.length;g++)if(s[g].Id===t){c=s[g];break}}return{all:s,selected:c}},getMapItem:function(e,t,n,a){i!==t.timestamp()&&(O={},i=t.timestamp());var r=e[n.keyAttribute().name()],o=O[t.name()]||{},l=o[r]||{};if(null==l[a]){var u=this.makeMapItem(e,t,n,a);null!=u&&(l[a]=u,o[r]=l,O[t.name()]=o)}return l[a]},makeMapItem:function(e,t,n,a){if(null==e||null==t||null==n)return null;var r,i,o=null,l=null,u=s.default.normalizeLatOrLng,d=n.keyAttribute();if(null!=a&&(i=n.findAttributeByName(a))&&e[a])switch(i.basestType()){case g.AppGlobals.AppModel.LATLONG_TYPE:case AppModel.CHANGELOCATION_TYPE:null!=(r=e[a].split(","))&&2===r.length&&(o=u(r[0]),l=u(r[1]));break;case g.AppGlobals.AppModel.XY_TYPE:var f=c.ImageMapType.fromXYStringToLatLng(e[a]);o=f.lat,l=f.lng}if(null!=o&&null!=l||(null==a&&null!=(i=n.findAttributesByType(g.AppGlobals.AppModel.ADDRESS_TYPE)[0])&&(a=i.name()),o=u(e["_latitude"+a]),l=u(e["_longitude"+a])),null==o||null==l){var p=e["_geo_"+a];null!=p&&p.match(new RegExp(/.*,.*/))&&null!=(r=p.split(","))&&2===r.length&&(o=u(r[0]),l=u(r[1]))}if(null==o||null==l)return null;var h=e[d.name()];return{Id:h,Label:t.labelTextForId(h),TableName:t.name(),Latitude:o,Longitude:l,Hash:s.default.hashLatLng(o,l),MapCol:a}},getCenterLat:function(e){return e.center.lat()},getCenterLng:function(e){for(var t=e.center.lng();t<-180;)t+=360;for(;t>180;)t-=360;return t}},k=_;t.default=k},263198:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.missingImageError=t.ifIOSHandlerExists=t.UNABLE_TO_LOAD_IMAGE_PREFIX=t.JeeneeBrowserAPI=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(571524)),l=a(n(112368)),u=a(n(593186)),s=a(n(21870)),c=a(n(496486)),d=n(429815),f=n(351101),p=n(318926),h=n(804758),v=n(218546),m=n(635672),g=n(50295),y=a(n(895466)),b=n(629503),T=n(646317),S=n(166089),A=n(892148),E=n(399713),w=a(n(266522)),C="Unable to load image data. ";t.UNABLE_TO_LOAD_IMAGE_PREFIX=C;var O=function(e){return C+e};t.missingImageError=O;var _=function(e){return{postMessage:function(t){var n,a=null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers[e];return null!=a&&a.postMessage("function"==typeof t?t():t),{else:function(e){null==a&&e()}}}}};t.ifIOSHandlerExists=_;var k=new(function(){function e(){(0,r.default)(this,e),this.DEFAULT_SCAN_RESULT="111122333",this.pendingCallbacks={},this.closeAfterNextSync=!1,this.scanComplete=function(e){},this.lastNativeMedia={nativeResourceId:"",fileUploadUtilsId:"",time:0,count:0},this.log={barcodeScan:function(e){p.logger.logEvent(new h.BarcodeScanEvent(e))},videoTaken:function(e,t,n,a){p.logger.logEvent(new h.VideoTakenEvent(e,t,n,a))},appSubscription:function(e){p.logger.logEvent(new h.AppSubscriptionEvent(e))},receivedNotification:function(){p.logger.logEvent(new h.ReceivedNotificationEvent)},shortcutAppStart:function(){p.logger.logEvent(new h.ShortcutAppStartEvent)},webviewCrash:function(){p.logger.logEvent(new h.WebviewCrashEvent)},cachedFileRecovered:function(e){p.logger.logEvent(new h.NativeCachedFileRecoveredEvent(e))},cachedFilesDeleted:function(e){p.logger.logEvent(new h.NativeCachedFilesDeletedEvent(e))}}}return(0,i.default)(e,[{key:"logNativeError",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=null===(t=window.JeeneeAndroid)||void 0===t?void 0:t.logError;null!=a&&("string"!=typeof n&&(n=JSON.stringify(n)),a(e,n))}},{key:"OnAppTemplateLoad",value:function(e){var t,n,a=w.default.getThemeData(e.Presentation.DisplayTheme,e);this.setNotchColorIOS(a.headerBackground,"#333"!==a.interfaceText),l.default.IsIOSAppWithMinVersion(6.3)?this.setMaxImageResolutionIOS({width:(0,d.getMaxImageResolution)()}):!l.default.IsAndroidAppWithMinVersion(6.4)||l.default.IsAndroidAppWithMinVersion(15.6)||o.default.IsUnsupportedAndroidVersion()||window.JeeneeAndroid.setMaxImageResolution((0,d.getMaxImageResolution)());var r=null!==(t=e.Presentation.ActionNameMappings)&&void 0!==t?t:[];this.setNativeLocalizationStrings(r);try{!l.default.IsAndroidAppWithMinVersion(10.6)||l.default.IsAndroidAppWithMinVersion(15.6)||o.default.IsUnsupportedAndroidVersion()||window.JeeneeAndroid.setGalleryEnabledForImagePicker(e.Presentation.AllowGalleryAccess),l.default.IsIOSAppWithMinVersion(10)&&this.setGalleryEnableIOS({galleryEnabled:!!e.Presentation.AllowGalleryAccess})}catch(e){u.default.ReportError({errorMessage:"Error calling setGalleryEnabledForImagePicker",error:e})}this.closeAfterNextSync&&!o.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.closeAppSheet(),this.closeAfterNextSync="true"===(null===(n=(0,T.parseUrlQuery)().closeAfterSync)||void 0===n?void 0:n.toLowerCase()),void 0!==l.default&&l.default.IsAndroidAppWithMinVersion(8.3)&&!o.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.hideLoadingView()}},{key:"setAuthCookie",value:function(){try{if(l.default.IsAndroidAppWithMinVersion(8.2)&&!o.default.IsUnsupportedAndroidVersion()){var e=("; "+document.cookie).split("; .JEENEEATH="),t="";2===e.length&&(t=e.pop().split(";").shift()),window.JeeneeAndroid.setAuthCookie(t)}}catch(e){u.default.ReportError({errorMessage:"Error calling setAuthCookie",error:e})}}},{key:"subscribeToApps",value:function(e,t){var n,a,r;try{if(70007!==(null===(a=null===(n=null===window||void 0===window?void 0:window.AppState)||void 0===n?void 0:n.UserInformation)||void 0===a?void 0:a.Id)&&!o.default.IsWhitelabelBrowser()&&(l.default.IsAndroidAppWithMinVersion(8.2)&&!o.default.IsUnsupportedAndroidVersion()&&(u.default.AddTraceContext("JeeneeAndroid.subscribeToApps"),null===(r=window.JeeneeAndroid)||void 0===r||r.subscribeToApps(e,JSON.stringify(t))),l.default.IsIOSAppWithMinVersion(9.9))){var i={appGallery:e,apps:JSON.stringify(t)};_("SubscribeToApps").postMessage(i).else((function(){$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=subscribeToApps",data:i})}))}}catch(e){u.default.ReportError({errorMessage:"Error calling subscribeToApps",error:e})}}},{key:"cacheFiles",value:function(e,t){var n=e.Id,a=e.Name;if(l.default.IsAndroidAppWithMinVersion(6.4)&&!o.default.IsUnsupportedAndroidVersion()&&(u.default.AddTraceContext("appModel.fetchCache (Android)"),b.Common.BeginOfflineCaching(),window.JeeneeAndroid.cacheFiles(JSON.stringify(t),a,"Common.FinishedCachingCallback('"+a+"')")),l.default.IsIOSAppWithMinVersion(4.4)){u.default.AddTraceContext("appModel.fetchCache (iOS)"),b.Common.BeginOfflineCaching();var r={urls:t.toString(),TemplateId:l.default.IsIOSAppWithMinVersion(12.3)?n:a,callback:"Common.FinishedCachingCallback('"+a+"')"};_("CacheFiles").postMessage(r).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=CacheFiles",data:r})}))}}},{key:"onNewNotificationToken",value:function(e,t,n){t="true"===t,n=n||null,S.AppGlobals.AppState.UserInformation.Id!==S.AppGlobals.AppState.GuestUserInformation.Id&&(0,m.ajaxPost)("/api/notif/settoken/",{token:e,whitelabelGuid:n,isWhitelabel:t}).then((function(){u.default.logToDevConsole("uploaded token for notification")})).catch((function(){u.default.logToDevConsole("error uploading token for notification")}))}},{key:"navigateBack",value:function(){return S.AppGlobals.ViewManager.photoGallery&&"loading"!==S.AppGlobals.ViewManager.photoGallery?(S.AppGlobals.ViewManager.photoGallery.close(),!0):$(".ReactModalPortal .Modal").length?($(".ReactModalPortal .Modal").click(),!0):S.AppGlobals.ViewManager.sideMenu.component.isOpen()?(S.AppGlobals.ViewManager.sideMenu.component.close(),!0):$("#FormPage.ActivePage").length&&null!=window.formViewComponent&&"function"==typeof window.formViewComponent.cancelForm?(window.formViewComponent.cancelForm(),!0):!S.AppGlobals.AppState.IsTopLevel()&&(S.AppGlobals.AppState.ChoosePreviousState(),!0)}},{key:"notifyJavaScriptLoaded",value:function(){window.JeeneeAndroid&&"function"==typeof window.JeeneeAndroid.onJavaScriptLoaded&&window.JeeneeAndroid.onJavaScriptLoaded()}},{key:"openScanner",value:function(e){var t,n=this;u.default.AddTraceContext(".ScanInputControl"),this.scanComplete=function(t){u.default.AddTraceContext(".scanComplete"),e(c.default.trim(t)),n.scanComplete=function(e){}};var a=S.AppGlobals.AppModel.appTemplate.barcodeScanner,r=(null===(t=a.key)||void 0===t?void 0:t.startsWith("W3EJE"))||!1;if(p.logger.logEvent(new h.ScanInputControlEvent(a.type,r)),l.default.SupportsBarcodeScan()){if(!a.enabled)return;if(o.default.InIOSWebView())return a.type===d.SCANNER.MLKIT&&l.default.mlkitUnsupported()&&s.default.showToast(g.MLKitWarningToast),void this._openScannerIOS(a.type,a.key);if(o.default.InAndroidWebView())return a.type===d.SCANNER.MLKIT&&l.default.mlkitUnsupported()?void s.default.showToast(g.MLKitUnsupportedToast):void this._openScannerAndroid(a.type,a.key);this.scanComplete(this.DEFAULT_SCAN_RESULT)}}},{key:"_openScannerAndroid",value:function(e,t){e===d.SCANNER.MLKIT?window.JeeneeAndroid.scanBarcode("JeeneeBrowserAPI.scanComplete('{0}')"):l.default.IsAndroidAppWithMinVersion(14.8)&&t?window.JeeneeAndroid.scanCode("JeeneeBrowserAPI.scanComplete('{0}')",t):window.JeeneeAndroid.scanCode("JeeneeBrowserAPI.scanComplete('{0}')")}},{key:"_openScannerIOS",value:function(e,t){_("ScanCode").postMessage((function(){return l.default.IsIOSAppWithMinVersion(14.4)?{callback:"JeeneeBrowserAPI.scanComplete('{0}');",scannerType:e,scannerKey:t}:{callback:"JeeneeBrowserAPI.scanComplete('{0}');",iOSmlkit:S.AppGlobals.AppModel.inRollout("iOSmlkitScanner")}})).else((function(){A.WindowWrapper.location="jeenee_method?ScanCode?callback=JeeneeBrowserAPI.scanComplete('{0}');"}))}},{key:"startNfcScan",value:function(e){var t=this;if(this.nfcScanComplete=function(n){p.logger.logAppEvent({eventName:v.AppEventName.NfcScanResult}),u.default.AddTraceContext(".nfcScanComplete"),e(function(e){if(e)try{var t=JSON.parse(e);return c.default.trim(t[0].record)||""}catch(e){u.default.ReportErrorOnce({errorMessage:"Error parsing json",error:e})}return""}(n)),t.nfcScanComplete=function(){}},o.default.InIOSWebView()&&l.default.SupportsNfcScan()){var n={callback:"JeeneeBrowserAPI.nfcScanComplete('{0}')"};_("StartNFCScan").postMessage(n).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=startNFCScan",data:n})}))}else o.default.InAndroidWebView()&&l.default.SupportsNfcScan()&&window.JeeneeAndroid&&"function"==typeof window.JeeneeAndroid.startNFCScan?window.JeeneeAndroid.startNFCScan("JeeneeBrowserAPI.nfcScanComplete('{0}')"):this.nfcScanComplete(JSON.stringify([{record:this.DEFAULT_SCAN_RESULT}]));p.logger.logAppEvent({eventName:v.AppEventName.StartNfcScan})}},{key:"startSpeechRecognition",value:function(e,t){if(l.default.SupportsSpeechRecognition())if(this.speechRecognitionComplete=function(n,a){a&&"{1}"!==a?t(n):(u.default.AddTraceContext(".speechRecognitionComplete"),e(n))},o.default.InIOSWebView()){var n={callback:"JeeneeBrowserAPI.speechRecognitionComplete('{0}', '{1}')"};_("StartSpeechRecognition").postMessage(n).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=startSpeechRecognition",data:n})}))}else o.default.InAndroidWebView()&&window.JeeneeAndroid.startSpeechRecognition("JeeneeBrowserAPI.speechRecognitionComplete('{0}', '{1}')")}},{key:"stopSpeechRecognition",value:function(){l.default.SupportsSpeechRecognition()&&(o.default.InIOSWebView()?_("StopSpeechRecognition").postMessage({}).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=stopSpeechRecognition"})})):o.default.InAndroidWebView()&&window.JeeneeAndroid.stopSpeechRecognition())}},{key:"offlineProgressChanged",value:function(e){S.AppGlobals.ViewManager&&(S.AppGlobals.ViewManager.sideMenu.setState(e),s.default.setCachingProgress(e))}},{key:"onLocationUpdate",value:function(e){if(this.nativeLocationCallback){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return JSON.parse(e)}catch(e){return u.default.ReportErrorOnce({errorMessage:"Error parsing json",error:e}),t}}(e);t&&this.nativeLocationCallback(t)}}},{key:"startLocationUpdates",value:function(e){var t=e.callback,n=e.failureCallback,a=e.interval,r=e.enableHighAccuracy,i=void 0!==r&&r;if(u.default.logToDevConsole("starting native location updates",{interval:a,enableHighAccuracy:i}),this.nativeLocationCallback=function(e){"error"in e?n(new Error(e.error)):t(e)},o.default.InAndroidWebView()){var l=i?3:2,s=a/1e3;window.JeeneeAndroid.startLocationUpdates("JeeneeBrowserAPI.onLocationUpdate({0})",s,Math.min(1,s),l)}else if(o.default.InIOSWebView()){var c={callback:"JeeneeBrowserAPI.onLocationUpdate('{0}')",desiredAccuracy:i?2:3};_("StartLocationUpdates").postMessage(c).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=startLocationUpdates",data:c})}))}}},{key:"stopLocationUpdates",value:function(){u.default.logToDevConsole("stopping native location updates"),o.default.InAndroidWebView()?window.JeeneeAndroid.stopLocationUpdates():o.default.InIOSWebView()&&_("StopLocationUpdates").postMessage({}).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=stopLocationUpdates"})}))}},{key:"clearPhotoStorageForCurrentApp",value:function(){var e;(null===(e=null===window||void 0===window?void 0:window.JeeneeAndroid)||void 0===e?void 0:e.clearPhotoStorageForCurrentApp)&&(u.default.AddTraceContext("Called clearPhotoStorage from app ".concat(S.AppGlobals.AppModel.AppTemplate.Name)),this.lastClearPhotoStorageTime=(new Date).toISOString(),window.JeeneeAndroid.clearPhotoStorageForCurrentApp())}},{key:"clearPhotoStorageAndroid",value:function(e,t,n){var a,r;if(null===(a=null===window||void 0===window?void 0:window.JeeneeAndroid)||void 0===a?void 0:a.clearPhotoStorageForApp)try{window.JeeneeAndroid.clearPhotoStorageForApp(e,t)}catch(e){u.default.ReportError({errorMessage:"clearPhotoStorageForApp unexpected error",error:e})}else if(null===(r=null===window||void 0===window?void 0:window.JeeneeAndroid)||void 0===r?void 0:r.clearPhotoStorageForCurrentApp){var i=n.length>0;try{var o=this.currentAppKnownToNative,l=S.AppGlobals.AppModel.AppTemplate.Id!==e||S.AppGlobals.AppModel.AppTemplate.Id!==(null==o?void 0:o.Id);i||l?u.default.ReportError({errorMessage:"clearPhotoStorageForCurrentApp data loss averted",appMismatch:l,appId:e,appKnownToNative:null==o?void 0:o.Id,windowAppId:S.AppGlobals.AppModel.AppTemplate.Id,hasPendingImages:i}):this.clearPhotoStorageForCurrentApp()}catch(e){u.default.ReportError({errorMessage:"clearPhotoStorage unexpected error",error:e})}}}},{key:"clearPhotoStorageForApp",value:function(e,t){if(o.default.InMobileWebView()){var n=(0,f.getAppModel)().findPendingImages(),a=new Date(t),r=a.getTime();if(n.some((function(e){return new Date(e.timestamp())<=a})))return void u.default.ReportError({errorMessage:"clearPhotoStorageForApp data loss averted"});this.lastClearPhotoStorageTime=t,o.default.InAndroidWebView()?this.clearPhotoStorageAndroid(e,r,n):_("ClearPhotoStorageForApp").postMessage({appId:e,timestamp:r})}}},{key:"openInNativeBrowserIOS",value:function(e){_("OpenInNativeBrowser").postMessage(e).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=OpenInNativeBrowser",data:e})}))}},{key:"takePhoto",value:function(e){var t,n,a=e.RequestId,r={galleryEnabled:null===(t=S.AppGlobals.AppModel.AppTemplate.Presentation.AllowGalleryAccess)||void 0===t||t,exposeToGallery:null===(n=S.AppGlobals.AppModel.AppTemplate.Behavior.SaveToGallery)||void 0===n||n,photoWidth:e.preferredWidth||(0,d.getMaxImageResolution)(),drzZone:(0,E.getDrz)()};if(o.default.InAndroidWebView())if(l.default.IsAndroidAppWithMinVersion(15.6)){var i=Object.assign(Object.assign({},r),{callback:"JeeneeBrowserAPI.onAndroidPhotoTaken('".concat(a,"','{0}');")});window.JeeneeAndroid.takePhoto(JSON.stringify(i))}else window.JeeneeAndroid.takePhoto("JeeneeBrowserAPI.onAndroidPhotoTaken('".concat(a,"',{0});"));else{var u=Object.assign(Object.assign({},r),{phphoto:"true",callback:"JeeneeBrowserAPI.onIOSPhotoTaken('".concat(a,"','{0}');")});_("TakePhoto").postMessage(u).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=TakePhoto",data:u})}))}}},{key:"chooseFile",value:function(e){var t=e.RequestId;if(o.default.InAndroidWebView())l.default.IsAndroidAppWithMinVersion(15.7)?window.JeeneeAndroid.chooseFile("JeeneeBrowserAPI.onAndroidFileChosen('".concat(t,"','{0}','{1}');"),(0,E.getDrz)()):window.JeeneeAndroid.chooseFile("JeeneeBrowserAPI.onAndroidFileChosen('".concat(t,"','{0}','{1}');"));else{var n={callback:"JeeneeBrowserAPI.onIOSFileChosen('".concat(t,"','{0}','{1}');")};_("ChooseFile").postMessage(n).else((function(){$.ajax({type:"POST",async:!0,url:"/jeenee_new?method=ChooseFile",data:n})}))}}},{key:"takeVideo",value:function(e){var t,n,a=e.RequestId,r={galleryEnabled:null===(t=S.AppGlobals.AppModel.AppTemplate.Presentation.AllowGalleryAccess)||void 0===t||t,exposeToGallery:null===(n=S.AppGlobals.AppModel.AppTemplate.Behavior.SaveToGallery)||void 0===n||n,drzZone:(0,E.getDrz)()};if(o.default.InAndroidWebView())if(l.default.IsAndroidAppWithMinVersion(15.6)){var i=Object.assign(Object.assign({},r),{callback:"JeeneeBrowserAPI.onAndroidVideoTaken('".concat(a,"','{0}');")});window.JeeneeAndroid.takeVideo(JSON.stringify(i))}else window.JeeneeAndroid.takeVideo("JeeneeBrowserAPI.onAndroidVideoTaken('".concat(a,"',{0})"))}},{key:"handleNativeMedia",value:function(e,t,n,a,r){if(n===this.lastNativeMedia.nativeResourceId){this.lastNativeMedia.count+=1;var i=b.Common.uploadRequests,o=b.Common.awaitingUploadRequests,l="Multiple media callback calls for the same token";u.default.ReportError({errorMessage:l,context:e,fileUploadUtilsId:t,mediaType:a,nativeResourceId:n,uploadRequestFound:!!i[t],awaitingUploadRequestFound:!!o[t],uploadRequestCount:Object.keys(i).length,awaitingUploadRequestCount:Object.keys(o).length,msSinceLastCall:performance.now()-this.lastNativeMedia.time,totalCalls:this.lastNativeMedia.count,sameFileInput:t===this.lastNativeMedia.fileUploadUtilsId}),this.logNativeError(l,{fileUploadUtilsId:t,nativeResourceId:n})}else this.lastNativeMedia={nativeResourceId:n,fileUploadUtilsId:t,time:performance.now(),count:1};b.Common.awaitUploadRequest(t,(function(t){var i=y.default.from({type:e,value:n,mediaType:a,preferredWidth:t.preferredWidth});i.setFileName(r),b.Common.finishImageRead(t,i)}))}},{key:"onAndroidPhotoTaken",value:function(e,t){u.default.AddTraceContext("Photo Taken (android)",{fileUploadUtilsId:e}),p.logger.logAppEvent({eventName:v.AppEventName.PhotoTaken}),this.handleNativeMedia("Android",e,t,"photo")}},{key:"onAndroidFileChosen",value:function(e,t,n){u.default.AddTraceContext("File Chosen (android)",{fileUploadUtilsId:e}),p.logger.logAppEvent({eventName:v.AppEventName.FileChosen}),this.handleNativeMedia("Android",e,t,"file",n)}},{key:"onAndroidVideoTaken",value:function(e,t){u.default.AddTraceContext("Video Taken (android)",{fileUploadUtilsId:e}),p.logger.logAppEvent({eventName:v.AppEventName.VideoTaken}),this.handleNativeMedia("Android",e,t,"video")}},{key:"onIOSPhotoTaken",value:function(e,t,n){u.default.AddTraceContext("Photo Taken (iOS)",{fileUploadUtilsId:e}),p.logger.logAppEvent({eventName:v.AppEventName.PhotoTaken}),this.handleNativeMedia("IOS",e,t,"photo",n)}},{key:"onIOSFileChosen",value:function(e,t,n){u.default.AddTraceContext("File Chosen (iOS)",{fileUploadUtilsId:e}),p.logger.logAppEvent({eventName:v.AppEventName.FileChosen}),this.handleNativeMedia("IOS",e,t,"file",n)}},{key:"getBase64DataAndroid",value:function(e,t){var n;if(l.default.IsAndroidAppWithMinVersion(6.8)&&e.value()&&e.value().length<50){var a;try{a=window.JeeneeAndroid.getBase64Photo(e.value())}catch(e){var r=e;u.default.ReportErrorOnce({errorMessage:"Failed to load image data on Android (probably out of memory)",error:r}),a=O("Image may be missing or upload size may be too large for this device.")}t(a)}else t(null!==(n=e.value())&&void 0!==n?n:"")}},{key:"getBase64DataIOS",value:function(e,t){var n=this;_("GetBase64Photo").postMessage((function(){var a=(0,T.makeGuid)();return n.pendingCallbacks[a]=t,{path:encodeURIComponent(e.value()),callback:"JeeneeBrowserAPI.onBase64ResultIOS('".concat(a,"', '{0}');"),maxWidth:e.preferredWidth||(0,d.getMaxImageResolution)()}})).else((function(){n.getBase64FromIOSFallback(e,t)}))}},{key:"onBase64ResultIOS",value:function(e,t){t||(u.default.ReportErrorOnce({errorMessage:"Failed to load image data on iOS"}),t=O("Image may be missing or upload size may be too large for this device. The image may still be in the camera roll on the device."));var n=this.pendingCallbacks[e];null==n?u.default.ReportErrorOnce({errorMessage:"callback not found in onBase64ResultIOS"}):n(t),delete this.pendingCallbacks[e]}},{key:"getBase64FromIOSFallback",value:function(e,t){$.ajax({url:"/jeenee_url?path="+encodeURIComponent(e.value())+"&id=5",dataType:"text",success:function(e){(null==e?void 0:e.target)&&0!==e.target.trim().indexOf("<!")?t(e.target):(u.default.ReportErrorOnce({errorMessage:"Failed to load image data on iOS (preWK.success)"}),t(O("Image may be missing or upload size may be too large for this device. The image may still be in the camera roll on the device.")))},error:function(e){var n=e.responseText;n&&0!==n.trim().indexOf("<!")?t(n):(u.default.ReportErrorOnce({errorMessage:"Failed to load image data on iOS (preWK.error)"}),t(O("Image may be missing or upload size may be too large for this device. The image may still be in the camera roll on the device.")))},cache:!1})}},{key:"setGalleryEnableIOS",value:function(e){_("SetGalleryEnabledForImagePicker").postMessage(e).else((function(){l.default.IsIOSAppWithMinVersion(14.3)||$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=setGalleryEnabledForImagePicker",data:e})}))}},{key:"setMaxImageResolutionIOS",value:function(e){_("SetMaxImageResolution").postMessage(e).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=SetMaxImageResolution",data:e})}))}},{key:"getBase64PhotoFromCacheIOS",value:function(e,t){var n=this;_("GetBase64PhotoFromCache").postMessage((function(){var a=String(Math.random());return n.pendingCallbacks[a]=t,{callback:"JeeneeBrowserAPI.onResult('".concat(a,"', '{0}')"),url:e}})).else((function(){t("")}))}},{key:"onResult",value:function(e,t){var n=this.pendingCallbacks[e];n&&n(t),delete this.pendingCallbacks[e]}},{key:"setOnTokenRefreshListenerIOS",value:function(e){_("SetOnTokenRefreshListener").postMessage(e).else((function(){$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=setOnTokenRefreshListener",data:e})}))}},{key:"setOnNetworkConnectivityChangedListenerIOS",value:function(e){_("SetOnNetworkConnectivityChangedListener").postMessage(e)}},{key:"clearCookiesIOS",value:function(){_("ClearCookies").postMessage({}).else((function(){$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=ClearCookies"})}))}},{key:"shareIOS",value:function(e,t,n){_("Share").postMessage({text:e,url:t,imageurl:n}).else((function(){A.WindowWrapper.location="jeenee_method?Share?text="+e+"&url="+t+"&imageurl="+n}))}},{key:"disableScrollBounceIOS",value:function(){_("DisableBounce").postMessage({})}},{key:"setNotchColorIOS",value:function(e,t){_("SetNotchColor").postMessage({notchColor:e,notchTextStyle:t?"light":"dark"})}},{key:"setStorageAuth",value:function(e){o.default.InAndroidWebView()?window.JeeneeAndroid.setStorageAuth&&window.JeeneeAndroid.setStorageAuth(e):o.default.InIOSWebView()}},{key:"getFileStorageUrl",value:function(e,t){if(o.default.InAndroidWebView()&&window.JeeneeAndroid){var n=String(Math.random());this.pendingCallbacks[n]=t,window.JeeneeAndroid.getFileStorageUrl(e,"JeeneeBrowserAPI.onResult('".concat(n,"', '{0}')"))}else t("")}},{key:"setCurrentApp",value:function(e){try{var t=null!=e?e:{},n=t.Name,a=t.Id;if(null==n||null==a)return void u.default.ReportError({errorMessage:"JeeneeBrowserAPI.setCurrentApp got null Name or Id",Name:n,Id:a});if(l.default.IsAndroidAppWithMinVersion(7.6)&&!o.default.IsUnsupportedAndroidVersion())if(window.JeeneeAndroid.setCurrentTemplate(n),36===a.length){var r=e.Behavior.AutoBackgroundUpdate;l.default.IsAndroidAppWithMinVersion(13.4)?window.JeeneeAndroid.setCurrentAppGuid(a,r):window.JeeneeAndroid.setCurrentAppGuid(a)}else u.default.ReportError({errorMessage:"JeeneeBrowserAPI.setCurrentApp got invalid Id",Id:a});else l.default.IsIOSAppWithMinVersion(12.3)?this.setCurrentTemplateIOS({TemplateId:a,TemplateName:n}):l.default.IsIOSAppWithMinVersion(4.4)&&this.setCurrentTemplateIOS({TemplateId:n});this.currentAppKnownToNative=e}catch(e){u.default.ReportError({errorMessage:"JeeneeBrowserAPI.setCurrentApp failed",error:e})}}},{key:"setCurrentTemplateIOS",value:function(e){_("SetCurrentTemplate").postMessage(e).else((function(){$.ajax({type:"POST",url:"/jeenee_new?method=SetCurrentTemplate",data:e})}))}},{key:"getCurrentAppGuid",value:function(e){var t=this;_("GetCurrentAppGuid").postMessage((function(){var n=(0,T.makeGuid)();return t.pendingCallbacks[n]=e,{callback:"JeeneeBrowserAPI.onResult('".concat(n,"', '{0}')")}})).else((function(){e("")}))}},{key:"setNativeLocalizationStrings",value:function(e){e=e.filter((function(e){return e.ActionName!==e.DisplayName}));var t=c.default.reduce(e,(function(e,t){return e[t.ActionName]=c.default.toString(S.AppGlobals.AppModel.MapActionName(t.ActionName)),e}),{});l.default.IsAndroidAppWithMinVersion(13.6)&&window.JeeneeAndroid.setNativeLocalizationStrings?window.JeeneeAndroid.setNativeLocalizationStrings(JSON.stringify(t)):_("SetNativeLocalizationString").postMessage({localizationStrings:JSON.stringify(t)})}}]),e}());t.JeeneeBrowserAPI=k,window.JeeneeBrowserAPI=k},710304:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e.toLowerCase()){case"hy-am":case"zh":case"zh-cn":case"zh-tw":case"zh-hk":case"ga-ie":case"he-il":case"bn-in":case"gu-in":case"hi-in":case"kn-in":case"ml-in":case"mr-in":case"ta-in":case"te-in":case"ar-eg":case"ja-jp":case"ko-kr":case"ms-my":case"es-mx":case"mn-mn":case"th-th":case"en":case"en-au":case"en-ca":case"en-ie":case"en-in":case"en-gb":case"en-us":case"en-ph":return{thousands:",",decimal:"."};case"de-ch":case"it-ch":return{thousands:"'",decimal:"."};case"fr-ch":return{thousands:" ",decimal:"."};case"az-latn-az":case"pt-br":case"hr-hr":case"da":case"da-dk":case"de":case"de-de":case"el-gr":case"id-id":case"it-it":case"ms-bn":case"nl-nl":case"ro-ro":case"sr-cyrl-rs":case"sr-latn-rs":case"sl-si":case"ca-es":case"tr-tr":case"vi-vn":case"es-ar":case"es":case"es-bo":case"es-cl":case"es-co":case"es-ec":case"es-py":case"es-es":case"es-uy":case"es-ve":return{thousands:".",decimal:","};case"az-cyrl-az":case"bg-bg":case"fr":case"fr-fr":case"fr-ca":case"cs-cz":case"fi":case"fi-fi":case"ka-ge":case"hu-hu":case"lv-lv":case"lt-lt":case"nb-no":case"nn-no":case"pl-pl":case"pt":case"pt-pt":case"ru-ru":case"sk-sk":case"sv-se":case"uk-ua":case"en-za":return{thousands:" ",decimal:","};default:return null}}},249e3:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(496486)),i=a(n(730381)),o=a(n(365914)),l=a(n(710304));a(n(571524)).default.detectIfNeeded();var u=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};function s(e){return null==e||""===e?e:"string"==typeof e?e.split("").reverse().join(""):"function"==typeof e.reverse?e.reverse():e}function c(){try{(0).toLocaleString("i")}catch(e){return"RangeError"===e.name}return!1}var d={language:function(){return window.navigator.language||window.navigator.browserLanguage},_decimal:null,decimal:function(){return null==d._decimal&&(d._decimal=d.initDecimal()),d._decimal},_date:null,date:function(){return null==d._date&&(d._date=d.initDate()),d._date},reset:function(){d._decimal=null,d._date=null},initDecimal:function(){var e,t=",",n=".",a=!1,i=!1,o=d.language(),f=c()?o:void 0;try{var p=65432.1.toLocaleString(f);if("65432.1"===p){if(i=!0,o){var h=(0,l.default)(o);h||(h=(0,l.default)(o.slice(0,2))),h&&(n=h.decimal,t=h.thousands,a=!0)}}else{var v=p.match(new RegExp("^65(.)?432(.)1$"));null==v||3!==v.length?a=!1:(t=v[1]||"",n=v[2],a=!0)}a&&(e=new RegExp("^[-−]?\\d*(?:"+u(t)+"\\d{3})*(?:"+u(n)+"\\d*)?$"),a=!0)}catch(e){a=!1}return{supported:a,unformatted:i,thousandSeparator:t,decimalSeparator:n,pattern:e,fromLocaleString:function(r){if(!a||!r.match(e))return null;var i=r.split(n),o=i[0].replace(new RegExp(u(t),"g"),""),l=null!=i[1]?i[1]:"",s=o+(l.length?"."+l:"");return(null==s?void 0:s.indexOf("−"))>=0&&(s=s.replace(/−/g,"-")),isNaN(Number(s))?null:s},toLocaleString:function(e,t){return null==(t=t||{}).maximumFractionDigits||t.maximumFractionDigits>20?t.maximumFractionDigits=20:t.maximumFractionDigits<0&&(t.maximumFractionDigits=0),null==t.minimumIntegerDigits||t.minimumIntegerDigits<1?t.minimumIntegerDigits=1:t.minimumIntegerDigits>21&&(t.minimumIntegerDigits=21),i&&a&&"function"==typeof this.fallbackToLocaleString?this.fallbackToLocaleString(e,t):e.toLocaleString(f,t)},fallbackToLocaleString:function(e,a){var i=t;!1===a.useGrouping&&(i="");try{var o=Number(e).toString().split("."),l=o[0],u=o[1];null!=a.minimumIntegerDigits&&(l=r.default.padStart(l,a.minimumIntegerDigits,"0"));var c=s(l),d=c.match(/\d{3}/g);if(!d)return e.toString();var f=c.split(d.join(""))[1];(null==f?void 0:f.length)&&"-"!==f&&d.push(f);var p=s(d.join(i))+(null!=u&&u.length?n+u:"");return"-"===f&&(p="-"+p),p}catch(t){return e.toLocaleString(void 0,a)}}}},initDate:function(){var e,t,n=d.language(),a=c()?n:void 0;try{var r=new Date("11/22/3333").toLocaleDateString(a).replace(/&lrm;|\u200E/gi,"");e=r.replace("11","MM").replace("22","DD").replace("3333","YYYY");var l="08/31/2016",u=new Date(l).toLocaleDateString(a).replace(/&lrm;|\u200E/gi,"");if(o.default.MDYformat((0,i.default)(u,e).toDate(),!0)!==l)throw new Error("unsupported");t=!0}catch(n){t=!1,e="MM/DD/YYYY"}return{supported:t,dateFormat:e,wireFormat:"MM/DD/YYYY",momentFromWireFormat:function(e){return(0,i.default)(e,"M/D/YYYY",!0)},fromLocaleString:function(n){if(!t)return null;if(null==n||""===n)return"";var a=e.replace(/[MDY]{4}/g,"\\d{4}").replace(/[MDY]{2}/g,"\\d{1,2}").replace(/\./g,"\\.").replace(/\s/g,"\\s"),r=new RegExp(a);if(n.match(r)){var l=(0,i.default)(n,e).toDate();return isNaN(l.getTime())?null:o.default.MDYformat(l,!0)}return null}}}},f=d;t.default=f},65706:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.makeKey,n=e.limit,a=e.fn,o=e.getTimestamp,l={timestamp:void 0,data:[]};function u(){for(var e,s,c,d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];try{e=t.apply(null,f),s=null==o?void 0:o.apply(null,f),l.timestamp!==s&&u.invalidate(s),c=l.data;var h=r.default.findIndex(c,(function(t){return t.key===e}));if(-1!==h)return c[h].value}catch(e){(0,i.errorToDevConsole)(e)}var v=performance.now(),m=a.apply(null,f),g=performance.now()-v;if(null!=e){var y={key:e,value:m,evalTime:g};g<10?c.unshift(y):c.push(y),n&&c.length>n&&(c[0].evalTime>10&&(l.data=r.default.sortBy(c,(function(e){return e.evalTime}))),l.data.shift())}return m}return u.invalidate=function(e){l.timestamp=e,l.data.length=0},u};var r=a(n(496486)),i=n(593186)},21870:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SyncUI=t.SyncState=t.DEFAULT_HEADER_HEIGHT=t.DEFAULT_FOOTER_HEIGHT=t.DEFAULT_DRAWER_OPEN_WIDTH=t.DEFAULT_DRAWER_CLOSE_WIDTH=void 0;var i=a(n(856690)),o=a(n(689728)),l=a(n(918698)),u=n(166089),s=a(n(496486)),c=n(722188),d=a(n(907673)),f=n(629503),p=n(351101),h=a(n(455127)),v=a(n(69411)),m=n(557310),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=T(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(593186)),y=n(44617),b=n(365914);function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(T=function(e){return e?n:t})(e)}function S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var E,w=function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":(0,l.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};t.SyncUI=E,function(e){e[e.Hidden=0]="Hidden",e[e.Subtle=1]="Subtle",e[e.Detailed=2]="Detailed",e[e.Blocking=3]="Blocking"}(E||(t.SyncUI=E={}));var C=function(){function e(){var t=this;(0,i.default)(this,e),this.refreshing=!1,this.initiatedBy="AppStart",this.fakeProgress=0,this.ui=E.Hidden,this.legacyOverlay=new v.default,setInterval((function(){if(t.info&&t.info.remainingSteps){var e=t.fakeProgress+10*Math.random();e>100&&(e=100),t.fakeProgress=e}}),200)}return(0,o.default)(e,[{key:"visibility",get:function(){return E[this.ui]}},{key:"setPreferredUI",value:function(e){e>this.ui&&(this.ui=e,this.ui===E.Blocking&&this.refreshing&&(g.default.logToDevConsole("showing Launch screen"),this.onSyncingStatus(!0),u.AppGlobals.ViewManager.ShowLaunchScreen(),this.legacyOverlay.onSyncingStatus(!0)))}},{key:"reset",value:function(){this.error=void 0,this.warning=void 0,this.refreshing=!1,this.info=void 0,this.fakeProgress=0}},{key:"onStart",value:function(e){var t=e.initiatedBy,n=e.notification;g.default.logToDevConsole("Sync started (".concat(E[this.ui],")")),this.legacyOverlay.onStart(),this.reset(),this.refreshing=!0,this.initiatedBy=t,this.notification=n}},{key:"onFinish",value:function(){g.default.logToDevConsole(this.refreshing?"Sync finished":"Startup from local cache"),this.legacyOverlay.onFinish(),this.reset(),this.ui=E.Hidden}},{key:"onError",value:function(e){this.legacyOverlay.onError(e),this.reset(),y.dynamicRollouts.includeByOwnerId("ClientNoPushDelay")&&e===g.SYNC_CANCELED_ERROR_MESSAGE?this.ui=E.Hidden:(this.error=e,g.default.logToDevConsole("Sync errored",e))}},{key:"onWarning",value:function(e){this.legacyOverlay.onWarning(e),this.warning=e,g.default.logToDevConsole("Sync warning",e)}},{key:"onProgress",value:function(e){this.legacyOverlay.onProgress(e),e.remainingSteps&&this.info&&e.remainingSteps===this.info.remainingSteps||(this.fakeProgress=0),this.info=e}},{key:"onSyncingStatus",value:function(e){this.legacyOverlay.onSyncingStatus(e)}},{key:"close",value:function(){this.ui=E.Hidden,this.refreshing||this.reset()}},{key:"message",get:function(){var e=(0,p.mapActionName)("Saving changes"),t=(0,p.mapActionName)("Syncing...");if(this.info){var n=this.info,a=n.remainingSteps,r=n.totalSteps;if(null!=a&&null!=r)return a>0?"".concat(e," (").concat(r-a+1,"/").concat(r,")"):t}return t}},{key:"percentDone",get:function(){if(this.info){var e=this.info,t=e.remainingSteps,n=e.totalSteps,a=e.percentDone;if(null!=t&&null!=n&&null==a)return this.fakeProgress/Number(n.toFixed(2))+(n-t)/Number(n.toFixed(2))*100}return 0}}]),e}();t.SyncState=C,w([c.observable],C.prototype,"info",void 0),w([c.observable],C.prototype,"error",void 0),w([c.observable],C.prototype,"warning",void 0),w([c.observable],C.prototype,"refreshing",void 0),w([c.observable],C.prototype,"initiatedBy",void 0),w([c.observable],C.prototype,"fakeProgress",void 0),w([c.observable],C.prototype,"ui",void 0),w([c.observable],C.prototype,"notification",void 0),w([c.action.bound],C.prototype,"setPreferredUI",null),w([c.action.bound],C.prototype,"reset",null),w([c.action.bound],C.prototype,"onStart",null),w([c.action.bound],C.prototype,"onFinish",null),w([c.action.bound],C.prototype,"onError",null),w([c.action.bound],C.prototype,"onWarning",null),w([c.action.bound],C.prototype,"onProgress",null),w([c.action.bound],C.prototype,"close",null);t.DEFAULT_FOOTER_HEIGHT=60;t.DEFAULT_HEADER_HEIGHT=56;t.DEFAULT_DRAWER_CLOSE_WIDTH=56;t.DEFAULT_DRAWER_OPEN_WIDTH=256;var O=function(){function e(){var t,n,a=this;(0,i.default)(this,e),this.widescreenBreakpoint=768,this.throttledToasts=new Map,this.toasts=[],this.showSearchControl=!0,this.showFooter=!0,this.headerSelectedTabIndex=new Map,this.headerHeight=56,this.drawerCloseWidth=56,this.drawerOpenWidth=256,this.headerTitle="",this.headerActionButtons=[],this.sideMenuOpen=!1,this.syncQueueCount=0,this.appTemplate=null,this.searchQuery=null,this.searchEnabled=!1,this.showAboutView=!1,this.localStorageState=new Map,this.totalFilesToCache=null,this.filesCached=null,this.filesWithError=null,this.hashState={general:{},specific:{},selectionCount:null},this.windowWidth=(null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.clientWidth)||0,this.windowHeight=(null===(n=null===document||void 0===document?void 0:document.body)||void 0===n?void 0:n.clientHeight)||0,this.flexBackgroundWidth=(0,b.maxDimensionPixels)(this.windowWidth,this.windowHeight),this.dataStamp=null,this.syncState=new C,this.initialized=!1,window.addEventListener("resize",(function(){return a.onResize()}))}return(0,o.default)(e,[{key:"setHash",value:function(e,t,n){e=e||{},t=t||{},this.hashState={general:e,specific:t,selectionCount:n}}},{key:"hash",get:function(){return this.hashState}},{key:"currentView",get:function(){return this.appTemplate?this.appTemplate.getView(this.hash.general.ControlName):null}},{key:"headerTabs",get:function(){var e=this,t=this.currentView;if(t){var n=t.definition();if("dashboard"===t.viewType()&&n.ShowTabs&&this.windowWidth<=this.widescreenBreakpoint)return n.ViewEntries.map((function(t){var n=e.appTemplate.getView(t.ViewName);return n.shouldBeShown(u.AppGlobals.AppModel)?(0,b.makePrettyTitle)(n.displayName(u.AppGlobals.AppModel),n):null})).filter((function(e){return null!==e}))}return[]}},{key:"footerEntries",get:function(){var e,t=(null===(e=this.appTemplate)||void 0===e?void 0:e.viewControls())||[],n=function(e){return u.AppGlobals.AppModel.POSITIONS_ORDERED.indexOf(e)};return t.filter((function(e){return e.IsValid&&e.Position!==u.AppGlobals.AppModel.POSITION_MENU&&e.Position!==u.AppGlobals.AppModel.POSITION_REF})).sort((function(e,t){return n(e.Position)-n(t.Position)}))}},{key:"footerHeight",get:function(){return this.showFooter?60:0}},{key:"viewWidth",get:function(){return this.windowWidth}},{key:"viewHeight",get:function(){return this.windowHeight-this.headerHeight-this.footerHeight}},{key:"headerTabIndex",get:function(){return this.currentView&&this.headerSelectedTabIndex.get(this.currentView.name())||0}},{key:"selectHeaderTab",value:function(e){this.currentView&&this.headerSelectedTabIndex.set(this.currentView.name(),e)}},{key:"showToast",value:function(e){this.toasts.includes(e)||this.toasts.push(e)}},{key:"dismissToast",value:function(){this.toasts.shift()}},{key:"showToastThrottled",value:function(e,t){var n=this,a=this.throttledToasts.get(e),r=null==a?void 0:a.throttled;r&&(null==a?void 0:a.cooldown)===t||(r=s.default.throttle((function(){return n.showToast(e)}),t,{trailing:!1,leading:!0}),this.throttledToasts.set(e,{throttled:r,cooldown:t})),r()}},{key:"isWideScreen",get:function(){return this.windowWidth>this.widescreenBreakpoint}},{key:"showResetDash",get:function(){return this.isWideScreen&&"dashboard"===this.hash.general.Root}},{key:"onResize",value:function(){var e=document.documentElement,t=e.clientWidth,n=e.clientHeight;this.windowWidth=t,this.windowHeight=n;var a=(0,b.maxDimensionPixels)(t,n);a>this.flexBackgroundWidth&&(this.flexBackgroundWidth=a)}},{key:"flexLaunchBackgroundUrl",get:function(){var e,t=null===(e=this.appTemplate)||void 0===e?void 0:e.model.Presentation.BackgroundImageUrl;return t?f.Common.FlexImageUrl(t,this.flexBackgroundWidth):""}},{key:"flexPageBackgroundUrl",get:function(){var e,t=null===(e=this.appTemplate)||void 0===e?void 0:e.model.Presentation.PageBackgroundImageUrl;return t?f.Common.FlexImageUrl(t,this.flexBackgroundWidth):""}},{key:"syncProgressHandle",get:function(){return(null==this._syncProgressHandle||this._syncProgressHandle.disabled)&&(this._syncProgressHandle=new h.default(this.syncState)),this._syncProgressHandle}},{key:"navigateToView",value:function(e){u.AppGlobals.AppState.SetActiveControl(e.control(),InputHandler.rootStateForControl,e.isFullScreen())}},{key:"navigateToPreviousHashState",value:function(){u.AppGlobals.AppState.NavigationStack.pop();var e=u.AppGlobals.AppState.NavigationStack[u.AppGlobals.AppState.NavigationStack.length-1],t=(null==e?void 0:e.HashState)||"",n=u.AppGlobals.AppState.ParseHash(t),a=n.page;if(""!==t&&(null!=a&&"empty"!==a||n.view))e.AppTemplateName!==u.AppGlobals.AppModel.AppTemplate.Name?this.PushState({Root:"empty"}):(e.scrollTop&&(this.restoreScrollPosition=e.scrollTop),u.AppGlobals.AppState.SetWindowHash(e.HashState));else{var r,i,o,l,s,c,d;u.AppGlobals.AppModel.AppTemplate.Presentation.Controls.filter((function(e){return e.IsValid&&"form"!==e.Action&&e.Action!==u.AppGlobals.AppState.CurrentUIState.Root&&null!=u.AppGlobals.AppModel.DisplayActions[e.Action]})).forEach((function(e){e.Name===u.AppGlobals.AppModel.AppTemplate.Presentation.DefaultStartView&&(r=e),e.Position===u.AppGlobals.AppModel.POSITION_FAR_LEFT&&(i=e),e.Position===u.AppGlobals.AppModel.POSITION_LEFT&&(o=e),e.Position===u.AppGlobals.AppModel.POSITION_RIGHT&&(l=e),e.Position===u.AppGlobals.AppModel.POSITION_FAR_RIGHT&&(s=e),e.Position===u.AppGlobals.AppModel.POSITION_CENTER&&(c=e),e.Position===u.AppGlobals.AppModel.POSITION_MENU&&(d=e)}));var f=r||i||o||l||s||c||d;f?u.AppGlobals.AppState.SetActiveControl(f,InputHandler.rootStateForControl):(u.AppGlobals.AppState.ActiveControl=null,u.AppGlobals.AppState.ResetState({Root:"empty"}))}}},{key:"setSearch",value:function(e){var t=e.searchQuery,n=void 0===t?this.searchQuery:t,a=e.searchEnabled,r=void 0===a?this.searchEnabled:a;this.searchQuery=n,this.searchEnabled=r}},{key:"setCachingProgress",value:function(e){var t=e.totalFilesToCache,n=void 0===t?this.totalFilesToCache:t,a=e.filesCached,r=void 0===a?this.filesCached:a,i=e.filesWithError,o=void 0===i?this.filesWithError:i;this.totalFilesToCache=n,this.filesCached=r,this.filesWithError=o}},{key:"setSideMenuOpen",value:function(e){this.sideMenuOpen=e,u.AppGlobals.StateChangeHandler.ShowUIState(!0)}},{key:"setAppTemplate",value:function(e){this.appTemplate=e}},{key:"initStateFromLocalStorage",value:function(e){var t=this;this.initialized?e&&e(this.localStorageState):(u.AppGlobals.AppModel.GetViewState().then((function(n){n||(n={}),t.localStorageState=new Map(Object.entries(n)),e&&e(t.localStorageState)})),this.initialized=!0)}}]),e}();w([c.observable],O.prototype,"widescreenBreakpoint",void 0),w([c.action.bound],O.prototype,"setHash",null),w([c.computed],O.prototype,"hash",null),w([c.computed],O.prototype,"currentView",null),w([c.computed],O.prototype,"headerTabs",null),w([c.computed],O.prototype,"footerEntries",null),w([c.computed],O.prototype,"footerHeight",null),w([c.computed],O.prototype,"viewWidth",null),w([c.computed],O.prototype,"viewHeight",null),w([c.computed],O.prototype,"headerTabIndex",null),w([c.action.bound],O.prototype,"selectHeaderTab",null),w([c.observable],O.prototype,"toasts",void 0),w([c.action.bound],O.prototype,"showToast",null),w([c.action.bound],O.prototype,"dismissToast",null),w([c.action.bound],O.prototype,"showToastThrottled",null),w([c.observable],O.prototype,"showSearchControl",void 0),w([c.observable],O.prototype,"showFooter",void 0),w([c.observable],O.prototype,"headerSelectedTabIndex",void 0),w([c.observable],O.prototype,"headerHeight",void 0),w([c.observable],O.prototype,"drawerCloseWidth",void 0),w([c.observable],O.prototype,"drawerOpenWidth",void 0),w([c.observable],O.prototype,"headerTitle",void 0),w([c.observable],O.prototype,"headerActionButtons",void 0),w([c.observable],O.prototype,"sideMenuOpen",void 0),w([c.observable],O.prototype,"syncQueueCount",void 0),w([c.observable],O.prototype,"appTemplate",void 0),w([c.observable],O.prototype,"searchQuery",void 0),w([c.observable],O.prototype,"searchEnabled",void 0),w([c.observable],O.prototype,"showAboutView",void 0),w([c.observable],O.prototype,"localStorageState",void 0),w([c.observable],O.prototype,"totalFilesToCache",void 0),w([c.observable],O.prototype,"filesCached",void 0),w([c.observable],O.prototype,"filesWithError",void 0),w([c.observable],O.prototype,"hashState",void 0),w([c.observable],O.prototype,"windowWidth",void 0),w([c.observable],O.prototype,"windowHeight",void 0),w([c.observable],O.prototype,"flexBackgroundWidth",void 0),w([c.observable],O.prototype,"dataStamp",void 0),w([c.observable],O.prototype,"syncState",void 0),w([c.computed],O.prototype,"isWideScreen",null),w([c.computed],O.prototype,"showResetDash",null),w([c.action.bound],O.prototype,"onResize",null),w([c.computed],O.prototype,"flexLaunchBackgroundUrl",null),w([c.computed],O.prototype,"flexPageBackgroundUrl",null),w([c.action.bound],O.prototype,"setSearch",null),w([c.action.bound],O.prototype,"setCachingProgress",null),w([c.action.bound],O.prototype,"setSideMenuOpen",null),w([c.action.bound],O.prototype,"setAppTemplate",null);var _=!0===window.APPSHEET_TEST_CONTEXT||m.ReactRootUIConfig.isReactRoot()?(0,d.default)(new O):new O;(0,c.autorun)((function(){var e,t,n=S(_.localStorageState.values());try{for(n.s();!(t=n.n()).done;)t.value}catch(e){n.e(e)}finally{n.f()}var a=_.localStorageState;(null===(e=u.AppGlobals.AppModel)||void 0===e?void 0:e.SetViewState)&&u.AppGlobals.AppModel.SetViewState(a)}));var k=_;t.default=k},891666:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.nativeGeolocationManager=t.NativeGeolocationManager=void 0;var r=a(n(689728)),i=a(n(856690)),o=a(n(496486)),l=a(n(593186)),u=a(n(190644)),s=n(263198);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var f=(0,r.default)((function e(){var t=this;(0,i.default)(this,e),this._nextId=1,this.highAccuracy=!1,this.isFetching=!1,this.listeners=[],this.shortestInterval=1/0,this.shouldStartFetching=function(e){var n=e.interval,a=e.enableHighAccuracy;return!t.isFetching||n&&n<t.shortestInterval||!0===a&&!t.highAccuracy},this.getCurrentPosition=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=a.enableHighAccuracy,i=void 0!==r&&r,o=a.timeout,s=void 0===o?1e4:o,c=a.maximumAge,d=void 0===c?6e4:c;if(u.default.pending||t.shouldStartFetching({enableHighAccuracy:i})){var f;l.default.logToDevConsole("NativeGeolocationManager.getCurrentPosition adding a listener");var p=t.addListener({callback:function(n){clearTimeout(f),t.removeListener(p),e(n)},failureCallback:function(e){clearTimeout(f),t.removeListener(p),n(e)},enableHighAccuracy:i,interval:d});setTimeout((function(){t.removeListener(p),n(new Error("getCurrentPosition timed out"))}),s)}else u.default.lastPosition?(l.default.logToDevConsole("NativeGeolocationManager.getCurrentPosition using lastPosition"),e(u.default.lastPosition)):(l.default.logToDevConsole("NativeGeolocationManager.getCurrentPosition location not available"),n(new Error("Location is not available")))},this.addListener=function(e){var n=e.callback,a=void 0===n?function(){}:n,r=e.failureCallback,i=void 0===r?function(){}:r,o=e.interval,u=void 0===o?6e4:o,s=e.enableHighAccuracy,c=void 0!==s&&s,d={id:t._nextId++,type:"NativeGeolocationManager",callback:a,failureCallback:i,interval:u,enableHighAccuracy:c};return t.listeners.push(d),l.default.logToDevConsole("adding listener"),t.shouldStartFetching(d)&&(d.interval&&(t.shortestInterval=t.shortestInterval?Math.min(t.shortestInterval,d.interval):d.interval),d.enableHighAccuracy&&(t.highAccuracy=!0),t._startFetching()),d},this.removeListener=function(e){if(e){var n=t.listeners.findIndex((function(t){return t.id===e.id}));if(n>=0){l.default.logToDevConsole("removing listener");var a=t.listeners[n];if(t.listeners.splice(n,1),0===t.listeners.length)t._stopFetching(),t.shortestInterval=1/0,t.highAccuracy=!1;else{var r=!1;a.interval===t.shortestInterval&&a.interval!==t._findNewShortestInterval()&&(r=!0),a.enableHighAccuracy&&!t._findNewAccuracy()&&(r=!0),r&&t._startFetching()}}}},this.removeAllListeners=function(){t.listeners.forEach(t.removeListener)},this.getFetchInterval=function(){return t.shortestInterval},this._locationCallback=function(e){var n,a=c(t.listeners);try{for(a.s();!(n=a.n()).done;){(0,n.value.callback)({coords:e})}}catch(e){a.e(e)}finally{a.f()}},this._failureCallback=function(e){var n,a=c(t.listeners);try{for(a.s();!(n=a.n()).done;){(0,n.value.failureCallback)(e)}}catch(e){a.e(e)}finally{a.f()}},this._startFetching=function(){s.JeeneeBrowserAPI.startLocationUpdates({callback:t._locationCallback,failureCallback:t._failureCallback,interval:t.shortestInterval,enableHighAccuracy:t.highAccuracy}),t.isFetching=!0},this._stopFetching=function(){s.JeeneeBrowserAPI.stopLocationUpdates(),t.isFetching=!1},this._findNewShortestInterval=function(){return t.shortestInterval=t.listeners.map((function(e){return e.interval})).reduce((function(e,t){return e<t?e:t})),t.shortestInterval},this._findNewAccuracy=function(){return t.highAccuracy=o.default.some(t.listeners,(function(e){return e.enableHighAccuracy})),t.highAccuracy}}));t.NativeGeolocationManager=f;var p=new f;t.nativeGeolocationManager=p},75212:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.parseHash=void 0;var r=a(n(280129));t.parseHash=function(e){e=(e||"").replace(/^#/,"");try{return r.default.parse(e)}catch(e){return{}}}},498967:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(166089),i=a(n(496486)),o=a(n(674823)),l=a(n(365914));function u(e,t){return e<t?-1:e>t?1:0}function s(e){return i.default.toLower(i.default.toString(e))}var c=new Map;function d(e){var t=c.get(e);if(null!=t)return t;t=[];for(var n,a,r=0,i=-1,o=0;n=(a=e.charAt(r++)).charCodeAt(0);){var l=46===n||n>=48&&n<=57;l!==o&&(t[++i]="",o=l),t[i]+=a}return c.set(e,t),t}var f=/[0-9]/;var p=function(){function e(e,t,n,a,r,i){for(var o=n,l=a+1,u=n;;){if(i(e[o],e[l])<=0){if(t[u++]=e[o++],o>a){do{t[u++]=e[l++]}while(l<=r);break}}else if(t[u++]=e[l++],l>r){do{t[u++]=e[o++]}while(o<=a);break}}}function t(t,a,r,i,o){if(!(i<r))if(i!=r){var l=Math.floor(r+(i-r)/2);n(t,a,r,l,o),n(t,a,l+1,i,o),e(t,a,r,l,i,o)}else a[r]=t[r]}function n(n,a,r,i,o){if(!(i<=r)){var l=Math.floor(r+(i-r)/2);t(n,a,r,l,o),t(n,a,l+1,i,o),e(a,n,r,l,i,o)}}return function(e,t){var a=e.slice(0);return n(e,a,0,e.length-1,t),e}}(),h=i.default.memoize((function(e){return new Date(e).getTime()})),v=i.default.memoize((function(e){return l.default.timeToDate(e).getTime()})),m={numericComparer:function(e,t){var n=Number(e),a=Number(t);return null!=e&&""!==e&&!isNaN(n)||null!=t&&""!==t&&!isNaN(a)?null==e||""===e||isNaN(n)?-1:null==t||""===t||isNaN(a)?1:n<a?-1:n>a?1:0:0},timeComparer:function(e,t){return m.utcMsComparer(v(e),v(t))},dateComparer:function(e,t){return m.utcMsComparer(h(e),h(t))},nativeDateComparer:function(e,t){return m.utcMsComparer(null==e?void 0:e.getTime(),null==t?void 0:t.getTime())},utcMsComparer:function(e,t){return isNaN(e)&&isNaN(t)?0:isNaN(e)?-1:isNaN(t)?1:e<t?-1:e>t?1:0},durationComparer:function(e,t){return null==e||null==t?0:m.numericComparer(e.replace(/:/g,""),t.replace(/:/g,""))},textComparer:function(e,t){return function(e,t){if(e=(0,o.default)(e),t=(0,o.default)(t),!f.test(e)&&!f.test(t))return u(e,t);for(var n=d(e),a=d(t),r=0;n[r]&&a[r];r++)if(n[r]!==a[r]){var i=Number(n[r]),l=Number(a[r]);if(i!=n[r]||l!=a[r])return n[r]>a[r]?1:-1;if(i!==l)return i-l}return e!==t&&n.length===a.length?u(e,t):n.length-a.length}(e?e.toLowerCase():"",t?t.toLowerCase():"")},genericComparer:u,listComparer:function(e,t,n){var a=e.indexOf(t),r=e.indexOf(n);return-1===a&&-1===r?this.genericComparer(t,n):-1===a?1:-1===r||a<r?-1:a>r?1:t===n?0:-1},labelComparer:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(n||(n={}),n.keyLabelMap&&n.labelComparer){var r=n.keyLabelMap[e],o=n.keyLabelMap[t];if(a<50){if(null!=r&&null!=o)return n.labelComparer(r,o,n,a+1);if(n.labelComparer!==m.labelComparer)return n.labelComparer(s(e),s(t),n,a+1)}}var l=function(e){return e?i.default.isString(e)?e.toLowerCase():e:""};return m.genericComparer(l(e),l(t))},sort:p,findSortInfo:function(e,t){var n;null!=t&&0!==t.length||((n=e.findAttributeByName(r.AppGlobals.AppModel.ROW_NUMBER_ATTRNAME))||(n=e.keyAttribute()),t=n.name());var a=!1;return 0===t.indexOf(r.AppGlobals.AppModel.DESC_SORT_PREFIX)&&(a=!0,t=t.replace(r.AppGlobals.AppModel.DESC_SORT_PREFIX,"")),{attribute:e.findAttributeByName(t),inverted:a}}},g=m;t.default=g},266522:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=a(n(627424)),o=a(n(856690)),l=a(n(689728)),u=n(166089),s=a(n(6767)),c=a(n(496486)),d=a(n(400568)),f=n(646514),p=a(n(593186)),h=n(714067),v=a(n(571524)),m=n(557310),g=n(646317),y=a(n(365914)),b=a(n(112368)),T={colorInputRed:"#fa5252",colorInputOrange:"#ff922b",colorInputYellow:"#ffd43b",colorInputGreen:"#51cf66",colorInputBlue:"#329af0",colorInputPurple:"#cc5de8",colorInputBlack:"#444",colorInputWhite:"#eee",cardBorderStyleDefault:"1px solid",cardBorderStyleSelected:"2px solid",cardBorderRadiusDefault:"4px",cardTopBorderRadiusLarge:"4px 4px 0 0",cardBottomBorderRadiusLarge:"0 0 4px 4px",nonCardHeaderTextOverlay:"linear-gradient(to bottom, rgba(255,0,0,0), 40%, rgba(0,0,0,0.6))"},S={Red:{mainColor:"#d95050",secondaryColor:"#ce4444",tertiaryColor:"#a93131",highlightColor:"#ce3737",mainTextColor:f.GOOGLE_WHITE},Orange:{mainColor:"#ff9b3d",secondaryColor:"#ea8e38",tertiaryColor:"#d47a26",highlightColor:"#ff8616",mainTextColor:f.GOOGLE_WHITE},LightGreen:{mainColor:"#64b161",secondaryColor:"#56a753",tertiaryColor:"#468c44",highlightColor:"#559e52",mainTextColor:f.GOOGLE_WHITE},ForestGreen:{mainColor:"#1b7c14",secondaryColor:"#196d13",tertiaryColor:"#125d0c",highlightColor:"#1d6b17",mainTextColor:f.GOOGLE_WHITE},Teal:{mainColor:"#2db2c5",secondaryColor:"#2aa7b9",tertiaryColor:"#228f9e",highlightColor:"#2798a9",mainTextColor:f.GOOGLE_WHITE},MediumBlue:{mainColor:"#4891db",secondaryColor:"#3f85cc",tertiaryColor:"#3675B5",highlightColor:"#2e7ac7",mainTextColor:f.GOOGLE_WHITE},NavyBlue:{mainColor:"#303aa5",secondaryColor:"#232d98",tertiaryColor:"#1c2373",highlightColor:"#27308e",mainTextColor:f.GOOGLE_WHITE},Purple:{mainColor:"#9575cd",secondaryColor:"#8c6ec1",tertiaryColor:"#7156a0",highlightColor:"#8666bb",mainTextColor:f.GOOGLE_WHITE},Magenta:{mainColor:"#d94da6",secondaryColor:"#ce489d",tertiaryColor:"#b14288",highlightColor:"#CF3697",mainTextColor:f.GOOGLE_WHITE},Almond:{mainColor:"#8d6e63",secondaryColor:"#826257",tertiaryColor:"#75554a",highlightColor:"#775e54",mainTextColor:f.GOOGLE_WHITE},"AppSheet Official":{mainColor:"#3dbfea",secondaryColor:"#37b1da",tertiaryColor:"#2a9abf",highlightColor:"#2daed8",mainTextColor:f.GOOGLE_WHITE}},A={Red:{mainColor:"#B71C1C",mainTextColor:"#EEE"},Orange:{mainColor:"#D08025",mainTextColor:"#EEE"},Yellow:{mainColor:"#FFCC06",mainTextColor:"#111"},LightGreen:{mainColor:"#68B366",mainTextColor:"#EEE"},ForestGreen:{mainColor:"#1b7c14",mainTextColor:"#EEE"},Teal:{mainColor:"#1792A0",mainTextColor:"#EEE"},MediumBlue:{mainColor:"#4891DB",mainTextColor:"#EEE"},NavyBlue:{mainColor:"#3F51B5",mainTextColor:"#EEE"},Purple:{mainColor:"#9575CD",mainTextColor:"#EEE"},Magenta:{mainColor:"#da4ea6",mainTextColor:"#EEE"}},E={White:{Blue:"#1e88e5",Red:"#e53935",Amber:"#ffa000",Green:"#43a047",Orange:"#e8710a",Pink:"#d81b60",Purple:"#8e24aa",Cyan:"#00acc1"},Dark:{Blue:"#90caf9",Red:"#ef9a9a",Amber:"#ffe082",Green:"#a5d6a7",Orange:"#ffcc80",Pink:"#f48fb1",Purple:"#ce93d8",Cyan:"#80deea"}},w=function(e,t){var n,a,r=null===(n=null==t?void 0:t.Presentation)||void 0===n?void 0:n.HeaderStyle,i=null===(a=null==t?void 0:t.Presentation)||void 0===a?void 0:a.FooterStyle,o=f.LIGHT_ELEVATION,l=f.LIGHT_ELEVATION,u=(0,s.default)(e.mainColor);return{mainBackground:f.GOOGLE_SURFACE_LIGHT,mainContentBackground:f.GOOGLE_WHITE,mainBackgroundVariant:"#F3F3F3",mainContentBackgroundList:f.GOOGLE_SURFACE_LIGHT,mainBackgroundVariantTranslucent:"rgba(0, 0, 0, 0.06)",mainBackgroundVariantExtra:f.GOOGLE_GREY_200,mainBackgroundTranslucent:(0,s.default)(f.GOOGLE_GREY_900).fade(.4).rgb().string(),formTabHover:"rgba(255,255,255,.8)",inputBackground:f.GOOGLE_WHITE,disabledInputBackground:"#EEE",detailBackground:f.LIGHT_ELEVATION,dividerColor:"#DDD",mainBorderColor:f.GOOGLE_GREY_300,weakAccentColor:f.STATE_FOCUS,mediumAccentColor:"#C2C2C2",focusColor:e.mainColor,detailSectionDivider:f.GOOGLE_GREY_100,buttonDisabledBorder:f.GOOGLE_GREY_300,buttonDisabledBackground:"rgba(0, 0, 0, 0.12)",faintBorderColor:"rgba(0, 0, 0, 0.12)",buttonOutline:e.mainColor,buttonTextColor:f.GOOGLE_WHITE,elevationTone1:f.LIGHT_ELEVATION,elevationTone2:f.LIGHT_ELEVATION2,elevationBoxShadow2:"3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",elevationTone3:f.LIGHT_ELEVATION3,elevationBoxShadow3:"0px 6px 10px rgba(0, 0, 0, 0.14), 0px 1px 18px rgba(0, 0, 0, 0.12), 0px 3px 5px rgba(0, 0, 0, 0.2)",bottomDrawerText:f.GOOGLE_GREY_800,bottomDrawerIcon:f.GOOGLE_GREY_700,cardOutlineDefault:f.GOOGLE_GREY_300,cardHoverShadowDefault:"0px 2px 2px rgba(0,0,0,0.14), 0px 3px 1px rgba(0,0,0,0.12), 0px 1px 5px rgba(0,0,0,0.2)",cardHoverBackgroundNarrowscreen:f.STATE_HOVER,cardHoverBackgroundDefault:f.GOOGLE_WHITE,tableBackground:o,tableGroupedHeaderTitle:f.GOOGLE_GREY_700,tableGroupedHeader:f.GOOGLE_SURFACE_LIGHT,tableGroupedAggregateContent:f.GOOGLE_GREY_800,tableAggregateBackground:f.GOOGLE_GREY_300,tableRow:l,tableRowFocus:f.STATE_FOCUS,tableRowHover:f.STATE_HOVER,tableRowSelectedHover:f.STATE_HOVER_SELECTED,tableRowSelectedHoverUpdate:u.alpha(.06).rgb().string(),chipHover:f.STATE_HOVER,drilldownArrow:f.GOOGLE_GREY_900,inputBorder:f.GOOGLE_GREY_400,inputBorderHover:f.GOOGLE_GREY_600,inputBorderDisabled:f.GOOGLE_GREY_200,inputInlineButtons:f.GOOGLE_GREY_700,inputBlockerBackground:(0,s.default)(f.GOOGLE_WHITE).fade(.2).rgb().string(),codeBackgroundColor:f.GOOGLE_GREY_50,codeTextColor:f.GOOGLE_GREY_800,slideshowArrowColor:f.GOOGLE_GREY_900,slideshowArrowBackgroundHover:f.GOOGLE_GREY_200,slideshowArrowBackgroundColor:f.GOOGLE_GREY_300,groupedByAggregateBackground:f.GOOGLE_GREY_200,groupedByAggregateContent:f.GOOGLE_GREY_700,calendarDivider:f.GOOGLE_GREY_200,elevationBoxShadow1:"0px 2px 2px -2px rgba(0, 0, 0, 0.14),  0px 3px 1px -1px rgba(0, 0, 0, 0.12), 0px 1px 5px -5px rgba(0, 0, 0, 0.2)",modalContentBorder:f.GOOGLE_GREY_300,focusColorRgb:u.fade(.88).rgb().string(),hoverColorRgb:u.fade(.96).rgb().string(),primaryText:f.GOOGLE_GREY_900,secondaryText:f.GOOGLE_GREY_800,minorText:f.GOOGLE_GREY_700,minorBodyText:f.GOOGLE_GREY_700,disabledText:"rgba(0, 0, 0, 0.38)",highlightOverlay:(0,s.default)(e.highlightColor).mix((0,s.default)(f.GOOGLE_WHITE),.82).rgb().string(),highlightOverlayUpdate:u.alpha(.13).rgb().string(),highlightOverlayTransparent:(0,s.default)(e.highlightColor).fade(.5).rgb().string(),interfaceBackgroundShadow:"rgba(0, 0, 0, 0.1)",interfaceBackgroundShadowStrong:"rgba(0, 0, 0, 0.3)",interfaceText:"#333",interfaceHighlightText:e.highlightColor,interfaceTextShadow:"transparent",interfaceBackground:"#F8F8F8",headerText:r===h.HEADERSTYLE_COLOR?e.mainTextColor:"#333",headerBackground:r===h.HEADERSTYLE_COLOR?e.mainColor:"#FFFFFF",footerText:i===h.FOOTERSTYLE_COLOR?e.mainTextColor:f.GOOGLE_GREY_700,footerBackground:i===h.FOOTERSTYLE_COLOR?e.mainColor:"#FFFFFF",interfaceSecondaryBackground:"#efefef",interfaceTertiaryBackground:"#d6d6d6",interfaceHighlightBackground:"#F8F8F8",interfaceIndicator:"#cc0b0b",actionIcon:e.highlightColor,actionButtonDeselectedShadow:"none",actionButtonDeselectedText:f.GOOGLE_GREY_700,actionButtonDeselectedBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonDeselectedBorder:f.GOOGLE_GREY_300,actionButtonText:e.mainTextColor,actionButtonBackground:e.mainColor,actionButtonHighlight:e.highlightColor,actionButtonBorder:e.mainColor,actionButtonHoverText:f.GOOGLE_GREY_800,actionButtonHoverBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonHoverBorder:f.GOOGLE_GREY_300,actionButtonPressText:f.GOOGLE_GREY_800,actionButtonPressBackground:f.GOOGLE_GREY_200,actionButtonPressBorder:f.GOOGLE_GREY_300,formatIconDefaultColor:e.mainTextColor,flatControlBackground:"rgba(0, 0, 0, 0.1)",flatControlForeground:e.mainTextColor,flatControlHighlight:e.highlightColor,attentionItemText:e.mainTextColor,attentionBackground:e.mainColor,errorColor:"#E66",warningColor:"#E4D58D",webpageBarColor:f.GOOGLE_WHITE,androidSystemBarColor:"black",amplifyColor:"rgba(0, 0, 0, 0.3)",amplifyColorTransparent:"rgba(0, 0, 0, 0)",signatureBackground:"#F8F8F8",themeMainColor:e.mainColor,themeTextColor:e.mainColor,themeBackgroundColor:u.alpha(.13).rgb().string(),themeBackgroundHover:u.alpha(.2).rgb().string(),sideMenuHeaderDividerColor:f.GOOGLE_GREY_200,sideMenuBackgroundColor:f.LIGHT_ELEVATION4,sideMenuBackgroundColorTransparent:"rgba(253,253,253,0)",sideMenuScrollShadow:"rgb(240, 240, 240)",sideMenuScrollShadowTransparent:"rgb(240, 240, 240, 0)",sideMenuSelected:u.fade(.9).rgb().string(),sideMenuTextColor:f.GOOGLE_GREY_800,sideMenuIconColor:f.GOOGLE_GREY_700,sideMenuBackgroundOverlay:f.SURFACE_DARK,thinScrollbarColor:f.GOOGLE_GREY_700,dropdownChipBackgroundColor:f.GOOGLE_WHITE,dropdownChipBorderColor:"#DADCE0",dropdownSpecialOptionBorderColor:f.GOOGLE_GREY_700,dropdownOverflowNumberColor:"#5F6368",dropdownInputBaseTableQuickEditFocusedColor:f.GOOGLE_WHITE,syncErrorIconColor:f.GOOGLE_RED_600,syncButtonBorderColor:"#dadce0",syncSeverityInfo:f.GOOGLE_THEME_INFO_LIGHT,syncSeverityWarning:f.GOOGLE_THEME_WARNING_LIGHT,syncSeverityError:f.GOOGLE_THEME_ERROR_LIGHT,syncSeverityOffline:f.GOOGLE_GREY_100,syncBadgeForUnsyncedChanges:"rgb(241,152,1)",syncErrorButtonBackground:f.GOOGLE_THEME_ERROR_LIGHT,syncErrorButtonTextAndBorder:f.GOOGLE_RED_500,syncErrorButtonTextAndBorderOffline:f.GOOGLE_RED_500,syncErrorButtonBackgroundHoverOrFocus:f.GOOGLE_THEME_ERROR_LIGHT_HOVER_OR_FOCUS,syncErrorButtonBorderHoverOrFocus:f.GOOGLE_RED_300,syncMenuBackgroundColor:f.GOOGLE_WHITE,simpleDialogCloseIcon:f.GOOGLE_GREY_500,"formattingRule-red":"#cc0b0b","formattingRule-orange":"#da7a00","formattingRule-yellow":"#c3ad00","formattingRule-green":"#00b11f","formattingRule-cyan":"#01cebc","formattingRule-blue":"#037be4","formattingRule-purple":"#7c00ff","formattingRule-pink":"#fb0a82","formattingRule-white":"#ffffff","formattingRule-black":"#000000",muiPalette:{type:"light",primary:{main:e.mainColor,contrastText:e.mainTextColor},secondary:{main:e.mainColor,contrastText:e.mainTextColor}}}},C=["red","orange","yellow","green","cyan","blue","purple","pink","primaryText","secondaryText","minorText","themeMainColor"],O=c.default.keyBy(C),_=function(){function e(t){(0,o.default)(this,e),this.themeFile=t;var n=document.getElementById("storybook-style");n?this.stylesheet=n:(this.stylesheet=document.createElement("style"),document.head.appendChild(this.stylesheet))}return(0,l.default)(e,[{key:"buildThemeCSS",value:function(e){var t=this.themeFile;for(var n in e){var a=new RegExp("\\b"+n+"\\b","g");t=t.replace(a,e[n])}return t}},{key:"setTheme",value:function(t,n){this.themeData=e.getThemeData(t,n);var a=this.buildThemeCSS(this.themeData);this.writeThemeData(a,this.themeData)}},{key:"getThemeColor",value:function(e){return this.themeData?this.themeData[e]:""}},{key:"getMuiThemeOptions",value:function(){var e,t;return{palette:(null===(e=this.themeData)||void 0===e?void 0:e.muiPalette)||{},typography:Object.assign({htmlFontSize:u.AppGlobals.AppModel.appTemplate.normalizedFontSize(),fontFamily:"inherit",h2:{paddingBottom:0}},m.ReactRootUIConfig.isReactRoot()&&{button:{textTransform:"none",fontWeight:400}}),overrides:{MuiCard:{root:{backgroundColor:null===(t=this.themeData)||void 0===t?void 0:t.mainContentBackground}}}}}},{key:"getHeaderMuiThemeOptions",value:function(){var e;return Object.assign(Object.assign({},this.getMuiThemeOptions()),{palette:(null===(e=this.themeData)||void 0===e?void 0:e.headerMuiPalette)||{}})}},{key:"getThemeBackgroundDimmer",value:function(){return this.themeData?"linear-gradient("+this.themeData.mainBackgroundTranslucent+", "+this.themeData.mainBackgroundTranslucent+")":(p.default.warnToDevConsole("No theme loaded when getThemeBackgroundDimmer was called"),"#ffffff")}},{key:"writeThemeData",value:function(e,t){var n,a=this;this.stylesheet.textContent=e,n=t.webpageBarColor,null==r&&(r=$("<meta>").attr("name","theme-color"),$("head").append(r)),r.attr("content",n),b.default.IsAndroidAppWithMinVersion(9)&&!v.default.IsUnsupportedAndroidVersion()&&setTimeout((function(){var e;null===(e=window.JeeneeAndroid)||void 0===e||e.setStatusBarColor(t.androidSystemBarColor)}),0),this.sfx&&this.sfx.sounds&&c.default.each(this.sfx.sounds,(function(e,t){a.sfx.remove(t)})),t.sounds&&(this.sfx||(this.sfx=new d.default),c.default.each(t.sounds,(function(e,t){a.sfx.load(e,t)})))}},{key:"triggerSound",value:function(e){this.sfx&&this.sfx.play(e)}}],[{key:"applyQueryTheme",value:function(e){var t;try{var n=e.split(" - "),a=(null!==(t=(0,g.parseUrlQuery)().theme)&&void 0!==t?t:"").split("-").map(c.default.upperFirst),r=(0,i.default)(a,2),o=r[0],l=r[1];if(c.default.includes(["Light","White","Dark"],o))n[0]=o.replace("Light","White"),l in("Dark"===o?A:S)&&(n[1]=l);return n.join(" - ")}catch(e){p.default.ReportErrorOnce({errorMessage:"Error in applyQueryTheme",error:e})}return e}},{key:"getThemeData",value:function(t,n){var a,r={WhiteRed:"White - Red",WhiteOrange:"White - Orange",WhiteLightGreen:"White - LightGreen",WhiteForestGreen:"White - ForestGreen",WhiteTeal:"White - Teal",WhiteMediumBlue:"White - MediumBlue",WhiteNavyBlue:"White - NavyBlue",WhitePurple:"White - Purple",WhiteMagenta:"White - Magenta",light:"White - MediumBlue",Light:"White - MediumBlue",dark:"Dark - Orange",Dark:"Dark - Orange",Clown:"White - Red"};if(r[t]&&(p.default.warnToDevConsole("Auto-migrating theme",t,"to",r[t]),t=r[t]),t in S)a=function(e){var t=f.LIGHT_ELEVATION,n=f.LIGHT_ELEVATION,a=(0,s.default)(e.mainColor);return{mainBackground:f.GOOGLE_SURFACE_LIGHT,mainContentBackground:"#ffffff",mainBackgroundVariant:"#F3F3F3",mainBackgroundVariantTranslucent:"rgba(0, 0, 0, 0.06)",mainBackgroundVariantExtra:f.GOOGLE_GREY_200,mainBackgroundTranslucent:(0,s.default)(f.GOOGLE_GREY_900).fade(.4).rgb().string(),formTabHover:"rgba(255,255,255,.8)",inputBackground:f.GOOGLE_WHITE,disabledInputBackground:"#DEDEDE",detailBackground:f.LIGHT_ELEVATION,dividerColor:"rgba(221, 221, 221, 0.6)",mainBorderColor:f.GOOGLE_GREY_300,weakAccentColor:f.STATE_FOCUS,mediumAccentColor:"#C2C2C2",focusColor:e.mainColor,detailSectionDivider:f.GOOGLE_GREY_100,primaryText:f.GOOGLE_GREY_900,secondaryText:f.GOOGLE_GREY_800,minorText:f.GOOGLE_GREY_700,minorBodyText:f.GOOGLE_GREY_700,disabledText:"rgba(0, 0, 0, 0.38)",highlightOverlay:(0,s.default)(e.highlightColor).mix((0,s.default)(f.GOOGLE_WHITE),.82).rgb().string(),highlightOverlayUpdate:(0,s.default)(e.mainColor).alpha(.13).rgb().string(),highlightOverlayTransparent:(0,s.default)(e.highlightColor).fade(.5).rgb().string(),interfaceBackgroundShadow:"rgba(0, 0, 0, 0.1)",interfaceBackgroundShadowStrong:"rgba(0, 0, 0, 0.3)",interfaceText:f.GOOGLE_WHITE,interfaceHighlightText:f.GOOGLE_WHITE,interfaceTextShadow:"transparent",interfaceBackground:e.mainColor,headerText:f.GOOGLE_WHITE,headerBackground:e.mainColor,footerText:f.GOOGLE_WHITE,footerBackground:e.mainColor,interfaceSecondaryBackground:e.secondaryColor,interfaceTertiaryBackground:e.tertiaryColor,interfaceHighlightBackground:e.highlightColor,interfaceIndicator:f.GOOGLE_WHITE,tableBackground:t,tableGroupedHeaderTitle:f.GOOGLE_GREY_700,tableGroupedHeader:f.GOOGLE_SURFACE_LIGHT,tableGroupedAggregateContent:f.GOOGLE_GREY_800,tableAggregateBackground:f.GOOGLE_GREY_300,tableRow:n,tableRowFocus:f.STATE_FOCUS,tableRowHover:f.STATE_HOVER,tableRowSelectedHover:f.STATE_HOVER_SELECTED,tableRowSelectedHoverUpdated:f.STATE_HOVER_SELECTED,chipHover:f.STATE_HOVER,drilldownArrow:f.GOOGLE_GREY_900,inputBorder:f.GOOGLE_GREY_400,inputBorderHover:f.GOOGLE_GREY_600,inputBorderDisabled:f.GOOGLE_GREY_200,inputInlineButtons:f.GOOGLE_GREY_700,inputBlockerBackground:(0,s.default)("white").fade(.2).rgb().string(),activeButtonText:f.GOOGLE_GREY_100,codeBackgroundColor:f.GOOGLE_GREY_50,codeTextColor:f.GOOGLE_GREY_800,slideshowArrowColor:f.GOOGLE_WHITE,slideshowArrowBackgroundHover:f.GOOGLE_GREY_200,slideshowArrowBackgroundColor:f.GOOGLE_GREY_300,groupedByAggregateBackground:f.GOOGLE_GREY_200,groupedByAggregateContent:f.GOOGLE_GREY_700,calendarDivider:f.GOOGLE_GREY_200,elevationBoxShadow1:"0px 2px 2px -2px rgba(0, 0, 0, 0.14),  0px 3px 1px -1px rgba(0, 0, 0, 0.12), 0px 1px 5px -5px rgba(0, 0, 0, 0.2)",actionIcon:e.highlightColor,actionButtonDeselectedShadow:"none",actionButtonDeselectedText:f.GOOGLE_GREY_400,actionButtonDeselectedBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonDeselectedBorder:f.GOOGLE_GREY_300,actionButtonText:e.mainTextColor,actionButtonBackground:e.mainColor,actionButtonHighlight:e.highlightColor,actionButtonBorder:e.mainColor,actionButtonHoverText:f.GOOGLE_GREY_800,actionButtonHoverBackground:f.GOOGLE_SURFACE_LIGHT,actionButtonHoverBorder:f.GOOGLE_GREY_300,actionButtonPressText:f.GOOGLE_GREY_800,actionButtonPressBackground:f.GOOGLE_GREY_200,actionButtonPressBorder:f.GOOGLE_GREY_300,cardOutlineDefault:f.GOOGLE_GREY_300,cardHoverShadowDefault:"0px 2px 2px rgba(0,0,0,0.14), 0px 3px 1px rgba(0,0,0,0.12), 0px 1px 5px rgba(0,0,0,0.2)",cardHoverBackgroundNarrowscreen:f.STATE_HOVER,cardHoverBackgroundDefault:f.GOOGLE_WHITE,buttonDisabledBorder:f.GOOGLE_GREY_300,buttonDisabledBackground:"rgba(0, 0, 0, 0.12)",faintBorderColor:"rgba(0, 0, 0, 0.12)",buttonOutline:e.mainColor,buttonTextColor:f.GOOGLE_WHITE,elevationTone1:f.LIGHT_ELEVATION,elevationTone2:f.LIGHT_ELEVATION2,elevationBoxShadow2:"3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",elevationTone3:f.LIGHT_ELEVATION3,elevationBoxShadow3:"0px 6px 10px rgba(0, 0, 0, 0.14), 0px 1px 18px rgba(0, 0, 0, 0.12), 0px 3px 5px rgba(0, 0, 0, 0.2)",bottomDrawerText:f.GOOGLE_GREY_800,bottomDrawerIcon:f.GOOGLE_GREY_700,modalContentBorder:f.GOOGLE_GREY_300,focusColorRgb:(0,s.default)(e.mainColor).fade(.88).rgb().string(),hoverColorRgb:(0,s.default)(e.mainColor).fade(.96).rgb().string(),flatControlBackground:"rgba(0, 0, 0, 0.1)",flatControlForeground:f.GOOGLE_WHITE,flatControlHighlight:e.highlightColor,attentionItemText:f.GOOGLE_WHITE,attentionBackground:e.highlightColor,errorColor:"#E66",warningColor:"#E4D58D",webpageBarColor:e.mainColor,androidSystemBarColor:e.mainColor,amplifyColor:"rgba(0, 0, 0, 0.3)",amplifyColorTransparent:"rgba(0, 0, 0, 0)",signatureBackground:f.GOOGLE_WHITE,themeMainColor:e.mainColor,themeTextColor:f.GOOGLE_WHITE,themeBackgroundColor:e.mainColor,themeBackgroundHover:a.lighten(.2).rgb().string(),sideMenuHeaderDividerColor:f.GOOGLE_GREY_200,sideMenuBackgroundColor:f.LIGHT_ELEVATION4,sideMenuBackgroundColorTransparent:"rgba(253,253,253,0)",sideMenuScrollShadow:"rgb(240, 240, 240)",sideMenuScrollShadowTransparent:"rgb(240, 240, 240, 0)",sideMenuSelected:(0,s.default)(e.mainColor).fade(.9).rgb().string(),sideMenuTextColor:f.GOOGLE_GREY_800,sideMenuIconColor:f.GOOGLE_GREY_700,sideMenuBackgroundOverlay:f.SURFACE_DARK,thinScrollbarColor:f.GOOGLE_GREY_700,dropdownChipBackgroundColor:f.GOOGLE_WHITE,dropdownChipBorderColor:"#DADCE0",dropdownSpecialOptionBorderColor:f.GOOGLE_GREY_700,dropdownOverflowNumberColor:"#5F6368",dropdownInputBaseTableQuickEditFocusedColor:f.GOOGLE_WHITE,syncErrorIconColor:f.GOOGLE_RED_600,syncButtonBorderColor:"#dadce0",syncSeverityInfo:f.GOOGLE_THEME_INFO_LIGHT,syncSeverityWarning:f.GOOGLE_THEME_WARNING_LIGHT,syncSeverityError:f.GOOGLE_THEME_ERROR_LIGHT,syncSeverityOffline:f.GOOGLE_GREY_100,syncBadgeForUnsyncedChanges:"rgb(241,152,1)",syncErrorButtonBackground:f.GOOGLE_THEME_ERROR_LIGHT,syncErrorButtonTextAndBorder:f.GOOGLE_RED_500,syncErrorButtonTextAndBorderOffline:f.GOOGLE_RED_500,syncErrorButtonBackgroundHoverOrFocus:f.GOOGLE_THEME_ERROR_LIGHT_HOVER_OR_FOCUS,syncErrorButtonBorderHoverOrFocus:f.GOOGLE_RED_300,syncMenuBackgroundColor:f.GOOGLE_WHITE,simpleDialogCloseIcon:f.GOOGLE_GREY_500,"formattingRule-red":"#cc0b0b","formattingRule-orange":"#da7a00","formattingRule-yellow":"#c3ad00","formattingRule-green":"#00b11f","formattingRule-cyan":"#01cebc","formattingRule-blue":"#037be4","formattingRule-purple":"#7c00ff","formattingRule-pink":"#fb0a82","formattingRule-white":"#ffffff","formattingRule-black":"#000000",muiPalette:{type:"light",primary:{main:e.mainColor,contrastText:e.mainTextColor},secondary:{main:e.mainColor,contrastText:e.mainTextColor}}}}(S[t]);else if(t&&t.includes(" - ")){var o=t.split(" - "),l=(0,i.default)(o,2),u=l[0],c=l[1],d="Dark"===u,v=e.computeColor(c,d);a=d?function(e,t){var n,a,r=null===(n=null==t?void 0:t.Presentation)||void 0===n?void 0:n.HeaderStyle,i=null===(a=null==t?void 0:t.Presentation)||void 0===a?void 0:a.FooterStyle,o=(0,s.default)(e.mainColor),l=f.SURFACE_DARK,u=f.DARK_ELEVATION,c=f.DARK_ELEVATION2,d=f.DARK_ELEVATION3,p=f.DARK_ELEVATION4,v=u,m=u,g=u,y=l,b=u,T=(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.12).rgb().string(),S=(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.04).rgb().string(),A=(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.18).rgb().string(),E=(0,s.default)(e.mainColor).mix((0,s.default)("#242424"),.78).rgb().string();return{mainBackground:l,mainContentBackground:b,mainBackgroundVariant:"#313131",mainContentBackgroundList:l,mainBackgroundVariantTranslucent:"rgba(255, 255, 255, 0.06)",mainBackgroundVariantExtra:f.GOOGLE_GREY_600,mainBackgroundTranslucent:(0,s.default)(b).fade(.4).rgb().string(),formTabHover:"rgba(48,48,48,.9)",inputBackground:"#222",disabledInputBackground:"#383838",detailBackground:v,dividerColor:"#4C4C4C",mainBorderColor:f.GOOGLE_GREY_800,weakAccentColor:f.DARK_STATE_FOCUS,mediumAccentColor:"#595959",focusColor:e.mainColor,detailSectionDivider:f.GOOGLE_GREY_800,primaryText:f.GOOGLE_GREY_100,secondaryText:f.GOOGLE_GREY_200,minorText:f.GOOGLE_GREY_400,minorBodyText:f.GOOGLE_GREY_400,disabledText:"rgba(232, 234, 237, 0.38)",highlightOverlay:E,highlightOverlayUpdate:E,highlightOverlayTransparent:(0,s.default)(e.mainColor).fade(.5).rgb().string(),elevationTone1:u,elevationTone2:c,elevationBoxShadow2:"0px 3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",elevationTone3:d,elevationBoxShadow3:"0px 3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",buttonDisabledBorder:"rgba(232, 234, 237, 0.38)",buttonDisabledBackground:"rgba(232, 234, 237, 0.12)",faintBorderColor:"rgba(232, 234, 237, 0.12)",buttonOutline:"rgba(232, 234, 237, 0.38)",buttonTextColor:f.GOOGLE_GREY_900,bottomDrawerText:f.GOOGLE_GREY_200,bottomDrawerIcon:f.GOOGLE_GREY_500,tableBackground:g,tableGroupedHeaderTitle:f.GOOGLE_GREY_400,tableGroupedHeader:y,tableGroupedAggregateContent:f.GOOGLE_GREY_200,tableAggregateBackground:f.GOOGLE_GREY_600,tableRow:m,tableRowFocus:T,tableRowHover:S,tableRowSelectedHover:A,tableRowSelectedHoverUpdate:A,chipHover:(0,s.default)(m).mix((0,s.default)(f.GOOGLE_WHITE),.04).rgb().string(),drilldownArrow:f.GOOGLE_GREY_300,inputBorder:f.GOOGLE_GREY_500,inputBorderHover:f.GOOGLE_GREY_400,inputBorderDisabled:f.GOOGLE_GREY_700,inputInlineButtons:f.GOOGLE_GREY_500,inputBlockerBackground:(0,s.default)(f.GOOGLE_GREY_900).fade(.2).rgb().string(),activeButtonText:f.GOOGLE_GREY_100,codeBackgroundColor:f.GOOGLE_GREY_800,codeTextColor:f.GOOGLE_GREY_100,slideshowArrowColor:f.GOOGLE_WHITE,slideshowArrowBackgroundHover:f.GOOGLE_GREY_700,slideshowArrowBackgroundColor:f.GOOGLE_GREY_800,groupedByAggregateBackground:f.GOOGLE_GREY_600,groupedByAggregateContent:f.GOOGLE_GREY_200,calendarDivider:f.GOOGLE_GREY_700,elevationBoxShadow1:"0px 2px 2px -2px rgba(0, 0, 0, 0.14),  0px 3px 1px -1px rgba(0, 0, 0, 0.12), 0px 1px 5px -5px rgba(0, 0, 0, 0.2)",cardOutlineDefault:f.GOOGLE_GREY_800,cardHoverShadowDefault:"0px 3px 4px rgba(0, 0, 0, 0.14), 0px 3px 3px rgba(0, 0, 0, 0.12), 0px 1px 8px rgba(0, 0, 0, 0.2)",cardHoverBackgroundNarrowscreen:f.DARK_STATE_HOVER,cardHoverBackgroundDefault:c,modalContentBorder:f.GOOGLE_GREY_500,focusColorRgb:(0,s.default)(e.mainColor).fade(.88).rgb().string(),hoverColorRgb:(0,s.default)(e.mainColor).fade(.96).rgb().string(),interfaceBackgroundShadow:"rgba(0, 0, 0, 0.1)",interfaceBackgroundShadowStrong:"rgba(0, 0, 0, 0.3)",interfaceText:"#EEE",interfaceHighlightText:e.mainTextColor,interfaceTextShadow:"transparent",interfaceBackground:"#2b2b2b",headerText:r===h.HEADERSTYLE_COLOR?e.mainTextColor:f.GOOGLE_GREY_100,headerBackground:r===h.HEADERSTYLE_COLOR?e.mainColor:c,footerText:i===h.FOOTERSTYLE_COLOR?e.mainTextColor:f.GOOGLE_GREY_500,footerBackground:i===h.FOOTERSTYLE_COLOR?e.mainColor:c,interfaceSecondaryBackground:"#252525",interfaceTertiaryBackground:"#0e0e0e",interfaceHighlightBackground:e.mainColor,interfaceIndicator:"#f12b2b",actionIcon:e.mainColor,actionButtonDeselectedShadow:"none",actionButtonDeselectedText:f.GOOGLE_GREY_400,actionButtonDeselectedBackground:f.GOOGLE_GREY_900,actionButtonDeselectedBorder:f.GOOGLE_GREY_500,actionButtonText:e.mainTextColor,actionButtonBackground:e.mainColor,actionButtonHighlight:e.highlightColor,actionButtonBorder:e.mainColor,actionButtonHoverText:f.GOOGLE_GREY_300,actionButtonHoverBackground:l,actionButtonHoverBorder:f.GOOGLE_GREY_300,actionButtonPressText:f.GOOGLE_GREY_300,actionButtonPressBackground:f.GOOGLE_GREY_900,actionButtonPressBorder:f.GOOGLE_GREY_300,flatControlBackground:"rgba(0, 0, 0, 0.5)",flatControlForeground:e.mainTextColor,flatControlHighlight:e.mainColor,attentionItemText:e.mainTextColor,attentionBackground:e.mainColor,errorColor:"#FC9991",warningColor:"#A9911F",webpageBarColor:"#303030",androidSystemBarColor:"#232323",amplifyColor:"rgba(255, 255, 255, 0.3)",amplifyColorTransparent:"rgba(255, 255, 255, 0)",signatureBackground:"#C2C2C2",themeMainColor:e.mainColor,themeTextColor:f.GOOGLE_WHITE,themeBackgroundColor:e.mainColor,themeBackgroundHover:o.lighten(.2).rgb().string(),sideMenuHeaderDividerColor:f.GOOGLE_GREY_700,sideMenuBackgroundColor:p,sideMenuBackgroundColorTransparent:"rgba(46,46,46,0)",sideMenuScrollShadow:"rgb(38, 38, 38)",sideMenuScrollShadowTransparent:"rgb(38, 38, 38, 0)",sideMenuSelected:(0,s.default)(e.mainColor).fade(.9).rgb().string(),sideMenuTextColor:f.GOOGLE_GREY_300,sideMenuIconColor:f.GOOGLE_GREY_500,sideMenuBackgroundOverlay:l,thinScrollbarColor:f.GOOGLE_GREY_300,dropdownChipBackgroundColor:f.GOOGLE_BLACK,dropdownChipBorderColor:"rgba(255, 255, 255, 0.08)",dropdownSpecialOptionBorderColor:f.GOOGLE_GREY_200,dropdownOverflowNumberColor:"#9AA0A6",dropdownInputBaseTableQuickEditFocusedColor:f.GOOGLE_BLACK,syncErrorIconColor:f.GOOGLE_RED_300,syncButtonBorderColor:"#3c4043",syncSeverityInfo:f.GOOGLE_THEME_INFO_DARK,syncSeverityWarning:f.GOOGLE_THEME_WARNING_DARK,syncSeverityError:f.GOOGLE_THEME_ERROR_DARK,syncErrorButtonBackground:"",syncSeverityOffline:f.GOOGLE_GREY_700,syncBadgeForUnsyncedChanges:"rgb(255,159,0)",syncErrorButtonTextAndBorder:f.GOOGLE_RED_100,syncErrorButtonTextAndBorderOffline:f.GOOGLE_RED_200,syncErrorButtonBackgroundHoverOrFocus:f.GOOGLE_THEME_ERROR_DARK_HOVER_OR_FOCUS,syncErrorButtonBorderHoverOrFocus:f.GOOGLE_RED_300,syncMenuBackgroundColor:f.GOOGLE_BLACK,simpleDialogCloseIcon:f.GOOGLE_GREY_500,"formattingRule-red":"#f12b2b","formattingRule-orange":"#f19a2b","formattingRule-yellow":"#e0ca18","formattingRule-green":"#14da37","formattingRule-cyan":"#19d0c0","formattingRule-blue":"#2c97f5","formattingRule-purple":"#a24bff","formattingRule-pink":"#ff4bce","formattingRule-white":"#ffffff","formattingRule-black":"#000000",muiPalette:{type:"dark",primary:{main:e.mainColor,contrastText:e.mainTextColor},secondary:{main:e.mainColor,contrastText:e.mainTextColor}}}}(v,n):w(v,n)}else{p.default.warnToDevConsole("Unknown theme (using default instead)",t);var m=e.computeColor("MediumBlue",!1);a=w(m,n)}return a.headerMuiPalette=e.createHeaderMuiPalette(a),Object.assign(Object.assign({},T),a)}},{key:"createHeaderMuiPalette",value:function(e){var t=(0,s.default)(e.headerText).dark()?"light":"dark";return Object.assign(Object.assign({},e.muiPalette),{type:t})}},{key:"dynamicFormattingColors",value:function(){return C}},{key:"isDynamicFormattingColor",value:function(e){return!!O[e]}},{key:"getFormattingColorForTheme",value:function(t,n){var a=e.getThemeData(t),r=a["formattingRule-"+n];if(r)return r;var i=a[n];return i||(p.default.warnToDevConsole("Unknown color specified in getFormattingColorForTheme"),"")}},{key:"computeColor",value:function(e,t){if(e||(p.default.warnToDevConsole("Unknown color name",e,"defaulting"),e="MediumBlue"),!y.default.isHexColor(e))return t?A[e]:S[e];var n=(0,s.default)(e),a=n.rotate(120).rgb().string(),r=n.rotate(240).rgb().string(),i=n.darken(.1).rgb().string(),o=f.GOOGLE_GREY_900,l=f.GOOGLE_WHITE;return{mainColor:e,secondaryColor:a,tertiaryColor:r,highlightColor:i,mainTextColor:n.light()?o:l}}},{key:"getColorLabel",value:function(e){var t={LightGreen:"Light green",ForestGreen:"Forest green",MediumBlue:"Medium blue",NavyBlue:"Navy blue"};return e in t?t[e]:e}},{key:"getLegacyColorsForLightOrDark",value:function(e){return e?S:A}},{key:"getColorsForLightOrDark",value:function(e){return E[e?"White":"Dark"]}}]),e}();t.default=_},881219:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abortOutstandingCalls=function(){for(;n.length>0;)n.shift().abort()};var n=[];$(document).ajaxComplete((function(e,t){var a=n.indexOf(t);a>-1&&n.splice(a,1)})),$(document).ajaxSend((function(e,t){n.push(t)}))},307827:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.onAppTemplateLoadCallbacks=t.CallbackGroup=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(593186));function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s=function(){function e(){(0,r.default)(this,e),this.callbacks=[]}return(0,i.default)(e,[{key:"add",value:function(e){this.callbacks.push(e)}},{key:"run",value:function(){var e,t=l(this.callbacks);try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n()}catch(e){o.default.ReportError({errorMessage:"Error in CallbackGroup.run",error:e,suppressBackendPost:!1})}}}catch(e){t.e(e)}finally{t.f()}}}]),e}();t.CallbackGroup=s;var c=new s;t.onAppTemplateLoadCallbacks=c},649431:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ReduxActionEvent=void 0;var r=a(n(689728)),i=a(n(856690)),o=a(n(861655)),l=a(n(994993)),u=a(n(73808)),s=n(377131),c=n(218546);function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,l.default)(this,n)}}var f=function(e){(0,o.default)(n,e);var t=d(n);function n(e,a){return(0,i.default)(this,n),t.call(this,c.AppEventName.ReduxAction,{action:e,payload:a})}return(0,r.default)(n)}(s.AppEvent);t.ReduxActionEvent=f},976661:(e,t)=>{"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.valuesOnly,r=void 0===a||a;e.forEach((function(e){e.OrderDirection="Ascending"===e.Order?1:-1}));var i=function(n,a){for(var r,i=0;r=e[i];){var o=t[r.Column],l=r.Comparer(n[r.Column],a[r.Column],o);if(0!==l)return l*r.OrderDirection;i+=1}return 0};return r?i:function(e,t){return i(e.values,t.values)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.makeObjectComparer=n,t.makeSortRulesComparer=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.sortBy,a=void 0===n?r:n;return e.forEach((function(e){e.OrderDirection="Ascending"===e.Order?1:-1})),function(t,n){for(var r,i=0;r=e[i];){var o=r,l=o.Comparer,u=o.OrderDirection,s=l(a(t,i,r),a(n,i,r));if(0!==s)return s*u;i+=1}return 0}};var a=n;t.default=a;var r=function(e){return e}},971145:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.FifeMapTiling=void 0;var r=a(n(364687)),i=a(n(856690)),o=a(n(689728));function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},c=["tile_width","tile_height","image_width","image_height","full_pyramid_depth"],d=["num_tiles_x","num_tiles_y","empty_pels_x","empty_pels_y"],f=function(){function e(t,n){(0,i.default)(this,e),this.zoom=t,this.attributes=n}return(0,o.default)(e,[{key:"attrValue",value:function(e){var t;return null===(t=this.attributes.getNamedItem(e))||void 0===t?void 0:t.value}},{key:"xTiles",get:function(){return Number(this.attrValue("num_tiles_x"))}},{key:"yTiles",get:function(){return Number(this.attrValue("num_tiles_y"))}},{key:"emptyX",get:function(){return Number(this.attrValue("empty_pels_x"))}},{key:"emptyY",get:function(){return Number(this.attrValue("empty_pels_y"))}}]),e}(),p=function(){function e(t,n){var a=this;(0,i.default)(this,e),this.url=t,this.tileUrl=function(e,t,n){return"".concat(a.url,"=").concat(["rp","pd","pc0x0","x".concat(e),"y".concat(t),"z".concat(n.zoom)].join("-"))};var r=n.children[0];this.attributes=r.attributes,this.zoomLevels=Array.from(r.children).map((function(e,t){return new f(t,e.attributes)}))}return(0,o.default)(e,[{key:"attrValue",value:function(e){var t;return null===(t=this.attributes.getNamedItem(e))||void 0===t?void 0:t.value}},{key:"zoomLevel",value:function(e){return this.zoomLevels[e]}},{key:"maxZoom",get:function(){return Number(this.attrValue("full_pyramid_depth"))-1}},{key:"tileWidth",get:function(){return Number(this.attrValue("tile_width"))}},{key:"tileHeight",get:function(){return Number(this.attrValue("tile_height"))}},{key:"widthScaling",get:function(){return 1-this.zoomLevels[0].emptyX/this.tileWidth}},{key:"heightScaling",get:function(){return 1-this.zoomLevels[0].emptyY/this.tileHeight}}],[{key:"tryGetFor",value:function(t){return s(this,void 0,void 0,r.default.mark((function n(){var a,i;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(a=new URL(t)).searchParams.append("fifeParameters","g"),n.next=4,fetch(a.href);case 4:return i=n.sent,n.abrupt("return",e.fromFetchResponse(i));case 6:case"end":return n.stop()}}),n)})))}},{key:"fromFetchResponse",value:function(t){var n;return s(this,void 0,void 0,r.default.mark((function a(){var i,o,u,s,f,p,h,v,m,g;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=function(e){if(!e)throw new Error("FifeMapTiling xml did not match expected format")},a.next=3,t.text();case 3:if(!(o=a.sent).startsWith("Error")){a.next=6;break}throw new Error(o);case 6:self.trustedTypes&&self.trustedTypes.createPolicy?(s=self.trustedTypes.createPolicy("fifemaptiling",{createHTML:function(e){return e}}),u=s.createHTML(o)):u=o,f=(new window.DOMParser).parseFromString(u,"text/xml"),p=f.children[0],h=l(c);try{for(h.s();!(v=h.n()).done;)m=v.value,i("string"==typeof(null===(n=p.attributes.getNamedItem(m))||void 0===n?void 0:n.value))}catch(e){h.e(e)}finally{h.f()}return i(p.children.length>0),Array.from(p.children).forEach((function(e){var t,n,a=l(d);try{for(a.s();!(n=a.n()).done;){var r=n.value;i("string"==typeof(null===(t=e.attributes.getNamedItem(r))||void 0===t?void 0:t.value))}}catch(e){a.e(e)}finally{a.f()}})),g=t.url.replace(/(=[\w-]+)?$/,""),a.abrupt("return",new e(g,f));case 15:case"end":return a.stop()}}),a)})))}}]),e}();t.FifeMapTiling=p},46239:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageMapType=void 0;var r=a(n(364687)),i=a(n(627424)),o=a(n(856690)),l=a(n(689728)),u=a(n(593186)),s=n(515128),c=n(714067),d=n(44617),f=n(971145),p=n(186473),h=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},v={},m=function(e){return Math.round(1e8*e)/1e6},g=function(){function e(t){var n=this;(0,o.default)(this,e),this.url=t,this.callbacks=[],this.getTileUrl=function(e,t){var a,r=e.x,i=e.y,o=null===(a=n.tiling)||void 0===a?void 0:a.zoomLevel(t);if(null==o||null==n.tiling)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";var l=n.getNormalizedCoord(r,i,o);return l?(r=l.x,i=l.y,n.tiling.tileUrl(r,i,o)):null},this.getTiling(t)}return(0,l.default)(e,[{key:"getTiling",value:function(e){return h(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!d.dynamicRollouts.includeByOwnerId("ClientFifeMapTiling")||!c.GETIMAGEURL_PATTERN.test(e)&&!c.GETREMOTEIMAGEURL_PATTERN.test(e)){t.next=10;break}return t.prev=1,t.next=4,f.FifeMapTiling.tryGetFor(e);case 4:this.tiling=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),u.default.ReportErrorOnce({errorMessage:"Failed to get FifeMapTiling",error:(0,s.asError)(t.t0)});case 10:if(null!=this.tiling){t.next=21;break}return t.prev=11,t.next=14,p.ImgixMapTiling.tryGetFor(e);case 14:this.tiling=t.sent,t.next=21;break;case 17:t.prev=17,t.t1=t.catch(11),u.default.ReportErrorOnce({errorMessage:"Failed to get ImgixMapTiling",error:(0,s.asError)(t.t1)}),this.error=(0,s.asError)(t.t1);case 21:for(;this.callbacks.length;)this.callbacks.shift()(this.error);case 22:case"end":return t.stop()}}),t,this,[[1,7],[11,17]])})))}},{key:"tileWidth",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.tileWidth)&&void 0!==t?t:1280}},{key:"tileHeight",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.tileHeight)&&void 0!==t?t:1280}},{key:"widthScaling",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.widthScaling)&&void 0!==t?t:1}},{key:"heightScaling",get:function(){var e,t;return null!==(t=null===(e=this.tiling)||void 0===e?void 0:e.heightScaling)&&void 0!==t?t:1}},{key:"id",value:function(){return"image"}},{key:"isReady",value:function(){return null!=this.tiling}},{key:"whenReady",value:function(e){var t=this;this.isReady()?setTimeout(e,1):this.error?setTimeout((function(){e(t.error)}),1):this.callbacks.indexOf(e)<0&&this.callbacks.push(e)}},{key:"getAllTileUrls",value:function(e){var t,n=[],a=null===(t=this.tiling)||void 0===t?void 0:t.zoomLevel(e);if(a)for(var r=0;r<a.xTiles;r++)for(var i=0;i<a.yTiles;i++){var o=this.getTileUrl({x:r,y:i},e);null!=o&&n.push(o)}return n}},{key:"definition",value:function(t){var n,a,r=this,i=new t.maps.ImageMapType({getTileUrl:this.getTileUrl,tileSize:new t.maps.Size(this.tileWidth,this.tileHeight),maxZoom:null!==(a=null===(n=this.tiling)||void 0===n?void 0:n.maxZoom)&&void 0!==a?a:10,minZoom:1,name:"Image"});return i.projection={fromLatLngToPoint:function(n){var a=n.lat(),i=n.lng(),o=e.fromLatLngToPoint(a,i),l=o.x,u=o.y;return new t.maps.Point(l*r.tileWidth*r.widthScaling,u*r.tileHeight*r.heightScaling)},fromPointToLatLng:function(n,a){var i=n.x/r.tileWidth/r.widthScaling,o=n.y/r.tileHeight/r.heightScaling,l=e.fromPointToLatLng(i,o),u=l.lat,s=l.lng;return new t.maps.LatLng(u,s,a)}},i}},{key:"mapOptions",value:function(){return{mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1}}},{key:"wrapX",value:function(){return!1}},{key:"wrapY",value:function(){return!1}},{key:"defaultZoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.focused,n=void 0!==t&&t;return n?3:1}},{key:"getNormalizedCoord",value:function(e,t,n){var a=n.xTiles,r=n.yTiles;if(t<0||t>=r){if(!this.wrapY())return null;t=(t%r+r)%r}if(e<0||e>=a){if(!this.wrapX())return null;e=(e%a+a)%a}return{x:e,y:t}}}],[{key:"MIN_ZOOM",get:function(){return 1}},{key:"MAX_ZOOM",get:function(){return 10}},{key:"CACHE_MAX_ZOOM",get:function(){return 4}},{key:"DEFAULT_ZOOM",get:function(){return 1}},{key:"getForUrl",value:function(t){return t in v&&!v[t].error||(v[t]=new e(t)),v[t]}},{key:"fromLatLngToPoint",value:function(e,t){return{x:.5+4*t/360,y:.5+4*e/180}}},{key:"fromPointToLatLng",value:function(e,t){return{lat:(180*t-90)/4,lng:(360*e-180)/4}}},{key:"fromLatLngToXY",value:function(t,n){var a=e.fromLatLngToPoint(t,n),r=a.x,i=a.y;return{x:m(r),y:m(i)}}},{key:"fromXYToLatLng",value:function(t,n){return e.fromPointToLatLng(t/100,n/100)}},{key:"fromLatLngToXYString",value:function(t,n){var a=e.fromLatLngToPoint(t,n),r=a.x,i=a.y;return"".concat(m(r),", ").concat(m(i))}},{key:"fromXYStringToLatLng",value:function(t){var n=(t=t||"").split(","),a=(0,i.default)(n,2),r=a[0],o=a[1];return e.fromPointToLatLng(Number(r)/100,Number(o)/100)}}]),e}();t.ImageMapType=g},186473:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.ImgixMapTiling=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(402568)),l=n(504674),u=256,s=function(e,t){null==t&&(t={});var n=function(e,t){var n=l.IMGIX+e+t,a=(0,o.default)(n);return t.length>0?t+"&s="+a:"?s="+a}(e="/".concat(function(e){return e=e.replace(/^\//,""),/^https?:\/\//.test(e)?encodeURIComponent(e):encodeURI(e)}(e)),function(e){var t,n,a,r,i=[];for(t in e)n=e[t],a=encodeURIComponent(t),r=encodeURIComponent(n),i.push(a+"="+r);return i[0]&&(i[0]="?"+i[0]),i.join("&")}(t));return"https://appsheet.imgix.net"+e+n},c=function(){function e(t,n,a){(0,r.default)(this,e),this.url=t,this.tileWidth=n,this.tileHeight=a,this.widthScaling=1,this.heightScaling=1}return(0,i.default)(e,[{key:"zoomLevel",value:function(e){var t=Math.pow(2,e);return{zoom:e,xTiles:t,yTiles:t}}},{key:"tileUrl",value:function(e,t,n){var a={fit:"crop",crop:"focalpoint",w:this.tileWidth,h:this.tileHeight,"fp-x":(e+.5)/n.xTiles,"fp-y":(t+.5)/n.yTiles,"fp-z":n.xTiles};return s(this.url,a)}}],[{key:"tryGetFor",value:function(t){return new Promise((function(n,a){var r=new Image;r.onload=function(){var a=r.width/r.height,i=a<=1?u:Math.floor(a*u),o=a>=1?u:Math.floor(u/a);n(new e(t,i,o))},r.onerror=function(){a(new Error("XY BaseImage failed to load url "+t))},r.src=s(t,{w:128,h:128,fit:"fill"})}))}}]),e}();t.ImgixMapTiling=c},454852:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=n(606610),u=a(n(888861)),s=a(n(385857)),c=a(n(962553)),d=n(166089),f="Display_Prominently",p="Display_Inline",h=function(){function e(t){(0,r.default)(this,e),this.action=t,this._evalTreeLookup={}}return(0,i.default)(e,[{key:"getFA5CompatibleIcon",value:function(){var e=this.action.Icon;return e.startsWith("fa ")||e.startsWith("fal ")||e.startsWith("far ")||e.startsWith("fas ")?e:"fa "+e}},{key:"getFA5LightIconToReplaceDefault",value:function(){return this.getFA5CompatibleIcon().replace("fa ","fal ")}},{key:"name",value:function(){return this.action.Name}},{key:"createdBy",value:function(){return this.action.CreatedBy||"Unknown"}},{key:"isAutoCreated",value:function(){return o.default.includes(["Auto (column)","Auto (row)","Auto (table)"],this.createdBy())}},{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this.action.ExprLookup||{};try{t[e]&&(this._evalTreeLookup[e]=u.default.create(t[e]))}catch(e){}}return this._evalTreeLookup[e]}},{key:"displayName",value:function(e,t,n,a){if("Delete"===this.action.Name)return e.MapActionName(this.action.Name);var r=this.evalTreeLookup("DisplayName");if(r){var i=r.run(new s.default(e,t,n,void 0,void 0,void 0,a));return i?String(i):this.name()}return this.name()}},{key:"type",value:function(){return"NAVIGATE_DIFFERENT_APP"===this.action.ActionType?"NAVIGATE_APP":this.action.ActionType}},{key:"table",value:function(){return this.action.Table}},{key:"icon",value:function(){return this.action.Icon}},{key:"dynamicTableScope",value:function(){var e=this,t=l.actionTypes[this.type()];return t&&!!t.tableScopeWhenStatic&&0===this.valueFormulaColumnsReferenced().length&&0===this.conditionFormulaColumnsReferenced().length&&["DisplayName"].every((function(t){var n=e.evalTreeLookup(t);return!n||0===n.columnsReferenced().length}))}},{key:"tableScope",value:function(){return this.action.TableScope}},{key:"prominence",value:function(){return this.action.ActionDefinition&&this.action.ActionDefinition.Prominence||f}},{key:"needsConfirmation",value:function(){return this.action.ActionDefinition&&this.action.ActionDefinition.NeedsConfirmation||!1}},{key:"confirmationMessage",value:function(e,t,n){var a=this.evalTreeLookup("ConfirmationMessage");if(a){var r=a.run(new s.default(e,t,n));return r?String(r):this.name()}return e.MapActionName("Are you sure?")}},{key:"autoReferencedColumn",value:function(){return this.action.AutoReferencedColumn}},{key:"launchExternal",value:function(){return this.action.ActionDefinition&&this.action.ActionDefinition.LaunchExternal||!1}},{key:"isValid",value:function(e){if(!this.action.IsValid)return!1;var t=l.actionTypes[this.type()];if(!t)return!1;if(t.requireValueEvalTree&&!this.action.ValueEvaluatable)return!1;if((this.tableScope()||this.dynamicTableScope())&&e){var n=this.conditionEvalTree();if(n&&!n.run(e))return!1}return!0}},{key:"isValidForTable",value:function(e,t,n,a){var r=this;return!(this.requiresDeletePermission(n)&&!e.allowsDelete(n))&&(!(this.requiresUpdatePermission(n)&&!e.allowsUpdate(n))&&(!(this.requiresAddPermission(n)&&!e.allowsAdd(n))&&((!t.isSlice()||!this.isAutoCreated()||null==this.columnToEdit()||0!==t.allAttributes().filter((function(e){return e.name()===r.columnToEdit()})).length)&&!(n&&(this.tableScope()||this.dynamicTableScope())&&!this.isValid(a||n.dataContext())))))}},{key:"isValidForRow",value:function(e,t){var n=this.conditionEvalTree();if(n&&(o.default.isEqual(e,t.rowData)||((t=t.copy()).rowData=e),!n.run(t)))return!1;return!0}},{key:"isBulkRunnable",value:function(){if(this.action.ActionDefinition&&null!=this.action.ActionDefinition.BulkApplicable)return this.action.ActionDefinition.BulkApplicable;var e=l.actionTypes[this.type()];return!!e&&e.bulkRunnable}},{key:"navigatesApp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.navigatesApp(e)})):t.navigatesApp)}},{key:"requiresDeletePermission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.requiresDeletePermission(e)})):t.requireDeletePermission)}},{key:"requiresUpdatePermission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.requiresUpdatePermission(e)})):t.requireUpdatePermission)}},{key:"requiresAddPermission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel,t=l.actionTypes[this.type()];return!t||("COMPOSITE"===this.type()?this.nestedActions(e).some((function(t){return t.requiresAddPermission(e)})):t.requireAddPermission)}},{key:"nestedActions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.AppGlobals.AppModel;if("COMPOSITE"!==this.type())return[];if(!this.action.ActionDefinition||!this.action.ActionDefinition.Actions)return[];var n=[];return this.action.ActionDefinition.Actions.forEach((function(a){var r=t.appTemplate.actions().findByName(e.table(),a.ActionName);r&&n.push(r)})),n}},{key:"columnToEdit",value:function(){return this.action.ColumnToEdit}},{key:"columnAttachment",value:function(){return this.action.ColumnAttachment}},{key:"conditionEvalTree",value:function(){return this.action.ConditionEvaluatable?(this._conditionEvalTree||(this._conditionEvalTree=u.default.create(this.action.ConditionEvaluatable)),this._conditionEvalTree):null}},{key:"conditionFormulaColumnsReferenced",value:function(){var e=this.conditionEvalTree();return e?e.columnsReferenced():[]}},{key:"valueEvalTree",value:function(){return this.action.ValueEvaluatable?(this._valueEvalTree||(this._valueEvalTree=u.default.create(this.action.ValueEvaluatable)),this._valueEvalTree):null}},{key:"valueFormulaColumnsReferenced",value:function(){var e=this.valueEvalTree();return e?e.columnsReferenced():[]}},{key:"messageBodyEvalTree",value:function(){return this.evalTreeLookup("TextMessage")}},{key:"messageSubjectEvalTree",value:function(){return this.evalTreeLookup("MessageSubject")}},{key:"referencedRowsEvalTree",value:function(){return this.evalTreeLookup("ReferencedRows")}},{key:"inputParameterValueEvalTree",value:function(e){return this.evalTreeLookup("Parameters["+e+"]")}},{key:"assignments",value:function(){var e,t,n=null===(t=null===(e=null==this?void 0:this.action)||void 0===e?void 0:e.ActionDefinition)||void 0===t?void 0:t.Assignments;if(n){for(var a=0;a<n.length;a++)n[a].NewColumnValue&&(n[a].valueEvalTree=this.evalTreeLookup("Assignments["+a+"]"));return n.filter((function(e){var t=e.ColumnToEdit;return null!=t&&""!==t}))}return this.valueEvalTree()?[{ColumnToEdit:this.columnToEdit(),valueEvalTree:this.valueEvalTree()}]:[]}},{key:"csvLocale",value:function(e){var t,n;if(null===(t=this.action.ActionDefinition.CsvLocale)||void 0===t?void 0:t.startsWith("=")){var a=this.evalTreeLookup("CsvLocale");if(a){var r=a.run(new s.default(e));return String(r)}return""}return null!==(n=this.action.ActionDefinition.CsvLocale)&&void 0!==n?n:"en-US"}},{key:"referencedTable",value:function(){return this.action.ActionDefinition?this.action.ActionDefinition.ReferencedTable:null}},{key:"referencedAction",value:function(){return this.action.ActionDefinition?this.action.ActionDefinition.ReferencedAction:null}},{key:"showInlineFor",value:function(e){if(this.prominence()!==p)return!1;var t=this.columnAttachment();return t&&t===e.name()}},{key:"triggerEventId",value:function(){var e,t;return null===(t=null===(e=this.action)||void 0===e?void 0:e.ActionDefinition)||void 0===t?void 0:t.triggerEventId}}],[{key:"DISPLAY_PROMINENTLY",get:function(){return f}},{key:"DO_NOT_DISPLAY",get:function(){return"Do_Not_Display"}},{key:"DISPLAY_INLINE",get:function(){return p}},{key:"DISPLAY_OVERLAY",get:function(){return"Display_Overlay"}},{key:"createFromAttribute",value:function(t,n,a,r){var i=[],l="Ref"===r.type()?r:r.basestAttribute(),s=u.default.createNot(u.default.createIsBlank(u.default.createColumnLookup(n,l))).model;if("Email"===l.type())i.push({ActionType:"EMAIL",ActionDefinition:{Prominence:p},Icon:"fa-envelope",Name:"Compose Email ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(n,l).model});else if("Address"===l.type()||"LatLong"===l.type()||"ChangeLocation"===l.type())i.push({ActionType:"NAVIGATE_APP",ActionDefinition:{Prominence:p},Icon:"fa-map-marker",Name:"View Map ("+l.name()+")",ValueEvaluatable:u.default.createConcatenate(u.default.createConstantValue(t.AppTemplate.Name+"#page=map&table="+a+"&mapcolumn="+l.name()+"&row=","Text"),u.default.createColumnLookup(n,n.keyAttribute())).model});else if("App"===l.type())i.push({ActionType:"NAVIGATE_APP",ActionDefinition:{Prominence:p},Icon:"fa-tasks",Name:"Open App ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(n,l).model});else if("Ref"===l.type()){var d=l.referencedTableName();c.default.findByName(d,t).tableSchema&&i.push({ActionType:"NAVIGATE_APP",ActionDefinition:{Prominence:p},Icon:"fa-chevron-circle-right",Name:"View Ref ("+l.name()+")",ValueEvaluatable:u.default.createConcatenate(u.default.createConstantValue("#page=detail&table="+d+"&row=","Text"),u.default.createColumnLookup(n,l)).model})}else if("Phone"===l.type()){var f=l.evalTreeLookup("TextMessage"),h=f?f.model:null,v=!1!==l.auxData().Callable,m=!1!==l.auxData().Textable;v&&i.push({ActionType:"CALL",ActionDefinition:{Prominence:p},Icon:"fa-phone",Name:"Call Phone ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(n,l).model}),m&&i.push({ActionType:"SMS",ActionDefinition:{Prominence:p},Icon:"fa-comment",Name:"Send SMS ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(n,l).model,ExprLookup:{TextMessage:h}})}else"Url"===l.type()?i.push({ActionType:"NAVIGATE_URL",ActionDefinition:{Prominence:p,LaunchExternal:l.auxData().LaunchExternal},Icon:"fa-external-link",Name:"Open URL ("+l.name()+")",ValueEvaluatable:u.default.createConcatenate(u.default.createColumnLookup(n,l)).model}):"File"===l.type()&&i.push({ActionType:"OPEN_FILE",ActionDefinition:{Prominence:p},Icon:"fa-file-text",Name:"Open File ("+l.name()+")",ValueEvaluatable:u.default.createColumnLookup(n,l).model});return i.map((function(t){return new e(o.default.extend(t,{ConditionEvaluatable:s,CreatedBy:"Auto (column)",Table:a,IsValid:!0,ColumnToEdit:l.name(),ColumnAttachment:l.name(),AutoReferencedColumn:l.name()}))}))}}]),e}();t.default=h},181405:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(454852)),u=a(n(962553)),s=a(n(385857)),c=a(n(593186)),d=function(){function e(t){(0,r.default)(this,e),this.actions=t.map((function(e){return new l.default(e)})).filter((function(e){return e.isValid()})),this.actionsByTable=o.default.groupBy(this.actions,(function(e){return e.table()}))}return(0,i.default)(e,[{key:"findByName",value:function(e,t){return o.default.find(this.actionsByTable[e],(function(e){return e.name()===t}))}},{key:"hasSystemAddActions",value:function(){return this.actions.filter((function(e){return"ADD_RECORD"===e.type()&&e.isAutoCreated()})).length>0}},{key:"actionsForTable",value:function(e,t,n,a){var r=u.default.findByName(e,t),i=r.table,o=r.tableSchema;if(!i||!o)return[];var l=o.isSlice()?o.sourceTableName():e,s=this.actions.filter((function(e){return e.table()===l}));if(o.isSlice()){var c=o.sliceDefinition.Actions;c&&c.indexOf("**auto**")<0&&(s=c.map((function(e){return s.find((function(t){return t.name()===e}))})).filter((function(e){return void 0!==e})))}var d=s.filter((function(e){return e.isValidForTable(i,o,t,a)}));return n?d.filter((function(e){return e.isBulkRunnable()})):d}},{key:"actionsForRows",value:function(e,t,n,a,r){var i=u.default.findByName(t,n).tableSchema;if(!i)return c.default.warnToDevConsole("Error running actionsForRow, unknown table:",t),[];var l=this.actionsForTable(t,n,void 0,r).filter((function(t){if(t.tableScope())return!1;var a=r||new s.default(n,i);return!o.default.some(e,(function(e){return a.replaceRowData(e),t.isValidForRow(e,a)?null:e}))}));return a?l.filter((function(e){return e.isBulkRunnable()})):l}},{key:"actionsForRow",value:function(e,t,n,a){return this.actionsForRows([e],t,n,!1,a)}},{key:"actionsAtTableScope",value:function(e,t,n){return u.default.findByName(e,t).tableSchema?this.actionsForTable(e,t,void 0,n).filter((function(e){return e.tableScope()||e.dynamicTableScope()})):(c.default.warnToDevConsole("Error running actionsAtTableScope, unknown table:",e),[])}}]),e}();t.default=d},429815:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.allExternalServicesEnabled=t.SCANNER_MIN_SUBSCRIPTION=t.SCANNER=void 0,t.getMaxImageResolution=function(){var e;return(null===(e=A.AppGlobals.AppModel)||void 0===e?void 0:e.appTemplate.imageResolution)||600};var r,i=a(n(856690)),o=a(n(689728)),l=a(n(496486)),u=a(n(192137)),s=a(n(282615)),c=a(n(181405)),d=a(n(173861)),f=a(n(593186)),p=a(n(985341)),h=a(n(973289)),v=a(n(455842)),m=a(n(738628)),g=a(n(81873)),y=a(n(454852)),b=n(161171),T=n(506871),S=n(591530),A=n(166089),E=n(714067),w=n(894002),C=S.SubscriptionType.FREE;t.SCANNER_MIN_SUBSCRIPTION=C,t.SCANNER=r,function(e){e[e.DISABLED=0]="DISABLED",e[e.MLKIT=1]="MLKIT",e[e.SCANDIT=2]="SCANDIT"}(r||(t.SCANNER=r={}));var O={EnableMapsAndGeocoding:!0,EnableFirebase:!0,EnableBarcodeScanning:!0,ScanningServiceName:"System Default: Google MLKit"};t.allExternalServicesEnabled=O;var _={ComparisonOperatorBlankValuesMode:b.ExpressionSettingsOption.Legacy,RefRowsParentMode:b.ExpressionSettingsOption.Legacy,NumberDivisionMode:T.NumberDivisionOption.Number};var k=function(){function e(t,n){var a=this;(0,i.default)(this,e),this._cacheStore={},this._ocrExtractors={},this._predictors={},this.model=t,this.appModel=n,this._actions=null,this._viewControlsByName=l.default.keyBy(this.viewControls(),(function(e){return e.Name.toLowerCase()})),this._richViewControlsByName=l.default.mapValues(this._viewControlsByName,(function(e){return new s.default(e)})),this._flatTableSchemasByName=l.default.keyBy(this.rootTableSchemas(),(function(e){return e.Name.toLowerCase()})),this._richTableSchemasByName=l.default.mapValues(this._flatTableSchemasByName,(function(e){return new u.default(e)})),this._tableDefinitionsByName=l.default.keyBy(this.tableDefinitions(),(function(e){return e.Name.toLowerCase()})),this._sliceDefinitionsByName=l.default.keyBy(this.sliceDefinitions(),(function(e){return e.Name.toLowerCase()})),this._schemasByTableName=l.default.mapValues(this._tableDefinitionsByName,(function(e){return a.findSchema(e.SchemaName)})),this._sliceTableSchemasBySliceName=l.default.mapValues(this._sliceDefinitionsByName,(function(e){var t=a.findRootTableDefinition(e.SourceTable),n=((null==t?void 0:t.SchemaName)||"").toLowerCase(),r=a._flatTableSchemasByName[n];return new u.default(r,e)}))}return(0,o.default)(e,[{key:"_cache",value:function(e,t){return this._cacheStore.hasOwnProperty(e)||(this._cacheStore[e]=t()),this._cacheStore[e]}},{key:"id",value:function(){return this.model.Id}},{key:"name",value:function(){return this.model.Name}},{key:"shortName",value:function(){return this.model.ShortName}},{key:"respectShowIf",get:function(){return!(!this.model.Presentation||!this.model.Presentation.RespectShowIfEverywhere)}},{key:"aboutUrl",get:function(){var e,t;return null===(t=null===(e=this.model.Behavior)||void 0===e?void 0:e.Description)||void 0===t?void 0:t.AboutUrl}},{key:"ownerEmail",get:function(){return this.model.OwnerEmail}},{key:"needsUserConsent",get:function(){return this.model.Behavior.UsageScopes!==this.model.Behavior.UserConsentedScopes}},{key:"usageScopes",get:function(){return this.model.Behavior.UsageScopes}},{key:"logoUrl",get:function(){var e;return null===(e=this.model.Presentation)||void 0===e?void 0:e.LogoUrl}},{key:"imageResolution",get:function(){switch(this.model.Presentation&&this.model.Presentation.PhotoResolution){case"Low":return 200;case"Medium":return 800;case"High":return 1600;case"Full":return E.NO_RESIZE_WIDTH;default:return 600}}},{key:"barcodeScanner",get:function(){if(this.model.OwnerId,this.model.OwnerSubscription<C)return{enabled:!1,type:r.DISABLED};var e=this.externalServiceSettings,t=e.EnableBarcodeScanning,n=e.ScanningServiceName,a=this.externalAccounts[n];return t?n&&a?{enabled:!0,type:r.SCANDIT,key:a}:this.appModel.inRollout("mlkitScanner")?{enabled:!0,type:r.MLKIT}:{enabled:!0,type:r.SCANDIT}:{enabled:!1,type:r.DISABLED}}},{key:"scanningDisabled",get:function(){return!this.barcodeScanner.enabled}},{key:"ownedByCurrentUser",get:function(){return A.AppGlobals.AppState.UserInformation.Id===this.model.OwnerId}},{key:"automaticUpdates",get:function(){return!(!this.model.Behavior.AutoBackgroundUpdate||(this.model.IsPublic||this.model.IsTeamPublic)&&!this.ownedByCurrentUser||this.appModel.shouldBlockSync)}},{key:"syncOnStart",get:function(){return this.model.Behavior.SyncOnStart}},{key:"externalServiceSettings",get:function(){return e.getExternalServiceSettings(this.model)}},{key:"externalAccounts",get:function(){var e;return null!==(e=this.model.ExternalAccounts)&&void 0!==e?e:{}}},{key:"isGoogleMapsDisabled",get:function(){return!1===this.externalServiceSettings.EnableMapsAndGeocoding}},{key:"isFirebaseDisabled",get:function(){return!1===this.externalServiceSettings.EnableFirebase}},{key:"isBarcodeScanningDisabled",get:function(){return!1===this.externalServiceSettings.EnableBarcodeScanning}},{key:"lastModified",value:function(){var e=null;if(this.model.LastModified){var t=this.model.LastModified.match(/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d(?::[0-5]\d(?:\.\d+)?)?([+-][0-2]\d:[0-5]\d|[Zz])?$/);t&&(e=this.model.LastModified,null==t[1]&&(e+="Z"))}return e}},{key:"normalizedFontSize",value:function(){var e,t=null===(e=this.model.Presentation)||void 0===e?void 0:e.FontSize;return 16===t?18:t}},{key:"tableDefinitions",value:function(){return(this.model.AppData.DataSets||[]).filter((function(e){return e.IsValid}))}},{key:"actions",value:function(){var e=this;return this._cache("actions",(function(){var t=(e.model.AppData.DataActions||[]).filter((function(e){return e.IsValid&&!(0,w.isEntityEmbedded)(e.Scope)})),n=l.default.sortBy(t,(function(e){return e.ActionOrder}));return new c.default(n)}))}},{key:"getProminentActionsForTable",value:function(e){return this.actions().actionsForTable(e,this.appModel,!1).filter((function(e){return e.prominence()===y.default.DISPLAY_PROMINENTLY})).map((function(e){return e.action}))}},{key:"sliceDefinitions",value:function(){return(this.model.AppData.TableSlices||[]).filter((function(e){return e.IsValid}))}},{key:"rootTableSchemas",value:function(){var e=this.model.AppData.DataSchemas||[];return e.filter((function(e){return e.IsValid}))}},{key:"expressionSettings",value:function(){return this.model.AppData.ExpressionSettings||_}},{key:"viewControls",value:function(){return(this.model.Presentation.Controls||[]).filter((function(e){return e.IsValid}))}},{key:"formattingRules",value:function(){var e=this;return this._cache("formattingRules",(function(){var t=e.model.Presentation.FormatRules||[];return new d.default(l.default.sortBy(t.filter((function(e){return e.IsValid})),(function(e){return e.RuleOrder})),e.appModel)}))}},{key:"predictiveModels",value:function(){var e=this;return this._cache("predictiveModels",(function(){var t;return((null===(t=e.model.Behavior)||void 0===t?void 0:t.AppPredictiveModels)||[]).filter((function(e){return e.IsValid})).map((function(e){return new h.default(e)}))}))}},{key:"ocrModels",value:function(){var e=this;return this._cache("ocrModels",(function(){var t;return((null===(t=e.model.Behavior)||void 0===t?void 0:t.AppOcrModels)||[]).filter((function(e){return e.IsValid})).map((function(e){return new v.default(e)}))}))}},{key:"ocrTextExtractor",value:function(){var e=this;return this._cache("ocrTextExtractor",(function(){var t=e.id();return new g.default({appId:t})}))}},{key:"loadOcrExtractors",value:function(){var e=this;this._cache("loadOcrExtractors",(function(){var t=e.ocrModels(),n=e.id();t.forEach((function(t){var a=new m.default({appId:n,ocrModel:t});e._ocrExtractors[t.name()]=a}))}))}},{key:"loadPredictors",value:function(){var e=this;this._cache("loadPredictors",(function(){e._predictors={};var t=e.predictiveModels().filter((function(e){return e.predictorReady()}));Promise.all(t.map((function(t){return p.default.fromDefinition(e.model,t).then((function(n){e._predictors[t.name()]=n}))}))).catch((function(e){if(!(String(e).indexOf("Unexpected token < in JSON")>=0))throw e})).catch((function(e){return f.default.ReportError({errorMessage:"Error loading predictive models",error:e})}))}))}},{key:"findOcrModel",value:function(e){return this.ocrModels().find((function(t){return t.name()===e}))}},{key:"findOcrExtractor",value:function(e){return this._ocrExtractors?this._ocrExtractors[e]:null}},{key:"findPredictor",value:function(e){return this._predictors?this._predictors[e]:null}},{key:"findSchema",value:function(e){var t=(e=e||"").toLowerCase();return this._richTableSchemasByName[t]}},{key:"findSchemaForTable",value:function(e){var t=(e=e||"").toLowerCase();return this._sliceTableSchemasBySliceName[t]||this._schemasByTableName[t]}},{key:"findRootSchemaForTable",value:function(e){var t;e=e||"";var n=this._sliceTableSchemasBySliceName[e.toLowerCase()];return t=n?(n.sourceTableName()||"").toLowerCase():e.toLowerCase(),this.findSchemaForTable(t)}},{key:"findRootTableDefinition",value:function(e){var t=(e=e||"").toLowerCase(),n=this._tableDefinitionsByName[t];if(!n){var a=this._sliceDefinitionsByName[t];a&&(t=a.SourceTable.toLowerCase(),n=this._tableDefinitionsByName[t])}return n}},{key:"findSliceDefinition",value:function(e){return e=e||"",this._sliceDefinitionsByName[e.toLowerCase()]}},{key:"findControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=e||"";var n=this._viewControlsByName[e.toLowerCase()];return n&&t&&t!==n.Action?null:n}},{key:"findControlsForTable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=e||"","string"==typeof t&&(t=[t]);var a=l.default.includes(t,"form"),r=this.viewControls().filter((function(r){var i="table"===r.Action?"fastTable":r.Action,o=r.TableOrFolderName&&r.TableOrFolderName.toLowerCase()===e.toLowerCase(),u=l.default.includes(t,i),s="ref"===r.Position;return n?!(!a&&"form"===r.Action)&&(o&&(u||s)):o&&u}));return l.default.sortBy(r,(function(e){return"ref"===e.Position?1:2}))}},{key:"getView",value:function(e){return e=e||"",this._richViewControlsByName[e.toLowerCase()]}},{key:"getViewDefinition",value:function(e){var t=this.getView(e);return t?t.definition():{}}},{key:"views",value:function(){return l.default.values(this._richViewControlsByName)}},{key:"secureImageAccess",get:function(){return(this.model.Behavior||{}).SecureImageAccess}},{key:"usesLocation",get:function(){var e;return null===(e=this.model.Behavior)||void 0===e?void 0:e.UsesGeolocation}},{key:"hasValidUsageScopesConsent",value:function(){return this.model.IsValid&&(!this.model.Behavior.RequireUserConsent||this.model.Behavior.UsageScopes===this.model.Behavior.UserConsentedScopes)}},{key:"recordUsageScopesConsent",value:function(){var e;l.default.set(this.model,"Behavior.UserConsentedScopes",null===(e=this.model.Behavior)||void 0===e?void 0:e.UsageScopes)}}],[{key:"getExternalServiceSettings",value:function(e){var t,n;return null!==(n=null===(t=e.Behavior)||void 0===t?void 0:t.ExternalServiceSettings)&&void 0!==n?n:O}}]),e}();t.default=k},150198:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.typeComparers=t.textTypes=t.temporalTypes=t.presentableImageTypes=t.numberTypes=t.mostlyNumberTypes=t.listTypes=t.imageTypes=t.externalFileTypes=t.enumeratedTypes=t.default=t.decimalTypes=t.colorMap=t.changeTriggeredTypes=t.booleanTypes=t.basicTypes=t.actionTypes=t.ValueFormat=t.LongTextFormatting=t.Attribute=void 0;var i,o,l=a(n(918698)),u=a(n(627424)),s=a(n(856690)),c=a(n(689728)),d=a(n(496486)),f=a(n(593302)),p=a(n(498967)),h=a(n(249e3)),v=a(n(190644)),m=a(n(593186)),g=O(n(365914)),y=a(n(730381)),b=a(n(440587)),T=a(n(302443)),S=a(n(304878)),A=O(n(888861)),E=n(166089),w=a(n(112368));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(C=function(e){return e?n:t})(e)}function O(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=C(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}t.ValueFormat=i,function(e){e.Native="Native",e.Wire="Wire"}(i||(t.ValueFormat=i={})),t.LongTextFormatting=o,function(e){e.HTML="HTML",e.Markdown="Markdown",e.PlainText="Plain Text"}(o||(t.LongTextFormatting=o={}));var _={green:"green",yellow:"yellow",orange:"orange",red:"red",purple:"purple",blue:"blue",white:"white",black:"black"};t.colorMap=_;var k=d.default.keyBy(["Text","Enum","EnumList","LongText","Name","Number","PostalCode","DateTime","Percent","Decimal","Price","Date","Time","Duration"]);t.basicTypes=k;var R=d.default.keyBy(["Email","Phone","LatLong","XY","Address","File","Url","ChangeLocation"]);t.actionTypes=R;var I=d.default.keyBy(["Image","Drawing","Signature","Thumbnail"]);t.imageTypes=I;var N=d.default.keyBy(["Image","Thumbnail"]);t.presentableImageTypes=N;var M=d.default.keyBy(["Yes/No"]);t.booleanTypes=M;var D=d.default.keyBy(["ChangeCounter","Number","Percent","Decimal","Price","Duration"]);t.numberTypes=D;var L=d.default.keyBy(["Address","Text","LongText","Url","Name","LatLong","XY","ChangeLocation","Phone"]);t.textTypes=L;var P=d.default.keyBy(["Date","Time","DateTime"]);t.temporalTypes=P;var G=d.default.keyBy(["ChangeCounter","ChangeLocation","ChangeTimestamp"]);t.changeTriggeredTypes=G;var x=d.default.keyBy(["Percent","Decimal","Price"]);t.decimalTypes=x;var F=d.default.keyBy(["ChangeCounter","Number","PostalCode","DateTime","ChangeTimestamp","Percent","Decimal","Price","Date","Time","Duration","Phone"]);t.mostlyNumberTypes=F;var V=d.default.keyBy(["Ref","Enum","EnumList","Color","Progress","Yes/No"]);t.enumeratedTypes=V;var U=d.default.keyBy(["List","EnumList"]);t.listTypes=U;var B=d.default.keyBy(["Image","Drawing","Signature","Thumbnail","File"]);t.externalFileTypes=B;var H={Text:p.default.textComparer,LongText:p.default.textComparer,Name:p.default.textComparer,Address:p.default.textComparer,LatLong:p.default.textComparer,XY:p.default.textComparer,ChangeLocation:p.default.textComparer,Number:p.default.numericComparer,ChangeCounter:p.default.numericComparer,Decimal:p.default.numericComparer,Percent:p.default.numericComparer,Price:p.default.numericComparer,Date:p.default.dateComparer,DateTime:p.default.dateComparer,ChangeTimestamp:p.default.dateComparer,Time:p.default.timeComparer,Duration:p.default.durationComparer,Ref:p.default.labelComparer,Enum:"special-enum",Color:"special-enum",Progress:"special-enum"};t.typeComparers=H;var W={Date:p.default.nativeDateComparer,DateTime:p.default.nativeDateComparer,ChangeTimestamp:p.default.nativeDateComparer,Time:p.default.nativeDateComparer},j=function(){function e(t){var n=this;(0,s.default)(this,e),this.model=t,this._evalTreeLookup={},this.getImageLabel=function(e,t){var a;if(n.isImageType())return e;var r=E.AppGlobals.AppModel.findTableCollection(n.auxData().ReferencedTableName),i=r.rootTable,o=r.rootTableSchema,l=null==o?void 0:o.labelImageAttribute();return l&&(null===(a=null==i?void 0:i.lookupTableRow(e,t))||void 0===a?void 0:a.get(l.name()))||""},this.localizeWireValue=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r>50)return t;switch(n.type().toLowerCase()){case"list":case"enumlist":if(!t)return"";if("function"==typeof t.split){var i=n.itemSeparator()||e.inferEnumListDelimiter(t);t=n.splitEnumListValue(t);var o=n.nestedAttribute();return t.map((function(e){return o.localizeWireValue(e,a,r+1)})).join(i)}return t;case"enum":var l=n.nestedAttribute();return l?l.localizeWireValue(t,a,r+1):t;case"ref":if(!a.noRefLabel){var u=1,s=n.referencedLabelCollection(u),c=s.table,d=s.labelBasicAttribute;if(c&&d&&d!==n)return d.localizeWireValue(c.labelTextForId(t,a.transaction),a,r+1)}if(a.noRefKeyFallback)return"";var f=n.nestedAttribute();return f?f.localizeWireValue(t,a,r+1):t;case"time":return t?g.default.toLocaleTimeString(t,n.ignoreSeconds()):"";case"date":return t?g.default.toLocaleDateString(t,n.useLongDateFormat()):"";case"datetime":case"changetimestamp":return t?g.default.localizeDateTime(t,n.ignoreSeconds(),n.useLongDateFormat()):"";case"percent":return n.normalizePercentValueToString(t);case"number":case"decimal":case"price":return e.formatLocalizedNumber(t,{precision:n.decimalDigits(),numericDigits:n.numericDigits(),useGrouping:!a.suppressGrouping&&n.showThousandsSeparator(),currencySymbol:n.currencySymbol()});case"yes/no":var p=n.booleanTypeLabels(a.dataContext),h=p.yesLabel,v=p.noLabel,m=e.booleanValueFromWireFormat(t);return m?h:v;default:return t}},this.getNormalizedLookupValue=function(e){d.default.isNil(e)&&(e="");var t,a=n.type(),r=n.nestedAttribute();switch(a){case"Enum":case"Ref":return d.default.isNil(r)?e:r.getNormalizedLookupValue(e);case"Date":case"DateTime":case"ChangeTimestamp":return new Date(e||0).getTime();case"Time":return e?g.default.timeToDate(e).getTime():"";case"Duration":return g.default.getDurationSecs(g.default.parseDuration(e));case"Yes/No":switch(t=(0,g.toNormalizedString)(e)){case"y":case"yes":case"t":case"true":return!0;case"n":case"no":case"f":case"false":return!1}return t;case"Progress":switch(t=(0,g.toNormalizedString)(e)){case"empty":return"empty";case"quarter":case"one quarter":return"quarter";case"half":return"half";case"three quarter":case"three quarters":return"three quarter";case"full":return"full"}return t;case"Number":case"Decimal":case"Price":case"Percent":case"ChangeCounter":return Number(e);case"File":case"Image":case"Signature":case"Thumbnail":case"Drawing":return g.default.stripRefImageValue(e,a);case"Url":if(e&&"function"==typeof e.indexOf&&0!==e.indexOf("{"))return JSON.stringify(n.valueFromWireFormat(e)).toLowerCase()}return(0,g.toNormalizedString)(e)}}return(0,c.default)(e,[{key:"auxData",value:function(){if(this._auxDataCache)return this._auxDataCache;var t=this.model.TypeAuxData||{};return"string"==typeof t&&(t=e.parseAuxData(t,this)),this._auxDataCache=t,t}},{key:"auxDataString",value:function(){return null==this.model.TypeAuxData?"":"string"==typeof this.model.TypeAuxData?this.model.TypeAuxData:(this._auxDataString||(this._auxDataString=JSON.stringify(this.model.TypeAuxData)),this._auxDataString)}},{key:"setInternalQualifier",value:function(e){this.model.InternalQualifier=e}},{key:"internalQualifier",value:function(){return this.model.InternalQualifier||{}}},{key:"isValid",value:function(){return this.model.IsValid}},{key:"isLabel",value:function(){return!!this.model.IsLabel}},{key:"isHidden",value:function(){return this.model.IsHidden}},{key:"isReadOnly",value:function(){return this.model.IsReadOnly}},{key:"isRequired",value:function(){return this.model.IsRequired}},{key:"isSys",value:function(){return this.model.IsSys}},{key:"isKey",value:function(){return!!this.model.IsKey}},{key:"isScannable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>20)return!1;if(this.model.IsScannable)return!0;if("Ref"===this.type()){var t=this.nestedAttribute();if(t&&t.isScannable(e+1))return!0}return!1}},{key:"isNfcScannable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>20)return!1;if(this.model.IsNfcScannable)return!0;if("Ref"===this.type()){var t=this.nestedAttribute();if(t&&t.isNfcScannable(e+1))return!0}return!1}},{key:"isSearchable",value:function(){return this.model.IsValid&&this.model.Searchable}},{key:"supportsEditsInTableView",value:function(){switch(this.type()){case"LongText":case"Yes/No":case"Text":case"Number":case"Decimal":case"Percent":case"Price":case"Url":case"Date":case"DateTime":case"Time":case"Duration":case"Name":case"Email":case"Address":case"Phone":case"Enum":case"EnumList":case"Ref":return!0}return!1}},{key:"shouldShowScannerButtons",value:function(){if(!this.isScannable()&&!this.isNfcScannable())return!1;if(!w.default.SupportsBarcodeScan())return!1;switch(this.type()){case"Text":case"Ref":case"Enum":case"EnumList":case"Number":case"Decimal":case"Price":case"Percent":return!0}return!1}},{key:"isListOfRefs",value:function(){var e=this.nestedAttribute();return!!e&&("List"===this.type()&&"Ref"===e.type())}},{key:"isReverseRef",value:function(){return this.isListOfRefs()&&this.isSys()}},{key:"isDependentRef",value:function(){return"Ref"===this.type()&&this.auxData().IsAPartOf}},{key:"isReverseDependentRef",value:function(){var e;if(!this.isReverseRef())return!1;var t=this.internalQualifier();return null===(e=null==t?void 0:t.Properties)||void 0===e?void 0:e.IsOwnerOf}},{key:"refListFilterDefaults",value:function(e){var t=(0,A.getFilterDefaultsAndFullyMapped)(this.refListFilter(e)),n=(0,u.default)(t,2),a=n[0];if(n[1])return a}},{key:"refListFilter",value:function(e){var t=this;if(this.isListOfRefs()){var n=this.appFormulaEvalTree();if(n){var a=function(n){return(0,A.createKeyInListFilter)(t.listElementType(),t.listElementTypeQualifier(),n.curry(e))};if("SELECT"===n.FunctionName){var r=n.children[0],i=e.appModel;if(!(null==i?void 0:i.inRollout("currySelect"))){var o=n.currySelectFilterOnly(e);return r.isRowList()?(0,A.createAnd)(a(r),o):o}var l=[this.listElementAttribute().referencedTableName(),r.TableName].map((function(e){return null==i?void 0:i.findTableCollection(e).rootTable})),s=(0,u.default)(l,2);if(s[0]===s[1]){var c=n.currySelectFilterOnly(e);return r.isRowList()?(0,A.createAnd)(a(r),c):c}}return a(n)}}}},{key:"type",value:function(){return this.model.Type}},{key:"nestedAttribute",value:function(){if(!this._nestedAttribute){var t,n=null;if("Enum"===this.type()||"EnumList"===this.type()){if(!(t=this.auxData().BaseType))return null;n=this.auxData().BaseTypeQualifier}else if("Ref"===this.type()){if(!(t=this.auxData().ReferencedType))return null;n=this.auxData().ReferencedTypeQualifier}else{if("List"!==this.type())return null;if(!(t=this.auxData().ElementType))return null;n=this.auxData().ElementTypeQualifier}var a=null;"EnumList"!==this.type()&&"List"!==this.type()&&(a=this.model.InternalQualifier&&this.model.InternalQualifier.ColumnStats),this._nestedAttribute=new e({Name:this.name(),Type:t,TypeAuxData:n,autoFrom:this,InternalQualifier:{ColumnStats:a}})}return this._nestedAttribute}},{key:"basestAttribute",value:function(){var e=this.nestedAttribute();return e=e?e.basestAttribute():this}},{key:"yields",value:function(e){var t;return"Ref"===this.type()||"Enum"===this.type()?!!(null===(t=this.nestedAttribute())||void 0===t?void 0:t.yields(e)):this.type()===e}},{key:"yieldsOneOf",value:function(e){var t;return!!Array.isArray(e)&&("Ref"===this.type()||"Enum"===this.type()?!!(null===(t=this.nestedAttribute())||void 0===t?void 0:t.yieldsOneOf(e)):d.default.includes(e,this.type()))}},{key:"firstNestedRef",value:function(){return this.firstNestedOfType("Ref",!1)}},{key:"firstNestedOfType",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.type()===e)return this;if(this.isListType()&&!t)return null;var n=this.nestedAttribute();return n&&(n=n.firstNestedOfType(e,t)),n}},{key:"allNestedTypes",value:function(){for(var e,t=this.nestedAttribute();t;)(e=e||[]).push(t.type()),t=t.nestedAttribute();return e}},{key:"listElementAttribute",value:function(){return"List"===this.type()?this.nestedAttribute():null}},{key:"enumElementAttribute",value:function(){return"Enum"===this.type()||"EnumList"===this.type()?this.nestedAttribute():null}},{key:"nestedType",value:function(){var e=this.nestedAttribute();return e?e.type():null}},{key:"basestType",value:function(){return this.basestAttribute().type()}},{key:"baseTypeQualifier",value:function(){var e=this.nestedAttribute();return e?e.auxData():null}},{key:"listElementType",value:function(){return"List"===this.type()?this.nestedType():null}},{key:"listElementTypeQualifier",value:function(){if("List"===this.type()){var e=this.nestedAttribute();if(e)return e.model.TypeAuxData}return null}},{key:"referencedTableName",value:function(){var e=this.firstNestedRef();return(null==e?void 0:e.auxData().ReferencedTableName)||null}},{key:"referencedTable",value:function(){var e=this.referencedTableName();return e&&E.AppGlobals.AppModel.findTableCollection(e).table||null}},{key:"referencedLabelCollection",value:function(e){for(var t,n,a,r,i=0,o=this.firstNestedRef();null!=o&&(null==e||i<e);){if(r=r||new Set,null==(a=null===(t=(n=E.AppGlobals.AppModel.findTableCollection(o.referencedTableName())).tableSchema)||void 0===t?void 0:t.labelBasicAttribute())||r.has(a))return{};r.add(a),o=a.firstNestedRef(),i++}return a?Object.assign(Object.assign({},n),{labelBasicAttribute:a}):{}}},{key:"derefRow",value:function(e){var t,n=this.referencedTableName(),a=((null===(t=E.AppGlobals.AppModel)||void 0===t?void 0:t.findTableCollection(n))||{}).rootTable;return null==a?void 0:a.lookupTableRow(e)}},{key:"numericDigits",value:function(){return this.auxData().NumericDigits}},{key:"decimalDigits",value:function(){var e=this.auxData().DecimalDigits;return"number"!=typeof e&&this.isNumericType()?"Number"===this.type()?0:2:e}},{key:"showThousandsSeparator",value:function(){return!1!==this.auxData().ShowThousandsSeparator}},{key:"currencySymbol",value:function(){return this.auxData().CurrencySymbol}},{key:"enumValues",value:function(){var e;return null===(e=this.auxData().EnumValues)||void 0===e?void 0:e.map(g.fastTrim)}},{key:"allowOtherValues",value:function(){return!!this.auxData().AllowOtherValues}},{key:"autoCompleteOtherValues",value:function(){return!!this.allowOtherValues()&&!!this.auxData().AutoCompleteOtherValues}},{key:"ignoreSeconds",value:function(){return!!this.auxData().IgnoreSeconds}},{key:"useLongDateFormat",value:function(){return!!this.auxData().UseLongDateFormat}},{key:"itemSeparator",value:function(){return this.auxData().ItemSeparator}},{key:"launchExternal",value:function(){return this.auxData().LaunchExternal}},{key:"geocodingEnabled",value:function(){return this.auxData().GeocodingEnabled}},{key:"name",value:function(){return this.model.Name}},{key:"lowercaseName",value:function(){return this._normalizedName||(this._normalizedName=this.name().trim().toLowerCase()),this._normalizedName}},{key:"longTextFormatting",value:function(){return this.auxData().LongTextFormatting}},{key:"baseImage",value:function(e){var t=this.baseImageEvalTree();if(t){if(e){var n=t.run(e);return n?String(n):""}return""}return this.auxData().BaseImage||""}},{key:"displayName",value:function(e){var t=this.auxData();if(this.name().indexOf("_Computed")>=0&&t.ComponentFieldNames)return t.ComponentFieldNames.join(" ");var n=this.displayNameField(e);return n||this.name()}},{key:"displayNameField",value:function(e){var t,n=this.evalTreeLookup("DisplayName");if(n&&e){var a=n.run(e);a&&(t=String(a))}return t}},{key:"hasDisplayName",value:function(){return!!this.model.DisplayName}},{key:"verboseName",value:function(e){return this.description(e)||this.model.Name}},{key:"description",value:function(e){var t=this.evalTreeLookup("Description");if(t&&e){var n=t.run(e);return n?String(n):""}return this.model.Description}},{key:"showContent",value:function(e){if(this.isShowType()){var t=this.showContentEvalTree();if(t&&e){var n=t.run(e);return n=this.coerceValue(n,t.resultType(),t.resultTypeQualifier()),n=this.valueToWireFormat(n),this.localizeWireValue(n)}return this.auxData().Content}return null}},{key:"appFormula",value:function(){return this.model.AppFormula}},{key:"hasFormula",value:function(){return!!this.model.Formula}},{key:"hasAppFormula",value:function(){var e;return!!(null!==(e=this.model.AppFormula)&&void 0!==e?e:this.appFormulaEvalTree())}},{key:"hasDefaultExpression",value:function(){var e;return!!(null!==(e=this.model.DefaultExpression)&&void 0!==e?e:this.defaultExpressionEvalTree())}},{key:"hasResetExpression",value:function(){return!!this.resetIfEvalTree()}},{key:"setAppFormula",value:function(e,t){delete this._evalTreeLookup.AppFormulaExpression,delete this._auxDataCache,delete this._auxDataString,delete this._nestedAttribute,this.internalQualifier().AppFormulaExpression=e.model,this.model.Type=e.resultType(),this.model.TypeAuxData=null!=t?t:e.resultTypeQualifier()}},{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this.internalQualifier(),n=t.ExpressionLookup||{},a=this.model.ExprLookup||{};try{a[e]?this._evalTreeLookup[e]=A.default.create(a[e]):n[e]?this._evalTreeLookup[e]=A.default.create(n[e]):t[e]?this._evalTreeLookup[e]=A.default.create(t[e]):"DefaultExpression"===e&&this.model[e]&&(this._evalTreeLookup[e]=A.default.create(this.model[e]))}catch(t){m.default.warnToDevConsole("Failed to create ExprEvalTree for "+e)}}return this._evalTreeLookup[e]}},{key:"appFormulaEvalTree",value:function(){return this.evalTreeLookup("AppFormulaExpression")}},{key:"defaultExpressionEvalTree",value:function(){return this.evalTreeLookup("DefaultExpression")}},{key:"validIfEvalTree",value:function(){return this.evalTreeLookup("Valid_If_AppEval")}},{key:"suggestedValuesEvalTree",value:function(){return this.evalTreeLookup("Suggested_Values")}},{key:"requiredIfEvalTree",value:function(){return this.evalTreeLookup("Required_If_AppEval")}},{key:"showIfEvalTree",value:function(){return this.evalTreeLookup("Show_If_AppEval")}},{key:"editableIfEvalTree",value:function(){return this.evalTreeLookup("Editable_If_AppEval")}},{key:"resetIfEvalTree",value:function(){return this.evalTreeLookup("Reset_If_AppEval")}},{key:"showContentEvalTree",value:function(){return this.evalTreeLookup("ShowContent")}},{key:"baseImageEvalTree",value:function(){return this.evalTreeLookup("XYBaseImage")}},{key:"displayNameEvalTree",value:function(){return this.evalTreeLookup("DisplayName")}},{key:"publishKeyEvalTree",value:function(){return this.evalTreeLookup("Publish_If_Rowkey")}},{key:"isChangeTriggered",value:function(){return!!G[this.type()]}},{key:"invalidMessageEvalTree",value:function(){return this.evalTreeLookup("Error_Message_If_Invalid")}},{key:"booleanEvalTrees",value:function(){return{yesEvalTree:this.evalTreeLookup("YesLabel"),noEvalTree:this.evalTreeLookup("NoLabel")}}},{key:"isBooleanWithCustomLabel",value:function(){var e=this.booleanEvalTrees(),t=e.yesEvalTree,n=e.noEvalTree;return null!=t||null!=n}},{key:"booleanTypeLabels",value:function(t){var n,a;if(t){var r=this.booleanEvalTrees(),i=r.yesEvalTree,o=r.noEvalTree;i&&(n=i.run(t))&&(n=e.valueToWireFormat(n,i.resultType(),i.resultTypeQualifier())),o&&(a=o.run(t))&&(a=e.valueToWireFormat(a,o.resultType(),o.resultTypeQualifier()))}return n||(n="Y"),a||(a="N"),{yesLabel:n,noLabel:a}}},{key:"isDynamic",value:function(){return this.isChangeTriggered()||this.hasAppFormula()||this.hasDefaultExpression()||this.resetsEachUpdate()||this.hasResetExpression()}},{key:"valueDependsOn",value:function(e,t){var n=this.appFormulaEvalTree(),a=this.defaultExpressionEvalTree(),r=this.resetIfEvalTree();return(null==n?void 0:n.tablesReferenced().includes(e))||(null==r?void 0:r.tablesReferenced().includes(e))||t&&(null==a?void 0:a.tablesReferenced().includes(e))}},{key:"isValidityEnum",value:function(){var e=this.validIfEvalTree();return e&&"function"==typeof e.isThisInCondition&&e.isThisInCondition()}},{key:"hasSuggestedValues",value:function(){return!!this.suggestedValuesEvalTree()}},{key:"isVirtual",value:function(){return!!this.model.IsVirtual}},{key:"isShowType",value:function(){return"Show"===this.type()}},{key:"isShowHeader",value:function(){return this.isPageHeader()||this.isSectionHeader()}},{key:"isPageHeader",value:function(){return this.isShowType()&&"Page_Header"===this.auxData().Category}},{key:"isSectionHeader",value:function(){return this.isShowType()&&"Section_Header"===this.auxData().Category}},{key:"isShowText",value:function(){return this.isShowType()&&"Text"===this.auxData().Category}},{key:"isShowUrl",value:function(){return this.isShowType()&&"Url"===this.auxData().Category}},{key:"isShowImage",value:function(){return this.isShowType()&&"Image"===this.auxData().Category}},{key:"isShowVideo",value:function(){return this.isShowType()&&"Video"===this.auxData().Category}},{key:"isBasicType",value:function(){return!!k[this.type()]}},{key:"isActionType",value:function(){return!!R[this.type()]}},{key:"isImageType",value:function(){return!!I[this.type()]}},{key:"isPresentableImageType",value:function(){return!!N[this.type()]}},{key:"isListType",value:function(){return!!U[this.type()]}},{key:"isBooleanType",value:function(){return!!M[this.type()]}},{key:"isNumericType",value:function(){var e=this.nestedAttribute();return e?!!D[e.type()]:!!D[this.type()]}},{key:"isTextualType",value:function(){var e=this.nestedAttribute();return e?!!L[e.type()]:!!L[this.type()]}},{key:"isTemporalType",value:function(){var e=this.nestedAttribute();return e?!!P[e.type()]:!!P[this.type()]}},{key:"isDecimalType",value:function(){var e=this.nestedAttribute();return e?!!x[e.type()]:!!x[this.type()]}},{key:"isEnumerated",value:function(){return!!V[this.type()]||this.isValidityEnum()||this.hasSuggestedValues()}},{key:"isMostlyNumberType",value:function(){return!!F[this.type()]}},{key:"hasInputMethod",value:function(){return"Video"!==this.type()||E.AppGlobals.AppModel.inRollout("videoUpload")}},{key:"shouldRightAlign",value:function(){var e,t,n,a=this.referencedLabelCollection().labelBasicAttribute;if(null!=a)return a.shouldRightAlign();var r=null!==(n=null===(t=null===(e=E.AppGlobals.AppModel)||void 0===e?void 0:e.AppTemplate)||void 0===t?void 0:t.Presentation)&&void 0!==n?n:{},i=r.UseAccountingFormat,o=r.RightAlignNumeric;return this.isNumericType()&&Boolean(i||o)}},{key:"shouldNotStretch",value:function(){return this.isImageType()||this.shouldRightAlign()}},{key:"valueComparer",value:function(e){var t,n=e===i.Native&&W[this.type()]||H[this.type()];if("special-enum"===n){var a=this.auxData(),r=a.EnumValues;n=r?a.AllowOtherValues&&"Color"!==this.type()&&"Progress"!==this.type()?null===(t=this.nestedAttribute())||void 0===t?void 0:t.valueComparer(e):p.default.listComparer.bind(p.default,r):this.nestedAttribute().valueComparer(e)}return n||(n=p.default.genericComparer),n}},{key:"columnStats",value:function(){if(this.model.InternalQualifier&&this.model.InternalQualifier.ColumnStats&&null!=this.model.InternalQualifier.ColumnStats.MaxLength)return this.model.InternalQualifier.ColumnStats;var e=this.basestAttribute().auxData();return(null==e?void 0:e.MaxLength)&&e.MinLength?{MaxLength:e.MaxLength,MinLength:e.MinLength,AverageLength:(e.MaxLength+e.MinLength)/2,StdDevLength:(e.MaxLength-e.MinLength)/10}:null}},{key:"getChartAxisFormat",value:function(e,t){var n=this.auxData(),a=this.isDecimalType(),r=this.isNumericType(),i=",";(a||r)&&(n.ShowThousandsSeparator||(i=""));if(a){var o=0;if(n.DecimalDigits)o=n.DecimalDigits;else if(e>=0&&t>=0){var l=t-e;o=Math.max(Math.ceil(Math.log10(Math.floor(20/l))),0)}return i+"."+o+"f"}return r?i+".0f":null}},{key:"getChartAxisValueRange",value:function(e,t){if(this.isNumericType()){var n=this.auxData().MinValue,a=this.auxData().MaxValue,r=null===n||isNaN(n)||isNaN(e)?n||e||0:Math.min(n,e),i=null===a||isNaN(a)||isNaN(t)?a||t||0:Math.max(a,t);if(!isNaN(r)&&!isNaN(i))return[r,i]}return null}},{key:"validIfConstraintInfo",value:function(){return this.internalQualifier().Valid_If_ConstraintInfo}},{key:"appFormulaColumnsReferenced",value:function(){return this.appFormulaEvalTree()&&this.appFormulaEvalTree().columnsReferenced()||[]}},{key:"defaultExpressionColumnsReferenced",value:function(){return this.defaultExpressionEvalTree()&&this.defaultExpressionEvalTree().columnsReferenced()||[]}},{key:"resetColumnsReferenced",value:function(){return this.resetIfEvalTree()&&this.resetIfEvalTree().columnsReferenced()||[]}},{key:"showContentColumnsReferenced",value:function(){return this.isShowType()&&this.evalTreeLookup("ShowContent")&&this.evalTreeLookup("ShowContent").columnsReferenced()||[]}},{key:"validIfColumnsReferenced",value:function(){return this.validIfEvalTree()&&this.validIfEvalTree().columnsReferenced()||[]}},{key:"suggestedValuesColumnsReferenced",value:function(){return this.suggestedValuesEvalTree()&&this.suggestedValuesEvalTree().columnsReferenced()||[]}},{key:"requiredIfColumnsReferenced",value:function(){return this.requiredIfEvalTree()&&this.requiredIfEvalTree().columnsReferenced()||[]}},{key:"showIfColumnsReferenced",value:function(){return this.showIfEvalTree()&&this.showIfEvalTree().columnsReferenced()||[]}},{key:"editableIfColumnsReferenced",value:function(){return this.editableIfEvalTree()&&this.editableIfEvalTree().columnsReferenced()||[]}},{key:"baseImageColumnsReferenced",value:function(){return this.baseImageEvalTree()&&this.baseImageEvalTree().columnsReferenced()||[]}},{key:"displayNameColumnsReferenced",value:function(){return this.displayNameEvalTree()&&this.displayNameEvalTree().columnsReferenced()||[]}},{key:"changeColumns",value:function(){return this.isChangeTriggered()?this.auxData().ChangeColumns:null}},{key:"changeValues",value:function(){return this.isChangeTriggered()?this.auxData().ChangeValues:null}},{key:"updateMode",value:function(){return this.isChangeTriggered()?this.auxData().UpdateMode:null}},{key:"numberDisplayMode",value:function(){return this.auxData().NumberDisplayMode}},{key:"resetsEachUpdate",value:function(){return"Reset"===this.updateMode()||!!this.model.ResetOnEdit}},{key:"checkChangeTriggered",value:function(e,t,n,a){var r=!1;if(this.isChangeTriggered()){var i=this.changeColumns();if(null==i||0===i.length)r=!0;else for(var o=0;o<i.length;o++){if(i[o].toLowerCase()===n.name().toLowerCase()){var l=this.changeValues();if(null==l||0===l.length){r=!0;break}for(var u={ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"Equals",IsAtomic:!0},s=0;s<l.length;s++){if(u.Children=[{ResultType:n.type(),ResultTypeQualifier:n.auxData(),EvalType:"CONSTANT",ConstantValue:a},{ResultType:n.type(),ResultTypeQualifier:n.auxData(),EvalType:"CONSTANT",ConstantValue:l[s]}],A.default.create(u).run()){r=!0;break}}if(r)break}}}return r}},{key:"getValues",value:function(e){return this.valueFromWireFormat(e)}},{key:"missingRequired",value:function(e){return!(!this.model.IsRequired||this.model.Formula||this.model.AppFormula||null!=e&&""!==e)}},{key:"validateValue",value:function(t){if(this.model.IsReadOnly)return!0;var n=e.validators[this.model.Type];return!n||n(t,this.auxData())}},{key:"convertibleTo",value:function(e){var t=this.type(),n=e.type();return t===n||(!(!this.isNumericType()||!e.isNumericType())||(!(!this.isTextualType()||!e.isTextualType())||(!(!this.isImageType()||!e.isImageType())||(!(!this.isListType()||!e.isListType())||(!(!this.isTemporalType()||"Duration"===t||"Duration"===n||!e.isTemporalType())||("LatLong"===t&&"XY"===n||(("Text"===t||"LongText"===t)&&"List"!==n||("Text"===n||"LongText"===n))))))))}},{key:"isMoreSpecificType",value:function(e){var t=this.type(),n=e.type();return"Text"!==t&&"LongText"!==t&&("Text"===n||"LongText"===n)||"Unknown"!==t&&(!n||"Unknown"===n)}},{key:"coerceValue",value:function(t,n,a){if(n=n||this.type(),a=a||this.auxData(),null==t)return null;if(this.isNumericType()){var r=Number(t),i=0;if("Number"!==this.type()&&"ChangeCounter"!==this.type()&&(i=this.auxData().DecimalDigits),!isNaN(r)&&"number"==typeof i){"Percent"===this.type()&&(i+=2);var o=Math.pow(10,i);return r=Math.round(r*o)/o}}if("function"==typeof t.getMonth&&"object"===(0,l.default)(a)&&a.IgnoreSeconds&&t.setSeconds(0),"Yes/No"===this.type()&&(t=e.normalizeBooleanValue(t)),this.type()!==n){var u=e.valueToWireFormat(t,n,a);return e.valueFromWireFormat(u,this.type(),this.auxData())}return t}},{key:"shouldUpdateOnChange",value:function(){if(this.isValidityEnum()||this.hasSuggestedValues())return!0;switch(this.type().toLowerCase()){case"enum":case"enumlist":case"list":case"ref":case"color":case"image":case"thumbnail":case"file":case"drawing":case"signature":case"progress":case"yes/no":return!0;default:return!1}}},{key:"shouldUseStackSelect",value:function(){return"Stack"===this.auxData().EnumInputMode||"Stack"===this.auxData().InputMode}},{key:"shouldUseButtonSelect",value:function(e,t,n,a){if("Buttons"===this.auxData().EnumInputMode||"Buttons"===this.auxData().InputMode)return!0;if("Stack"===this.auxData().EnumInputMode||"Stack"===this.auxData().InputMode)return!0;if("Dropdown"===this.auxData().EnumInputMode)return!1;if(!e||!e.length)return!!n;if(a)return!1;if(t&&!this.isValidityEnum())return!1;var r=d.default.max(d.default.map(e,(function(e){return"string"!=typeof e?0:e.length}))),i=r<=14&&e.length<=3,o=r<=2&&e.length<=6;return i||o}},{key:"inFullDependentChain",value:function(e){var t,n,a=!1;if(null!=this.validIfConstraintInfo()&&e.length>0){a=!0;for(var r=0;r<e.length;r++){if(t=e[r],n=r>0?e[r-1]:null,null==t.validIfConstraintInfo()){a=!1;break}if(n){var i=t.validIfColumnsReferenced(),o=n.validIfColumnsReferenced();if(i.length!==o.length+1||d.default.intersection(i,o).length!==o.length){a=!1;break}}else if(this.name()!==t.name()){a=!1;break}}}return a}},{key:"valueExists",value:function(t){return e.valueExists(t,this.type())}},{key:"valueFromWireFormat",value:function(t){var n=this.nestedAttribute();switch(this.type()){case"List":return t?"function"==typeof t.split?t.split(e.listDelimiter).filter((function(e){return null!=e&&""!==e})).map((function(e){return n.valueFromWireFormat(e)})):t:[];case"EnumList":return t?"function"==typeof t.split?this.splitEnumListValue(t).filter((function(e){return null!=e&&""!==e})).map((function(e){return n.valueFromWireFormat(e)})):t:[];case"Ref":case"Enum":return n.valueFromWireFormat(t);default:return e.valueFromWireFormat(t,this.type(),this.auxData())}}},{key:"valuesFromWireFormat",value:function(e){var t=this;return e.map((function(e){return t.valueFromWireFormat(e)}))}},{key:"valueToWireFormat",value:function(t){var n=this.nestedAttribute();switch(this.type()){case"List":case"EnumList":return t?Array.isArray(t)?t.filter((function(e){return!d.default.isNil(e)&&""!==e})).map((function(e){return n?n.valueToWireFormat(e):e})).join(e.listDelimiter):t:"";case"Enum":case"Ref":if(n)return n.valueToWireFormat(t)}return e.valueToWireFormat(t,this.type(),this.auxData())}},{key:"valuesToWireFormat",value:function(e){var t=this;return null==e?[]:(e=Array.isArray(e)?e:[e]).map((function(e){return t.valueToWireFormat(e)}))}},{key:"needsAsyncCallback",value:function(){return"LatLong"===this.type()||this.usesOcrAsyncFormula()}},{key:"usesOcrAsyncFormula",value:function(){var e=this.defaultExpressionEvalTree(),t=this.appFormulaEvalTree(),n=function(e){return!!e&&("OCR"===e.FunctionName||"OCRTEXT"===e.FunctionName)};return n(e)||n(t)}},{key:"normalizePercentValueToString",value:function(t){if(""===t)return"";var n=this.auxData(),a=n&&null!=n.DecimalDigits?n.DecimalDigits:0,r=null==n?void 0:n.NumericDigits,i=e.normalizePercentValueToNumber(t);return null===i?"":e.formatLocalizedNumber(i,{precision:a,numericDigits:r})+"%"}},{key:"splitEnumListValue",value:function(t,n){var a=e.listDelimiter;return e.splitEnumListValue(t,a,n)}}],[{key:"parseAuxData",value:function(e,t){if(!e)return{};try{return JSON.parse(e)}catch(n){return m.default.warnToDevConsole("Error parsing aux data",e,t),{}}}},{key:"makeDate",value:function(e){return e?new Date(e):new Date(0)}},{key:"baseTypeFromAuxData",value:function(t,n){var a=t.BaseType||t.ReferencedType||t.ElementType;if(n&&a){var r=e.baseTypeQualifierFromAuxData(t);if(r){var i=e.baseTypeFromAuxData(r,!0);i&&(a=i)}}return a}},{key:"referencedTypeFromAuxData",value:function(t){return"Ref"===t.ReferencedType?e.referencedTypeFromAuxData(e.parseAuxData(t.ReferencedTypeQualifier)):t.ReferencedType}},{key:"baseTypeQualifierFromAuxData",value:function(t){var n=t.BaseTypeQualifier;return n||(n=t.ReferencedTypeQualifier)||(n=t.ElementTypeQualifier),n?e.parseAuxData(n):null}},{key:"fromTypeData",value:function(t,n,a){return new e({Name:t,Type:n,TypeAuxData:a})}},{key:"getColor",value:function(e){return"string"!=typeof e?null:_[e.toLowerCase()]}},{key:"valueExists",value:function(t,n){return"Url"===n?!!e.urlValueFromWireFormat(t).url:null!=t&&""!==t}},{key:"valueFromWireFormat",value:function(t,n,a){var r,i="Date"===n?"MM/DD/YYYY":"MM/DD/YYYY HH:mm:ss";switch(n){case"Yes/No":return e.booleanValueFromWireFormat(t);case"List":return e.listValueFromWireFormat(t,a);case"EnumList":return e.enumlistValueFromWireFormat(t,a);case"Enum":return e.enumValueFromWireFormat(t,a);case"Ref":return e.refValueFromWireFormat(t,a);case"Date":case"DateTime":case"ChangeTimestamp":return r=null,t&&("function"==typeof t.slice&&"00"===t.slice(6,8)?(r=(0,y.default)(t,i,!0).toDate(),isNaN(r.getTime())&&(r=new Date(t))):r=new Date(t)),r;case"Time":return t&&""!==t?g.default.timeToDate(t):null;case"Url":return e.urlValueFromWireFormat(t);case"LatLong":case"ChangeLocation":return e.latLongValueFromWireFormat(t);case"XY":return e.XYValueFromWireFormat(t);case"Number":case"Decimal":case"Percent":case"ChangeCounter":return null!=t&&""!==t?e.getNumberFromString(t):null;case"Price":return e.priceValueFromWireFormat(t,a);case"File":return e.fileValueFromWireFormat(t);default:return null==t?null:t}}},{key:"valueToWireFormat",value:function(t,n,a){var r=null!=t&&"function"==typeof t.getMonth;switch(n){case"Yes/No":return e.booleanValueToWireFormat(t);case"List":return e.listValueToWireFormat(t,a);case"EnumList":return e.enumlistValueToWireFormat(t,a);case"Enum":return e.enumValueToWireFormat(t,a);case"Ref":return e.refValueToWireFormat(t,a);case"Image":case"Thumbnail":case"Drawing":case"Signature":case"File":return t||"";case"Date":if(r)return g.default.MDYformat(t,!0);break;case"Time":if(r)return g.default.dateToTime(t);break;case"DateTime":case"ChangeTimestamp":if(r)return g.default.MDYHMSformat(t,!0);break;case"Url":if(t&&"object"===(0,l.default)(t)){var i=t.url||"",o=t.linkText||"";return JSON.stringify({Url:i,LinkText:o})}if(null===t||""===t)return JSON.stringify({Url:"",LinkText:""})}return null!=t?String(t):""}},{key:"valuesToWireFormat",value:function(t,n,a){return null==t?[]:(t=Array.isArray(t)?t:[t]).map((function(t){return e.valueToWireFormat(t,n,a)}))}},{key:"normalizeBooleanValue",value:function(e){var t=e?String(e).toLowerCase():null;return["y","yes","t","true"].indexOf(t)>=0||!(!1===e||["n","no","f","false"].indexOf(t)>=0)&&null}},{key:"booleanValueFromWireFormat",value:function(t){return e.normalizeBooleanValue(t)}},{key:"booleanValueToWireFormat",value:function(e){return!0===e?"Y":!1===e?"N":""}},{key:"listValueFromWireFormat",value:function(t,n){if(!t)return[];var a=n.ElementType,r=e.parseAuxData(n.ElementTypeQualifier);return"function"==typeof t.split?t.split(e.listDelimiter).filter((function(e){return null!=e&&""!==e})).map((function(t){return e.valueFromWireFormat(t,a,r)})):t}},{key:"enumlistValueFromWireFormat",value:function(t,n){if(!t)return[];var a=n.BaseType,r=e.parseAuxData(n.BaseTypeQualifier);if("function"==typeof t.split){var i=e.fromTypeData("_temp",a,r);return i.splitEnumListValue(t).map((function(e){return i.valueFromWireFormat(e)}))}return t}},{key:"enumValueFromWireFormat",value:function(t,n){var a=n.BaseType,r=e.parseAuxData(n.BaseTypeQualifier);return e.valueFromWireFormat(t,a,r)}},{key:"refValueFromWireFormat",value:function(t,n){var a=n.ReferencedType,r=e.parseAuxData(n.ReferencedTypeQualifier);return e.valueFromWireFormat(t,a,r)}},{key:"listValueToWireFormat",value:function(t,n){var a=this,r=n.ElementType,i=e.parseAuxData(n.ElementTypeQualifier);return t?Array.isArray(t)?t.filter((function(e){return null!=e&&""!==e})).map((function(e){return a.valueToWireFormat(e,r,i)})).join(e.listDelimiter):t:""}},{key:"enumlistValueToWireFormat",value:function(t,n){var a=this,r=n.BaseType,i=e.parseAuxData(n.BaseTypeQualifier);return"string"==typeof t?t:t?t.filter((function(e){return null!=e&&""!==e})).map((function(e){return a.valueToWireFormat(e,r,i)})).join(e.listDelimiter):""}},{key:"enumValueToWireFormat",value:function(t,n){var a=n.BaseType,r=e.parseAuxData(n.BaseTypeQualifier);return e.valueToWireFormat(t,a,r)}},{key:"refValueToWireFormat",value:function(t,n){var a=n.ReferencedType,r=e.parseAuxData(n.ReferencedTypeQualifier);return e.valueToWireFormat(t,a,r)}},{key:"priceValueFromWireFormat",value:function(e,t){var n="$";return(null==t?void 0:t.CurrencySymbol)&&(n=t.CurrencySymbol),"string"==typeof e&&null!=e&&0===e.indexOf(n)&&(e=e.substr(1)),null!=e&&""!==e?this.getNumberFromString(e):null}},{key:"fileValueFromWireFormat",value:function(e){return null==e?null:e}},{key:"urlValueFromWireFormat",value:function(e){if(!e||"{"!==e[0])return new b.default(e,e);try{var t=JSON.parse(e),n=t.Url,a=t.LinkText;return new b.default(n,a)}catch(e){return m.default.ReportErrorOnce({errorMessage:"Error parsing json Url type"}),new b.default("",null)}}},{key:"normalizeUrlValue",value:function(e){return e&&!e.match(/\w+\:/)?"http://"+e:e}},{key:"toHttpsUrl",value:function(e){if(e){if(!e.match(/^\w+:\/\//))return"https://"+e;if(e.match("^http://"))return e.replace("http://","https://")}return e}},{key:"latLongValueFromWireFormat",value:function(e){if(e){var t=String(e).trim().split(/\s*,\s*/g);return 2===t.length?new T.default(t[0],t[1]):null}return null}},{key:"XYValueFromWireFormat",value:function(e){if(e){var t=String(e).trim().split(/\s*,\s*/g);if(2===t.length)return new S.default(t[0],t[1])}return e}},{key:"normalizePercentValueToNumber",value:function(e){var t=e;if(null==t||"number"==typeof t&&isNaN(t))return null;if("string"==typeof e&&e.indexOf("%")===e.length-1){t=e.substr(0,e.length-1);var n=parseFloat(t);return isNaN(n)?null:n}var a=Math.round(1e8*t)/1e6;return isNaN(a)?null:a}},{key:"getNumberFromString",value:function(e){if(null===e||""===e)return null;var t=Number(e);return isNaN(t)&&"string"==typeof e&&(t=Number(e.replace(/,/g,""))),t}},{key:"formatLocalizedNumber",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.precision,r=n.numericDigits,i=n.useGrouping,o=n.currencySymbol,l=void 0===o?"":o;if(!t&&0!==t)return"";var u="string"==typeof t?e.getNumberFromString(t):Number(t);if(isNaN(u))return m.default.warnToDevConsole("formatLocalizedNumber errored parsing number:",t),t;if(void 0!==a){var s=Math.pow(10,a);u=Math.round(u*s)/s}var c=h.default.decimal().toLocaleString(u,{useGrouping:null==i||i,minimumIntegerDigits:r});if(a){var d=u.toString().split(".")[1];if(d){var f=a-d.length;f>0&&(c+=new Array(f+1).join("0"))}else{var p=h.default.decimal().decimalSeparator||".";c+=p+new Array(a+1).join("0")}}return l+c}},{key:"validateNumeric",value:function(e){return!Array.isArray(e)&&e-parseFloat(e)+1>=0}},{key:"inferEnumListDelimiter",value:function(t,n){var a=e.enumListDelimiter;return("function"==typeof t.indexOf&&t.indexOf(e.listDelimiter)>=0||n&&d.default.includes(n,t))&&(a=e.listDelimiter),a}},{key:"splitEnumListValue",value:function(t,n,a){return t=t||"",n=n||e.inferEnumListDelimiter(t,a),"function"==typeof t.split?t.split(n).filter((function(e){return null!=e&&""!==e})):[t]}}]),e}();t.Attribute=j,j.validators={Color:function(){return!0},Enum:function(){return!0},EnumList:function(){return!0},"Yes/No":function(){return!0},Email:function(e){return null==e||""===e||!!e.match(/^[^@]+@[^@]+$/)},Text:function(e,t){return null==e||""===e||!((null==t?void 0:t.MinLength)&&e.length<t.MinLength)&&!((null==t?void 0:t.MaxLength)&&e.length>t.MaxLength)},LongText:function(e,t){return j.validators.Text(e,t)},LatLong:function(e){if(null==e||""===e)return!0;var t=e.match(/^(-?\d+(?:\.\d+)?),\s?(-?\d+(?:\.\d+)?)$/);return!!t&&v.default.isValidLatLng(t[1],t[2])},XY:function(e){if(null==e||""===e)return!0;var t=e.match(/^(-?\d+(?:\.\d+)?),\s?(-?\d+(?:\.\d+)?)$/);return!!t&&(S.default.isValidXOrY(t[1])&&S.default.isValidXOrY(t[2]))},Number:function(e,t){return j.validators.Decimal(e,d.default.extend({},t,{DecimalDigits:0}))},Decimal:function(e,t){if(t||(t={}),null==e||""===e)return!0;var n,a=(0,g.fastTrim)(e);try{n=new f.default(a)}catch(e){return!1}var r,i=t.MinValue||0;if(t.StepValue&&null!=t.MaxValue){r=new f.default(t.MaxValue).minus(i).div(t.StepValue).round(void 0,0).times(t.StepValue).plus(i).toString()}else r=t.MaxValue;if(null!=t.MaxValue&&n.gt(r))return!1;if(null!=t.MinValue&&n.lt(t.MinValue))return!1;var o,l=null==t.DecimalDigits?2:t.DecimalDigits;return o=0===l?"^-?\\d*?$":"^-?\\d*(?:\\.\\d{1,"+l+"})?$",new RegExp(o).test(a)},Percent:function(e,t){return t||(t={}),d.default.endsWith(e,"%")&&(e=e.substr(0,e.length-1)),j.validators.Decimal(e,d.default.extend({},t,{DecimalDigits:null==t.DecimalDigits?t.DecimalDigits:t.DecimalDigits+2,MinValue:null==t.MinValue||0===t.MinValue?t.MinValue:t.MinValue/100,MaxValue:null==t.MaxValue||0===t.MaxValue?t.MaxValue:t.MaxValue/100,StepValue:null==t.StepValue||0===t.StepValue?t.StepValue:t.StepValue/100}))},Price:function(e,t){return j.validators.Decimal(e,t)},ChangeCounter:function(){return!0},ChangeTimestamp:function(){return!0},DateTime:function(e,t){var n;if(null==e||""===e)return!0;var a=new Date(e);if(isNaN(a.getSeconds()))return!1;if((null===(n=E.AppGlobals.AppModel)||void 0===n?void 0:n.inRollout("DateTimeRespectsMinMax"))&&t){var r=t.MinValue,i=t.MaxValue;if(null!=i&&a>new Date(i))return!1;if(null!=r&&a<new Date(r))return!1}return!0},Date:function(e){if(null==e||""===e)return!0;var t=h.default.date().momentFromWireFormat(e).toDate();return!isNaN(t.getSeconds())},Time:function(e){if(null==e||""===e)return!0;if(!e.match(/^\d{2}:\d{2}(:\d{2})?/))return!1;var t=new Date("12/30/1970 "+e);return!isNaN(t.getSeconds())},Duration:function(e){return null==e||""===e||null!=e.match(/^-?(\d+):([0-5][0-9]):([0-5][0-9])$/)},Drawing:function(){return!0},Signature:function(){return!0}},j.enumListDelimiter=", ",j.listDelimiter=" , ",j.SHEET_FORMULA_NEEDS_RECOMPUTE="[sync to compute]";var Y=j;t.default=Y},107465:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(689728)),i=a(n(856690)),o=(0,r.default)((function e(t,n){(0,i.default)(this,e),this.singleDataContext=t,this.rows=n}));t.default=o},385857:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(627424)),o=a(n(600861)),l=a(n(856690)),u=a(n(689728)),s=a(n(496486)),c=w(n(150198)),d=a(n(192137)),f=a(n(962553)),p=w(n(302443)),h=a(n(190644)),v=a(n(498967)),m=a(n(365914)),g=w(n(888861)),y=n(959191),b=n(166089),T=n(714067),S=a(n(819433)),A=n(95483);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}function w(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var _=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},k=new WeakMap;function R(e,t,n,a,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.rowData;if(i[e.tempId])return o;i[e.tempId]=!0,s.default.keys(e.pendingRefStates).forEach((function(o){R(e.pendingRefStates[o],t,n,a,r+1,i)})),s.default.keys(e.pendingReverseRefStates).forEach((function(o){R(e.pendingReverseRefStates[o],t,n,a,r-1,i)}));var l=t[e.tableName]||{},u=n[r]||{};return l[e.tempId]=e,u[e.tempId]=e,t[e.tableName]=l,t[e.rootTableName]=l,n[r]=u,a[e.tempId]=e,o}var I=function(){function e(t,n,a,r,i,o,u,s){(0,l.default)(this,e),this.appModel=t,this.formState=r,this._parentContext=i,this.inputParameterValues=o,this.uiContext=u,this._transaction=s,this.isFakeContext=!1,this.rowData=a||{},!n||n instanceof d.default||(n=new d.default(n)),this.tableSchema=n}return(0,u.default)(e,[{key:"pendingTransaction",get:function(){var e,t,n,a;if(!f.default.usePendingChangesStore)return this.appModel.dataManager.currentTransaction;if(this._transaction&&!this._transaction.closed)return this._transaction;var r=null===(e=this.uiContext)||void 0===e?void 0:e.viewStateKey;if(r){var i=(0,S.default)().getState(),o=null===(n=null===(t=(0,A.getViewStack)(i).find((function(e){return e.viewStateKey===r})))||void 0===t?void 0:t.mutableState)||void 0===n?void 0:n.transactionId;return null===(a=b.AppGlobals.AppModel)||void 0===a?void 0:a.dataManager.getTransaction(o)}}},{key:"schemaName",value:function(){return this.tableSchema&&this.tableSchema.name()}},{key:"isSettingsSchema",value:function(){return this.schemaName()===T.USER_SETTINGS_SCHEMA_NAME}},{key:"setParentContext",value:function(e){this._parentContext=e}},{key:"getParentContext",value:function(){return this._parentContext?this._parentContext:this.isSettingsSchema()||this.appModel.IsTestModel?null:this.appModel.userSettingsDataContext()}},{key:"getRootContext",value:function(){return this._parentContext?this._parentContext.getRootContext():this}},{key:"getInputParameterValue",value:function(e){if(this.inputParameterValues&&e){var t=this.inputParameterValues[e.toLowerCase()];if(void 0!==t)return t;if(this._parentContext)return this._parentContext.getInputParameterValue(e)}return null}},{key:"isEmpty",value:function(){return 0===s.default.keys(this.rowData).length}},{key:"copy",value:function(){var t=new e(this.appModel,this.tableSchema,this.rowData,s.default.clone(this.formState),this._parentContext,void 0,this.uiContext,this._transaction);return t}},{key:"replaceRowData",value:function(e){this.rowData=e||{},this.formState&&(this.formState.rowData=e)}},{key:"augmentWithRowData",value:function(t){var n={};s.default.forEach(t,(function(e,t){n[t]={value:e,enumerable:!0,configurable:!0,writable:!0}}));var a=Object.create(this.rowData,n);return new e(this.appModel,this.tableSchema,a,void 0,void 0,void 0,this.uiContext)}},{key:"augmentWithViewContext",value:function(e,t){var n;if(!e||(null===(n=this.uiContext)||void 0===n?void 0:n.viewStateKey)===e)return this;var a=t?this:this.copy();return a.uiContext={viewStateKey:e},a}},{key:"augmentWithTransaction",value:function(e,t){var n,a=this;if(f.default.usePendingChangesStore&&e!==this._transaction&&((a=t?this:this.copy())._transaction=e),null==this.uiContext&&e){var r=null===(n=e.owningViewState)||void 0===n?void 0:n.viewStateKey;if(r)return a.augmentWithViewContext(r,t||a!==this)}return a}},{key:"augmentWith",value:function(e,t,n){var a=n?this.augmentWithRowData(n):this;return a=(a=a.augmentWithViewContext(e,a!==this)).augmentWithTransaction(t,a!==this)}},{key:"getValue",value:function(e){return"string"!=typeof e&&(e=e.name()),this.rowData[e]}},{key:"setValue",value:function(e,t){var n=this.rowData[e]!==t;return this.rowData[e]=t,this.formState&&(this.formState.rowData[e]=t),n}},{key:"extendDefaultRecomputeParams",value:function(e){var t=e.theseAttributesAndInfluenced,n=_(e,["theseAttributesAndInfluenced"]);return t=s.default.clone(t),Object.assign({considered:{},computed:{},computeDefaults:!1,skipChangeTriggers:!1,skipLeafAttrs:!1,initialData:s.default.clone(this.rowData),nowDate:new Date,theseAttributesAndInfluenced:t},n)}},{key:"recomputeDynamicValues",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=this.extendDefaultRecomputeParams(n),r=null!==(e=a.theseAttributesAndInfluenced)&&void 0!==e?e:this.tableSchema.dynamicAttributes(),i=C(r);try{for(i.s();!(t=i.n()).done;){var o=t.value;this.recomputeAttribute(o,a)}}catch(e){i.e(e)}finally{i.f()}}},{key:"recomputeAppFormulas",value:function(e){var t,n=this.extendDefaultRecomputeParams(e),a=C(this.tableSchema.dynamicAttributes());try{for(a.s();!(t=a.n()).done;){var r=t.value;(r.hasAppFormula()||r.isChangeTriggered()||r.resetsEachUpdate()||r.hasResetExpression())&&this.recomputeAttribute(r,n)}}catch(e){a.e(e)}finally{a.f()}}},{key:"recomputeVirtualColumns",value:function(e){this.recomputeAppFormulas({computeDefaults:!1,skipLeafAttrs:!1,virtualOnly:!0,recomputeKey:!!(null==e?void 0:e.recomputeKey)})}},{key:"recomputeInfluencedAttributes",value:function(e,t){var n=this;t=t||{},this.tableSchema.influencedDynamicAttributes(e).forEach((function(e){n.recomputeAttribute(e,t)}))}},{key:"recomputeAttribute",value:function(e,t){var n,a,r,i,l=this,u=(t=t||{}).considered=t.considered||{},c=t.computed=t.computed||{},d=t.skipTheseDefaults||{},f=t.initialData=t.initialData||s.default.clone(this.rowData),p=t.wasReset||{},v=t.theseAttributesAndInfluenced,g=this,y=e.name(),b=!1;if(!u[y]&&(u[y]=!0,e.isDynamic()&&(!t.virtualOnly||e.isVirtual()))){var T=y in d,S=this.tableSchema.dynamicDependencies(e);if((S.length||!t.skipLeafAttrs)&&(S.forEach((function(e){var n=e.name();u[n]||n===y||l.recomputeAttribute(e,t)})),!v||v.includes(e))){g._tempInitialData=f;var A=function(n){if(null!=n){var a;t.noAsync||"function"!=typeof t.getAsyncCallback||(a=t.getAsyncCallback(e));var r=n.run(g,{asyncCallback:a,attrName:y});r=e.coerceValue(r),r=e.valueToWireFormat(r),b=g.setValue(y,r),c[y]=!0}},E=e.resetsEachUpdate(),w=e.resetIfEvalTree();if(w&&(E=w.run(g)),T||(e.hasDefaultExpression()&&(t.computeDefaults||E)?A(e.defaultExpressionEvalTree()):E&&(b=g.setValue(y,""),c[y]=!0,p[y]=!0)),!t.skipChangeTriggers&&e.isChangeTriggered()){var C,O=0,_=g.getValue(y);E&&(f[y]=_);for(var k=E?_:f[y],R=0;R<S.length;R++){var I=S[R],N=I.name(),M=null!==(n=g.getValue(N))&&void 0!==n?n:"";if((null!==(a=f[N])&&void 0!==a?a:"")!==M&&(t.noAsync||"function"!=typeof t.getAsyncCallback||(C=t.getAsyncCallback(e)),e.checkChangeTriggered(k,_,I,M)&&(O++,!E)))break}if(O>0){var D;switch(e.type().toLowerCase()){case"changecounter":var L=1,P=Number(k);E&&(L=O),D=isNaN(P)?L:P+L;break;case"changetimestamp":D=_===k?m.default.MDYHMSformat(null!==(r=t.nowDate)&&void 0!==r?r:new Date,!0):_;break;case"changelocation":if(h.default.fetchLatLong((function(e,t){return C?C(h.default.stringifyLatLng(e,t)):null})),D="",h.default.lastPosition){var G=h.default.lastPosition.coords,x=G.latitude,F=G.longitude;D=h.default.stringifyLatLng(x,F)}}b=g.setValue(y,e.valueToWireFormat(D)),c[y]=!0}else b=g.setValue(y,f[y]),c[y]=!0}else if(e.hasAppFormula()){var V=this.tableSchema.isKeyComponent(e);(t.computeDefaults||!V||V&&t.recomputeKey)&&A(e.appFormulaEvalTree())}e.isKey()&&this.resolveParentRefs(),delete g._tempInitialData,b&&(null===(i=t.onDynamicValueChanged)||void 0===i||i.call(t,e,this.getValue(y)),v&&v.push.apply(v,(0,o.default)(this.tableSchema.influencedDynamicAttributes(e))))}}}},{key:"tableRow",get:function(){var e,t,n=this,a=this.pendingTransaction,r=null===(e=this.tableSchema)||void 0===e?void 0:e.sourceTableName(),i=null===(t=this.tableSchema)||void 0===t?void 0:t.keyAttribute().name(),o=this.appModel.findTableCollection(r).rootTable;return null==o?void 0:o.lookupTableRows(i,this.keyValue,a).filter((function(e){return e.values===n.rowData}))[0]}},{key:"stableId",get:function(){var e,t;return null!==(t=null===(e=this.tableRow)||void 0===e?void 0:e.stableId)&&void 0!==t?t:this.keyValue}},{key:"getColumnValue",value:function(e,t,n){var a,r;if(n||(n=0),-2===n){var i,o=this.pendingTransaction;if(this.formState&&this.formState.initialData)i=this.formState.initialData;else if(this._tempInitialData)i=this._tempInitialData;else if(o&&this.rowData){var l=this.tableSchema.sourceTableName();i=o.getInitialRowValues(l,this.stableId)}if(i)return i[e]}return n<1?(null===t||e&&"_this"!==e.toLowerCase()?"_thisrow"===e.toLowerCase()?e=null==(r=this.tableSchema.keyAttribute())?void 0:r.name():null!=t&&this.rowData&&!this.rowData.hasOwnProperty(e)&&(e=(null==(r=null===(a=this.tableSchema)||void 0===a?void 0:a.model.Attributes[t])?void 0:r.Name.toLowerCase())===e.toLowerCase()?null==r?void 0:r.Name:e):e=null==(r=this.tableSchema.model.Attributes[t])?void 0:r.Name,null!=e&&null!=this.rowData?this.rowData[e]:null):this.getParentContext()?this.getParentContext().getColumnValue(e,t,n-1):null}},{key:"getTableColumnValue",value:function(e,t,n,a){var r=f.default.findByName(e,this.appModel),i=r.table,o=r.tableSchema;if(null!=i&&null!=o){var l=o.keyAttribute().name(),u=i.table,s=this.appModel.FindTableDefinition(e);if(null!=u&&null!=s&&null!=s.SchemaName){var c=this.getTableRow(u,t,{keyAttrName:l});if(null!=c){if(null==n){var d=this.appModel.FindSchema(s.SchemaName);null!=d&&(n=d.Attributes[a].Name)}if(null!=n)return c[n]}}}return null}},{key:"makeColumnSetKey",value:function(e){var t=e.tableName,n=e.rowListAttrName,a=e.columnIndex,r=e.makeDistinct,i=e.maxEntries,o=e.elementAttribute;return[t,n,a,r,i,o.type(),o.auxDataString()].join("|")}},{key:"sortData",value:function(e,t,n,a){var r=this,i=f.default.findByName(t,this.appModel),o=i.table,l=i.tableSchema;if(!o||!l)return e.slice(0,a);var u=l.keyAttribute(),s=this.makeNestedContext(l),d=e.map((function(e){var t,a=u.valueToWireFormat(e);return s.replaceRowData(null===(t=o.lookupTableRow(a,r.pendingTransaction))||void 0===t?void 0:t.values),{refVal:e,sortExpr:n.map((function(e){return e.sortExpression.run(s)}))}})),p=n.map((function(e){return new c.default({Type:e.sortExpression.resultType(),TypeAuxData:JSON.stringify(e.sortExpression.resultTypeQualifier())})}));return v.default.sort(d,(function(e,t){for(var a=0;a<n.length;a++){var r=p[a].valueComparer(c.ValueFormat.Native)(e.sortExpr[a],t.sortExpr[a]);if(0!==r)return n[a].descending?-1*r:r}return 0})),a&&(d=d.slice(0,a)),d.map((function(e){return e.refVal}))}},{key:"makeNestedContext",value:function(t){var n=new e(this.appModel,t,void 0,void 0,this,void 0,this.uiContext);return this.isFakeContext&&(n.isFakeContext=!0),n}},{key:"getTableColumnSet",value:function(e,t,n,a,r,o,l){var u,d,f=this,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=this.appModel.findTableCollection(e),v=h.table,m=h.tableSchema,T=h.rootTableSchema,S=T&&T.allAttributes()[t];if(null!=v&&null!=m&&null!=S){var A=v.table,E=null,w=null,C=null,O=null,_=!1;if(null!=n&&(O=this.makeNestedContext(m),C=n.curry(O)),null!=o){var k=this.getColumnValue(l,o,p),R=null===(u=b.AppGlobals.AppState)||void 0===u?void 0:u.pendingFormState;if(null==R)w=(null==k?void 0:k.split(c.default.listDelimiter).filter((function(e){return null!=e&&""!==e})))||[],E=s.default.compact(w.map((function(e){var t;return null===(t=v.lookupTableRow(e,f.pendingTransaction))||void 0===t?void 0:t.values})));else{var I="List",N={ElementType:"Ref",ElementTypeQualifier:null};w=c.default.valueFromWireFormat(k,I,N);var M=A.keyAttrName;E=[];for(var D=0;D<w.length;D++){var L=w[D],P={};P[M]=L,E=E.concat(this.getTableRows(A,P))}}}else if(null!=C)if("CONSTANT"===C.evalType()&&"Yes/No"===C.resultType()&&"N"===C.constantValue())E=null;else{var G=null;if(null===(d=this.appModel)||void 0===d?void 0:d.inRollout("curryNativeValue")){var x,F=(0,g.getFilterDefaultsAndFullyMapped)(C),V=(0,i.default)(F,2);x=V[0],_=V[1],G=(0,y.filterDefaultsToLookupValues)(x)}else"BOOLEAN"===C.evalType()&&(G=C.getLookupValues());E=this.getTableRows(A,G)}else E=this.getTableRows(A);if(null!=E){if(null!=C&&!_){var U=0,B={noCache:!0};E=E.filter((function(e){if(O.replaceRowData(e),r&&U>=r)return!1;var t=C.run(O,B);return t&&U++,t}))}var H=E.map((function(e){return e[S.name()]}));return a&&(H=s.default.uniq(H)),H}}return[]}},{key:"keyValue",get:function(){var e,t;return null===(e=this.rowData)||void 0===e?void 0:e[null===(t=this.tableSchema)||void 0===t?void 0:t.keyAttribute().name()]}},{key:"getTableRows",value:function(e,t){var n,a=(null===(n=b.AppGlobals.AppState)||void 0===n?void 0:n.pendingFormState)||this.formState,r=this.appModel.findTableCollection(e.Name).table;if(null==r)return[];var i=this.pendingTransaction;if(a&&!f.default.usePendingChangesStore){var o=(0,y.lookupValuesToFilterDefaults)(t);return r.filteredRowValues({filterDefaults:o,transaction:i},this.appModel,this)}var l=t&&r.lookupTableRowsByLookupValues(t,i,this);return(null!=l?l:r.rows({transaction:i,dataContext:this})).map((function(e){return e.values}))}},{key:"getTableRow",value:function(e,t){var n,a,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.keyAttrName;if(e instanceof f.default?e=(r=e).table:r=f.default.findByName(e.Name,this.appModel).table,o){var l=(null===(n=b.AppGlobals.AppState)||void 0===n?void 0:n.pendingFormState)||this.formState,u=this.pendingRowsForTable(e.Name).filter((function(e){return e.tempId!==l.tempId&&e.rowData[o]===t}));if(u.length)return u[0].rowData}return r?null===(a=r.lookupTableRow(t,this.pendingTransaction))||void 0===a?void 0:a.values:null}},{key:"getFilteredTableRows",value:function(e,t){var n,a=(null===(n=b.AppGlobals.AppState)||void 0===n?void 0:n.pendingFormState)||this.formState,r=this.appModel.findTableCollection(e.Name).table;if(null==r)return[];if(a&&!f.default.usePendingChangesStore)return r.filteredRowValues({filterExpr:t});var i=this.pendingTransaction;return r.queryRowValues({filterExpr:t,transaction:i},this.appModel,this)}},{key:"findTableKeyValues",value:function(e){var t=f.default.findByName(e,this.appModel).tableSchema;if(null==t)return{data:[],key:null};var n=t.findAttributeIndex(t.keyAttribute().name());return{data:this.getTableColumnSet(e,n),key:t.keyAttribute()}}},{key:"getFilterDefaultValues",value:function(e){var t=null,n=e.refListFilter(this);if(n){var a=g.default.getFilterDefaults(n);if(a){t={};for(var r=0;r<a.length;r++)t[a[r].ColumnName]=a[r].ColumnValue}}return t}},{key:"resolveParentRefs",value:function(){for(var e,t=(null===(e=b.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)||this.formState,n={};t;){var a=t,r=a.tempId,i=a.parentState,o=a.rowData,l=a.keyAttrName,u=a.launchedBy;if(n[r])break;if(n[r]=!0,i&&r in i.pendingRefStates){var c=o[l],d=i.rowData[u];if(d!==c){var f=this.appModel.findTableCollection(i.tableName).tableSchema,p=f&&f.findAttributeByName(u),h=null!=c?c:"";if(p&&"EnumList"===p.type()){d=p.valueFromWireFormat(d)||[];var v=k.get(t),m=null!=v?d.indexOf(v):-1;m>=0?d[m]=h:s.default.includes(d,h)||d.unshift(h),k.set(t,h),h=p.valueToWireFormat(d)}i.rowData[u]=h}}t=t.parentState}}},{key:"pendingSaves",value:function(){var e,t={},n={},a={},r=(null===(e=b.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)||this.formState;return r&&R(r,t,n,a,0),{byTable:t,byDepth:n,byId:a}}},{key:"pendingRowsForTable",value:function(e){return s.default.values(this.pendingSaves().byTable[e]||{})}},{key:"pendingKeysForTable",value:function(e){return this.pendingRowsForTable(e).map((function(e){return e.rowData[e.keyAttrName]}))}},{key:"getLatLong",value:function(e){if(null==e?void 0:e.supportsAsync)return new Promise((function(t){h.default.fetchLatLong((function(e,n){return t(new p.default(e,n))}),(function(){return t(p.defaultLatLong)}),e)}));if(h.default.lastPositionAge()>1e4){var t=null==e?void 0:e.asyncCallback;h.default.fetchLatLong((function(e,n){return t?t(h.default.stringifyLatLng(e,n)):null}))}if(h.default.lastPosition){var n=h.default.lastPosition.coords,a=n.latitude,r=n.longitude;return new p.default(a,r)}return p.defaultLatLong}}],[{key:"getDefaultValues",value:function(e,t){var n;if(!t||e&&e.length||(e=g.default.getFilterDefaults(t)),e){if(!(e.length&&e[0].hasOwnProperty("ColumnName")&&e[0].hasOwnProperty("ColumnValue")))return e;n={};for(var a=0;a<e.length;a++){var r=e[a],i=r.ColumnName,o=r.ColumnValue;n[i]=o}}return n}}]),e}();t.default=I},743537:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=n(166089),l=function(){function e(t,n){(0,r.default)(this,e),this.model=t,this.view=n}return(0,i.default)(e,[{key:"type",value:function(){return this.model.EventType}},{key:"actionName",value:function(){return"**auto**"!==this.model.EventAction?this.model.EventAction:null}},{key:"action",value:function(e,t){e=e||o.AppGlobals.AppModel;var n=null;if(null!==this.actionName()&&e&&this.view){var a=e.appTemplate.actions();if(!t){var r=this.view.table(),i=r&&e.findTableCollection(r).rootTable;t=i&&i.name()}var l=this.actionName();l&&(n=a.findByName(t,l))}return n}}]),e}();t.default=l},513979:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(888861)),u=a(n(266522)),s=a(n(593186)),c=n(166089),d=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},f=function(e){var t;return e&&u.default.isDynamicFormattingColor(e)?u.default.getFormattingColorForTheme(null===(t=c.AppGlobals.AppModel)||void 0===t?void 0:t.AppTemplate.Presentation.DisplayTheme,e):e},p=function(){function e(t){(0,r.default)(this,e),this.data=t}return(0,i.default)(e,[{key:"settings",get:function(){if(!this._settings){var e={};try{var t=JSON.parse(this.data.Settings),n=t.icon,a=t.textSize,r=t.highlightColor,i=t.textColor,l=d(t,["icon","textSize","highlightColor","textColor"]),u=void 0,c=Number(a);c?u=Math.max(.2,Math.min(3,c)):0!==a&&"0"!==a||(u=0),e=o.default.omitBy(Object.assign(Object.assign({},l),{icon:"_blank_"===n?null:n,textColor:f(i),highlightColor:f(r),textSize:u}),o.default.isNil)}catch(e){s.default.warnToDevConsole("Formatting Rule Settings was not valid json",this.data)}this._settings=e}return this._settings}},{key:"tableOrSlice",value:function(){return this.data.TableOrSlice}},{key:"columns",value:function(){return this.data.ColumnsToFormat}},{key:"condition",value:function(){return!this._conditionEvalTree&&this.data.IsValid&&null!=this.data.Condition&&null!=this.data.ConditionEvaluatable&&(this._conditionEvalTree=l.default.create(this.data.ConditionEvaluatable)),this._conditionEvalTree||null}},{key:"equivalentKeyRollout",value:function(){var e=this.condition();if(null!=e&&"Equals"===e.operatorName()){var t=e.children.find((function(e){return"COLUMN"===e.evalType()})),n=e.children.find((function(e){return"CONSTANT"===e.evalType()}));if(null!=t&&null!=(null==n?void 0:n.constantValue()))return"SourceColumn:".concat(t.ColumnName," - RuleTable:").concat(this.tableOrSlice())}return null}},{key:"equivalentKey",value:function(){var e;if(null===(e=c.AppGlobals.AppModel)||void 0===e?void 0:e.inRollout("curryNativeValue"))return this.equivalentKeyRollout();var t=this.condition();if(t){var n=t.model;if(n&&"Equals"===n.OperatorName){var a=n.Children.find((function(e){return"COLUMN"===e.EvalType})),r=n.Children.find((function(e){return"CONSTANT"===e.EvalType}));if(!a||!r)return null;if(null!=r.ConstantValue)return"SourceColumn:"+a.ColName+" - RuleTable:"+this.tableOrSlice()}}return null}}]),e}();t.default=p},173861:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(513979)),u=a(n(962553)),s=a(n(385857)),c=a(n(365914)),d=n(166089),f={icon:[],icons:[]},p=function(){function e(t,n){(0,r.default)(this,e);var a=t.filter((function(e){return!0===e.IsValid&&!e.Disabled}));this.rules=o.default.map(a,(function(e){return new l.default(e)})),this.appModel=n||d.AppGlobals.AppModel,this._cacheStore={timestamp:this.appModel.DataStamp,rulesForColumnOrAction:{},rulesForTable:{},formattingById:{}}}return(0,i.default)(e,[{key:"_makeCacheKey",value:function(e,t,n,a,r){return c.default.hashCode([e,t,n,a,r].join("|"))}},{key:"_validateCache",value:function(){this._cacheStore.timestamp!==this.appModel.DataStamp&&(this._cacheStore.timestamp=this.appModel.DataStamp,this._cacheStore.formattingById={})}},{key:"getFormatting",value:function(t){var n=t.tableOrSlice,a=t.rootTable,r=t.column,i=t.actionName,l=t.rowKey,c=t.dataContext,p=this.appModel||d.AppGlobals.AppModel;if(!a&&n){var h=u.default.findByName(n,p).table;h&&(a=h.rootTable())}if(a&&!c){var v={};l&&(v=a.findRow(l)||{}),c=new s.default(p,a.tableSchema,v)}this._validateCache();var m=a?a.name():"",g=this._makeCacheKey(m,r,i,l,c?JSON.stringify(c.rowData):null),y=this._cacheStore.formattingById[g];if(!y){var b=this.activeRules({rootTableName:m,column:r,actionName:i,dataContext:c}),T=b.activeRules,S=b.isPure;y=o.default.omitBy(e.mergeRulesByImportance(T),o.default.isNil),S&&(o.default.isEqual(y,f)&&(y=f),this._cacheStore.formattingById[g]=y)}return y}},{key:"rulesForTable",value:function(e){var t=this._cacheStore.rulesForTable[e];return t||(t=o.default.filter(this.rules,(function(t){return!(!e||t.data.TableOrSlice!==e)})),this._cacheStore.rulesForTable[e]=t),t}},{key:"rulesForColumnOrAction",value:function(e,t,n){var a=this._makeCacheKey(e,t,n),r=this._cacheStore.rulesForColumnOrAction[a];return r||(r=o.default.filter(this.rulesForTable(e),(function(e){return t?o.default.includes(e.data.ColumnsToFormat,t):n?o.default.includes(e.data.ColumnsToFormat,"__action__"+n):null==e.data.ColumnsToFormat||0===e.data.ColumnsToFormat.length})),this._cacheStore.rulesForColumnOrAction[a]=r),r}},{key:"activeRules",value:function(e){var t=e.rootTableName,n=e.column,a=e.actionName,r=e.dataContext,i=this.rulesForColumnOrAction(t,n,a),l=o.default.every(i,(function(e){return o.default.isNil(e.condition())||e.condition().isPure()})),u=o.default.filter(i,(function(e){return!!o.default.isNil(e.condition())||!!r&&!!e.condition().run(r)}));return{activeRules:u,isPure:l}}},{key:"computeWorstCaseFormatting",value:function(t,n){var a=n.tableOrSlice,r=n.column;return e.combineRulesToWorst(t,this.worstCaseRules({tableOrSlice:a,column:r}))}},{key:"worstCaseRules",value:function(e){var t=e.tableOrSlice,n=e.column,a=o.default.find(this.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.Name===t})),r=a?a.SourceTable:t,i=o.default.filter(this.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.SourceTable===r})),l=o.default.map(i,(function(e){return e.Name})),u=o.default.filter(this.rules,(function(e){return e.data.TableOrSlice===r||o.default.includes(l,e.data.TableOrSlice)}));return o.default.filter(u,(function(e){return n?o.default.includes(e.data.ColumnsToFormat,n):null==e.data.ColumnsToFormat||0===e.data.ColumnsToFormat.length}))}}],[{key:"mergeRulesByImportance",value:function(e){return o.default.reduce(e,(function(e,t){return o.default.extendWith(e,t.settings,(function(n,a,r){var i;return"textSize"===r&&1===a?n:"icon"===r?(a&&(n.unshift(a),e.icons.unshift({name:a,color:null===(i=t.settings)||void 0===i?void 0:i.highlightColor})),n):a||n}))}),o.default.cloneDeep(f))}},{key:"combineRulesToWorst",value:function(e,t){var n={};return o.default.reduce(t,(function(e,t){var a=!1,r=t.equivalentKey();return r&&(n[r]&&(a=!0),n[r]=t),o.default.extendWith(e,t.settings,(function(n,r,i){var o;return"icon"===i?(a||r&&(n.unshift(r),e.icons.unshift({name:r,color:null===(o=t.settings)||void 0===o?void 0:o.highlightColor})),n):"textSize"===i&&null!=n?Math.max(parseFloat(n),parseFloat(r)):r||n}))}),o.default.cloneDeep(f))}},{key:"cssStylesForText",value:function(e){var t={};return e.textColor&&(t.color=e.textColor),e.textSize&&(t.fontSize=e.textSize+"em"),t}},{key:"styleClassesForText",value:function(e){var t=[];return e.bold&&t.push("FormatRule--bold"),e.italic&&t.push("FormatRule--italic"),e.underline&&t.push("FormatRule--underline"),e.strikethrough&&t.push("FormatRule--strikethrough"),e.uppercase&&t.push("FormatRule--uppercase"),t.join(" ")}}]),e}();t.default=p},895466:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MISSING_AUTH_TOKEN=t.ImageHandle=void 0,t.isImageHandle=function(e){return null!=e&&"object"===(0,o.default)(e)&&null!=e.type&&null!=e.value};var r=a(n(856690)),i=a(n(689728)),o=a(n(918698)),l=a(n(496486)),u=a(n(365914)),s=a(n(571524)),c=a(n(593186)),d=a(n(112368)),f=n(263198),p=a(n(440587)),h=n(629503),v=n(646317),m=n(635672),g=n(166089),y=n(557310),b="missing_auth_token";t.MISSING_AUTH_TOKEN=b;var T=function(e,t){return"".concat(e,"|").concat(t)};var S={},A=function(){function e(t,n){if((0,r.default)(this,e),this._flattenCallbacks=new Map,this._flattened={},this._processCallbacks=[],this._processed=null,this._processPending=!1,"string"==typeof t&&0===t.indexOf("{")){var a=t;try{t=JSON.parse(a),t=p.default.from(t).url||t}catch(e){c.default.ReportError({errorMessage:"Tried to create ImageHandle from non-url string",serializedString:a})}}t&&"object"===(0,o.default)(t)?y.ReactRootUIConfig.isReactRoot()?this.model=Object.assign({},t):this.model=t.model||t:"string"==typeof t?(this.model={value:t},t&&0!==t.indexOf("data:")?this.model.type="Url":this.model.type="Data"):this.model={},n&&(this.model.tableName=n);var i=this.id()||(0,v.makeGuid)();this.model.id=i;var l=this.timestamp()||(new Date).toISOString();this.model.timestamp=l,S[i]=this,this.model.cachedById&&(this.model.value=g.AppGlobals.AppModel.GetFromImageCache(this.model.id)||"",delete this.model.cachedById)}return(0,i.default)(e,[{key:"equals",value:function(t){return t=e.from(t),this.id()===t.id()||this.value()&&this.value()===t.value()}},{key:"isValid",value:function(){return!(!this.type()||null==this.value())}},{key:"isAndroidHandle",value:function(){return this.isValid()&&"Android"===this.type()}},{key:"isIosHandle",value:function(){return this.isValid()&&"IOS"===this.type()}},{key:"isWebFileHandle",value:function(){return this.isValid()&&"WebFileReader"===this.type()}},{key:"isWebImageHandle",value:function(){return this.isValid()&&"WebImageReader"===this.type()}},{key:"isUrlHandle",value:function(){return this.isValid()&&"Url"===this.type()}},{key:"isDataHandle",value:function(){return this.isValid()&&"Data"===this.type()}},{key:"isBlank",value:function(){return null==this.value()||""===this.value()}},{key:"id",value:function(){return this.model.id}},{key:"timestamp",value:function(){return this.model.timestamp}},{key:"tableName",value:function(){return this.model.tableName}},{key:"type",value:function(){return this.model.type}},{key:"value",value:function(){return this.model.value}},{key:"mediaType",value:function(){return this.model.mediaType}},{key:"filePath",value:function(){var e,t;if(void 0===this.model.filePath){var n=null===(t=null===(e=g.AppGlobals.AppModel)||void 0===e?void 0:e.localState)||void 0===t?void 0:t.GetFilePaths(),a=this.id();n&&a&&(this.model.filePath=n[a]||void 0)}return this.model.filePath}},{key:"setFilePath",value:function(e){this.model.filePath=e,g.AppGlobals.AppModel.localState.AddImageFilePath(this.id(),e)}},{key:"setFileInput",value:function(e){this.file=e}},{key:"fileName",value:function(){return this.model.filename}},{key:"setFileName",value:function(e){this.model.filename=e}},{key:"preferredWidth",get:function(){return this.model.preferredWidth}},{key:"nestedHandle",value:function(){if(void 0!==this.model.nestedHandle){var t=e.from(this.model.nestedHandle,this.tableName());return t.isValid()?t:null}return null}},{key:"setNestedHandle",value:function(t){var n=e.from(t,this.tableName());return this.model.nestedHandle=n.isValid()?n:null,this}},{key:"resolve",value:function(){return this.isValid()?this.isDataHandle()?this.value():this.isUrlHandle()?g.AppGlobals.AppModel.ResolveFile(this.value(),this.tableName()):g.AppGlobals.AppModel.ResolveFile(this.model,this.tableName()):""}},{key:"_flushProcessCallbacks",value:function(e,t){var n=this,a=l.default.uniq(this._processCallbacks);this._processCallbacks=[],a.forEach((function(a){return a(e,t,n)}))}},{key:"canUseFirebaseUpload",value:function(){return this.isAndroidHandle()&&d.default.SupportsFirebaseFileUpload()}},{key:"getFirebaseToken",value:function(e){var t=this;(0,m.ajaxGet)("/api/firebaseToken").then((function(n){(null==n?void 0:n.firebaseToken)?(f.JeeneeBrowserAPI.setStorageAuth(n.firebaseToken),t.getUrlForSync(e,!1)):e(null,"")})).catch((function(){e(null,"")}))}},{key:"getUrlForSync",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.nestedHandle()?this.flatten(e):this.isBlank()?e(null,""):this.canUseFirebaseUpload()?f.JeeneeBrowserAPI.getFileStorageUrl(this.value(),(function(a){a&&a!==b?e(null,a):a===b&&n?t.getFirebaseToken(e):(c.default.ReportErrorOnce({errorMessage:"getUrlForSync firebase path falling back to base64"}),t.getBase64UrlForSync(e))})):this.getBase64UrlForSync(e)}},{key:"getBase64UrlForSync",value:function(e){var t=this;h.Common.processImage(this,(function(n){t.fileName()&&n.indexOf("#")<0&&(n+="#filename=".concat(encodeURIComponent(t.fileName()))),t.value()&&!n&&c.default.ReportErrorOnce({errorMessage:"Failed to get base64 data for sync",imageUrl:n}),e(null,n)}),(function(t){c.default.ReportErrorOnce({errorMessage:"Failed to get base64 data for sync",nestedErrorMessage:t}),e(t)}))}},{key:"getUrlForImgSrc",value:function(){var e=h.Common.getCachedImage(this);if(null!=e)return e;var t=this.value();switch(this.type()){case"Data":case"Url":return t;case"IOS":return void 0!==window.webkit?"appsheetios://?path="+encodeURIComponent(t)+"&method=getImageOrFile&id=5":"/jeenee_url?path="+encodeURIComponent(t)+"&id=5";case"Android":return d.default.IsAndroidAppWithMinVersion(6.8)&&t&&t.length<50?"/jeenee_url?path="+encodeURIComponent(t):t;case"WebFileReader":case"WebImageReader":return null}return null}},{key:"getBase64OrWebUrl",value:function(e){var t=this;if(this._processCallbacks.push(e),!this.isValid())return setTimeout((function(){return t._flushProcessCallbacks(null,"")}),1),"";if(this._processed)return setTimeout((function(){return t._flushProcessCallbacks(null,t._processed)}),1),this._processed;if(this.isUrlHandle()){var n=this.resolve();return setTimeout((function(){return t._flushProcessCallbacks(null,n)}),1),n}return this._processPending?"":(this._processPending=!0,h.Common.processImage(this,(function(e){t._processPending=!1,t._processed=e,t._flushProcessCallbacks(null,e)}),(function(e){t._processPending=!1,c.default.warnToDevConsole("unable to process image: ",e),t._flushProcessCallbacks(null,"")})))}},{key:"flushFlattenCallbacks",value:function(e,t,n){var a=this,r=l.default.uniq(this._flattenCallbacks.get(e));this._flattenCallbacks.delete(e),r.forEach((function(e){return e(t,n,a)}))}},{key:"cachedFlattened",value:function(e,t){return this._flattened[T(e,t)]}},{key:"flatten",value:function(e,t,n){var a=this,r=T(t,n),i=this._flattenCallbacks.get(r)||[];this._flattenCallbacks.set(r,i);var o=i.length>0;if(i.push(e),this.isValid()){var l=this.cachedFlattened(t,n);if(l)setTimeout((function(){return a.flushFlattenCallbacks(r,null,l)}),1);else if(!o){var d=document.createElement("canvas");d.width=0,d.height=0;var f=function(){c.default.warnToDevConsole("unable to load image data in ImageHandle.flatten"),a.flushFlattenCallbacks(r,null,a.resolve())},p=function(e,a){if(d){var r=e.width,i=e.height;if(s.default.IsMobileBrowser()){var o=Math.max(window.innerWidth,window.innerHeight);r=Math.min(e.width,o),i=Math.min(e.height,o)}t=d.width||t||r,n=d.height||n||i;var l=u.default.computeImageSizing({mode:d.width?"cover":"contain",containerWidth:t||0,containerHeight:n||0,imageWidth:e.width,imageHeight:e.height,centerHorizontal:!0}),c=l.scaledWidth,f=l.scaledHeight,p=l.left,h=l.top,v=d.getContext("2d");if(!d.width||!d.height){if(d.width=c,d.height=f,p=0,h=0,v.setTransform(1,0,0,1,0,0),y.ReactRootUIConfig.isReactRoot())v.fillStyle="rgba(0,0,0,0)";else{var m="#F8F8F8";g.AppGlobals.ViewManager.theme&&(m=g.AppGlobals.ViewManager.theme.getThemeColor("signatureBackground")||m),v.fillStyle=m}v.fillRect(0,0,d.width,d.height)}v.setTransform(1,0,0,1,0,0),v.drawImage(e,p,h,c,f)}delete e.onload,delete e.onerror,delete e.src,a(e)};!function e(r,i){var o=function(e){var t=new Image;e.match(/^data:/)?delete t.crossOrigin:t.crossOrigin="Anonymous",t.onerror=f,e?(t.onload=p.bind(null,t,i),t.src=e):setTimeout((function(){i(t)}),1)},l=r.cachedFlattened(t,n);l&&y.ReactRootUIConfig.isReactRoot()?o(l):r.getBase64OrWebUrl((function(t,n){if(t)f();else{n=n||"";var l=r.nestedHandle();l?function(t,n){e(n,(function(e){t?(e=new Image,t.match(/^data:/)?delete e.crossOrigin:e.crossOrigin="Anonymous",e.onerror=f,e.onload=p.bind(a,e,i),e.src=t):i(e)}))}(n,l):o(n)}}))}(this,(function(){try{y.ReactRootUIConfig.isReactRoot()?a._flattened[r]=d.toDataURL("image/png",1):a._flattened[r]=d.toDataURL("image/jpeg"),a.flushFlattenCallbacks(r,null,a._flattened[r])}catch(e){c.default.warnToDevConsole("unable to flatten composite image: ",e),a.flushFlattenCallbacks(r,null,a.resolve())}}))}}else setTimeout((function(){return a.flushFlattenCallbacks(r,null,"")}),1)}},{key:"toJSON",value:function(){var e=this.value(),t=l.default.clone(this.model);if(this.isDataHandle()&&e){var n=g.AppGlobals.AppModel.GetFromImageCache(this.id());n&&n===e||g.AppGlobals.AppModel.AddToImageCache(this.id(),e),t.cachedById=!0,t.value=u.default.hashCode(e)}return t}},{key:"toString",value:function(){return"Url"===this.type()&&this.value()||""}},{key:"toDebugString",value:function(){return JSON.stringify(this.model)}}],[{key:"from",value:function(t,n){return t instanceof e?(!t.tableName()&&n&&(t.model.tableName=n),t):t&&"object"===(0,o.default)(t)&&null!=t.id&&t.id in S?S[t.id]:new e(t,n)}},{key:"clearCache",value:function(){S={}}}]),e}();t.ImageHandle=A;var E=A;t.default=E},87786:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(654158)),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;(0,r.default)(this,e),this.tableRows=t,this._indexStore=n}return(0,i.default)(e,[{key:"indexStore",get:function(){var e;return null!==(e=this._indexStore)&&void 0!==e?e:this._indexStore=new Map}},{key:"push",value:function(e){this.tableRows.push(e)}},{key:"allRows",value:function(){return this.tableRows}},{key:"count",get:function(){return this.tableRows.length}},{key:"lookupAtomic",value:function(e,t){return e?this.getIndex(e).lookup(t).allRows():[]}},{key:"lookup",value:function(e){var t=this;if(!this.tableRows||!e.length)return null;if(e.map((function(e){return e.attribute})).filter((function(e){return!e||"List"===e.type()||"EnumList"===e.type()})).length)return null;var n=new WeakMap;if(e.forEach((function(e){n.set(e,t.getIndex(e.attribute).lookup(e.value))})),1===e.length)return n.get(e[0]).allRows();var a=o.default.sortBy(e,(function(e){return n.get(e).count}));return n.get(a[0]).lookup(a.slice(1))}},{key:"getIndex",value:function(e){var t=e.lowercaseName(),n=this.indexStore.get(t);return n||(n=new l.default(this.tableRows,e),this.indexStore.set(t,n)),n}}]),e}();t.default=u},306593:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.Paging=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=function(){function e(t){(0,r.default)(this,e);for(var n=1,a=[],i={1:a},o={},l=0;l<t.length;l++){var u=t[l],s=t[l-1],c=t[l+1];if(u.isPageHeader()){var d=a.filter((function(e){return!e.isHidden()&&!e.isPageHeader()})),f=u.showContent(),p=u.description(),h=!(null!=f&&""!==f||null!=p&&""!==p||u.hasDisplayName()),v=s&&s.isPageHeader()||c&&c.isPageHeader();if(h&&v)continue;if(h&&!c)continue;if(!d.length){if(h)continue;if(1===n){a.unshift(u),o[u.name()]=n;continue}var m=a[0];if(!(null!=m.showContent()&&""!==m.showContent()||null!=m.description()&&""!==m.description())){a[0]=u,o[m.name()]=null,o[u.name()]=n;continue}}a=[u],i[++n]=a,o[u.name()]=n}else a.push(u),o[u.name()]=n}this.attributes=t,this.attributesByPage=i,this.pagesByAttribute=o}return(0,i.default)(e,[{key:"formPageCount",get:function(){return o.default.keys(this.attributesByPage).length}},{key:"rowStateColumnNames",get:function(){return this.attributes.map((function(e){return e.name()}))}},{key:"pageHeader",value:function(e){return this.attributesOnPage(e).filter((function(e){return e.isPageHeader()}))[0]}},{key:"attributesOnPage",value:function(e){return this.attributesByPage[e]||[]}},{key:"onPage",value:function(e){return this.pagesByAttribute[e]}}]),e}();t.Paging=l},455127:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=n(166089),l=n(851353),u=n(44617),s=n(276891),c=function(){function e(t){(0,r.default)(this,e),this.uiController=t,this.totalBigSteps=4,this.totalQueued=0,this.remainingQueued=0,this.completedSteps={},this.errorCount=0,this.intervalTimerCount=0,this.completeCount=1,this.errors=[],this.isInteractiveEmulator=(0,l.isAnyEmulator)()&&(u.dynamicRollouts.includeByUserId("ConversationEnable")||u.dynamicRollouts.includeByUserId("ShowVFEEmulatorOverlay"))}return(0,i.default)(e,[{key:"disable",value:function(){this.clearIntervalTimer(),this.disabled=!0}},{key:"start",value:function(e){this.uiController.onStart(e)}},{key:"updateProgress",value:function(e){this.disabled||this.uiController.onProgress(e)}},{key:"finish",value:function(){this.disabled||(this.disable(),this.uiController.onFinish(),this.isInteractiveEmulator&&(0,l.sendEmulatorPingMessage)(s.EmulatorPingEventName.SyncSucceeded))}},{key:"raiseWarning",value:function(e){this.uiController.onWarning(e)}},{key:"getPlanInfo",value:function(){var e=o.AppGlobals.AppModel.AppTemplate,t=!1===e.HasValidPlan&&!e.IsPersonal&&!e.IsDeployable,n=e.PlanViolationLevel,a=e.OwnerId===o.AppGlobals.AppState.UserInformation.Id;return{violationLevel:n,upgradeNeeded:t,inTestMode:!e.IsDeployable&&!a}}},{key:"setSyncQueueStatus",value:function(e){var t,n;this.totalQueued=null!==(t=e.totalSteps)&&void 0!==t?t:0,this.remainingQueued=null!==(n=e.remainingSteps)&&void 0!==n?n:0,this.updateProgress(e)}},{key:"clearIntervalTimer",value:function(){null!=this.intervalHandle&&(clearInterval(this.intervalHandle),delete this.intervalHandle,this.intervalTimerCount=0)}},{key:"completeSection",value:function(e){var t=this;if(!this.disabled&&!this.completedSteps[e])if(this.completedSteps[e]=!0,this.completeCount++,this.updateProgress({step:e,percentDone:this.getCompletePercentage()}),this.checkFinished()){this.clearIntervalTimer();var n=this.getPlanInfo();(n.violationLevel||n.upgradeNeeded||n.inTestMode)&&this.raiseWarning(n),this.finish()}else this.clearIntervalTimer(),this.intervalHandle=setInterval((function(){t.intervalTimerCount++,t.updateProgress({percentDone:t.getCompletePercentage()}),t.intervalTimerCount>9&&t.clearIntervalTimer()}),3e3)}},{key:"raiseError",value:function(e){if(!this.disabled){var t=e instanceof Error?e.message:e;this.clearIntervalTimer(),this.errorCount++,this.errors.push(t),this.uiController.onError(t),this.isInteractiveEmulator&&(0,l.sendEmulatorPingMessage)(s.EmulatorPingEventName.SyncFailed)}}},{key:"getErrors",value:function(){return this.errors[0]}},{key:"getCompletePercentage",value:function(){var e=this.totalQueued+this.totalBigSteps,t=1-(this.remainingQueued+this.totalBigSteps-this.completeCount)/e,n=this.intervalTimerCount;return n>=9&&(n=9),100*(t+=n/(10*e))}},{key:"checkFinished",value:function(){return this.totalBigSteps===this.completeCount}},{key:"setSyncingStatus",value:function(e){var t,n;this.disabled||null===(n=(t=this.uiController).onSyncingStatus)||void 0===n||n.call(t,e)}},{key:"closeDialog",value:function(){this.uiController.close()}}]),e}();t.default=c},494012:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.RowState=t.DynamicStateStore=void 0;var r=a(n(238416)),i=a(n(856690)),o=a(n(689728)),l=a(n(496486)),u=a(n(150198)),s=n(365914),c=n(166089),d=a(n(962553)),f=n(557310),p=n(29827),h=a(n(819433));function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var g=function(e){return"form"===(0,p.createViewStateSelector)(e,p.getViewType)((0,h.default)().getState())},y=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];(0,i.default)(this,e),this.name=t,this.evalName=n,this.store=new Map,this.checkFn=a,this.dependencies=r}return(0,o.default)(e,[{key:"evalTree",value:function(e){return e.evalTreeLookup(this.evalName)}},{key:"tablesReferenced",value:function(e){return l.default.compact(l.default.flatMap(l.default.concat(this.dependencies,this),(function(t){return t.evalTree(e)&&t.evalTree(e).tablesReferenced()})))}},{key:"invalidate",value:function(t){var n,a=e.makeCacheKeyPrefix(t),r=e.makeCacheKey(t),i=v(this.store.keys());try{for(i.s();!(n=i.n()).done;){var o=n.value;(o===r||null!=a&&o.startsWith(a))&&this.store.delete(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"check",value:function(t,n){var a=e.makeCacheKey(t,n);if(this.store.has(a))return this.store.get(a);var r=this.checkFn(t,n);return this.store.set(a,r),r}}],[{key:"makeCacheKey",value:function(e,t){return f.ReactRootUIConfig.isReactRoot()?e.name()+(t?"/".concat(t):""):e.name()}},{key:"makeCacheKeyPrefix",value:function(e){return f.ReactRootUIConfig.isReactRoot()?e.name()+"/":null}}]),e}();t.DynamicStateStore=y;var b=function(){function e(t,n,a,r){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};(0,i.default)(this,e),this._checkValidOptions=function(e,t){if(e.isValidityEnum()){var n=e.validIfEvalTree().getInConditionListInformation(o.dataContext.augmentWithViewContext(t)),a=n.values;return n.elementAttribute.valuesToWireFormat(a)}return null},this._checkSuggestedValues=function(e,t){return e.hasSuggestedValues()?e.valuesToWireFormat(e.suggestedValuesEvalTree().run(o.dataContext.augmentWithViewContext(t))):null},this._checkShowContent=function(e,t){if(e.isShowType()){var n=e.evalTreeLookup("ShowContent");if(n){var a=n.run(o.dataContext.augmentWithViewContext(t));return a=e.coerceValue(a,n.resultType(),n.resultTypeQualifier()),a=e.valueToWireFormat(a),e.localizeWireValue(a)}return e.auxData().Content||null}return null},this._checkDisplayName=function(e,t){return e.displayName(o.dataContext.augmentWithViewContext(t))},this._checkHidden=function(e,t){var n,a,r,i=o.value(e),s=e.isReverseDependentRef(),c=t?g(t):o.pendingFormState(),f=null===(r=null===(a=null===(n=null===window||void 0===window?void 0:window.AppState)||void 0===n?void 0:n.CurrentUIState)||void 0===a?void 0:a.FormUIState)||void 0===r?void 0:r.DefaultValues,p=Array.isArray(f)&&f.length>1;if(c||p){if(e.isVirtual()&&e.isKey())return!0;if(e.isSys()&&!s)return!0;if(p){if(e.isKey())return!0;if(l.default.includes(l.default.keys(f[0]),e.name()))return!0}}if(!e.isShowType()&&!u.default.valueExists(i,e.type())&&(!o.isEditable(e,t)||!o.appModel.allowScanOverride()&&(e.isScannable()||e.isNfcScannable())&&!e.shouldShowScannerButtons())){if(!s)return!0;if(p)return!0;var h=o.appModel.findTableCollection(e.nestedAttribute().referencedTableName()).table;if(!h||!h.allowsAdd(o.appModel))return!0}if(o.isEditable(e,t)&&e.isValidityEnum()){var v=o.validOptions(e,t);if(null==v||0===v.length){var m=e.referencedTableName();if(null==m)return!0;var y=d.default.findByName(m,o.appModel).table;if(null==y||!y.allowsAdd(o.appModel))return!0}}if(c||p||o.appModel.appTemplate.respectShowIf){var b=e.showIfEvalTree();if(b){var T=o.dataContext;return e.isPageHeader()&&o.getVisitedDataContext&&(T=o.getVisitedDataContext()||o.dataContext),!b.run(T.augmentWithViewContext(t))}}return!!e.isHidden()},this._checkValid=function(e,t){var n=e.validIfEvalTree(),a=o.value(e);if(e.isShowType())return!0;if(!u.default.valueExists(a,e.type())||a===u.default.SHEET_FORMULA_NEEDS_RECOMPUTE)return!0;if(o.isHidden(e,t))return!0;var r=o.paging.onPage(e.name()),i=o.paging.pageHeader(r);return!(!o.includes(i)||!o.isHiddenPage(i,t))||!(n&&!n.run(o.dataContext.augmentWithViewContext(t)))&&e.validateValue(a)},this._checkRequired=function(e,t){if(e.isKey())return!0;if(o.isHidden(e,t))return!1;if(e.isShowType())return!1;var n=o.paging.onPage(e.name()),a=o.paging.pageHeader(n);if(o.includes(a)&&o.isHiddenPage(a,t))return!1;var r=e.requiredIfEvalTree();return r?!!r.run(o.dataContext.augmentWithViewContext(t)):!!e.isRequired()},this._checkEditable=function(e,t){if(!1===o.table.allowsUpdate(o.appModel)&&!o.isNewRow)return!1;if(!1===o.table.allowsAdd(o.appModel)&&o.isNewRow)return!1;if(o.editableColumnAllowlist&&!l.default.includes(o.editableColumnAllowlist,e.name()))return!1;if(o.editableColumnDenylist&&l.default.includes(o.editableColumnDenylist,e.name()))return!1;if(null!=e.firstNestedRef()&&o.stableId&&o.appModel.dataManager.currentTransaction.hasStableReverseRef({tableName:o.table.rootName(),stableId:o.stableId,refColumnName:e.name()}))return!1;if(e.isReadOnly()||e.hasAppFormula()||e.hasFormula()||e.isShowType()||e.isChangeTriggered())return!1;if(!o.isNewRow&&(e.isKey()||o.tableSchema.isKeyComponent(e)))return!1;var n=e.editableIfEvalTree();return!n||!!n.run(o.dataContext.augmentWithViewContext(t))},this.appModel=t,this.table=n,this.tableSchema=n.tableSchema,this.view=c.view,this.dataContext=a,this.getVisitedDataContext=c.getVisitedDataContext,this.rowKey=r,this.stableId=c.stableId,this.stateAttributes=s,this.editableColumnAllowlist=c.editableColumnAllowlist,this.editableColumnDenylist=c.editableColumnDenylist,this.rowStatePaging=c.paging;var f=new y("displayName","DisplayName",this._checkDisplayName),p=new y("showContent","ShowContent",this._checkShowContent),h=new y("validOptions","Valid_If_AppEval",this._checkValidOptions),v=new y("suggestedValues","Suggested_Values",this._checkSuggestedValues),m=new y("isEditable","Editable_If_AppEval",this._checkEditable),b=new y("isHidden","Show_If_AppEval",this._checkHidden,[m,h]),T=new y("isValid","Valid_If_AppEval",this._checkValid,[b]),S=new y("isRequired","Required_If_AppEval",this._checkRequired,[b]),A={displayName:f,showContent:p,validOptions:h,suggestedValues:v,isEditable:m,isHidden:b,isValid:T,isRequired:S};this.stateStores=A}return(0,o.default)(e,[{key:"displayName",value:function(e,t){return this.stateStores.displayName.check(e,t)}},{key:"showContent",value:function(e,t){return this.stateStores.showContent.check(e,t)}},{key:"validOptions",value:function(e,t){return this.stateStores.validOptions.check(e,t)}},{key:"suggestedValues",value:function(e,t){return this.stateStores.suggestedValues.check(e,t)}},{key:"isEditable",value:function(e,t){return this.stateStores.isEditable.check(e,t)}},{key:"isHidden",value:function(e,t){return this.stateStores.isHidden.check(e,t)}},{key:"isValid",value:function(e,t){return this.stateStores.isValid.check(e,t)}},{key:"isRequired",value:function(e,t){return this.stateStores.isRequired.check(e,t)}},{key:"isNewRow",get:function(){return null==this.rowKey}},{key:"paging",get:function(){var e;return this.rowStatePaging||(null===(e=this.view)||void 0===e?void 0:e.paging)||this.tableSchema.paging}},{key:"values",value:function(){return this.dataContext.rowData}},{key:"value",value:function(e){return"string"!=typeof e&&(e=e.name()),this.dataContext.getValue(e)}},{key:"onDataChange",value:function(e){var t=this;this.stateStores&&l.default.values(this.stateStores).forEach((function(n){t.stateAttributes.forEach((function(t){var a=n.tablesReferenced(t);l.default.includes(a,e.tableName)&&n.invalidate(t)}))}))}},{key:"updateAndValidate",value:function(t,n,a){if("string"==typeof t&&(t=this.tableSchema.findAttributeByName(t)),t){var i=l.default.clone(this.values()),o=this.validateSave({viewStateKey:a}).errorState;this.dataContext.setValue(t.name(),n);var u={initialData:i,noAsync:!0};(t.resetsEachUpdate()||t.hasResetExpression())&&(u.skipTheseDefaults=(0,r.default)({},t.name(),!0)),this.dataContext.recomputeAppFormulas(u),this.refreshState();var s=this.validateSave({viewStateKey:a}).errorState;return e.changeInvalidatesRow(t,o,s)}return null}},{key:"includes",value:function(e){return l.default.includes(this.stateAttributes,e)}},{key:"id",get:function(){var e;return null!==(e=this.stableId)&&void 0!==e?e:this.value(this.tableSchema.keyAttribute())}},{key:"refreshState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stateAttributes;l.default.values(this.stateStores).forEach((function(t){e.forEach((function(e){t.invalidate(e)}))}))}},{key:"getErrorState",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stateAttributes,a=arguments.length>1?arguments[1]:void 0,r=l.default.clone(this.values()),i=function(e){return e.map((function(e){return e.name()}))},o=function(e){return null==r[e.name()]||""===r[e.name()]},u=function(e){return e.isKey()||t.tableSchema.isKeyComponent(e)},s=i(n.filter((function(e){return!t.isValid(e,a)}))),c=i(n.filter((function(e){return o(e)&&t.isRequired(e,a)}))),d=l.default.uniq(l.default.concat(s,c).map((function(e){return t.paging.onPage(e)}))),f=d.length>0,p=n.filter((function(e){return o(e)&&u(e)&&t.isHidden(e,a)}));return p.length&&(e="Key field '".concat(p[0].name(),"' cannot be blank")),{error:f,message:e,invalid:s,missingRequired:c,pages:d,rowValues:r}}},{key:"validateSave",value:function(e){var t,n,a,r=void 0===e?{}:e,i=r.enforceStableKey,o=void 0!==i&&i,s=r.usedTransactions,c=void 0!==s&&s,d=r.transaction,f=r.viewStateKey,p=void 0===f?null===(t=null==d?void 0:d.owningViewState)||void 0===t?void 0:t.viewStateKey:f,h=this.values(),v=this.tableSchema.keyAttribute(),m=v.name(),g=this.rowKey;a=(n=this.getErrorState(void 0,p)).pages,n.error||(n=null,a=null);var y=h[m];if(u.default.valueExists(y,v.type())||(n={error:!0,message:"Key field '".concat(m,"' is required"),pages:a}),this.isNewRow){var b=c?1:0;if(this.table.rootTable().lookupTableRows(m,y,d).length>b){var T=this.appModel.MapActionName("There is already a row with the key:");n={error:!0,message:"".concat(T," '").concat(y,"'"),pages:a}}}else y!==g&&(this.tableSchema.keyAttribute().isVirtual()&&l.default.trim(y)===l.default.trim(g)||(o?n={error:!0,message:"The key of an existing row cannot be changed",pages:a}:y=g));return{errorState:n,newRowKey:y}}},{key:"pendingFormState",value:function(){var e;return this.dataContext.formState||(null===(e=c.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)}},{key:"isHiddenPage",value:function(e,t){return!(!e.isPageHeader()||!this.isHidden(e,t)||null==e.showIfEvalTree())}}],[{key:"diffErrorState",value:function(e,t){var n,a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.checkValueChange,o=void 0===i||i,u=r.wasReset,c=void 0===u?{}:u;if(!t||!t.error)return null;e=e||{};var d=new s.NestedStore;if(t.message&&t.message!==e.message&&d.store("message",t.message),null!=t.invalid)for(var f=0;f<t.invalid.length;f++){var p=t.invalid[f],h=null===(n=e.rowValues)||void 0===n?void 0:n[p],v=null===(a=t.rowValues)||void 0===a?void 0:a[p];(null==e||!l.default.includes(e.invalid,p)||o&&h!==v)&&d.push("invalid",p)}if(t.missingRequired)for(var m=0;m<t.missingRequired.length;m++){var g=t.missingRequired[m];null!=e&&l.default.includes(e.missingRequired,g)?o&&c[g]&&d.push("missingRequired",g):d.push("missingRequired",g)}return d.isEmpty()?null:d.toSimpleObject()}},{key:"changesInvalidateRow",value:function(e,t){var n;if(!t||!t.error)return null;if(e=e||{},t.message&&t.message!==e.message)return{message:t.message};if(null!=t.invalid)for(var a=0;a<t.invalid.length;a++){var r=t.invalid[a],i=null===(n=e.rowValues)||void 0===n?void 0:n[r],o=t.rowValues[r];if(!l.default.includes(e.invalid,r)||i!==o)return{attribute:r,reason:"invalid"}}if(t.missingRequired)for(var u=0;u<t.missingRequired.length;u++){var s=t.missingRequired[u];if(!l.default.includes(e.missingRequired,s))return{attribute:s,reason:"blank and required"}}return null}},{key:"changeInvalidatesRow",value:function(t,n,a){return a&&a.error?l.default.includes(a.invalid,t.name())?{attribute:t.name(),reason:"invalid"}:l.default.includes(a.missingRequired,t.name())?{attribute:t.name(),reason:"blank and required"}:e.changesInvalidateRow(n,a):null}}]),e}();t.RowState=b;var T=b;t.default=T},69411:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(856690)),o=a(n(689728)),l=n(166089),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(21870));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}var c=function(){function e(){var t=this;(0,i.default)(this,e),this.close=function(){l.AppGlobals.ViewManager.ShowingInfoPage()&&"none"!==$("#InfoPage #LaunchScreen").css("display")&&l.AppGlobals.ViewManager.HideInfoPage((function(){$("#InfoPage").hasClass("ActivePage")||t.launchScreen.hide()}))}}return(0,o.default)(e,[{key:"launchScreen",get:function(){return $("#LaunchScreen")}},{key:"onStart",value:function(){u.default.syncState.ui===u.SyncUI.Blocking&&l.AppGlobals.ViewManager.ShowLaunchScreen()}},{key:"onProgress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.totalSteps,n=e.remainingSteps,a=e.step,r=e.percentDone;if(void 0!==t){var i=l.AppGlobals.AppModel.MapActionName("Saving changes"),o=l.AppGlobals.AppModel.MapActionName("Syncing...");null!=n&&null!=t&&(i="".concat(i," (").concat(t-n+1,"/").concat(t,")"));var u=n&&n>0?i:o;this.launchScreen.find(".SyncingStatusLabel .LoadingStatusLabelMain").text(u)}r&&this.launchScreen.find(".LoadingStatus .bar").css("width",r+"%"),a&&this.launchScreen.find(".LoadStatusDiv .Loaded"+a).removeClass("LoadingState").addClass("LoadedState")}},{key:"onFinish",value:function(){$("#LaunchScreen .AppBlockedMode").hide(),this.closeDataLoadModalTimeout=setTimeout(this.close,0)}},{key:"onWarning",value:function(e){var t=e.violationLevel,n=e.upgradeNeeded,a=e.inTestMode,r=e.message;t||n||a||r&&this.launchScreen.find(".ErrorMessage").show().append($("<p />").text(r))}},{key:"onError",value:function(e){if(e&&"function"==typeof e.indexOf&&0===e.indexOf("__:")&&(e=e.slice(3,e.length)),this.launchScreen.find(" .LoadStatusDiv .LoadingState").removeClass("LoadingState").addClass("ErrorState"),this.launchScreen.find(".LoadingStatus").hide(),this.launchScreen.find(".btn").prop("disabled",!1),"abort"!==e){var t=this.launchScreen.find(".ErrorMessage");e.split("\n").forEach((function(e){return t.append($("<p />").text(e))})),t.show(),this.launchScreen.find(".SyncingStatusLabel").hide(),this.launchScreen.find(".aspinner").hide()}}},{key:"onSyncingStatus",value:function(e){this.launchScreen.find(".LoadingFromCacheStatusLabel").toggle(!e),this.launchScreen.find(".SyncingStatusLabel").toggle(e),e&&(this.launchScreen.find(".LoadingStatus").show(),this.launchScreen.find(".CancelButton").toggle(!0))}}]),e}();t.default=c},962553:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(627424)),o=a(n(600861)),l=a(n(856690)),u=a(n(689728)),s=a(n(496486)),c=a(n(65706)),d=_(n(365914)),f=a(n(674823)),p=a(n(385857)),h=_(n(888861)),v=a(n(389549)),m=a(n(87786)),g=a(n(450513)),y=n(417751),b=n(959191),T=n(166089),S=n(149313),A=n(354632),E=n(44617),w=n(557310),C=n(365914);function O(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(O=function(e){return e?n:t})(e)}function _(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=O(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var I=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},N=function(){function e(t,n,a){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Map,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Set,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Set,f=arguments.length>7?arguments[7]:void 0;(0,l.default)(this,e),this.tableName=t,this.transactionId=n,this.keyAttribute=a,this.createdRows=i,this.updatedRows=u,this.deletedRows=s,this.pendingRows=c,this._indexedRows=f,this.getMergedRows=function(e,t,n,a){var i=(0,o.default)(e);return r.mergeIntoRows(i,t,n,a),i},this.mergeIntoRows=function(e,t,n,a){var i,o,l=null==t?void 0:t.getRootContext(),u=null===(i=null==l?void 0:l.pendingTransaction)||void 0===i?void 0:i.owningViewState,s=k(r.pendingRows.values());try{for(s.s();!(o=s.n()).done;){var c=o.value;u&&c.values===(null==l?void 0:l.rowData)||(null!=n&&!n.includes(c)||null!=a&&!a.run(c.dataContext)?(0,d.remove)(e,c.shadowing):(0,d.addOrReplace)(e,c,c.shadowing))}}catch(e){s.e(e)}finally{s.f()}var f,p=k(r.deletedRows);try{for(p.s();!(f=p.n()).done;){var h=f.value;(0,d.remove)(e,h)}}catch(e){p.e(e)}finally{p.f()}}}return(0,u.default)(e,[{key:"hasChanges",get:function(){return this.pendingRows.size>0||this.deletedRows.size>0}},{key:"indexedRows",get:function(){var e;return null!==(e=this._indexedRows)&&void 0!==e?e:this._indexedRows=new m.default(Array.from(this.pendingRows))}},{key:"onDataChange",value:function(e){delete this._indexedRows}},{key:"addCreatedRow",value:function(e){this.createdRows.set(e.stableId,e),this.pendingRows.add(e),this.onDataChange()}},{key:"getShadowCopy",value:function(e){if(this.pendingRows.has(e))return e;var t=this.updatedRows.get(e.stableId);if(t)return t;var n=e.copy();return n.shadowing=e,this.updatedRows.set(e.stableId,n),this.pendingRows.add(n),this.onDataChange(),n}},{key:"markForDeletion",value:function(e){var t,n=null!==(t=e.shadowing)&&void 0!==t?t:e;this.deletedRows.add(n),this.createdRows.delete(e.stableId),this.updatedRows.delete(e.stableId),this.pendingRows.delete(e),this.onDataChange()}}]),e}(),M=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new WeakMap;(0,l.default)(this,e),this.tableName=t,this.keyAttribute=n,this.store=a}return(0,u.default)(e,[{key:"forTransaction",value:function(e){var t=this.store.get(e);return null==t&&(t=new N(this.tableName,e.id,this.keyAttribute),this.store.set(e,t)),t}}]),e}(),D=function(){function e(t,n,a,r,i){var o,u,f=this;(0,l.default)(this,e),this._updateModeUnmemoized=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.AppGlobals.AppModel,n=f.updateModeEvalTree();if(n){var a=String(n.run(t.dataContext()));return a in y.UpdateModeEnum?y.UpdateModeEnum[a]:y.UpdateModeEnum.READ_ONLY}var r=null!==(e=f.sliceDefinition)&&void 0!==e?e:f.tableDefinition,i=r.UpdateMode;return i},this.appModel=i||T.AppGlobals.AppModel,this.table=this.model=t,this.tableSchema=n,this.tableDefinition=a,this._rootTable=r,t.IsSlice||(this._pendingChanges=new M(this.name(),n.keyAttribute()),this._tableRows=s.default.map(t.Rows,(function(e){return new v.default(e,f)})),this._formatting=new g.default(t.Name,this.appModel),this._indexedTableRowsByName=new Map);this.queryMemoized=(0,c.default)({limit:15,makeKey:function(e){return e.filterExpr&&!e.filterExpr.isPure()?null:(e=(0,d.stripEmptyItems)(e),String(d.default.hashCode(JSON.stringify(e))))},getTimestamp:function(e){var t,n=e.transaction,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.appModel;if(n){var r=null!==(t=n.lastModifiedTimestamp)&&void 0!==t?t:0;return Math.max(f.timestamp(a),r)}return f.timestamp(a)},fn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.appModel,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.default(f.appModel,f.tableSchema),a=e.transaction;return f._queryCompatibility(e,t,n.augmentWithTransaction(a))}});var h=null===(u=null===(o=a.ExprLookup)||void 0===o?void 0:o.UpdateMode)||void 0===u?void 0:u.IsPure;this.updateMode=h?(0,c.default)({limit:2,makeKey:function(e){return(0,S.$TSFixMeMaybeNull)(e),e.DataStamp},getTimestamp:function(e){return f.timestamp(e)},fn:this._updateModeUnmemoized}):this._updateModeUnmemoized,this.indexedTableRows=function(){var e=f.rootTable()._indexedTableRowsByName,t=e.get(f.name());return null==t&&(t=new m.default(f.rows()),e.set(f.name(),t)),t}}return(0,u.default)(e,[{key:"pendingChanges",get:function(){return this.rootTable()._pendingChanges}},{key:"isUserSettingsTable",get:function(){return(0,C.isUserSettingsTable)(this.name())}},{key:"queryRowValues",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!0,groupBy:void 0}),t,n)}},{key:"queryRows",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!1,groupBy:void 0}),t,n)}},{key:"queryRowValuesAsync",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!0,groupBy:void 0}),t,n)}},{key:"queryRowsAsync",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!1,groupBy:void 0}),t,n)}},{key:"queryRowValuesGroupBy",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!0}),t,n)}},{key:"queryRowsGroupBy",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!1,valuesOnly:!1}),t,n)}},{key:"queryRowValuesGroupByAsync",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!0}),t,n)}},{key:"queryRowsGroupByAsync",value:function(e,t,n){return this.queryMemoized(Object.assign(Object.assign({},e),{doAsync:!0,valuesOnly:!1}),t,n)}},{key:"formatting",get:function(){return this.isSlice()?this.rootTable().formatting:this._formatting}},{key:"sliceDefinition",get:function(){return this.tableSchema.sliceDefinition}},{key:"labelTextForId",value:function(e,t){var n=this.lookupTableRow(e,t);if(n){var a=this.tableSchema.labelBasicAttribute();if(a)return n.get(a.name())}return e}},{key:"timestamp",value:function(e){return(e=e||this.appModel)?s.default.max([this.rootTable().ownTimestamp,e.dataStampTime()]):0}},{key:"rootName",value:function(){return this.rootTable().name()}},{key:"rootTable",value:function(){return this.model.IsSlice?this._rootTable:this}},{key:"rowLabelValue",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.dataContext){var a=this.keyAttribute().name();t=n.dataContext.getTableRow(this,e,{keyAttrName:a})}else t=this.findRow(e);if(t){var r=this.tableSchema.labelAttributes(),i=r.map((function(e){return t[e.name()]})).join(" ");return i}return e}},{key:"isSlice",value:function(){return this.model.IsSlice}},{key:"sliceFilterEvalTree",value:function(){var e,t;if(void 0===this._sliceFilterEvalTree){var n=null===(t=null===(e=null==this?void 0:this.tableSchema)||void 0===e?void 0:e.sliceDefinition)||void 0===t?void 0:t.FilterEvaluatable;this._sliceFilterEvalTree=n?h.default.create(n):null}return this._sliceFilterEvalTree}},{key:"keyLabelMap",value:function(e,t){var n=this;e=e||this.appModel,t=t||new p.default(e,this.tableSchema);var a=this.tableSchema.findAttributeIndex(this.keyAttribute().name()),r=t.getTableColumnSet(this.rootName(),a),i=this.tableSchema.labelBasicAttribute()||this.tableSchema.keyAttribute(),o=this.tableSchema.findAttributeIndex(i.name()),l=t.getTableColumnSet(this.rootName(),o);return t.pendingRowsForTable(this.name()).forEach((function(e){var t=e.rowData[n.keyAttribute().name()],a=e.rowData[i.name()];t&&(r.push(t),l.push(a||""))})),s.default.zipObject(r,l)}},{key:"deleteRow",value:function(e){if(this.isSlice())return this.rootTable().deleteRow(e);var t=this.keyAttribute().name(),n=this.rows().find((function(n){return n.get(t)===e}));if(n){var a=n.snapshot(),r=n.keyAttribute.name(),i=n.keyValue,o=function(e){return e[r]===i};return s.default.remove(this.model.Rows,o),s.default.remove(this._tableRows,(function(e){return o(e.values)})),this.onDataChange(),a}return null}},{key:"deleteRowByStableId",value:function(t,n){if(this.isSlice())this.rootTable().deleteRowByStableId(t,n);else if(n&&e.usePendingChangesStore){var a=this.lookupTableRow(t,n);a&&this.pendingChanges.forTransaction(n).markForDeletion(a)}else{var r=this.rows().findIndex((function(e){return e.stableId===t}));r>-1&&(this.model.Rows.splice(r,1),this._tableRows.splice(r,1),this.onDataChange())}}},{key:"createRow",value:function(t,n){if(this.isSlice())return this.rootTable().createRow(t,n);var a=new v.default(t,this);return n&&e.usePendingChangesStore?this.pendingChanges.forTransaction(n).addCreatedRow(a):(this.model.Rows.push(t),this._tableRows.push(a),this.onDataChange()),t}},{key:"replaceRow",value:function(e){var t=this.lookupTableRow(e[this.keyAttribute().name()]);if(t){var n=this._tableRows.indexOf(t),a=this.table.Rows.indexOf(t.values),r=new v.default(e,this);this._tableRows[n]=r,this.table.Rows[a]=e,this.onDataChange()}}},{key:"resetRowValues",value:function(e,t,n){if(this.isSlice())return this.rootTable().resetRowValues(e,t,n);var a=this.keyAttribute().name(),r=this.rows().find((function(t){return t.get(a)===e}));return r?(r.resetValues(t),this.onDataChange(),r):null}},{key:"createNewRow",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isSlice())return this.rootTable().createNewRow(n);var a=this.tableSchema.getDefaultValues(n.initialValues),r=n.transaction,i=s.default.clone(a)||{},o=new p.default(this.appModel,this.tableSchema,i).augmentWithTransaction(r),l={considered:{},computed:{},computeDefaults:!0,skipTheseDefaults:a,skipChangeTriggers:!0,getAsyncCallback:this.getAsyncCallback,nowDate:new Date,onDynamicValueChanged:n.onDynamicValueChanged};this.tableSchema.allBaseTableAttributes().forEach((function(e){var n=e.name(),a=i[n];if("_RowNumber"===n){var u=(s.default.max(t.rootTable().rows({transaction:r}).map((function(e){return Number(e.get("_RowNumber"))})))||1)+1;i[n]=e.valueToWireFormat(u)}else e.isDynamic()?o.recomputeAttribute(e,l):null==a&&(i[n]="")}));var u=new v.default(i,this,{stableId:d.default.makeGuid()});return r&&e.usePendingChangesStore?this.pendingChanges.forTransaction(r).addCreatedRow(u):(this._tableRows.push(u),this.model.Rows.push(i),this.onDataChange()),u}},{key:"getPendingRow",value:function(t,n){return this.isSlice()?this.rootTable().getPendingRow(t,n):e.usePendingChangesStore?this.pendingChanges.forTransaction(n).getShadowCopy(t):t}},{key:"commitPendingChanges",value:function(e){if(this.isSlice())this.rootTable().commitPendingChanges(e);else if(!e.closed){var t=this.pendingChanges.forTransaction(e);t.hasChanges&&(this._tableRows=t.getMergedRows(this._tableRows),this.model.Rows=this._tableRows.map((function(e){return e.values})),this.onDataChange())}}},{key:"rowValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.appModel,n=void 0===t?this.appModel:t;return this.rows({appModel:n}).map((function(e){return e.values}))}},{key:"rows",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.appModel,n=void 0===t?this.appModel:t,a=e.transaction,r=e.dataContext;if(!n)return[];if(this.isSlice()){var i=this.sliceFilterEvalTree();return this.rootTable().queryRows({filterExpr:i||void 0,transaction:a})}return a?this.pendingChanges.forTransaction(a).getMergedRows(this._tableRows,r):s.default.clone(this._tableRows)}},{key:"filteredRowValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.appModel,n=arguments.length>2?arguments[2]:void 0;return this.filteredRows(e,t,n).map((function(e){return e.values}))}},{key:"filteredRows",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.filterExpr,a=t.filterDefaults,r=void 0===a?[]:a,l=t.transaction,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.appModel,c=arguments.length>2?arguments[2]:void 0;if(!u)return[];var d=performance.now(),f=E.dynamicRollouts.includeByOwnerId("ClientExpressionPerformance")?"true":"false",m=new p.default(u,this.tableSchema).augmentWithTransaction(l),g=null==n?void 0:n.curry(m);if(g&&"CONSTANT"===g.evalType()&&"Yes/No"===g.resultType()&&"N"===g.constantValue())return A.filterTimeMetric.record(performance.now()-d,{InRollout:f}),[];var y,S=this.rootTable(),w=S.tableSchema,C=(0,h.getFilterDefaultsAndFullyMapped)(g),O=(0,i.default)(C,2),_=O[0],k=O[1],R=(0,b.filterDefaultsToIndexLookup)(r,w),I=(0,b.filterDefaultsToIndexLookup)(_,w),N=R.concat(I),M=this.indexedTableRows().lookup(N);if(M){if(y=M,l){var D=this.pendingChanges.forTransaction(l),L=D.hasChanges,P=D.getMergedRows,G=D.indexedRows;if(L){var x=G.lookup(N);y=P(M,c,x,this.sliceFilterEvalTree())}}}else y=this.rows({appModel:u,transaction:l});if(r.length&&null==M){var F=s.default.compact(R.map((function(e){var t=e.attribute,n=e.value;return h.default.createColFilter(n,w,t)})).concat(g));g=1===F.length?F[0]:h.default.createAnd.apply(h.default,(0,o.default)(F))}if(g&&(!M||!k)){var V={noCache:!0};y=y.filter((function(e){return m.replaceRowData(e.values),g.run(m,V)}))}if(c){var U=c.pendingRowsForTable(this.name());if(null==U?void 0:U.length){var B=T.AppGlobals.AppState.pendingFormState||c.formState;B&&(U=U.filter((function(t){var a,r=t.tempId!==B.tempId,i=s.default.compact([n]);if(N){var l=N.map((function(t){var n=t.attribute,a=t.value;return h.default.createColFilter(a,e.tableSchema,n)}));i=s.default.concat(i,l)}return i.length>1?a=h.default.createAnd.apply(h.default,(0,o.default)(i)):1===i.length&&(a=i[0]),a&&(m.replaceRowData(t.rowData),r=r&&a.run(m)),r}))),U=U.map((function(t){return new v.default(t.rowData,e)})),y=s.default.uniqBy(U.concat(y),(function(t){return t.get(e.keyAttribute().name())}))}}return A.filterTimeMetric.record(performance.now()-d,{InRollout:f}),y}},{key:"findRow",value:function(e){var t;return null===(t=this.lookupTableRow(e))||void 0===t?void 0:t.values}},{key:"isPendingDeletion",value:function(e,t){return this.pendingChanges.forTransaction(t).deletedRows.has(e)}},{key:"lookupTableRow",value:function(t,n){var a;if(null!=t)return e.usePendingChangesStore?this.lookupTableRows(this.keyAttribute().name(),t,n)[0]:null!==(a=this.appModel.dataManager.findPendingRow(t))&&void 0!==a?a:this.indexedTableRows().lookupAtomic(this.keyAttribute(),t)[0]}},{key:"lookupTableRowsByIndexLookup",value:function(t,n,a){var r=this.indexedTableRows().lookup(t);if(r&&n&&e.usePendingChangesStore){var i=this.pendingChanges.forTransaction(n),o=i.hasChanges,l=i.indexedRows,u=i.getMergedRows;if(o)return u(r,a,l.lookup(t),this.sliceFilterEvalTree())}return r}},{key:"lookupTableRowsByLookupValues",value:function(e,t,n){var a=(0,b.lookupValuesToIndexLookup)(e,this.tableSchema);return this.lookupTableRowsByIndexLookup(a,t,n)}},{key:"lookupTableRows",value:function(t,n,a,r){var i=this.rootTable().tableSchema.findAttributeByName(t),o=this.indexedTableRows().lookupAtomic(i,n);if(a&&e.usePendingChangesStore){var l=this.pendingChanges.forTransaction(a),u=l.hasChanges,s=l.createdRows,c=l.indexedRows,d=l.getMergedRows;if(u){var f=s.get(n);return d(o,r,f?[f]:c.lookupAtomic(i,n),this.sliceFilterEvalTree())}}return o}},{key:"keyAttribute",value:function(){return this.tableSchema.keyAttribute()}},{key:"hasUniqueComputedKey",value:function(){return function e(t){return null!=t&&("UNIQUEID"===t.functionName()||"CONCATENATE"===t.functionName()&&s.default.some(t.children,e))}(this.keyAttribute().defaultExpressionEvalTree())}},{key:"name",value:function(){return this.model.Name}},{key:"imageAttrName",value:function(){var e;return this.isSlice()?this.rootTable().imageAttrName():null===(e=this.tableSchema.imageAttributesByImportance()[0])||void 0===e?void 0:e.name()}},{key:"updateModeEvalTree",value:function(){var e;if(void 0===this._updateModeEvalTree){var t=(null!==(e=this.sliceDefinition)&&void 0!==e?e:this.tableDefinition).ExprLookup;(null==t?void 0:t.UpdateMode)?this._updateModeEvalTree=h.default.create(t.UpdateMode):this._updateModeEvalTree=null}return this._updateModeEvalTree}},{key:"allowsUpdate",value:function(e){e=e||this.appModel;var t=(this.updateMode(e)&y.UpdateModeEnum.UPDATES_ONLY)>0;if(t&&this.isSlice()){var n=this.rootTable();n&&(t=n.allowsUpdate(e))}return t}},{key:"allowsAdd",value:function(e){e=e||this.appModel;var t=(this.updateMode(e)&y.UpdateModeEnum.ADDS_ONLY)>0;if(t&&this.isSlice()){var n=this.rootTable();n&&(t=n.allowsAdd(e))}return t}},{key:"allowsDelete",value:function(e){e=e||this.appModel;var t=(this.updateMode(e)&y.UpdateModeEnum.DELETES_ONLY)>0;if(t&&this.isSlice()){var n=this.rootTable();n&&(t=n.allowsDelete(e))}return t}},{key:"_queryCompatibility",value:function(e,t,n){var a=e.valuesOnly,r=void 0===a||a,i=e.doAsync,o=void 0!==i&&i,l=I(e,["valuesOnly","doAsync"]),u=(0,d.stripEmptyItems)(l),c=this._query(u,t,n),f=l.groupBy;if(r||void 0===r){var p=c.map((function(e){return e.values}));if(null!=f){var h=d.default.getGroupByMap(p,f);return o?Promise.resolve(h):h}return o?Promise.resolve(p):p}if(null!=f){var v=s.default.groupBy(c,(function(e){return e.get(f)}));return o?Promise.resolve(v):v}return o?Promise.resolve(c):c}},{key:"_query",value:function(e,t,n){var a,r=e.filterExpr,i=e.filterDefaults,o=e.sortRules,l=e.searchQuery,u=e.transaction,c=I(e,["filterExpr","filterDefaults","sortRules","searchQuery","transaction"]);if(s.default.isEmpty(c))return null==l?(a=this.filteredRows({filterExpr:r,filterDefaults:i,transaction:u},t,n),this.tableSchema.sortTableRows(a,o)):(a=this.queryRows({filterExpr:r,filterDefaults:i,sortRules:o,transaction:u},t,n),this.evaluateSearch(a,l,t));a=this.queryRows({filterExpr:r,filterDefaults:i,sortRules:o,searchQuery:l,transaction:u},t,n);var d=c.limit,f=c.uniqueBy;return f&&(a=s.default.uniqBy(a,(function(e){var t=e.get(f);return(null==t?void 0:t.toString)?t.toString().toLowerCase():t}))),d&&(a=a.slice(0,d)),a}},{key:"evaluateSearch",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.appModel,r=(0,f.default)(t).toLowerCase().trim(),i=this.tableSchema.searchableAttributes().filter((function(e){return"Ref"===e.type()})),o={};i.forEach((function(e){if(!o[e.referencedTableName()]){var t=a.findTableCollection(e.referencedTableName()),n=t.table,r=t.tableSchema;n&&r&&(o[n.name()]=n.keyLabelMap(a))}}));var l=new p.default(a,this.tableSchema),u=performance.now();e=e.filter((function(e){return l.replaceRowData(e.values),n.tableSchema.searchMatchesRow(e.values,r,o,l)}));var s=performance.now()-u;return A.searchTimeMetric.record(s),e}},{key:"onDataChange",value:function(t,n){var a,r=this;this.isSlice()&&this.rootTable().onDataChange(t,n),null!=t&&w.ReactRootUIConfig.isReactRoot()&&!t.find((function(e){return e.rootTableName===r.rootName()}))||(null===(a=this._indexedTableRowsByName)||void 0===a||a.clear(),this.ownTimestamp=(new Date).getTime(),!this.isSlice()&&n&&e.usePendingChangesStore&&this.pendingChanges.forTransaction(n).onDataChange(t)),this.queryMemoized.invalidate()}},{key:"dispose",value:function(){var e;this.isUserSettingsTable||(this.isSlice()||(this._tableRows.length=0,this.model.Rows.length=0),null===(e=this._indexedTableRowsByName)||void 0===e||e.clear(),this.model.Disposed=!0)}}],[{key:"findByName",value:function(e,t,n){return(t=t||T.AppGlobals.AppModel).findTableCollection(e,n)}},{key:"usePendingChangesStore",get:function(){return E.dynamicRollouts.includeByOwnerId("TransactionPendingChanges")&&w.ReactRootUIConfig.isReactRoot()}}]),e}();t.default=D},450513:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(513979)),u=a(n(593186)),s=n(166089);var c=function(){function e(t){var n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.AppGlobals.AppModel;(0,r.default)(this,e);try{var c=(null===(a=null===(n=null==i?void 0:i.AppTemplate)||void 0===n?void 0:n.Presentation)||void 0===a?void 0:a.FormatRules)||[],d=c.filter((function(e){return e.IsValid&&!e.Disabled&&e.TableOrSlice===t})),f=o.default.sortBy(d,(function(e){return e.RuleOrder}));this.rules=f.map((function(e){return new l.default(e)})),this.appModel=i}catch(e){this.rules=[],u.default.warnToDevConsole("error instantiating TableFormatting",e)}}return(0,i.default)(e,[{key:"forColumn",value:function(e,t){var n=this.rules.filter((function(t){return o.default.includes(t.columns(),e)})),a=o.default.every(n,(function(e){return o.default.isNil(e.condition())||e.condition().isPure()}));t&&(n=n.filter((function(e){return o.default.isNil(e.condition())||e.condition().run(t,{noCache:!0})})));var r=function(e){return o.default.reduce(e,(function(e,t){return o.default.extendWith(e,t.settings,(function(n,a,r){var i;return"textSize"===r&&1===a?n:"icon"===r?(a&&(n.unshift(a),e.icons.unshift({name:a,color:null===(i=t.settings)||void 0===i?void 0:i.highlightColor})),n):a||n}))}),{icon:[],icons:[]})}(n);return r.timestamp=this.appModel.dataStampTime(),{rules:r,isPure:a}}},{key:"computeWorstCaseFormatting",value:function(e){var t,n,a,r,i,l,u,s=this,c=e.tableOrSlice,d=e.column;return a=o.default.find(s.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.Name===c})),r=a?a.SourceTable:c,i=o.default.filter(s.appModel.AppTemplate.AppData.TableSlices,(function(e){return e.SourceTable===r})),l=o.default.map(i,(function(e){return e.Name})),u=o.default.filter(s.rules,(function(e){return e.data.TableOrSlice===r||o.default.includes(l,e.data.TableOrSlice)})),t=o.default.filter(u,(function(e){return d?o.default.includes(e.data.ColumnsToFormat,d):0===e.data.ColumnsToFormat.length})),n={},o.default.reduce(t,(function(e,t){var a=!1,r=t.equivalentKey();return r&&(n[r]&&(a=!0),n[r]=t),o.default.extendWith(e,t.settings,(function(n,r,i){var o;return"icon"===i?(a||r&&(n.unshift(r),e.icons.unshift({name:r,color:null===(o=t.settings)||void 0===o?void 0:o.highlightColor})),n):"textSize"===i&&null!=n?Math.max(parseFloat(n),parseFloat(r)):r||n}))}),{icon:[],icons:[]})}}]),e}();t.default=c},389549:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TableRow=void 0;var r=a(n(600861)),i=a(n(627424)),o=a(n(856690)),l=a(n(689728)),u=a(n(496486)),s=a(n(593186)),c=a(n(385857)),d=a(n(494012)),f=n(44617),p=n(557310),h=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},v=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=a.stableId;(0,o.default)(this,e);var i=n.tableSchema,l=n.appModel;this.appModel=l,this.table=n,this.tableSchema=i,this.formatting={},this._stableId=r,this._rowStateMap=new Map,this.values=t,this.keyAttribute=i.keyAttribute(),null===r&&(this._keyValue=t[this.keyAttribute.name()])}return(0,l.default)(e,[{key:"refresh",value:function(){this._rowStateMap.forEach((function(e){return e.refreshState()})),this.rowState.refreshState(),this.rowTimestamp=(new Date).getTime(),this.formatting={}}},{key:"snapshot",value:function(){return u.default.cloneDeep(this.values)}},{key:"copy",value:function(){return new e(this.snapshot(),this.table,{stableId:this._stableId})}},{key:"tableName",get:function(){return this.table.rootName()}},{key:"rowId",get:function(){return this.keyValue}},{key:"keyValue",get:function(){return null!=this._keyValue?this._keyValue:this.values[this.keyAttribute.name()]}},{key:"labelValue",get:function(){return this.table.labelTextForId(this.rowId)}},{key:"labelAttribute",get:function(){return this.tableSchema.labelBasicAttribute()}},{key:"stableId",get:function(){return this._stableId||this.keyValue}},{key:"timestamp",get:function(){return u.default.max([this.rowTimestamp||this.table.timestamp(this.appModel)||this.appModel.dataStampTime()])}},{key:"dataContext",get:function(){return null==this._dataContext&&(this._dataContext=new c.default(this.appModel,this.tableSchema,this.values)),this._dataContext}},{key:"rowState",get:function(){if(null==this._rowState){var e=this._stableId?null:this.keyValue;this._rowState=new d.default(this.appModel,this.table,this.dataContext,e,this.tableSchema.allBaseTableAttributes(),{stableId:this._stableId})}return this._rowState}},{key:"getReferencedRows",value:function(e){var t=this;return u.default.compact(this.tableSchema.findBaseTableAttributesByType("Ref").map((function(n){var a=t.get(n.name());if(null!=a&&""!==a){var r=t.appModel.findTableCollection(n.referencedTableName()).rootTable;if(r)return r.lookupTableRow(a,e)}return null})))}},{key:"get",value:function(e){return this.values[e]}},{key:"getRowState",value:function(e){var t=e.paging,n=t.rowStateColumnNames.toString(),a=this._rowStateMap.get(n);if(null==a){var r=this._stableId?null:this.keyValue;a=new d.default(this.appModel,this.table,this.dataContext,r,t.attributes,{paging:t,stableId:this._stableId}),this._rowStateMap.set(n,a)}return a}},{key:"getColumnFormatting",value:function(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.formatting,l=this.table,u={icon:[],icons:[]},s=o[e]||Object.assign({},u),c=Object.assign({},u),d=this.tableSchema.findAttributeByName(e);if(a){var p=null==d?void 0:d.derefRow(this.values[e]);c=(null==p?void 0:p.getColumnFormatting((null===(t=null==p?void 0:p.labelAttribute)||void 0===t?void 0:t.name())||""))||c}var h=o[e];if(!(null==h?void 0:h.timestamp)||h.timestamp<(null===(n=this.appModel)||void 0===n?void 0:n.dataStampTime())){var v=this.dataContext,m=l.formatting.forColumn(e,v),g=m.rules,y=m.isPure;y&&(o[e]=g),s=g}var b=Object.assign({},s);return a&&f.dynamicRollouts.includeByOwnerId("UseRecursiveFormattingRule")&&Object.entries(c).forEach((function(e){if(e){var t=(0,i.default)(e,2),n=t[0],a=t[1];if("boolean"==typeof a)b[n]=s[n]||a;else if(Array.isArray(a)){var o=n;b[o]=[].concat((0,r.default)(s[o]||[]),(0,r.default)(a))}else b[n]=a}})),b}},{key:"isNewRow",value:function(){return null!=this._stableId}},{key:"commitRowId",value:function(){delete this._stableId,delete this._rowState,this._rowStateMap.clear(),this._keyValue=this.values[this.keyAttribute.name()]}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enforceStableKey,n=e.usedTransactions,a=e.transaction,r=e.paging,i=arguments.length>1?arguments[1]:void 0,o=p.ReactRootUIConfig.isReactRoot()&&r?this.getRowState({paging:r}):this.rowState;return o.validateSave({enforceStableKey:t,usedTransactions:n,transaction:a,viewStateKey:i}).errorState}},{key:"recompute",value:function(e){var t=e.userEdited,n=e.transaction,a=e.wasReset,r=void 0===a?{}:a,i=e.noAsync,o=void 0===i||i,l=h(e,["userEdited","transaction","wasReset","noAsync"]);if(f.dynamicRollouts.includeByOwnerId("TransactionRecomputeInfluenced"))return this.dataContext.augmentWithTransaction(n).recomputeDynamicValues(Object.assign(Object.assign({},l),{wasReset:r,noAsync:o,computeDefaults:this.isNewRow(),skipTheseDefaults:t})),this.refresh(),r;var u=l.initialData,s=l.virtualOnly;return this.dataContext.augmentWithTransaction(n).recomputeAppFormulas({initialData:u,virtualOnly:s,wasReset:r,noAsync:!0,skipTheseDefaults:t}),this.refresh(),r}},{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.userEdited,r=n.initialData,i=n.noAsync,o=n.getAsyncCallback,l=n.wasReset,c=void 0===l?{}:l,d=n.updateInfluenced,f=void 0===d||d,p=n.transaction,h=arguments.length>3?arguments[3]:void 0,v=!this.isNewRow(),m=this.snapshot(),g=this.keyValue,b=this.tableSchema;if(this.values[e.name()]=t,this.table.onDataChange(),f){var T=this.isNewRow(),S=b.changeTriggeredAttributes().map((function(e){return e.name()})),A=u.default.extend(u.default.keyBy(S),a);y(e,b,this.dataContext.augmentWithTransaction(p),this.rowState,{initialData:r,noAsync:i,getAsyncCallback:o,computeDefaults:T,skipTheseDefaults:A,wasReset:c},void 0,h),this.table.onDataChange()}return v&&this.keyValue!==g?(s.default.errorToDevConsole("an update attempted to change the key of an existing row"),u.default.extend(this.values,m),c):(this.refresh(),c)}},{key:"resetValues",value:function(e){u.default.extend(this.values,e),this.refresh(),this.table.onDataChange()}},{key:"invalidate",value:function(){this.refresh()}},{key:"onDataChange",value:function(e,t,n){this!==e&&(this.rowState.onDataChange(e),t&&n&&this.tableSchema.virtualAttributes().filter((function(t){return u.default.includes(t.appFormulaEvalTree().tablesReferenced(),e.tableName)})).length&&t.recompute(this.tableName,this.stableId,{virtualOnly:!0,triggeredBy:n.id}))}}]),e}();t.TableRow=v;var m=v;t.default=m;var g=!1;function y(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6?arguments[6]:void 0;if(g){if(i>0)return;g=!1}var l=new Date,s={},c={},d={},f=u.default.extend({skipLeafAttrs:!0,considered:s,computed:c,wasReset:d,nowDate:l},r);e.isKey()&&n.resolveParentRefs(),n.recomputeInfluencedAttributes(e,f),b(e,t,n,a,r,i,o)}function b(e,t,n,a,r){for(var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6?arguments[6]:void 0,c=t.influencedValidityEnums(e),d={},p=[],h=e.inFullDependentChain(c),v=f.dynamicRollouts.includeByOwnerId("TransactionRecomputeInfluenced"),m=0;m<c.length;m++){var b=c[m],T=n.getValue(b),S=a.validOptions(b,l)||[],A=v&&b.hasAppFormula(),E=b===e||A||h&&0===m&&(0===o&&S.length||o>0&&""===T);if(E)i=T;else{if(h&&m>0&&(null==i||""===i))S=[];else{var w=b.validIfEvalTree(),C=w.getInConditionListInformation(n),O=C.values,_=C.elementAttribute;S=_.valuesToWireFormat(O)}d[b.name()]=S;var k=Array.isArray(T)?T:[T];"EnumList"===b.type()&&(k=b.splitEnumListValue(T,S));for(var R=!0,I=0;I<k.length;I++){var N=k[I];if(""!==N&&null!=N&&!u.default.includes(S,N)){R=!1;break}}null==S||R||""===n.getValue(b)||(T="",n.setValue(b.name(),T),p.push({attr:b})),i=T}}return p.forEach((function(i){var u=i.attr;if(e.name()!==u.name())if(o<20)y(u,t,n,a,r,o+1,l);else if(!g){g=!0;var c="Possible infinite loop in handleEntryValueChanged";s.default.ReportErrorOnce({errorMessage:c}),s.default.warnToDevConsole(c)}})),d}},654158:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TableRowIndex=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(87786)),l=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;(0,r.default)(this,e),this.tableRows=n,this.indexAttribute=a,this.store=i,this.tableRows=n,this.indexAttribute=a,n.forEach((function(e){var n=e.get(a.name());t.lookup(n).push(e)}))}return(0,i.default)(e,[{key:"distinctValues",value:function(){return Array.from(this.store.keys())}},{key:"lookup",value:function(e){var t=this.indexAttribute.getNormalizedLookupValue(e),n=this.store.get(t);return null==n&&(n=new o.default,this.store.set(t,n)),n}}]),e}();t.TableRowIndex=l;var u=l;t.default=u},192137:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(856690)),o=a(n(689728)),l=a(n(496486)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(150198)),s=a(n(888861)),c=a(n(385857)),d=n(976661),f=n(365914),p=a(n(498967)),h=n(306593),v=a(n(593186)),m=a(n(674823)),g=n(351101),y=n(166089),b=n(251347),T=n(557310);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var w="**all other columns**",C=function(){function e(t,n){var a,r,o=this;(0,i.default)(this,e),t instanceof e&&v.default.warnToDevConsole("TableSchema was double-instantiated"),this.model=t,this.sliceDefinition=n,this._cacheStore={};var s=null!==(r=null===(a=this.model)||void 0===a?void 0:a.Attributes.map((function(e){return new u.default(e)})))&&void 0!==r?r:[];this._allBaseTableAttributeIndexesByName={},this._allBaseTableAttributeIndexesByLowercasedName={},s.forEach((function(e,t){o._allBaseTableAttributeIndexesByName[e.name()]=t,e.name()&&(o._allBaseTableAttributeIndexesByLowercasedName[e.name().toLowerCase()]=t)})),this._allBaseTableAttributes=s,this._allAttributes=this.sliceDefinition?n.Columns.map((function(e){return s[o._allBaseTableAttributeIndexesByName[e]]||s[o._allBaseTableAttributeIndexesByLowercasedName[e?e.toLowerCase():e]]})):s,this._allAttributes=this._allAttributes.filter((function(e){return e})),this._nonCosmeticAttributes=this._allAttributes.filter((function(e){return!e.isShowType()})),this.paging=new h.Paging(this._allAttributes),this._allAttributesByName=l.default.keyBy(this._allAttributes,(function(e){return e.name()})),this._allAttributesLowercased=l.default.keyBy(this._allAttributes,(function(e){var t;return null===(t=e.name())||void 0===t?void 0:t.toLowerCase()}));var c=this._allAttributes.filter((function(e){return e.isValid()})).filter((function(e){return!!e.isVirtual()||!e.isSys()}));this._attributes=c}return(0,o.default)(e,[{key:"_cache",value:function(e,t){return this._cacheStore.hasOwnProperty(e)||(this._cacheStore[e]=t()),this._cacheStore[e]}},{key:"name",value:function(){return this.sliceDefinition?this.sliceDefinition.Name:this.model.Name}},{key:"isSlice",value:function(){return!!this.sliceDefinition}},{key:"tableOrSliceName",value:function(){return this.isSlice()?this.sliceDefinition.Name:this.model.AutoSchemaFrom}},{key:"sourceTableName",value:function(){return this.isSlice()?this.sliceDefinition.SourceTable:this.model.AutoSchemaFrom}},{key:"allAttributes",value:function(){return this._allAttributes}},{key:"virtualAttributes",value:function(){return this._allBaseTableAttributes.filter((function(e){return e.isVirtual()}))}},{key:"nonCosmeticAttributes",value:function(){return this._nonCosmeticAttributes}},{key:"allBaseTableAttributes",value:function(){return this._allBaseTableAttributes}},{key:"allAttributesExcept",value:function(e){return this.allAttributes().filter((function(t){return-1===e.indexOf(t.name())}))}},{key:"formItemNumber",value:function(e){return l.default.indexOf(this._nonCosmeticAttributes.map((function(e){return e.name()})),e)}},{key:"visibleAttributes",value:function(){var e=this;return this._cache("visibleAttributes",(function(){return e._attributes.filter((function(e){return!e.isHidden()}))}))}},{key:"visibleAttributesWithoutShowTypes",value:function(){var e=this;return this._cache("visibleAttributesWithoutShowTypes",(function(){return e._attributes.filter((function(e){return!e.isHidden()&&!e.isShowType()}))}))}},{key:"visibleAttributesWithoutPageHeaders",value:function(){var e=this;return this._cache("visibleAttributesWithoutPageHeaders",(function(){return e._attributes.filter((function(e){return!e.isHidden()&&!e.isPageHeader()}))}))}},{key:"visibleAttributesExcept",value:function(e){return this.visibleAttributesWithoutShowTypes().filter((function(t){return-1===e.indexOf(t.name())}))}},{key:"refAttributesToTable",value:function(e){var t=function(t){return t.referencedTableName()===e};return T.ReactRootUIConfig.isReactRoot()?this.allAttributes().filter(t):this.findAttributesByType("Ref",{includeHidden:!0}).filter(t)}},{key:"recurseReferencedRowToTable",value:function(e,t,n,a,r){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};n=n||y.AppGlobals.AppModel;var l=this.findAttributesByType("Ref",{includeHidden:!0});return(null==l?void 0:l.length)&&null!==(i=l.map((function(i){var l,u=i.referencedTableName(),s=null===(l=e.lookupTableRow(a,r))||void 0===l?void 0:l.values;if(s){var c=s[i.name()];if(null!=c){if(u===t)return c;var d=n.findTableCollection(u),f=d.table,p=d.tableSchema;if(f&&p&&!o[f.name()])return o[f.name()]=!0,p.recurseReferencedRowToTable(f,t,n,c,r,o)}}return null})).find((function(e){return null!=e})))&&void 0!==i?i:null}},{key:"sheetFormulaAttributes",value:function(){return this._allBaseTableAttributes.filter((function(e){return e.hasFormula()}))}},{key:"changeTriggeredAttributes",value:function(){var e=this;return this._cache("changeTriggeredAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.isChangeTriggered()}))}))}},{key:"dynamicAttributes",value:function(){var e=this;return this._cache("dynamicAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.isDynamic()}))}))}},{key:"virtualAttributesThatDependOn",value:function(e){return this.virtualAttributes().filter((function(t){return t.appFormulaEvalTree().tablesReferenced().includes(e)}))}},{key:"dynamicAttributesThatDependOn",value:function(e,t){return this.dynamicAttributes().filter((function(n){return n.valueDependsOn(e,t)}))}},{key:"columnDependencies",value:function(e){var t=this;return this._cache(e.name()+"ColumnDependencies",(function(){var n=t.dynamicDependencies(e),a=t.findAttributesByIndices(l.default.union(e.showIfColumnsReferenced(),e.validIfColumnsReferenced(),e.requiredIfColumnsReferenced(),e.editableIfColumnsReferenced(),e.showContentColumnsReferenced(),e.suggestedValuesColumnsReferenced(),e.displayNameColumnsReferenced())),r=t.paging,i=r.pageHeader(r.onPage(e.name()));i&&i!==e&&i.showIfEvalTree()&&(a=l.default.union(a,t.columnDependencies(i)));var o=[];return a.forEach((function(e){o=l.default.union(o,t.dynamicDependencies(e))})),l.default.union(o,n,a)}))}},{key:"dynamicDependencies",value:function(e){return this._cache(e.name()+"DynamicDependencies",this._dynamicDependencyRecursor.bind(this,e))}},{key:"_dynamicDependencyRecursor",value:function(t,n){n=n||{};var a=this.findAttributesByIndices(t.appFormulaColumnsReferenced()),r=this.findAttributesByIndices(t.defaultExpressionColumnsReferenced()),i=this.findAttributesByIndices(t.resetColumnsReferenced()),o=t.changeColumns();o=null!=o?0===o.length?this._allBaseTableAttributes.filter((function(e){return!e.isChangeTriggered()})):this._allBaseTableAttributes.filter((function(e){return l.default.includes(o,e.name())})):[];var u=l.default.union(a,r,i,o);n[t.name()]=!0;var s=[];return u=u.filter(function(a){if(!(a.name()in n)){var r=this._dynamicDependencyRecursor(a,n);if(t.isChangeTriggered()&&l.default.indexOf(e.attributeNames(r),t.name())>=0)return!1;s=l.default.union(s,r)}return!0}.bind(this)),l.default.union(s,u)}},{key:"influencedAttributes",value:function(t){var n=this;return this._cache(t.name()+"InfluencedAttributes",(function(){return n._allBaseTableAttributes.filter(function(n){var a=this.columnDependencies(n);return e.attributeNames(a).indexOf(t.name())>=0}.bind(n))}))}},{key:"influencedDynamicAttributes",value:function(t){var n=this;return this._cache(t.name()+"InfluencedDynamicAttributes",(function(){return n.dynamicAttributes().filter(function(n){var a=this.dynamicDependencies(n);return e.attributeNames(a).indexOf(t.name())>=0}.bind(n))}))}},{key:"influencedValidityEnums",value:function(t){var n=this;return this._cache(t.name()+"InfluencedValidityEnums",(function(){return n._allBaseTableAttributes.filter(function(n){if(!n.isValidityEnum())return!1;var a=this.columnDependencies(n);return e.attributeNames(a).indexOf(t.name())>=0}.bind(n)).sort((function(e,t){return e.validIfColumnsReferenced().length<t.validIfColumnsReferenced().length?-1:e.validIfColumnsReferenced().length>t.validIfColumnsReferenced().length?1:0}))}))}},{key:"findAttributesByNames",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.includeHidden,r=void 0!==a&&a,i=[];return e.forEach((function(n){if(n===w){var a=r?t.allAttributesExcept(e):t.visibleAttributesExcept(e);i=i.concat(a)}else{var o=t.findAttributeByName(n);o?i.push(o):v.default.warnToDevConsole("Could not find attribute",n,"requested in columnOrder",e,t)}})),i}},{key:"findAttributesByIndices",value:function(e){var t=this,n=[];return e.length&&(n=e.map((function(e){return t._allBaseTableAttributes[e]}))),n}},{key:"keyAttribute",value:function(){var e=this;return this._cache("keyAttribute",(function(){return e._allAttributes.find((function(e){return e.isKey()}))||e._allAttributes[0]}))}},{key:"keyAttributes",value:function(){var e=this;return this._cache("keyAttributes",(function(){var t=e.keyAttribute();return e.hasCompoundKey()?t.appFormulaColumnsReferenced().map((function(t){return e._allBaseTableAttributes[t]})).filter((function(e,t,n){return n.indexOf(e)===t})):[t]}))}},{key:"isKeyComponent",value:function(e){var t=this.keyAttributes().map((function(e){return e.name()}));return this.hasCompoundKey()&&l.default.includes(t,e.name())}},{key:"hasCompoundKey",value:function(){return this.keyAttribute().isVirtual()}},{key:"labelAttributes",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._cache("labelAttributes",(function(){var n=e._attributes.filter((function(e){return e.isLabel()}));if(t&&!n.length){var a=e.basicAttributesByImportance()[0],r=e.presentableImageAttributesByImportance()[0];n=[],a&&n.push(a),r&&n.push(r)}return l.default.sortBy(n,(function(e){return e.isImageType()?1:2}))}))}},{key:"labelImageAttribute",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._cache("labelImageAttribute",(function(){var n=e._attributes.filter((function(e){return e.isLabel()&&e.isImageType()}));return n.length?n[0]:t?e.presentableImageAttributesByImportance()[0]:null}))}},{key:"labelBasicAttribute",value:function(){var e=this;return this._cache("labelBasicAttributes",(function(){var t=e._allBaseTableAttributes.filter((function(e){return e.isLabel()&&!e.isImageType()}));return t.length?t[0]:e.basicAttributesByImportance().length?e.basicAttributesByImportance()[0]:null}))}},{key:"searchableAttributes",value:function(){var e=this;return this._cache("searchableAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.model.IsValid&&e.model.Searchable}))}))}},{key:"scannableAttributes",value:function(){var e=this;return this._cache("scannableAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.model.IsValid&&e.model.IsScannable}))}))}},{key:"nfcScannableAttributes",value:function(){var e=this;return this._cache("nfcScannableAttributes",(function(){return e._allBaseTableAttributes.filter((function(e){return e.model.IsValid&&e.model.IsNfcScannable}))}))}},{key:"summaryFormulaAttributesByImportance",value:function(){var e=this;return this._cache("summaryFormulaAttributesByImportance",(function(){return e.visibleAttributesWithoutShowTypes().filter((function(e){return e.hasFormula()&&e.isNumericType()})).reverse()}))}},{key:"imageAttributesByImportance",value:function(){var e=this;return this._cache("imageAttributesByImportance",(function(){var t=e.visibleAttributesWithoutShowTypes().filter((function(e){return e.isImageType()})),n=l.default.sortBy(t,(function(e){return e.isRequired()?1:2}));return l.default.sortBy(n,(function(e){return e.isLabel()?1:2}))}))}},{key:"presentableImageAttributesByImportance",value:function(){var e=this;return this._cache("presentableImageAttributesByImportance",(function(){return e.imageAttributesByImportance().filter((function(e){return e.isPresentableImageType()}))}))}},{key:"basicAttributesByImportance",value:function(){var e=this;return this._cache("basicAttributesByImportance",(function(){var t=e.basicTypeAttributes(),n=l.default.sortBy(t,(function(e){return e.isRequired()?1:2})),a=l.default.sortBy(n,(function(e){return e.isKey()?1:2})),r=l.default.sortBy(a,(function(e){return"Name"===e.type()?1:2})),i=l.default.sortBy(r,(function(e){return"Name"===e.type()&&e.isVirtual()?1:2}));return l.default.sortBy(i,(function(e){return e.isLabel()?1:2}))}))}},{key:"basicTypeAttributes",value:function(){var e=this;return this._cache("basicTypeAttributes",(function(){return e.visibleAttributesWithoutShowTypes().filter((function(e){return e.isBasicType()}))}))}},{key:"actionTypeAttributes",value:function(){var t=this;return this._cache("actionTypeAttributes",(function(){var n=t.visibleAttributesWithoutShowTypes().filter((function(e){return e.isActionType()}));return e.reduceAttributesToUniqueTypes(n)}))}},{key:"rowNumberAttribute",value:function(){return this.findAttributeByName("_RowNumber")}},{key:"findBaseTableAttributeByName",value:function(e){return this._allBaseTableAttributes[this.findAttributeIndex(e)]}},{key:"findAttributeByName",value:function(e){return this._allAttributesByName[e]||this._allAttributesLowercased[e?e.toLowerCase():e]}},{key:"findAttributeIndex",value:function(e){return this._allBaseTableAttributeIndexesByName[e]||this._allBaseTableAttributeIndexesByLowercasedName[e?e.toLowerCase():e]}},{key:"findBaseTableAttributesByType",value:function(e){return this._allBaseTableAttributes.filter((function(t){return t.type()===e}))}},{key:"findAttributesByType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.includeHidden,a=void 0!==n&&n,r=a?this.allAttributes():this.visibleAttributesWithoutShowTypes();return r.filter((function(t){return t.type()===e}))}},{key:"isInSlice",value:function(e){return null!=this.findAttributeByName(e)}},{key:"getDefaultValues",value:function(e){var t=this,n={};return l.default.isObject(e)?(l.default.keys(e).forEach((function(a){var r=t.findAttributeByName(a);n[r?r.name():a]=e[a]})),n):{}}},{key:"uniqueColumnValues",value:function(e,t){var n=this.findAttributeByName(e);if(!n)return v.default.warnToDevConsole("Could not find column named",e),[];if(!t)return[];var a=[];return t.forEach((function(t){var r=t[e];if("EnumList"===n.type()){var i=n.getValues(r);a=a.concat(i)}else a.push(r)})),l.default.uniq(a.filter((function(e){return!!e})))}},{key:"isAppLauncherSchema",value:function(){var e,t=this.visibleAttributesWithoutShowTypes().length<=3,n=this.findAttributesByType("App").length>0,a=this.presentableImageAttributesByImportance().length>0,r=!!((null===(e=y.AppGlobals.AppModel)||void 0===e?void 0:e.AppTemplate)&&["AppGallery-245842-3-176618-10305","AppGallery-10305","AppGalleryDev-10305"].indexOf(y.AppGlobals.AppModel.AppTemplate.Name)>=0);return t&&n&&a||r}},{key:"isUrlLauncherSchema",value:function(){var e=this.visibleAttributesWithoutShowTypes().length<=3,t=this.findAttributesByType("Url").length>0,n=this.presentableImageAttributesByImportance().length>0;return e&&t&&n}},{key:"isPhotogenic",value:function(){var e=this.presentableImageAttributesByImportance().length>0,t=this.basicTypeAttributes().length>0;return e&&t}},{key:"rowComparer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.valuesOnly,a=void 0===n||n,r=this.augmentSortRules(e),i=r.augmentedSortRules,o=r.additionalComparerArguments;return(0,d.makeObjectComparer)(i,o,{valuesOnly:a})}},{key:"augmentSortRules",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.inRollout,r=void 0!==a&&a,i=[],o={};t.forEach((function(t){var n=e.findAttributeByName(t.Column);if(n){for(var a,s,c=n,d={},f=(0,g.getAppModel)();null!=c.firstNestedRef()&&f;){var h=f.findTableCollection(c.referencedTableName()),m=h.table,y=h.rootTableSchema;if(!m||!y)break;var b=y.labelBasicAttribute();if(!b)break;var T="".concat(m.rootName(),"|").concat(b.name());if(d[T]){s=p.default.genericComparer,o[c.name()]={labelComparer:s};break}a?function(){var e=m.keyLabelMap();a=l.default.mapValues(a,(function(t){return e[t]}))}():a=m.keyLabelMap(),s=b.valueComparer(u.ValueFormat.Wire),o[n.name()]={keyLabelMap:a,labelComparer:s},c=b,d[T]=!0}var S=l.default.extend({},t,{Comparer:r&&s||n.valueComparer(u.ValueFormat.Wire)});i.push(S)}else v.default.warnToDevConsole("Sort attribute",t.Column,"was not found in table schema",e)}));var s=this.rowNumberAttribute();return s&&i.push({Column:s.name(),Order:"Ascending",Comparer:s.valueComparer(u.ValueFormat.Wire)}),{augmentedSortRules:i,additionalComparerArguments:o}}},{key:"sortTableRows",value:function(e,t){var n=this.augmentSortRules(t,{inRollout:!0}),a=n.augmentedSortRules,r=n.additionalComparerArguments,i=e.map((function(e){var t,n,i=[e],o=A(a);try{for(o.s();!(n=o.n()).done;){var l=n.value,u=l.Column,s=l.Comparer,c=e.get(u),d=null===(t=r[u])||void 0===t?void 0:t.keyLabelMap;if(null!=d){var h=d[c];null!=h&&(c=h)}s!==p.default.textComparer&&"string"==typeof c||(c=(0,f.toNormalizedString)(c)),i.push(c)}}catch(e){o.e(e)}finally{o.f()}return i})),o=(0,d.makeSortRulesComparer)(a,{sortBy:function(e,t){return e[t+1]}});return p.default.sort(i,o),i.map((function(e){return e[0]}))}},{key:"searchMatchesRow",value:function(e,t,n,a){if(!t)return!0;if(null==e)return!1;var r=b.dynamicRollouts.includeByOwnerId("UseDateLocaleInAppSearch");n=n||{};for(var i=this.searchableAttributes(),o=0;o<i.length;o++){var l=i[o],u=e[l.name()];if(null!=u&&"function"==typeof u.toLowerCase){var s=l.type();if(r){var c=u;if(u=l.localizeWireValue(c,{dataContext:a}),null!=l.firstNestedRef())u="".concat(c,"|").concat(u);else if("Decimal"===s||"Number"===s||"Price"===s){var d=l.localizeWireValue(c,{dataContext:a,suppressGrouping:!0});u="".concat(d,"|").concat(u)}}else if("Ref"===s){var f=l.referencedTableName(),p=f&&n[f];p&&(u="".concat(u,"|").concat(p[u]))}else if("Yes/No"===s){var h=l.booleanTypeLabels(a),v=h.yesLabel,g=h.noLabel;u="Y"===u?v:g}if((0,m.default)(u).toLowerCase().indexOf(t)>=0)return!0}}return!1}},{key:"computeAggregate",value:function(e){var t=e.aggregationFunction,n=e.targetColumnName,a=e.rows,r=e.tableName,i=e.appModel;if("COUNT"===t)return a.length;var o=this.findAttributeByName(n);if(!o)return null;var d=this.findAttributeIndex(n),f=new c.default(i,this);f.getTableRows=function(){return a},f.getTableRow=function(e,t){var n=this.keyAttribute().name();return l.default.find(a,(function(e){return e[n]===t}))};var p,h={ResultType:"List",ResultTypeQualifier:{ElementType:o.type(),ElementTypeQualifier:o.auxDataString()},EvalType:"COLUMNSET",ColIndex:d,ColName:o.name(),TableName:r},m={ResultType:o.type(),ResultTypeQualifier:o.auxData(),EvalType:"FUNCTION",FunctionName:t,Children:[h]},g=s.default.create(m).run(f);switch(t){case"MIN":case"MAX":case"SUM":p=o;break;default:p=o.decimalDigits()?o:u.default.fromTypeData(t,"Decimal",'{ "DecimalDigits": 2 }')}try{g=p.coerceValue(g)}catch(e){v.default.warnToDevConsole("error coercing value in computeAggregate",g,p)}return g}}],[{key:"reduceAttributesToUniqueTypes",value:function(e){return l.default.uniqBy(e,(function(e){return"LatLong"===e.type()||"Address"===e.type()?"GenericAddressType":e.type()}))}},{key:"attributeNames",value:function(e){return e.map((function(e){return e.name()}))}}]),e}();t.default=C},282615:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.viewNameIconMap=t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(888861)),l=a(n(385857)),u=a(n(593186)),s=a(n(743537)),c=n(306593),d=n(166089),f=n(557310);t.viewNameIconMap={calendar:"date_range",dashboard:"view_quilt",deck:"ballot",table:"view_list",gallery:"border_all",detail:"category",map:"location_on",chart:"insert_chart_outlined",form:"view_stream",onboarding:"view_carousel",card:"insert_photo",iframe:"web_asset"};var p=function(){function e(t){(0,r.default)(this,e),this._appControl=t,this._evalTreeLookup={},this._cacheStore={}}return(0,i.default)(e,[{key:"_cache",value:function(e,t){return this._cacheStore.hasOwnProperty(e)||(this._cacheStore[e]=t()),this._cacheStore[e]}},{key:"name",value:function(){return this._appControl.Name}},{key:"control",value:function(){return this._appControl}},{key:"table",value:function(){return"dashboard"===this.viewType()?null:this._appControl.TableOrFolderName}},{key:"viewType",value:function(){return this._appControl.Action}},{key:"columnOrder",get:function(){return this.definition().ColumnOrder}},{key:"paging",get:function(){var e=this.columnOrder,t=d.AppGlobals.AppModel.findTableCollection(this.table()).tableSchema;return null!=t&&null!=e&&e.length>0&&("form"===this.viewType()||f.ReactRootUIConfig.isReactRoot())?this._cache("paging",(function(){return new c.Paging(t.findAttributesByNames(e,{includeHidden:!0}))})):null==t?void 0:t.paging}},{key:"createdBy",value:function(){return this._appControl.CreatedBy}},{key:"isSystemView",value:function(){return"System"===this.createdBy()}},{key:"isFullScreen",value:function(){return"onboarding"===this.viewType()}},{key:"position",value:function(){return this._appControl.Position}},{key:"rowKey",value:function(e){if(this._rowKey&&this._rowKey.timestamp===e.DataStamp)return this._rowKey.value;var t=this.definition().RowKey,n=this.evalTreeLookup("ROW_KEY");return n&&(t=n.run(e.dataContext()),n.isPure()&&(this._rowKey={timestamp:e.DataStamp,value:t})),t}},{key:"definition",value:function(){var e=this;return this._cache("definition",(function(){var t=e.control();if(!t)return{};if(t.ViewDefinition)return t.ViewDefinition;try{return JSON.parse(t.Settings)}catch(e){return{}}}))}},{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this._appControl.ExprLookup||{};try{t[e]&&(this._evalTreeLookup[e]=o.default.create(t[e]))}catch(t){u.default.warnToDevConsole("Failed to create ExprEvalTree for "+e)}}return this._evalTreeLookup[e]}},{key:"hasDisplayName",value:function(){return!!this.evalTreeLookup("DisplayName")}},{key:"displayName",value:function(e,t,n,a){var r=this.evalTreeLookup("DisplayName");if(r){var i=r.run(new l.default(e,t,n,void 0,void 0,void 0,a));return i?String(i):this.name()}return this.name()}},{key:"events",value:function(){var e=this;return this._cache("events",(function(){return(e.definition().Events||[]).map((function(t){return new s.default(t,e)})).filter((function(e){return!!e.actionName()}))}))}},{key:"getEventByType",value:function(e){return this.events().filter((function(t){return t.type()===e.name}))[0]}},{key:"shouldBeShown",value:function(e){var t=this.evalTreeLookup("ShowIf");return!t||!!t.run(e?e.dataContext():new l.default(d.AppGlobals.AppModel))}}],[{key:"createFromControl",value:function(t){return new e(t)}}]),e}();t.default=p},351101:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayMode=void 0,t.checkTemplateMatchesAppState=Ne,t.default=void 0,t.getAppModel=ke,t.mapActionName=Re,t.setTestAppModel=void 0;var i=a(n(364687)),o=a(n(600861)),l=a(n(918698)),u=a(n(627424)),s=a(n(856690)),c=a(n(689728)),d=a(n(496486)),f=a(n(297636)),p=a(n(734155)),h=a(n(294184)),v=a(n(730381)),m=a(n(571524)),g=a(n(143249)),y=a(n(112368)),b=ge(n(593186)),T=a(n(315847)),S=n(852468),A=a(n(152200)),E=n(685650),w=a(n(190644)),C=n(46239),O=ge(n(21870)),_=n(365914),k=n(75212),R=n(318926),I=n(218546),N=n(431335),M=n(881219),D=n(646317),L=n(422339),P=n(249633),G=n(629503),x=n(354632),F=n(249825),V=ge(n(895466)),U=a(n(429815)),B=a(n(962553)),H=a(n(192137)),W=a(n(150198)),j=a(n(385857)),Y=a(n(888861)),q=a(n(513954)),K=a(n(700482)),z=a(n(688291)),J=a(n(27401)),Q=a(n(710229)),X=n(714067),Z=n(263198),ee=n(796326),te=n(946094),ne=n(804758),ae=n(161171),re=n(557310),ie=n(515128),oe=n(764685),le=n(892148),ue=n(166089),se=n(149313),ce=n(737351),de=n(235049),fe=n(44617),pe=n(609464),he=n(50295),ve=n(161822);function me(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(me=function(e){return e?n:t})(e)}function ge(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=me(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}function ye(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return be(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Te,Se=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))};t.DisplayMode=Te,function(e){e.Automatic="Automatic",e.Centered="Centered",e.NoHeadings="No Headings",e.Normal="Normal",e.SideBySide="Side-by-side"}(Te||(t.DisplayMode=Te={}));var Ae,Ee,we=function(e){return"errorMessage"in e&&!!e.errorMessage},Ce=function(e){if((0,ee.isSuccessResponse)(e)){var t=e.response,n=null==t?void 0:t.Template,a=null==n?void 0:n.Behavior.UsageScopes,r=(null==n?void 0:n.Behavior.RequireUserConsent)&&a&&a!==t.UserConsentedScopes;return(null==t?void 0:t.GeolocationRequired)&&(!n||!r)}return!1},Oe=function(){function e(t,n){(0,s.default)(this,e),this.data=t,this.columns=n}return(0,c.default)(e,[{key:"toRowValues",value:function(){var e=this;return this.data.map((function(t){return d.default.zipObject(e.columns,t)}))}}],[{key:"fromJSON",value:function(t){try{var n=JSON.parse(t);return new e(n.data,n.columns)}catch(t){return b.default.ReportErrorOnce({errorMessage:"Error parsing json",error:t}),new e([],[])}}}]),e}(),_e=function(e){Ee!==ue.AppGlobals.AppModel&&b.default.ReportError({errorMessage:"setCurrentAppModel _currentAppModel !== AppGlobals.AppModel",currentDefined:null!=Ee,windowDefined:null!=ue.AppGlobals.AppModel});var t=Ee;Ee=e,window.AppModel=Ee,e&&e===t?b.default.ReportError({errorMessage:"setCurrentAppModel newAppModel === oldAppModel"}):(e&&(null==t?void 0:t.pendingAppModel)===e&&(null==t||delete t.pendingAppModel),null==t||t.Dispose((null==e?void 0:e.AppTemplate.Id)!==(null==t?void 0:t.AppTemplate.Id)))};function ke(){var e;return ue.AppGlobals.AppModel||b.default.ReportErrorOnce({errorMessage:"getAppModel called but there is no AppGlobals.AppModel"}),Ee!==ue.AppGlobals.AppModel&&null!=(null===(e=ue.AppGlobals.AppModel)||void 0===e?void 0:e.appTemplate)?(b.default.ReportErrorOnce({errorMessage:"getAppModel window mismatch"}),ue.AppGlobals.AppModel):Ee}function Re(e,t){var n,a;return null!==(a=null===(n=ke())||void 0===n?void 0:n.MapActionName(e,t))&&void 0!==a?a:t||e}var Ie=window.APPSHEET_TEST_CONTEXT?_e:d.default.noop;function Ne(e,t){var n,a,r=function(e){try{var t=e.match(/^\/?([^#]+)#?/)[1];return decodeURIComponent(t).toLowerCase()}catch(t){return e}};return(null===(n=e.Name)||void 0===n?void 0:n.toLowerCase())===r(t.Name)||(null===(a=e.Id)||void 0===a?void 0:a.toLowerCase())===r(t.Id)}t.setTestAppModel=Ie;var Me=function(){function e(t){var n=this;(0,s.default)(this,e),this.deferredUntilSwap=[],this.inBackgroundSync=!1,this.startedGeocoding=!1,this.dynamicRollouts=new F.DynamicRolloutContainer,this.readyToSwap=!1,this.useConsistentComparisonOperators=!1,this.Disposed=!1,this.IsTestModel=!1,this.USERSTORE_PROVIDER="user-local",this.NativeProvider="native",this.API_LEVEL=2,this.SYSTEM_OWNER_IDS=[10305,71626],this.DESC_SORT_PREFIX="▼",this.ANY_IMAGE_TYPE="anyImage",this.ROW_NUMBER_ATTRNAME="_RowNumber",this.ROW_ID_ATTRNAME="Row ID",this.SHOW_LIST="list",this.DisplayActions={card:!0,table:!0,dashboard:!0,deck:!0,gallery:!0,slideshow:!0,detail:!0,map:!0,chart:!0,form:!0,search:!0,calendar:!0,onboarding:!0,iframe:!0},this.SHOW_WORKFLOW="flow",this.LIST_OPTION_TABLE="Tabular",this.LIST_OPTION_GROUPED="Grouped",this.LIST_OPTION_CARD="Deck",this.DECK_OPTION_SQUARE="Square Image",this.DECK_OPTION_CIRCLE="Round Image",this.DECK_OPTION_FULL="Full Image",this.CHART_OPTION_ROW="Row Series",this.CHART_OPTION_ROW_STACKED="Row Series [Stack]",this.CHART_OPTION_ROW_LINE="Row Series [Line]",this.CHART_OPTION_COL="Col Series",this.CHART_OPTION_COL_STACKED="Col Series [Stack]",this.CHART_OPTION_COL_LINE="Col Series [Line]",this.CHART_OPTION_SCATTER="Scatter Plot",this.CHART_OPTION_PIECHART="PieChart",this.CHART_OPTION_DONUTCHART="DonutChart",this.CHART_OPTION_HISTOGRAM="Histogram",this.CHART_OPTION_HORIZ_HISTOGRAM="Horizontal Histogram",this.CHART_OPTION_AGGREGATE_PIECHART="Aggregate PieChart",this.CHART_OPTION_AGGREGATE_DONUTCHART="Aggregate DonutChart",this.CHART_OPTION_AGGREGATE_NUMBER="Aggregate Number",this.ACTION_SEARCH="search",this.ACTION_LOOKUP="lookup",this.ACTION_NEW="new",this.ACTION_SCAN="scan",this.POSITION_FAR_LEFT="left most",this.POSITION_FAR_RIGHT="right most",this.POSITION_LEFT="left",this.POSITION_RIGHT="right",this.POSITION_CENTER="center",this.POSITION_MENU="menu",this.POSITION_REF="ref",this.POSITIONS_ORDERED=["left most","left","center","right","right most"],this.FORM_CACHE_INTERVAL_MS=1e4,this.FORM_RESTORE_STATE_TIMEOUT_MS=6e5,this.DataStamp=(new Date).toISOString(),this.ForceDelayedSync=!1,this.InASyncCall=!1,this.ReadFromLocalCache=!0,this.Tables=[],this.backgroundSyncInProgress=!1,this.numOutstandingRequests=0,this.shouldBlockSync=!1,this.nativeProviderFor=function(e){return(null==e?void 0:e.ProviderName)===n.NativeProvider?n.nativeDataProvider:void 0},t&&(this.ReadFromLocalCache=!1,this.dynamicRollouts=t.dynamicRollouts),this.Types=K.default.init(this),this.dataManager=new Q.default(this),this.AppTemplate={IsValid:!1,IsRunnable:!0,IsDeployable:!0,AppData:{Folders:[],DataSets:[],DataSchemas:[],TableSlices:[]},Behavior:{},Presentation:{Controls:[],FormatRules:[]}},this.appTemplate=new U.default(this.AppTemplate,this),this.defaultDataProvider=new L.DefaultProvider,this.nativeDataProvider=new P.NativeProvider(this),this.shouldBlockSync=(0,ve.isCloningApp)()}return(0,c.default)(e,[{key:"isCurrent",get:function(){return ke()===this}},{key:"signature",get:function(){return this.appTemplateModel.Id}},{key:"rowCount",get:function(){return d.default.sum(this.Tables.filter((function(e){return e.Rows})).map((function(e){return e.Rows&&e.Rows.length})))}},{key:"appTemplateModel",get:function(){return this.AppTemplate}},{key:"dataContext",value:function(){return this.cachedDataContext||(this.cachedDataContext=new j.default(this)),this.cachedDataContext}},{key:"isReady",value:function(){return this.appTemplateModel.IsValid}},{key:"inDynamicRolloutByOwnerId",value:function(e){return this.dynamicRollouts.byOwner(e)}},{key:"inRollout",value:function(e){return this.rollouts?Boolean(this.rollouts.get(e)):(b.default.errorToDevConsole("Checked rollout ".concat(e," before template was available - using out-of-rollout path.")),!1)}},{key:"setRollout",value:function(e,t){this.rollouts||(this.rollouts=new Map),this.rollouts.set(e,t)}},{key:"setRollouts",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var a=(0,u.default)(n[t],2),r=a[0],i=a[1];this.setRollout(r,i)}}},{key:"setAppTemplate",value:function(e){this.rollouts=g.default.allByOwner(e),this.AppTemplate=e,this.appTemplate=new U.default(e,this),this.rolloutClassNames=(0,h.default)("CSSRolloutContainer",{ReactRootRollout:re.ReactRootUIConfig.isReactRoot(),OutsideReactRootRollout:!re.ReactRootUIConfig.isReactRoot()}),this.storageManager&&this.storageManager.setCurrentTemplate(e),this.dataManager&&this.dataManager.onTemplateChange(),this.useConsistentComparisonOperators=this.appTemplate.expressionSettings().ComparisonOperatorBlankValuesMode===ae.ExpressionSettingsOption.Consistent}},{key:"Dispose",value:function(e){var t,n;b.default.AddTraceContext("AppModel.Dispose"),this.stopSyncQueue(),this.discardPendingAppModel(),null===(t=this.dataManager)||void 0===t||t.dispose(),null===(n=this.storageManager)||void 0===n||n.dispose(!!e),this.Tables=[],this.Disposed=!0}},{key:"dataStampTime",value:function(){return this.cachedDataStampTime&&this.cachedDataStampTime.dataStamp===this.DataStamp||(this.cachedDataStampTime={dataStamp:this.DataStamp,time:new Date(this.DataStamp).getTime()||0}),this.cachedDataStampTime.time}},{key:"rebuildTableIndex",value:function(){b.default.AddTraceContext("appModel.rebuildTableIndex"),this.TableNameIndex={};for(var e=0;e<this.Tables.length;e++){var t=this.Tables[e];this.TableNameIndex[t.Name]=e,null!=t.Name&&(this.TableNameIndex[t.Name.toLowerCase()]=e)}}},{key:"initialize",value:function(e,t,n){var a=this;b.default.AddTraceContext("appModel.initialize");var r=!1,i=!1,o=function(n){switch(null==e||e.completeSection(n),n){case"Data":i=!0;break;case"Template":r=!0}i&&r&&"function"==typeof t&&(b.default.AddTraceContext("appTemplateSuccess"),t(a.AppTemplate))},l=ue.AppGlobals.AppState.AppTemplate.Id?ue.AppGlobals.AppState.AppTemplate.Id:ue.AppGlobals.AppState.AppTemplate.Name;(0,se.$TSFixMeMaybeNull)(l),(0,se.$TSFixMeMaybeNull)(ue.AppGlobals.AppState.AppTemplate.Version),this.GetAppTemplateAsync(l,ue.AppGlobals.AppState.AppTemplate.Version,(function(e){if(null!=e){var t=(e.Behavior.AuthRequired||void 0!==window.OTURLParams.requireLogin)&&!m.default.IsIFramePreview();if(!ue.AppGlobals.AppState.IsAuthenticatedUser(t))return ue.AppGlobals.AppState.SwitchToLoginPage(e.IsPublic?null:e.Behavior.AuthProvider," Offline app fetch indicates login is required",e.Id),b.default.AddTraceContext("Switching to login page"),!1}return o("Template"),!0}),(function(){o("Data")}),(function(t){var a,r;a="Template",r=t,null==e||e.raiseError(r),"Template"===a&&"function"==typeof n&&n(r)}))}},{key:"GetTableRowHeight",value:function(){var e;return 2.111*(null===(e=this.appTemplate)||void 0===e?void 0:e.normalizedFontSize())}},{key:"FindTableDefinition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null==e)return null;if(t>5)return null;for(var n=e.toLowerCase(),a=0;a<this.appTemplateModel.AppData.DataSets.length;a++)if(this.appTemplateModel.AppData.DataSets[a].IsValid){if(n===this.appTemplateModel.AppData.DataSets[a].Name.toLowerCase())return this.appTemplateModel.AppData.DataSets[a]}else b.default.AddTraceContext("Found INVALID TABLE DEFINITION for "+e);if(null!=this.appTemplateModel.AppData.TableSlices)for(var r=0;r<this.appTemplateModel.AppData.TableSlices.length;r++)if(this.appTemplateModel.AppData.TableSlices[r].IsValid&&n===this.appTemplateModel.AppData.TableSlices[r].Name.toLowerCase())return this.FindTableDefinition(this.appTemplateModel.AppData.TableSlices[r].SourceTable,t+1);return null}},{key:"FindSliceDefinition",value:function(e){if(null==e)return null;for(var t=e.toLowerCase(),n=0;n<this.appTemplateModel.AppData.TableSlices.length;n++)if(this.appTemplateModel.AppData.TableSlices[n].IsValid&&t===this.appTemplateModel.AppData.TableSlices[n].Name.toLowerCase())return this.appTemplateModel.AppData.TableSlices[n];return null}},{key:"FindControl",value:function(e,t){if(null==e)return null;for(var n=e.toLowerCase(),a=0;a<this.appTemplateModel.Presentation.Controls.length;a++){var r=this.appTemplateModel.Presentation.Controls[a];if(r.IsValid&&(n===r.Name.toLowerCase()&&(!t||t===r.Action)))return r}return null}},{key:"FindControlsForTable",value:function(e,t,n){"string"==typeof t&&(t=[t]);var a=null;t||(a=["form","dashboard","search","detail"]);var r=d.default.includes(t,"form");if(null==this.appTemplateModel.Presentation.Controls)return[];var i=this.appTemplateModel.Presentation.Controls.filter((function(i){var o,l=i.Action;"table"===l&&(l="fastTable");var u=(null===(o=i.TableOrFolderName)||void 0===o?void 0:o.toLowerCase())===e.toLowerCase(),s=!t||d.default.includes(t,l);a&&s&&(s=!d.default.includes(a,l));var c="ref"===i.Position;return n?!(!r&&"form"===i.Action)&&(u&&(s||c)):u&&s}));return d.default.sortBy(i,(function(e){return"ref"===e.Position?"App owner"===e.CreatedBy?1:2:3}))}},{key:"NavStateForView",value:function(e,t){if(!e)return null;var n=this.appTemplate.getView(e.Name),a=n?n.definition():{},r=(0,_.getGroupAggregateFromString)(a.GroupAggregate),i=n?n.rowKey(this):null,o=null==n?void 0:n.table(),l={TableName:t||o,RowKey:i,GroupBy:a.GroupBy,SortBy:a.SortBy,FilterExpr:a.FilterExpr,ColumnOrder:a.ColumnOrder,ColumnWidth:a.ColumnWidth,ChartType:a.ChartType,ChartColumns:a.ChartColumns,TrendLine:a.TrendLine,ShowLegend:a.ShowLegend,LabelType:a.LabelType,ColorCodes:a.ChartColors,ImageDisplayType:a.ImageShape,defaultCalendarView:a.DefaultCalendarView,viewEntries:a.ViewEntries,MaxNestedRows:a.MaxNestedRows,groupAggregate:r,mainSlideshowImageColumn:a.MainSlideshowImageColumn,detailContentColumn:a.DetailContentColumn,headerColumns:a.HeaderColumns,SlideshowDisplayMode:a.DisplayMode,MapCol:a.MapColumn,SecondaryTable:a.SecondaryTable,SecondaryColumn:a.SecondaryColumn,LocationMode:a.LocationMode,GalleryImageSize:a.ImageSize,Layout:"**auto**"===a.Layout?null:a.Layout,UseCardLayout:a.UseCardLayout,mainDeckImageColumn:"**auto**"===a.MainDeckImageColumn?null:a.MainDeckImageColumn,primaryDeckHeaderColumn:"**auto**"===a.PrimaryDeckHeaderColumn?null:a.PrimaryDeckHeaderColumn,secondaryDeckHeaderColumn:"**auto**"===a.SecondaryDeckHeaderColumn?null:a.SecondaryDeckHeaderColumn,deckSummaryColumn:"**auto**"===a.DeckSummaryColumn?null:a.DeckSummaryColumn,deckNestedTableColumn:"**auto**"===a.DeckNestedTableColumn?null:a.DeckNestedTableColumn,startDateColumn:"**auto**"===a.StartDateColumn?null:a.StartDateColumn,endDateColumn:"**auto**"===a.EndDateColumn?null:a.EndDateColumn,startTimeColumn:"**auto**"===a.StartTimeColumn?null:a.StartTimeColumn,endTimeColumn:"**auto**"===a.EndTimeColumn?null:a.EndTimeColumn,labelColumn:"**auto**"===a.LabelColumn?null:a.LabelColumn,categoryColumn:"**auto**"===a.CategoryColumn?null:a.CategoryColumn,showActionBar:!1!==a.ShowActionBar,actionColumns:a.ActionColumns,actionBarEntries:a.ActionBarEntries,interactiveMode:a.InteractiveMode,showTabs:a.ShowTabs,image:"**none**"===a.Image?null:a.Image,title:"**none**"===a.Title?null:a.Title,firstBlurb:"**none**"===a.FirstBlurb?null:a.FirstBlurb,secondBlurb:"**none**"===a.SecondBlurb?null:a.SecondBlurb,finishView:"**none**"===a.FinishView?null:a.FinishView};return e.Action===ue.AppGlobals.AppState.SHOW_MAP?l.MapType=a.MapType||e.ActionType:e.Action===ue.AppGlobals.AppState.SHOW_GALLERY?l.SortAttr=e.Parameters.length>0?e.Parameters[0]:null:e.Action!==ue.AppGlobals.AppState.SHOW_DETAIL&&e.Action!==ue.AppGlobals.AppState.SHOW_SLIDESHOW||(l.ImageDisplayType=a.ImageStyle),l}},{key:"FindSchema",value:function(e){if(!this.appTemplateModel.SchemaLookup||!this.appTemplateModel.SchemaLookup[e]){for(var t={},n=0;n<this.appTemplateModel.AppData.DataSchemas.length;n++){var a=this.appTemplateModel.AppData.DataSchemas[n];a.IsValid&&(t[a.Name]=a)}this.appTemplateModel.SchemaLookup=t}return this.appTemplateModel.SchemaLookup[e]}},{key:"FindTable",value:function(e){if(null==e||null==this.Tables||0===this.Tables.length)return null;null==this.TableNameIndex&&this.rebuildTableIndex();var t=this.TableNameIndex[e.toLowerCase()];return null!=t?this.Tables[t]:null}},{key:"FindRootTable",value:function(e){var t=this.FindTable(e);return null!=t&&t.IsSlice&&null!=t.SliceSource&&t.SliceSource!==t.Name?this.FindRootTable(t.SliceSource):t}},{key:"ResolveFile",value:function(e,t){var n,a,r=!!(null===(n=this.AppTemplate)||void 0===n?void 0:n.Behavior.FullOfflineCaching);if(null==e||""===e)return e;if(!(0,V.isImageHandle)(e)&&"string"==typeof e&&"http"!==e.substr(0,4)&&"data:"!==e.substr(0,5)){var i=e.split("::");2===i.length&&(t=i[0],e=i[1]);var o=le.WindowWrapper.location.protocol,l=encodeURIComponent(e),u="";r||(u="&appVersion="+this.appTemplateModel.Version);var s,c=B.default.findByName(t,this).rootTable,f=c?c.name():t,p="appName="+encodeURIComponent(this.appTemplateModel.Name)+"&tableName="+encodeURIComponent(f)+u+"&fileName="+l,h=this.FindTableDefinition(t);if(null==h?void 0:h.EnablePartitioning)if(((null===(a=h.SourcePartitionDefinition)||void 0===a?void 0:a.Expression)||"").toLowerCase().indexOf("usersettings(")>=0){var v=this.GetUserSettings(this.appTemplateModel.Name);v&&(p+="&settings="+encodeURIComponent(JSON.stringify(v)))}return s=o+"//"+le.WindowWrapper.location.host+"/template/gettablefileurl?"+(this.appTemplate.secureImageAccess?"secure=1&":"")+p,d.default.endsWith(e&&e.toLowerCase(),".pdf")&&(s+="&n="+encodeURIComponent(e)),s}if((0,V.isImageHandle)(e)){var g=V.default.from(e),b=g.getUrlForImgSrc();e=b||null==g.filePath()?b:this.ResolveFile(g.filePath(),t)}else if("string"==typeof e)if(m.default.InAndroidWebView()){var T=(0,_.getTableFileQueryParsed)(e).fileName;"string"==typeof T&&T.toLowerCase().endsWith(".pdf")&&(e+="&n="+encodeURIComponent(T))}else if(m.default.InIOSWebView()&&!y.default.IsIOSAppWithMinVersion(12.7)&&r){var S=(0,_.getTableFileQueryString)(e)||"";S&&(e=X.GETTABLEFILEURL_BASE+S)}return e}},{key:"sortRowByNumber",value:function(e,t){var n=Number(e[this.ROW_NUMBER_ATTRNAME]),a=Number(t[this.ROW_NUMBER_ATTRNAME]);return null==n||""===n?1:null==a||""===a?-1:n>a?1:n<a?-1:0}},{key:"AddDeleteOrUpdateTableRows",value:function(e,t,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.skipWriteTables,o=void 0===i||i,l=r.usedTransactions,u=void 0!==l&&l,s=r.bypassSubmitToServer,c=void 0!==s&&s;t=t||d.default.noop,n=n||d.default.noop,(0,f.default)(e,(function(e,t){var n=function(e){return we(e)?e:void 0};switch(e.type){case"AddTableRow":return t(n(a.CheckAddRequest(e,u)));case"UpdateTableRow":return t(n(a.CheckUpdateRequest(e)));case"DeleteTableRow":return t(n(a.CheckDeleteRequest(e)));default:return t({errorMessage:"AddDeleteOrUpdateTableRows was passed a request of unknown type: ".concat(e.type),request:e})}}),(function(r){if(r){var i=r.request,l=r.errorMessage;n({request:i,errorMessage:l})}else{var s=!1,d=new _.NestedStore;(0,f.default)(e,(function(e,t){var n=function(e,n){s=s||!!e,d.merge(n),t()},r=function(n){return t({request:e,errorMessage:n})},i={skipWriteTables:o,usedTransactions:u,bypassSubmitToServer:c};switch(e.type){case"AddTableRow":a.AddTableRow(e,n,r,i);break;case"UpdateTableRow":a.UpdateTableRow(e,n,r,i);break;case"DeleteTableRow":a.DeleteTableRow(e,n,r,i)}}),(function(e){if(e){var r=e.request,i=e.errorMessage;return b.default.warnToDevConsole("unexpected error in AddDeleteOrUpdateTableRows:\n",i,r),void n({request:r,errorMessage:i})}u||a.Snapshot(d),t(s)}))}}))}},{key:"CheckAddRequest",value:function(e,t){var n=function(t){return b.default.AddTraceContext("ERROR in AddTableRow: ".concat(t)),{request:e,errorMessage:t}},a=B.default.findByName(e.tableName,this),r=a.table,i=a.tableSchema,o=a.tableDefinition;if(null==r)return n("Table ".concat(e.tableName," not found"));if(null==i)return n("TableSchema ".concat(e.tableName," not found"));if(null==o)return n("TableDefinition ".concat(e.tableName," not found"));if(!r.allowsAdd(this))return n("Table ".concat(e.tableName," does not allow new entries"));var l=r.rootTable();if(null==l)return n("Base table of slice ".concat(e.tableName," not found"));var u=d.default.clone(e.row),s=u[l.keyAttribute().name()];if(!t&&null!=l.findRow(s))return n("".concat(Re("There is already a row with the key:")," ").concat(s));return{table:r,rootTable:l,tableSchema:i,tableDefinition:o,newRow:u,keyValue:s}}},{key:"AddTableRow",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=a.usedTransactions,i=a.skipWriteTables,o=a.bypassSubmitToServer;t=t||d.default.noop,n=n||d.default.noop,b.default.AddTraceContext("AddTableRow");var l=this.CheckAddRequest(e,r);if(we(l))n(l.errorMessage);else{var u=l.table,s=l.rootTable,c=l.tableSchema,f=l.keyValue,p=l.newRow;if(!r){if(u.isSlice()){var h=new j.default(this,c);c.allBaseTableAttributes().forEach((function(e){if(e.isValid()&&!c.isInSlice(e.name())&&!(e.name()in p)){(0,b.doWeEverHitThis)("Missing attribute in AddTableRow");var t=e.hasDefaultExpression()?e.defaultExpressionEvalTree().run(h):null;"function"==typeof t?t((function(e,t){p[t.name()]=W.default.valueToWireFormat(e,t.type(),t.auxData())}),e):p[e.name()]=W.default.valueToWireFormat(t,e.type(),e.auxData())}})),e.tableName=s.name()}s.createRow(p)}var v=new _.NestedStore;if(v.for(s.name()).store(f,p),!r){this.onDataChange();var m=this.updateVirtualColumns(p,s,c);v.merge(m)}var g=new q.default.AddTableRowAction(e);i||this.Snapshot(v),o||this.Submit(g),this.onDataChange(),s.table.Timestamp=this.DataStamp,this.discardPendingAppModel(),t(!1,v)}}},{key:"CheckDeleteRequest",value:function(e){var t=function(t){return b.default.AddTraceContext("ERROR in DeleteTableRow: ".concat(t)),{request:e,errorMessage:t}},n=B.default.findByName(e.tableName,this),a=n.table,r=n.tableSchema,i=n.tableDefinition;if(null==a)return t("Table ".concat(e.tableName," not found"));if(null==r)return t("TableSchema ".concat(e.tableName," not found"));if(null==i)return t("TableDefinition ".concat(e.tableName," not found"));if(!a.allowsDelete(this))return t("Table ".concat(e.tableName," does not allow deletes"));var o=a.rootTable();if(null==o)return t("Base table of slice ".concat(e.tableName," not found"));var l=e.row||o.findRow(e.rowKey);if(null==l)return t("Row ".concat(e.rowKey," not found"));var u=l[o.keyAttribute().name()];return null==u?t("Row ".concat(e.rowKey," has an empty key")):{table:a,rootTable:o,tableDefinition:i,tableSchema:r,thisRow:l,keyValue:u}}},{key:"DeleteTableRow",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=a.usedTransactions,i=a.skipWriteTables,o=a.bypassSubmitToServer;t=t||d.default.noop,n=n||d.default.noop,b.default.AddTraceContext("DeleteTableRow");var l=this.CheckDeleteRequest(e);if(we(l))n(l.errorMessage);else{var u=l.table,s=l.rootTable,c=l.tableSchema,f=l.thisRow,p=l.keyValue;u.isSlice()&&(e.tableName=s.name()),r||s.deleteRow(p);var h=new _.NestedStore;if(h.for(s.name()).store(p,null),!r){this.onDataChange();var v=this.updateVirtualColumns(f,s,c);h.merge(v)}r||(f[c.keyAttribute().name()]=e.rowKey,e.row=f);var m=new q.default.DeleteTableRowAction(e);i||this.Snapshot(h),o||this.Submit(m),this.onDataChange(),s.table.Timestamp=this.DataStamp,this.discardPendingAppModel(),t(!1,h)}}},{key:"CheckUpdateRequest",value:function(e){var t=function(t){return b.default.AddTraceContext("ERROR in UpdateTableRow: ".concat(t)),{request:e,errorMessage:t}},n=B.default.findByName(e.tableName,this),a=n.table,r=n.tableSchema,i=n.tableDefinition;if(null==a)return t("Table ".concat(e.tableName," not found"));if(null==r)return t("TableSchema ".concat(e.tableName," not found"));if(null==i)return t("TableDefinition ".concat(e.tableName," not found"));if(!a.allowsUpdate(this))return t("Table ".concat(e.tableName," does not allow updates"));var o=a.rootTable();if(null==o)return t("Base table of slice ".concat(e.tableName," not found"));var l=d.default.clone(e.row),u=o.keyAttribute().name(),s=l[u],c=o.findRow(s);return null==c?t("Updated row with key ".concat(s," cannot be found")):{table:a,rootTable:o,tableSchema:r,tableDefinition:i,newRow:l,keyAttrName:u,keyValue:s,oldRow:c}}},{key:"UpdateTableRow",value:function(e,t,n){var a,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.usedTransactions,o=r.skipWriteTables,l=r.bypassSubmitToServer;t=t||d.default.noop,n=n||d.default.noop,b.default.AddTraceContext("UpdateTableRow");var u=this.CheckUpdateRequest(e);if(we(u))n(u.errorMessage);else{var s=u.rootTable,c=u.tableSchema,f=u.tableDefinition,p=u.newRow,h=u.keyAttrName,v=u.keyValue,m=u.oldRow,g=d.default.clone(m);i||s.replaceRow(p);var y=new _.NestedStore;if(y.for(s.name()).store(v,p),!i){this.onDataChange();var T=_.NestedStore.merge(this.updateVirtualColumns(g,s,c),this.updateVirtualColumns(p,s,c));y.merge(T)}m[h]=v;var S=(0,_.isUserSettingsTable)(e.tableName),A={immediateSync:S,enqueueChanges:!S};if(null===(a=this.nativeProviderFor(f))||void 0===a||a.OnLocalUpdateRow({tableName:e.tableName,row:e.row,oldRow:g,nextSteps:A}),A.enqueueChanges){var E=new q.default.UpdateTableRowAction(e);o||this.Snapshot(y),l||this.Submit(E)}this.onDataChange(),s.table.Timestamp=this.DataStamp,this.discardPendingAppModel(),t(A.immediateSync,y)}}},{key:"onDataChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timestampString,n=void 0===t?(new Date).toISOString():t,a=e.logDelta,r=e.transaction;this.DataStamp=n,delete this.cachedUserSettingsDataContext,this.dataManager&&this.dataManager.onDataChange(a,r),O.default.dataStamp=n}},{key:"shouldEncryptLocalData",value:function(){return this.appTemplateModel.Behavior.EncryptLocalData}},{key:"allowScanOverride",value:function(){var e,t,n=null===(t=null===(e=null==this?void 0:this.AppTemplate)||void 0===e?void 0:e.Presentation)||void 0===t?void 0:t.AllowScanOverride;return!1!==n}},{key:"allowLatLongOverride",value:function(){var e,t,n=null===(t=null===(e=null==this?void 0:this.AppTemplate)||void 0===e?void 0:e.Presentation)||void 0===t?void 0:t.AllowScanOverride;return!1!==n}},{key:"getSortHandleWidth",value:function(){return X.SORTHANDLE_WIDTH}},{key:"startBackgroundSync",value:function(){var t,n=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{initiatedBy:"Polling"},r=this.NumDelayedActions()+this.NumProcessingActions(),i=this.dataManager.currentTransaction,o=fe.dynamicRollouts.includeByOwnerId("ReactAppFormSyncFix")?null==i?void 0:i.hasUserEdits:null==i?void 0:i.started;if(!(this.NeedsUsageScopesConsent()||G.Common.InitializingApp||this.backgroundSyncInProgress||this.InASyncCall||o||0!==r)){var l=new Date,u=null!==(t=a.progressHandle)&&void 0!==t?t:O.default.syncProgressHandle;this.backgroundSyncProgressHandle=u;var s=new e(this);this.pendingAppModel=s;var c=this.DataStamp,d=JSON.stringify(ue.AppGlobals.AppState.AppTemplate),f=function(e){var t;n.backgroundSyncInProgress=!1,ue.AppGlobals.StateChangeHandler.ShowFinishBackendCall(),b.default.logToDevConsole("Background sync succeeded"),(null==e?void 0:e.IsRunnable)&&n.DataStamp===c&&n.pendingAppModel===s&&JSON.stringify(ue.AppGlobals.AppState.AppTemplate)===d?(s.deferIfBackgroundSync((function(){s.SyncSuccess()})),R.logger.logAppEvent({eventName:I.AppEventName.BackgroundSyncSucceeded}),s.ReadFromLocalCache=!0,s.readyToSwap=!0,s.inBackgroundSync=!1,(null===(t=null===window||void 0===window?void 0:window.AppModel)||void 0===t?void 0:t.pendingAppModel)===s&&ue.AppGlobals.AppModel.swapInPendingAppModel(),(0,x.recordSyncMetrics)(l,n.lastSuccessfulSyncTimeMs(),{InitiatedBy:a.initiatedBy,Visibility:O.default.syncState.visibility,Result:"success",Background:"true"})):(b.default.logToDevConsole("but the new app template could not be used"),s.Dispose(),n.discardPendingAppModel(),(0,x.recordSyncMetrics)(l,n.lastSuccessfulSyncTimeMs(),{InitiatedBy:a.initiatedBy,Visibility:O.default.syncState.visibility,Result:"not_usable",Background:"true"})),u.finish()},p=function(e){b.default.logToDevConsole("Background sync failed"),R.logger.logAppEvent({eventName:I.AppEventName.BackgroundSyncFailed}),ue.AppGlobals.StateChangeHandler.ShowFinishBackendCall(),n.backgroundSyncInProgress=!1,n.SyncFailure(),n.discardPendingAppModel(),(0,x.recordSyncMetrics)(l,n.lastSuccessfulSyncTimeMs(),{InitiatedBy:a.initiatedBy,Visibility:O.default.syncState.visibility,Result:"failure",Background:"true"}),u.raiseError(e)};return this.backgroundSyncInProgress=!0,b.default.logToDevConsole("Starting a background sync"),b.default.AddTraceContext("Starting background sync"),s.inBackgroundSync=!0,s.readyToSwap=!1,ue.AppGlobals.StateChangeHandler.ShowStartBackendCall(),u.start(a),s.Initialize(u,f,p),!0}return!1}},{key:"deferIfBackgroundSync",value:function(e){this.inBackgroundSync?this.deferredUntilSwap.push(e):e()}},{key:"swapInPendingAppModel",value:function(){var e,t,n,a,r,i=this;if(this.NumDelayedActions()+this.NumProcessingActions()>0)this.discardPendingAppModel();else if(this.pendingAppModel&&this.pendingAppModel.readyToSwap&&!this.InASyncCall){if(null===(t=null===(e=null===window||void 0===window?void 0:window.AppState)||void 0===e?void 0:e.CurrentUIState)||void 0===t?void 0:t.FormUIState){if(this.appTemplateModel.Version!==this.pendingAppModel.AppTemplate.Version)return;if(null===(r=null===(a=null===(n=null===window||void 0===window?void 0:window.AppState)||void 0===n?void 0:n.CurrentUIState)||void 0===a?void 0:a.FormUIState)||void 0===r?void 0:r.RestoreState)return;var o=this.dataContext().pendingSaves().byTable,l=!1;if(d.default.keys(o).forEach((function(e){var t=i.pendingAppModel.findTableCollection(e).table;d.default.values(o[e]).forEach((function(e){if(e.rowKey)if(null==t)l=!0;else{var n=t.findRow(e.rowKey);null!=n&&d.default.isEqual(n,e.initialData)||(l=!0)}}))})),l)return}else{var u=document.activeElement;if(u&&("INPUT"===u.tagName||"TEXTAREA"===u.tagName))return}if(this.pendingAppModel.Disposed)return void b.default.ReportError({errorMessage:"Tried to swap in disposed pendingAppModel"});if(this.pendingAppModel.Tables.some((function(e){return e.Disposed})))return void b.default.ReportError({errorMessage:"Tried to swap in pendingAppModel with disposed Tables"});try{b.default.AddTraceContext("Swapping in pending AppModel");for(var s=this.pendingAppModel;s.deferredUntilSwap.length;){s.deferredUntilSwap.shift()()}_e(s);var c=s.AppTemplate;ue.AppGlobals.AppModel.OnAppTemplateLoad(c),Z.JeeneeBrowserAPI.OnAppTemplateLoad(c),ue.AppGlobals.ViewManager.OnAppTemplateLoad(c,!0),ue.AppGlobals.AppState.OnAppTemplateLoad(c),(0,ce.installOrUpdateServiceWorker)(),R.logger.logAppEvent({eventName:I.AppEventName.BackgroundSyncAppModelSwap})}catch(e){b.default.ReportError({errorMessage:"error switching to pending AppModel",error:e}),b.default.warnToDevConsole("error occurred when swapping in pending AppModel"),b.default.logToDevConsole(e),ue.AppGlobals.AppModel.discardPendingAppModel()}}}},{key:"discardPendingAppModel",value:function(){this.pendingAppModel&&(b.default.AddTraceContext("Discarding pending app model"),this.pendingAppModel.deferredUntilSwap=[],this.pendingAppModel.Dispose(),delete this.pendingAppModel,this.backgroundSyncProgressHandle&&(this.backgroundSyncProgressHandle.finish(),delete this.backgroundSyncProgressHandle))}},{key:"SyncData",value:function(e,t,n,a){var r=this;b.default.AddTraceContext("appModel.SyncData"),null==e||e.start(t);var i=new Date;this.ReadFromLocalCache=!1;try{this.Initialize(e,(function(e){r.ReadFromLocalCache=!0,null!=e&&(e.IsRunnable?(ue.AppGlobals.AppModel.OnAppTemplateLoad(e),Z.JeeneeBrowserAPI.OnAppTemplateLoad(e),ue.AppGlobals.ViewManager.OnAppTemplateLoad(e),ue.AppGlobals.AppState.OnAppTemplateLoad(e)):ue.AppGlobals.ViewManager.ShowErrorScreen("This app '"+e.ShortName+"' is in an invalid state. Please contact the app creator.")),(0,x.recordSyncMetrics)(i,r.lastSuccessfulSyncTimeMs(),{InitiatedBy:t.initiatedBy,Visibility:O.default.syncState.visibility,Result:"success",Background:"false"}),n(),(0,ce.installOrUpdateServiceWorker)()}),(function(e){r.ReadFromLocalCache=!0,r.RecordSyncEnd(),(0,x.recordSyncMetrics)(i,r.lastSuccessfulSyncTimeMs(),{InitiatedBy:t.initiatedBy,Visibility:O.default.syncState.visibility,Result:"failure",Background:"false"}),a(e),(0,ce.installOrUpdateServiceWorker)()}),(function(e){r.ReadFromLocalCache=!0,r.RecordSyncEnd(),(0,x.recordSyncMetrics)(i,r.lastSuccessfulSyncTimeMs(),{InitiatedBy:t.initiatedBy,Visibility:O.default.syncState.visibility,Result:"flush_load_failure",Background:"false"}),a(e),(0,ce.installOrUpdateServiceWorker)()}))}catch(e){ue.AppGlobals.AppModel.ReadFromLocalCache=!0,a((0,ie.asError)(e).message)}}},{key:"backendSync",value:function(t,n,a,r){var i=this;if(this.RecordSyncStart(),this.appTemplateModel.IsValid&&this.appTemplateModel.Name===ue.AppGlobals.AppState.AppTemplate.Name){this.ResetSyncFailures(),(0,de.autoConnect)();var o=this.NumProcessingActions()+this.NumDelayedActions(),l=setInterval((function(){var u,s,c=(0,oe.getSyncErrorHandler)(i.appTemplateModel.Id,(function(){clearInterval(l)}),!1);if(null===(u=i.syncQueue)||void 0===u||u.Check(t,c),t){var d={remainingSteps:i.NumProcessingActions()+i.NumDelayedActions(),totalSteps:o};t.setSyncQueueStatus(d)}if(0===i.NumProcessingActions())if(clearInterval(l),0===i.NumDelayedActions()&&0===i.NumProcessingActions())if(null==t||t.completeSection("Queue"),i===ue.AppGlobals.AppModel&&i.InASyncCall){var f=new e(i);f.Initialize(t,(function(e){if(ue.AppGlobals.AppModel.InASyncCall){var t=i.RecordSyncEnd();f.SyncSuccess(t),f.ReadFromLocalCache=!0,_e(f),n(e)}else f.Dispose()}),(function(e){i.SyncFailure(),i.RecordSyncEnd(),a(e)}))}else i.initialize(t,(function(e){i.RecordSyncEnd(),i.SyncSuccess(),n(e)}),(function(e){i.RecordSyncEnd(),a(e)}));else"function"==typeof r&&r(null!==(s=null==t?void 0:t.getErrors())&&void 0!==s?s:"")}),200)}else null==t||t.completeSection("Queue"),this.initialize(t,(function(e){var t=i.RecordSyncEnd();fe.dynamicRollouts.includeByOwnerId("ReactAppFormSyncFix")?i.deferIfBackgroundSync((function(){i.SyncSuccess(t)})):i.SyncSuccess(t),n(e)}),(function(e){i.RecordSyncEnd(),a(e)}))}},{key:"initializeStorageManager",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.AppGlobals.AppState.AppTemplate,t=e.Name,n=e.Id,a=e.Version,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue.AppGlobals.AppState.UserInformation.Id;this.storageManager=new J.default({tentativeTemplateName:t,tentativeTemplateId:n,appTemplateVersion:a,userId:r})}},{key:"Initialize",value:function(e,t,n,a){var r=this;b.default.AddTraceContext("appModel.Initialize",{inNestedSync:this!==ue.AppGlobals.AppModel}),this.storageManager||this.initializeStorageManager();var i=function(){var i,o=r!==ue.AppGlobals.AppModel;if(r.ReadFromLocalCache){r.localState=null!==(i=r.storageManager.validStorageInterface)&&void 0!==i?i:r.storageManager.defaultStorageInterface;var l=J.default.readUserRollouts(),u=r.localState.GetOwnerRollouts();(l||u)&&r.dynamicRollouts.restoreFromStorage({ownerDynamicRollouts:u,userDynamicRollouts:l});var s=r.lastSuccessfulSyncTime();s&&r.onDataChange({timestampString:s})}else o&&(r.localState=r.storageManager.defaultStorageInterface);r.actionNames=null,r.ReadFromLocalCache&&r.LocalStateIsValid()?(null==e||e.completeSection("Queue"),r.initialize(e,t,n)):(o||r.LocalStateIsValid()||r.ClearLocalState(),r.ReadFromLocalCache&&(null==e||e.setSyncingStatus(!0)),r.backendSync(e,t,n,a))};this.ReadFromLocalCache?(ue.AppGlobals.AppState.ForceWipeUserData&&(this.ClearPrivateData(),ue.AppGlobals.AppState.ForceWipeUserData=!1),ue.AppGlobals.AppState.ForceRefreshAppDefinition&&(this.ClearTemplateData(),ue.AppGlobals.AppState.ForceRefreshAppDefinition=!1),this.ReadLocalState((function(e){return e&&b.default.warnToDevConsole(e),p.default.nextTick(i)}))):i()}},{key:"RecordSyncStart",value:function(){this.InASyncCall=!0,this.syncStartTime=Date.now()}},{key:"RecordSyncEnd",value:function(){var e;if(this.InASyncCall=!1,this.syncStartTime){var t=Date.now()-this.syncStartTime;try{(null===(e=window.parent)||void 0===e?void 0:e.recordSyncTime)&&window.parent.recordSyncTime(t/1e3)}catch(e){}return delete this.syncStartTime,t}}},{key:"CancelSync",value:function(){b.default.AddTraceContext("appModel.CancelSync"),this.RecordSyncEnd(),(0,M.abortOutstandingCalls)()}},{key:"OnAppTemplateLoad",value:function(e){var t;b.default.AddTraceContext("appModel.OnAppTemplateLoad"),null==(null===(t=null==e?void 0:e.Behavior)||void 0===t?void 0:t.Description)&&d.default.set(e,"Behavior.Description",{}),m.default.detect();var n=m.default.Locale();if("en-us"===n.toLowerCase()){var a={weekdaysMin:"S_M_T_W_T_F_S".split("_")};v.default.updateLocale(n,a)}else v.default.locale(n);(0,se.$TSFixMeMaybeNull)(ue.AppGlobals.AppState.AppTemplate.Name),(this.appTemplateModel.Name&&d.default.toLower(this.appTemplateModel.Name)===d.default.toLower(ue.AppGlobals.AppState.AppTemplate.Name)||this.appTemplateModel.Id&&ue.AppGlobals.AppState.AppTemplate.Id===this.appTemplateModel.Id)&&ue.AppGlobals.AppState.SetCurrentTemplate(this.AppTemplate),O.default.setAppTemplate(this.appTemplate),this.RequiresSamplesUser(e)?ue.AppGlobals.AppState.SetSamplesUser():ue.AppGlobals.AppState.ReadUserInfoFromUStore(),this.startSyncQueue(this.appTemplate),this.NeedsUsageScopesConsent()||this.SetupGeolocationListener(),this.StartGeocodingTableData(),this.appTemplate.loadPredictors(),this.appTemplate.loadOcrExtractors()}},{key:"SetupGeolocationListener",value:function(){var e=this.appTemplate.usesLocation;if(e&&!Ae){Ae=w.default.addListener({interval:6e4,enableHighAccuracy:!1})}!e&&Ae&&(w.default.removeListener(Ae),Ae=null)}},{key:"ProcessAppTemplate",value:function(e){var t,n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;b.default.AddTraceContext("appModel.ProcessAppTemplate"),this.Tables=null!==(t=this.Tables)&&void 0!==t?t:[];var o=this.appTemplateModel.AppData.DataSets.filter((function(e){return e.IsValid}));this.appTemplateModel.IsRunnable&&this.GetTables(o,r,i,(function(t){b.default.AddTraceContext("GetTables callback - tablesArray count: "+t.length),n.Tables=t,n.appTemplateModel.AppData.TableSlices.filter((function(e){return e.IsValid})).forEach((function(e){var t=n.MakeTable(e.Name);t.IsSlice=!0,t.SliceSource=e.SourceTable,n.Tables.push(t)})),n.ProcessTables(),"function"==typeof e&&e()}),a)}},{key:"ProcessTables",value:function(){var e=this,t=[this.appTemplateModel.Presentation.LogoUrl,"https://www.appsheet.com/content/img/favicon64.ico","https://www.appsheet.com/content/img/pageart/draggable-pin-white-2x.png","https://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png","https://mts.googleapis.com/maps/vt/icon/name=icons/spotlight/directions_drag_cross_67_16.png&scale=4"],n=function(t,n,a,r){if("function"==typeof r&&(y.default.IsIOSAppWithMinVersion(4.4)||y.default.IsAndroidAppWithMinVersion(6.4))){var i=[],o=[],u=[],s=[],c=[],p=[/https?:\/\/drive\.google\.com\/open\?/];(0,f.default)(n.Attributes,(function(n,a){var r,l,d,p,h,v;if(n.IsValid)switch(n.Type){case e.IMAGE_TYPE:case e.THUMBNAIL_TYPE:case e.DRAWING_TYPE:case e.SIGNATURE_TYPE:i.push(n);break;case e.FILE_TYPE:u.push(n);break;case e.SHOW_TYPE:(r=new W.default(n)).isShowImage()&&(l=r.showContent(e.dataContext()))&&o.push(l);break;case e.XY_TYPE:r=new W.default(n),p=new j.default(e),v=new Set,(h=r.auxData().KMLFileUrl)&&s.push(h),(d=r.baseImage(p))&&v.add(d);var m,g=ye(t.length?t:[{}]);try{for(g.s();!(m=g.n()).done;){var y=m.value;p.replaceRowData(y),(d=r.baseImage(p))&&v.add(d)}}catch(e){g.e(e)}finally{g.f()}return void(0,f.default)(Array.from(v),(function(e,t){var n=C.ImageMapType.getForUrl(e);n.whenReady((function(e){if(null==e)for(var a=1;a<=C.ImageMapType.CACHE_MAX_ZOOM;a++)c=c.concat(n.getAllTileUrls(a));t()}))}),(function(){return a()}))}a()}),(function(n){n&&b.default.warnToDevConsole(n),r(function(){var n=[];if(i.length>0)for(var r=0;r<t.length;r++)for(var f=t[r],h=0;h<i.length;h++){var v=f[i[h].Name];if(null!=v&&"object"!==(0,l.default)(v)&&""!==v&&!v.startsWith("data:")){var m=G.Common.FlexImageUrl(e.ResolveFile(v,a));n.push(m)}}if(u.length>0)for(var g=0;g<t.length;g++)for(var y=t[g],b=0;b<u.length;b++){var T=y[u[b].Name];if(null!=T&&"object"!==(0,l.default)(T)&&""!==T)for(var S=e.ResolveFile(T,a),A=0;A<p.length;A++)S&&!p[A].test(S)&&n.push(S)}if(o.length>0)for(var w=0;w<o.length;w++){var C=o[w];null!=C&&"object"!==(0,l.default)(C)&&""!==C&&n.push(G.Common.FlexImageUrl(C))}return c.forEach((function(e){return n.push(e)})),s.forEach((function(e){return n.push(e)})),c.length&&(0,E.preloadForOffline)(),n=d.default.uniq(n)}())}))}},a=[],r=[],i=[];b.default.AddTraceContext("ProcessTables - this.Tables count: "+this.Tables.length);var o=this.appTemplateModel.Id;o&&"c37bc8a4-6b53-4e71-812c-2348072cbf2e"!==o&&(r=r.concat(o)),this.Tables.forEach((function(t){if(!t.IsSlice){var o=e.FindTableDefinition(t.Name);if(null!=o){var l=e.FindSchema(o.SchemaName);if(null!=l){i.push(t.Name);var u=new H.default(l).keyAttribute();if(t.keyAttrName=u.name(),b.default.Debug()){var s=d.default.uniqBy(t.Rows,(function(e){return e[t.keyAttrName]}));if(t.Rows.length!==s.length){var c=d.default.keys(d.default.pickBy(d.default.groupBy(t.Rows,(function(e){return e[t.keyAttrName]})),(function(e){return e.length>1})));b.default.warnToDevConsole("removed ".concat(t.Rows.length-s.length," rows with duplicate keys ")+"from table ".concat(t.Name," with keyAttr ").concat(t.keyAttrName,":\n"),c),t.Rows=s}}try{e.appTemplateModel.Behavior.FullOfflineCaching&&a.push(n.bind(null,t.Rows,l,t.Name))}catch(e){b.default.ReportError({errorMessage:"ProcessTables: Error in getCachedFilesArray for table",tableName:t.Name,error:e})}var f=function(t,n){var a,r=[],i=[],o=ye(n.Attributes);try{for(o.s();!(a=o.n()).done;){var l=a.value;l.IsValid&&l.Type===e.APP_TYPE&&i.push(l)}}catch(e){o.e(e)}finally{o.f()}for(var u=0;u<t.length;u++)for(var s=t[u],c=0;c<i.length;c++){var d=s[i[c].Name];d&&36===d.length&&r.push(d)}return r}(t.Rows,l,t.Name);f.length>0&&(r=r.concat(f))}else{var p=e.appTemplateModel.AppData.DataSchemas||[];b.default.AddTraceContext("TableSchema NOT FOUND for non-slice table "+t.Name,{schemasFrom:p.map((function(e){return e.AutoSchemaFrom}))})}}else{var h=e.appTemplateModel.AppData.DataSets||[];b.default.AddTraceContext("TableDefinition NOT FOUND for non-slice table "+t.Name,{dataSetNames:h.map((function(e){return e.Name}))})}}})),this.rebuildTableIndex(),i=[],this.Tables.forEach((function(t){if(t.IsSlice){var n=e.FindTableDefinition(t.Name),a=e.FindTable(t.SliceSource);i.push(t.Name),null==n||null==a||a===t?(t.IsValid=!1,b.default.ReportErrorOnce({errorMessage:"Seems like an invalid table slice",tableName:t.Name,sliceSource:t.SliceSource,tableDefinitionMissing:null==n,sourceTableMissing:null==a,sourceTableEqualsSlice:a===t})):t.keyAttrName=a.keyAttrName}}));var u=function(e){var t;(null===(t=ue.AppGlobals.ViewManager)||void 0===t?void 0:t.sideMenu)&&!d.default.isEqual(e,d.default.pick(ue.AppGlobals.ViewManager.sideMenu.state,d.default.keys(e)))&&ue.AppGlobals.ViewManager.sideMenu.setState(e),O.default.setCachingProgress(e)};u({totalFilesRequested:null,totalFilesToCache:null,filesCached:null,filesWithError:null}),this.appTemplateModel.Behavior.FullOfflineCaching&&(0,f.default)(a,(function(e,n){e((function(e){t=t.concat(e),n()}))}),(function(n){n&&b.default.warnToDevConsole(n),(t=d.default.uniq(t)).length>1&&u({totalFilesRequested:t.length,totalFilesToCache:t.length,filesCached:null,filesWithError:null}),Z.JeeneeBrowserAPI.cacheFiles(e.appTemplateModel,t)})),Z.JeeneeBrowserAPI.setAuthCookie(),Z.JeeneeBrowserAPI.subscribeToApps(this.appTemplateModel.Name,r)}},{key:"MatchesAppNameOrId",value:function(e){return this.AppTemplate&&(this.appTemplateModel.Name===e||this.appTemplateModel.Id===e)}},{key:"fetchAppTemplate",value:function(e,t,n){var a;return Se(this,void 0,void 0,i.default.mark((function r(){var o,l,u,s;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o="/api/template/"+e+"/",l=function(t){var n=ue.AppGlobals.AppModel.appTemplate&&ue.AppGlobals.AppModel.appTemplate.lastModified();ue.AppGlobals.AppModel.MatchesAppNameOrId(e)&&n&&t.setRequestHeader("If-Modified-Since",n)},r.next=4,ue.AppGlobals.AppModel.makeGetAppTemplateParamsAsync(e,n);case 4:return u=r.sent,null!=t&&(u.version=t),this.inBackgroundSync&&(u.isBackgroundSync=!0),(s=null===(a=this.localState)||void 0===a?void 0:a.GetSyncToken())&&(u.syncToken=s),r.abrupt("return",$.postJSONAsync(o,u,l));case 10:case"end":return r.stop()}}),r,this)})))}},{key:"redirectIfNeeded",value:function(e,t){var n=this;return new Promise((function(a){var r=le.WindowWrapper.location.href,i=!1;"sync"===t&&re.ReactRootUIConfig.needsReload(e)&&(i=!0,r=re.ReactRootUIConfig.getRedirectUrl(e,r)),A.default.shouldBeUnloaded(e)&&(i=!0,r=(0,D.replaceGuid)(r,e.Id)),r!==le.WindowWrapper.location.href?le.WindowWrapper.location.href=r:i?(n.ClearTemplateData(),le.WindowWrapper.location.reload()):a()}))}},{key:"GetAppTemplateAsync",value:function(e,t){var n,a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!0},o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return Se(this,void 0,void 0,i.default.mark((function u(){var s,c,f,p,h,v,g,y,T,S,A,E,w,C,_,k,N,M,D,L,P,x,F,V,U,B,H,W,j,Y,q=this;return i.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.ReadFromLocalCache||!this.LocalStateIsValid()){i.next=10;break}if(s=this.GetTemplateResult(),this.setAppTemplate(s),r(s)){i.next=5;break}return i.abrupt("return");case 5:return i.next=7,this.redirectIfNeeded(s,"local cache");case 7:this.ProcessAppTemplate(o,l),i.next=64;break;case 10:return c=!(!ue.AppGlobals.AppModel.MatchesAppNameOrId(e)||!(null===(n=ue.AppGlobals.AppModel.AppTemplate.Behavior)||void 0===n?void 0:n.UsesGeolocation)),(f=R.logger.startTelemetryLogger()).log(I.AppTelemetryEventName.FetchAppTemplateStart),i.next=15,this.fetchAppTemplate(e,t,c);case 15:if(p=i.sent,!Ce(p)){i.next=21;break}return c=!0,i.next=20,this.fetchAppTemplate(e,t,c);case 20:p=i.sent;case 21:if(!(0,ee.isFailureResponse)(p)){i.next=29;break}return v=(h=p).responseText,g=h.httpStatus,v===b.SYNC_CANCELED_ERROR_MESSAGE?f.log(I.AppTelemetryEventName.FetchAppTemplateCancel):f.log(I.AppTelemetryEventName.FetchAppTemplateError),(0,oe.getSyncErrorHandler)(e,l,this.inBackgroundSync)(v,g),i.abrupt("return");case 29:if(y=null!==(a=p.response)&&void 0!==a?a:{},T=y.AppSheetJSVersion,S=y.Success,A=y.ErrorDescription,E=y.NotModified,w=y.Template,C=y.UserRole,_=y.NestedDataSets,k=y.DataSetFormat,N=y.Timestamp,M=y.FirebaseCustomToken,D=y.ExternalAccounts,L=y.OwnerEmail,P=y.UserConsentedScopes,x=y.UserRollouts,F=y.OwnerRollouts,V=y.SyncToken,U=y.DeltaNotificationSyncToken,B=y.DeprecationStatus,!m.default.InMobileWebView()||"Block"!==B){i.next=36;break}return H=p.httpStatus,W=A||"",(0,oe.getSyncErrorHandler)(W,l,this.inBackgroundSync)(W,H,!0),i.abrupt("return");case 36:if(S){i.next=40;break}return f.log(I.AppTelemetryEventName.FetchAppTemplateError),l("Unable to fetch app definition.\n ".concat(null!=A?A:"Empty app template")),i.abrupt("return");case 40:if(m.default.InMobileWebView()&&"Warning"===B&&0===O.default.toasts.length&&(864e5,O.default.showToastThrottled(he.DeprecationWarningToast,864e5)),this.dynamicRollouts.update({upstreamAppSheetJSVersion:T,ownerDynamicRollouts:F,userDynamicRollouts:x}),Ne(j=E?ue.AppGlobals.AppModel.AppTemplate:w,ue.AppGlobals.AppState.AppTemplate)){i.next=48;break}return b.default.ReportError({errorMessage:"Current app changed without canceling sync",thisAppName:this.appTemplateModel.Name,thisAppId:this.appTemplateModel.Id,scopeAppName:j.Name,scopeAppId:j.Id,windowAppName:ue.AppGlobals.AppModel.AppTemplate.Name,windowAppId:ue.AppGlobals.AppModel.AppTemplate.Id,stateAppName:ue.AppGlobals.AppState.AppTemplate.Name,stateAppId:ue.AppGlobals.AppState.AppTemplate.Id,NotModified:E,inAppStartup:ue.AppGlobals.AppState.inAppStartup,inBackgroundSync:this.inBackgroundSync,initializingApp:G.Common.InitializingApp}),l(b.SYNC_CANCELED_ERROR_MESSAGE),f.log(I.AppTelemetryEventName.FetchAppTemplateCancel),i.abrupt("return");case 48:if(f.log(I.AppTelemetryEventName.FetchAppTemplateEnd,{ownerSubscription:j.OwnerSubscription,syncInitiatedBy:O.default.syncState.initiatedBy,syncVisibility:O.default.syncState.visibility}),ue.AppGlobals.AppState.SaveUserRole(C),fe.dynamicRollouts.includeByOwnerId("SendDataNotificationsOnChangeRollout")&&(0,pe.deltaNotificationInstance)().setLatestWatermark(j,U),this.setAppTemplate(j),this.onDataChange({timestampString:N}),M&&Z.JeeneeBrowserAPI.setStorageAuth(M),L&&(j.OwnerEmail=L),D&&(j.ExternalAccounts=D),P&&(j.Behavior.UserConsentedScopes=P),r(this.AppTemplate)){i.next=59;break}return i.abrupt("return");case 59:return i.next=61,this.redirectIfNeeded(j,"sync");case 61:this.deferIfBackgroundSync((function(){q.WriteSyncResultToLocalStorage(E,V).catch((function(e){var t;b.default.AddTraceContext("getAppTemplateCallback WriteSyncResultToLocalStorage error"),(null===(t=q.appTemplateModel.Behavior)||void 0===t?void 0:t.LaunchOffline)&&!m.default.IsIFrame()&&l((0,ie.asError)(e).message)}))})),Y=_?d.default.keyBy(_,(function(e){return e.Name})):{},this.ProcessAppTemplate(o,l,Y,k);case 64:case"end":return i.stop()}}),u,this)})))}},{key:"makeGetAppTemplateParamsAsync",value:function(e,t){var n=this;return new Promise((function(a){return n.MakeGetAppTemplateParams(e,t,a)}))}},{key:"MakeGetAppTemplateParams",value:function(e,t,n){var a,r,i,o,l=!this.MatchesAppNameOrId(e),u=this.GetUserSettings(e);null!=this.SyncInfo.LastSyncTableParams?i=this.getPerTableSyncParams(e):o=this.GetTableTimestamps(e),b.default.logToDevConsole("Syncing with ".concat(i?"perTableParams":"timestamps"),null!=i?i:o);var s={settings:u?JSON.stringify(u):null,getAllTables:!0,syncsOnConsent:!0,syncUI:O.SyncUI[O.default.syncState.ui],initiatedBy:O.default.syncState.initiatedBy,dataNotificationSyncPayload:O.default.syncState.notification,isPreview:m.default.IsIFramePreview(),apiLevel:this.API_LEVEL,supportsJsonDataSets:!0,tzOffset:(new Date).getTimezoneOffset(),locale:navigator.languages?navigator.languages[0]:navigator.language,tableTimestamps:o,perTableParams:i,lastSyncTime:this.lastSuccessfulSyncTime()||"",appStartTime:window.APP_START_TIME||"",dataStamp:this.DataStamp||"",clientId:this.GetClientId(),build:window.AppSheetJSBuild,hasValidPlan:this.AppTemplate&&this.appTemplateModel.HasValidPlan,userConsentedScopes:this.AppTemplate?this.appTemplateModel.Behavior.UserConsentedScopes:null};m.default.InAndroidWebView()?s.androidAppVersion=y.default.AppVersion():m.default.InIOSWebView()&&(s.iosAppVersion=y.default.AppVersion()),!l&&(null===(a=this.AppTemplate)||void 0===a?void 0:a.Version)&&(s.localVersion=this.appTemplateModel.Version);try{(null===(r=window.parent)||void 0===r?void 0:r.getDegreeOfParallelism)&&(this.CustomDegreeOfParallelism=window.parent.getDegreeOfParallelism())}catch(e){}this.CustomDegreeOfParallelism&&(s.customDegreeOfParallelism=this.CustomDegreeOfParallelism);var c=(0,te.getPreviewAsEmail)();if(c&&(s.previewAsEmail=c),t&&!w.default.lastPosition)this.SafeGetLocation((function(e){s.location=e,n(s)}));else if(t&&w.default.lastPosition){var d=w.default.lastPosition.coords,f=d.latitude,p=void 0===f?0:f,h=d.longitude,v=void 0===h?0:h;s.location=w.default.stringifyLatLng(p,v),n(s)}else n(s)}},{key:"GetTableTimestamps",value:function(e){var t={};if(this.GetTablesResult()&&this.MatchesAppNameOrId(e))for(var n=0;n<this.Tables.length;n++){var a=this.Tables[n];if(!a.IsSlice){var r=this.lastTableTimestamp(a.Name);t[a.Name]=a.Timestamp!==r||a.Disposed?null:r}}return t}},{key:"getPerTableSyncParams",value:function(e){var t=new _.NestedStore;if(this.GetTablesResult()&&this.MatchesAppNameOrId(e))for(var n=0;n<this.Tables.length;n++){var a=this.Tables[n];if(!a.IsSlice){var r=this.lastSyncTableParams(a.Name);r&&a.Timestamp===r.time&&!a.Disposed&&t.for(a.Name).store(r)}}return t.toSimpleObject()}},{key:"GetUserSettings",value:function(e){var t,n,a,r,i;if(fe.dynamicRollouts.includeByOwnerId("ClientRetainUserSettings"))return(!e||(null===(t=this.localState)||void 0===t?void 0:t.matches(e)))&&null!==(i=null===(r=null===(a=null===(n=this.localState)||void 0===n?void 0:n.GetTable(X.USER_SETTINGS_TABLE_NAME))||void 0===a?void 0:a.Rows)||void 0===r?void 0:r[0])&&void 0!==i?i:null;if(!e||this.MatchesAppNameOrId(e)){var o=this.FindSchema(X.USER_SETTINGS_SCHEMA_NAME);if(o)if(new H.default(o)){var l=d.default.find(this.Tables,(function(e){return(0,_.isUserSettingsTable)(e.Name)}));if(null==l?void 0:l.Rows)return l.Rows[0]}}return null}},{key:"userSettingsDataContext",value:function(){if(this.cachedUserSettingsDataContext)return this.cachedUserSettingsDataContext;var e=this.FindSchema(X.USER_SETTINGS_SCHEMA_NAME);if(e){var t=new H.default(e),n=this.GetUserSettings(),a=new j.default(this,t,n,null);return null!=n&&(this.cachedUserSettingsDataContext=a),a}return null}},{key:"SafeGetLocation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,n=!1;if(w.default.lastPosition){var a=w.default.lastPosition.coords,r=a.latitude,i=void 0===r?0:r,o=a.longitude,l=void 0===o?0:o;e(w.default.stringifyLatLng(i,l))}else{var u={timeout:t,enableHighAccuracy:!1},s=function(t){b.default.warnToDevConsole(t);var a=w.default.stringifyLatLng(0,0);n||(n=!0,e(a))},c=function(t,a){var r=w.default.stringifyLatLng(t,a);n||(n=!0,e(r))};w.default.fetchLatLong(c,s,u)}}},{key:"GetTable",value:function(e,t,n,a,r,i){this.defaultDataProvider.ReadTable(e,t,n,null,null,null,r,i)}},{key:"GetTables",value:function(e,t,n,a,r){var i,o=this;if(this.ReadFromLocalCache&&this.LocalStateIsValid()){if((i=this.GetTablesResult())&&Array.isArray(i)&&i.length)return b.default.AddTraceContext("appModel.GetTables - used local"),void a(i);var l="";i?Array.isArray(i)?i.length||(l="tablesResult array was empty"):l="tablesResult was not an array":l+="tablesResult was null ";var u="appModel.GetTables - tried to use local but ".concat(l);(0,b.doWeEverHitThis)(u)}var s=0,c=0,f={},p=[];if(null==e||0===e.length)return b.default.warnToDevConsole("no tableDefinitions found in AppTemplate, proceeding with empty tables and clearing local state"),b.default.AddTraceContext("appModel.GetTables - empty result"),this.ClearLocalState(),void a(p);b.default.AddTraceContext("appModel.GetTables - getUserTable loop");var h,v=ye(e);try{var m=function(){var e=h.value;if(e.IsValid){s++;var i=function(e,t,n,r,i){if(i){var l=d.default.clone(i);l.Rows=d.default.clone(i.Rows),n&&(l.Timestamp=n),p.push(l),f[e]=!0}else p.push(o.MakeTable(e,t,n,r));++c===s&&(o.deferIfBackgroundSync((function(){p.some((function(e){return e.Disposed}))?b.default.ReportError({errorMessage:"Tried to write disposed tablesResult"}):o.WriteTablesResult(p.filter((function(e){return!e.IsSlice})),{tablesToSkip:f})})),b.default.AddTraceContext("getTableSuccessFn: "+s+" tables"),a(p))};!function(t,a,l,u,s){var c,d,f,p,h=null!=s?s:{},v=h.DataSet,m=h.NotModified,g=h.LastModified,y=h.ETag;if(m){var T=ue.AppGlobals.AppModel.FindTable(l);if(null==T||T.Disposed){null===(c=ue.AppGlobals.AppModel.localState)||void 0===c||c.clearSyncState(),ue.AppGlobals.AppModel===o||null===(d=o.localState)||void 0===d||d.clearSyncState();var S="There was a problem fetching table",A="".concat(S," ").concat(l,". Please try again."),E=ue.AppGlobals.AppModel.findTableCollection(l).table;b.default.ReportErrorOnce({errorMessage:S,tableName:l,thisAppName:o.appTemplateModel.Name,thisAppId:o.appTemplateModel.Id,windowAppName:ue.AppGlobals.AppModel.AppTemplate.Name,windowAppId:ue.AppGlobals.AppModel.AppTemplate.Id,stateAppName:ue.AppGlobals.AppState.AppTemplate.Name,stateAppId:ue.AppGlobals.AppState.AppTemplate.Id,windowTableCount:null===(f=ue.AppGlobals.AppModel.Tables)||void 0===f?void 0:f.length,inAppStartup:ue.AppGlobals.AppState.inAppStartup,inBackgroundSync:o.inBackgroundSync,initializingApp:G.Common.InitializingApp,foundTable:null!=E,foundTableRowCount:null===(p=null==E?void 0:E.rows())||void 0===p?void 0:p.length,isDisposed:!!(null==T?void 0:T.Disposed)}),r(A)}else(0,se.$TSFixMeMaybeNull)(T.Rows),T.Rows.length&&b.default.logToDevConsole("not modified:",T.Name,"(".concat(T.Rows.length,")")),setTimeout((function(){(0,se.$TSFixMeMaybeNull)(T.Rows),i(l,T.Rows,g||T.Timestamp,T.ETag,T)}),1)}else if(v)setTimeout((function(){var e="json"===n?Oe.fromJSON(v).toRowValues():N.CSV.parse(v);e.length&&b.default.logToDevConsole("SENT DATA:",l,"(".concat(e.length,")")),i(l,e,g,y)}),1);else{if(o.NeedsUsageScopesConsent())return void setTimeout((function(){i(l,[])}),1);b.default.ReportErrorOnce({errorMessage:"getUserTable fell into unexpected `GetTable` path",tableName:l,IsAutoCreated:e.IsAutoCreated}),o.GetTable(t,a,l,o.USERSTORE_PROVIDER===u,i,r)}}(o.appTemplateModel.Name,o.appTemplateModel.Version,e.Name,e.ProviderName,t[e.Name])}};for(v.s();!(h=v.n()).done;)m()}catch(e){v.e(e)}finally{v.f()}0===s&&a(p)}},{key:"MakeTable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return{Name:e,Rows:t,IsSlice:!1,SliceSource:null,Timestamp:n,ETag:a}}},{key:"tablesByRowCount",value:function(){return d.default.sortBy(ue.AppGlobals.AppModel.Tables.filter((function(e){return e.Rows&&e.Rows.length>0})),(function(e){return(0,se.$TSFixMeMaybeNull)(e.Rows),-e.Rows.length})).map((function(e){return(0,se.$TSFixMeMaybeNull)(e.Rows),[e.Rows.length,e.Name,e]}))}},{key:"ExtractShareInfo",value:function(e,t){var n=this,a="",r="",i=B.default.findByName(e,this).table;if(i){var o=i.rootTable();if(null==o?void 0:o.tableSchema){var l=o.tableSchema,u=o.findRow(t);u&&l.visibleAttributesWithoutShowTypes().forEach((function(t){var r;switch(t.type()){case n.IMAGE_TYPE:case n.THUMBNAIL_TYPE:case n.DRAWING_TYPE:case n.SIGNATURE_TYPE:a+=t.name()+" - "+((0,V.isImageHandle)(u[t.name()])?"(photo being processed)":G.Common.FlexImageUrl(n.ResolveFile(u[t.name()],e)))+"\r\n";break;case n.SHOW_TYPE:break;case n.URL_TYPE:(null==(r=W.default.urlValueFromWireFormat(u[t.name()]))?void 0:r.linkText)&&r.linkText!==r.url?a+=t.name()+" - "+r.linkText+":"+r.url+"\r\n":a+=r?t.name()+" - "+r.url+"\r\n":t.name()+" - \r\n";break;default:a+=t.name()+" - "+t.localizeWireValue(u[t.name()])+"\r\n"}}));var s=l.imageAttributesByImportance().filter((function(e){return e.type()!==n.SIGNATURE_TYPE}))[0];s&&(r=G.Common.FlexImageUrl(this.ResolveFile(u[s.name()],e)))}}return{body:a,image:r}}},{key:"RequiresSamplesUser",value:function(e){return e.IsPublic&&this.SYSTEM_OWNER_IDS.indexOf(e.OwnerId)>=0&&e.Behavior.AuthRequired&&"AppGallery-10305"!==e.Name}},{key:"MakeSliceMappingContext",value:function(e){var t=this.FindSliceDefinition(e);if(null!=t){var n={TableToSliceMapping:{}};return n.TableToSliceMapping[t.SourceTable]=t,n}return null}},{key:"updateVirtualColumns",value:function(e,t,n){var a=this,r=new _.NestedStore;return n.findBaseTableAttributesByType(this.TABLEREF_TYPE).forEach((function(t){var n=e[t.name()],i=B.default.findByName(t.referencedTableName(),a).table;if(i){var o=i.rootTable();if(o){var l=o.tableSchema;if(l){var u=o.lookupTableRow(n),s=null==u?void 0:u.values;if(s&&l.virtualAttributes().length){var c=new j.default(a,l,s),f=d.default.clone(s);if(c.recomputeVirtualColumns(),!d.default.isEqual(f,s)){var p=o.name();r.for(p).store(n,s),null==u||u.invalidate()}}}}}})),r}},{key:"SendQueuedChangesToRecoveryEndpoint",value:function(){return Se(this,void 0,void 0,i.default.mark((function e(){var t,n,a,r,o,l;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.GetQueuedActions()||[],n=[],a=ye(t),e.prev=3,a.s();case 5:if((r=a.n()).done){e.next=18;break}if(null==(o=r.value)){e.next=16;break}return e.prev=8,e.next=11,this.defaultDataProvider.RecordRecoveryData(this.appTemplateModel.Name,o.params);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),n.push(e.t0);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(3),a.e(e.t1);case 23:return e.prev=23,a.f(),e.finish(23);case 26:if(!n.length){e.next=30;break}throw(l=new Error(n.map((function(e){return e.message})).join("\n"))).stack=n[0].stack,l;case 30:case"end":return e.stop()}}),e,this,[[3,20,23,26],[8,13]])})))}},{key:"SendCreatorFeedback",value:function(e){var t="/api/template/"+this.appTemplateModel.Id+"/feedback";$.postJSON(t,e,(function(){}),(function(){}))}},{key:"StartGeocodingTableData",value:function(){var e=this;if(!T.default.disabled&&!this.startedGeocoding){this.startedGeocoding=!0;var t={},n=m.default.IsEditorIFramePreview()?5:25,a=function(e,t){e.length>0&&ue.AppGlobals.AppModel.WriteGeocodeResults(e,null,null,t)};this.Tables.forEach((function(r){if(!r.IsSlice){var i=e.findTableCollection(r.Name),o=i.table,l=i.tableSchema,u=i.tableDefinition;if(o&&l&&u){var s=l.findBaseTableAttributesByType("Address").filter((function(e){return e.geocodingEnabled()}));s.length&&function(){for(var r=0,i=0,c=[],f=T.default.region(u.LocaleName),p=T.default.BAD_GEO_VALUE,h=d.default.shuffle(o.rowValues()),v=0;v<h.length;v++){var m=h[v];if(!m._isGeoCoded){if(!e.appTemplateModel.IsDeployable&&r>=25)break;for(var g=0;g<s.length;g++){var y=s[g],A=m["_geo_"+y.name()];if(A){var E=A.split(",");if(2===E.length){if(Number(E[0])===p)continue;if(!(Number(E[0])>p)){m["_latitude"+y.name()]=E[0],m["_longitude"+y.name()]=E[1];continue}}}var w=m[y.name()];if(w&&w.trim())if("continue"===function(){if(w=w.trim(),T.default.addressHasBeenQueued(w))return"continue";var e=l.keyAttribute().name(),u={tableName:o.name(),rowKey:m[e],keyAttrName:e,address:w,addressAttrName:y.name()},s=function(e){var t,o;e.length?(t=e[0].latitude,o=e[0].longitude):(t=p,o=p);var l=B.default.findByName(u.tableName,ue.AppGlobals.AppModel),s=l.table,d=l.tableSchema;if(s&&d){var f=d.keyAttribute();if(d.findAttributeByName(u.addressAttrName)&&f.name()===u.keyAttrName){var h=s.findRow(u.rowKey);if(h)h[u.addressAttrName]===u.address&&(h["_latitude"+u.addressAttrName]=t,h["_longitude"+u.addressAttrName]=o,h._isGeoCoded=!0)}}if(c.push({Address:u.address,LatLong:t+","+o}),++i===r)a(c,u.tableName);else if(i>0&&i%n==0){var v=c;c=[],a(v,u.tableName)}};r++,T.default.geocodeAddress(w,{region:f}).then((function(e){var n=e.status,a=e.results;a?s(a):function(e){if(e===S.ZERO_RESULTS||e===S.INVALID_REQUEST)s([]);else{i++;var n=[S.REQUEST_DENIED];d.default.includes(n,e)&&!t[e]&&(b.default.ReportErrorOnce({errorMessage:"Geocoding of address failed",address:u.address,status:e},e),t[e]=!0,s([]))}}(n)})).catch(b.default.warnToDevConsole)}())continue}m._isGeoCoded=!0}}}()}}}))}}},{key:"WriteGeocodeResults",value:function(e,t,n,a){var r=this.appTemplateModel.Name,i=!this.appTemplateModel.IsDeployable,o=this.appTemplateModel.OwnerId,l="/api/template/geocodeResults?tableName="+encodeURIComponent(a)+"&appName="+encodeURIComponent(r)+"&ownerId="+encodeURIComponent(o)+"&isPrototype="+encodeURIComponent(i);if($.postJSON(l,e,(function(e){null!=t&&t(e)}),(function(){null!=n&&n()})),a&&this.ReadFromLocalCache&&!this.InASyncCall){var u=this.FindRootTable(a);this.WriteTableResult(u)}}},{key:"IsWhitelabelApp",value:function(){var e,t;return!!(null===(t=null===(e=this.appTemplateModel.Behavior)||void 0===e?void 0:e.Description)||void 0===t?void 0:t.IsWhitelabel)}},{key:"findTableCollection",value:function(e,t){return this.dataManager.findTableCollection(e,t)}},{key:"findReferencedRow",value:function(e,t,n){var a=e.referencedTableName();if(!a)return null;var r=this.findTableCollection(a),i=r.table,o=r.tableSchema;if(!i||!o)return null;var l=i.timestamp(),u=o.keyAttribute().name(),s={table:i,tableSchema:o,timestamp:l,appModel:this,keyAttrName:u};return t?null!=(n=null!=n?n:t.getValue(e))?t.getTableRow(i,n,s):null:null!=n?i.findRow(n):null}},{key:"RunExpression",value:function(e){return Y.default.create(e).run(new j.default(this))}},{key:"runDisplayName",value:function(e){var t=this.dataContext();return e.runAndLocalize(t)}},{key:"MapActionName",value:function(e,t){var n=this;if(!this.actionNames){var a=this.appTemplateModel.Presentation.ActionNameMappings;if(!a)return e;this.actionNames={},d.default.forEach(a,(function(e){var t=e.ActionName;if(e.NameEval){var a=Y.default.create(e.NameEval);e.NameEval.IsPure?n.actionNames[t]=n.runDisplayName(a):n.actionNames[t]=a}else n.actionNames[t]=e.DisplayName}))}var r=this.actionNames[e];return r?"function"==typeof r.run?this.runDisplayName(r):r:t||e}},{key:"Snapshot",value:function(e){b.default.Test()&&b.default.logToDevConsole("Snapshot",e.toSimpleObject()),this.ReadFromLocalCache&&this.WriteTableRows(e.toSimpleObject())}},{key:"Submit",value:function(e){var t,n,a;if(b.default.Test())b.default.logToDevConsole("Submit",e.params);else if(null!=e&&(null!==(t=ue.AppGlobals.AppModel)&&void 0!==t?t:this).EnqueueDelayedAction(e),fe.dynamicRollouts.includeByOwnerId("ClientNoPushDelay"))(this.backgroundSyncInProgress||this.InASyncCall)&&0===this.NumProcessingActions()&&(b.default.logToDevConsole("Canceling sync due to local data change"),this.CancelSync()),(null===(n=this.syncQueue)||void 0===n?void 0:n.AutomaticUpdateSync)&&(this.stopSyncQueue(),this.startSyncQueue(this.appTemplate));else if(!this.ReadFromLocalCache){var r=ue.AppGlobals.AppState.AppTemplate.Id?ue.AppGlobals.AppState.AppTemplate.Id:ue.AppGlobals.AppState.AppTemplate.Name;(0,se.$TSFixMeMaybeNull)(r);var i=(0,oe.getSyncErrorHandler)(r,null,!0);null===(a=this.syncQueue)||void 0===a||a.Check(void 0,i)}}},{key:"ResetSyncFailures",value:function(){this.syncQueue&&this.syncQueue.ResetFailures()}},{key:"NumDelayedActions",value:function(){return this.syncQueue?this.syncQueue.DelayedCount():0}},{key:"NumProcessingActions",value:function(){return this.syncQueue?this.syncQueue.ActiveCount():0}},{key:"totalRows",value:function(){return d.default.sum(this.Tables.filter((function(e){return e.Rows})).map((function(e){return e.Rows.length})))}},{key:"startSyncQueue",value:function(e){this.syncQueue||(this.syncQueue=new z.default(this)),this.syncQueue.Start(e.name());var t=null==this.storageManager.validStorageInterface,n="_restore"in(0,k.parseHash)(this.GetControlState()),a=t||n;this.syncQueue.applySyncSettings(e,a)}},{key:"stopSyncQueue",value:function(){var e;null===(e=this.syncQueue)||void 0===e||e.Stop()}},{key:"GetQueuedActions",value:function(){return null!=this.syncQueue?this.syncQueue.getQueuedActions():null}},{key:"EnqueueDelayedAction",value:function(e){null!=this.syncQueue&&this.syncQueue.Enqueue(e)}},{key:"ShouldDelaySync",value:function(){var e;return this.appTemplateModel.Behavior&&this.appTemplateModel.Behavior.DelayedSync||(null===(e=ue.AppGlobals.AppState)||void 0===e?void 0:e.pendingFormState)||this.ForceDelayedSync}},{key:"RevokeUserAccess",value:function(t){b.default.AddTraceContext("RevokeUserAccess"),b.default.logToDevConsole("revoking user access"),w.default.removeAllListeners(),ue.AppGlobals.AppModel.ClearPrivateData(),ue.AppGlobals.AppModel.Dispose(),this.syncQueue&&(this.syncQueue.AutomaticUpdateSync=!1),e.reset(),ue.AppGlobals.ViewManager.ShowErrorScreen(t||(0,X.accessDeniedErrorMessage)())}},{key:"ReadLocalState",value:function(e){this.storageManager.readLocalAppData().then((function(){return e()})).catch(e)}},{key:"WriteTableResult",value:function(e){if(e&&this.localState){ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.ShowStorageInProgress();var t=this.shouldEncryptLocalData();this.localState.WriteTableResult(e,{shouldEncrypt:t},(function(e){e&&b.default.warnToDevConsole(e),ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.HideStorageInProgress()}))}}},{key:"WriteTablesResult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.tablesToSkip;ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.ShowStorageInProgress();var a=this.shouldEncryptLocalData();this.localState.WriteTablesResult(e,{tablesToSkip:n,shouldEncrypt:a},(function(e){e&&b.default.warnToDevConsole(e),ue.AppGlobals.ViewManager&&ue.AppGlobals.ViewManager.HideStorageInProgress()}))}},{key:"WriteTableRows",value:function(e){var t=this;d.default.keys(e).forEach((function(n){var a=t.FindRootTable(n),r=t.shouldEncryptLocalData();t.localState.writeTableRows(a,e[n],{shouldEncrypt:r})}))}},{key:"SetControlState",value:function(e){var t;"string"==typeof e&&e.length&&e.indexOf("appName=")<0&&(e="appName=".concat(this.appTemplateModel.Name,"&")+e),null===(t=this.localState)||void 0===t||t.WriteControlState(e)}},{key:"SetViewState",value:function(e){var t;null===(t=this.localState)||void 0===t||t.WriteViewState(e)}},{key:"WriteSyncResultToLocalStorage",value:function(e,t){var n,a=this.dynamicRollouts.getStorageFormat(),r=a.userDynamicRollouts,i=a.ownerDynamicRollouts;return Promise.all([e||null===(n=this.localState)||void 0===n?void 0:n.writeTemplateResult(this.AppTemplate),this.localState.writeOwnerRollouts(i),this.localState.writeSyncToken(t),J.default.writeUserRollouts(r)])}},{key:"NeedsUsageScopesConsent",value:function(){return this.inRollout("userConsent")&&!this.appTemplate.hasValidUsageScopesConsent()}},{key:"RecordUsageScopesConsent",value:function(){var e,t;this.InASyncCall||(this.appTemplate.recordUsageScopesConsent(),null===(t=null===(e=this.localState)||void 0===e?void 0:e.writeTemplateResult(this.AppTemplate))||void 0===t||t.catch((function(e){b.default.ReportError({errorMessage:"Error saving consents to local storage",nestedErrorMessage:(0,ie.asError)(e).message})})),$.postJSON("/api/template/"+this.appTemplateModel.Id+"/userconsent?consentedScopes="+encodeURIComponent(this.appTemplateModel.Behavior.UserConsentedScopes)+"&clientId="+encodeURIComponent(this.GetClientId())),this.SetupGeolocationListener(),ue.AppGlobals.StateChangeHandler.RefreshAppData({initiatedBy:"AppStart"}))}},{key:"AddToImageCache",value:function(e,t){this.localState.AddToImageCache(e,t)}},{key:"SyncSuccess",value:function(e){var t,n=new _.NestedStore,a={},r=ye(this.Tables);try{for(r.s();!(t=r.n()).done;){var i=t.value;!i.IsSlice&&i.Timestamp&&(a[i.Name]=i.Timestamp,n&&n.for(i.Name).store({time:i.Timestamp,etag:i.ETag}))}}catch(e){r.e(e)}finally{r.f()}this.localState.WriteSyncSuccess(this.DataStamp,a,null==n?void 0:n.toSimpleObject(),e),this.MaybeClearImageCache()}},{key:"findPendingImages",value:function(){var e,t,n,a,r=d.default.values(this.dataContext().pendingSaves().byId).map((function(e){return e.rowData})),i=null!==(e=this.GetQueuedActions())&&void 0!==e?e:[],l=null!==(n=null===(t=ke())||void 0===t?void 0:t.GetQueuedActions())&&void 0!==n?n:[],u=null!==(a=[].concat((0,o.default)(i),(0,o.default)(l)).map((function(e){return e.params.row})))&&void 0!==a?a:[];return[].concat((0,o.default)(r),(0,o.default)(u)).reduce((function(e,t){return[].concat((0,o.default)(e),(0,o.default)(d.default.values(t).filter(V.isImageHandle).map((function(e){return V.default.from(e)}))))}),[])}},{key:"hasPendingImages",value:function(){return this.findPendingImages().length>0}},{key:"MaybeClearImageCache",value:function(){this.LocalStateIsValid()&&!this.hasPendingImages()?this.ClearImageCache():R.logger.logEvent(new ne.AppEvent(I.AppEventName.SkippedClearImageCache))}},{key:"SyncFailure",value:function(){this.localState&&this.localState.WriteSyncFailure()}},{key:"ClearPersistedActions",value:function(){var e;this.syncQueue?this.syncQueue.Clear(!0):(null===(e=ue.AppGlobals.AppState)||void 0===e?void 0:e.AppTemplate)&&z.default.RemovePersistedActions(ue.AppGlobals.AppState.AppTemplate.Name)}},{key:"ClearTemplateData",value:function(){var e=this;this.storageManager&&this.storageManager.clearTables().then((function(){return e.storageManager.clearTemplate()})).catch(b.default.warnToDevConsole)}},{key:"ClearControlState",value:function(){this.storageManager&&this.storageManager.clearControlState().catch(b.default.warnToDevConsole)}},{key:"ClearPrivateData",value:function(){this.ClearPersistedActions(),this.ClearLocalState()}},{key:"ClearLocalState",value:function(){this.storageManager&&this.storageManager.clearAll().catch(b.default.warnToDevConsole)}},{key:"ClearImageCache",value:function(){V.default.clearCache(),this.storageManager&&(this.storageManager.clearImageCache().catch(b.default.warnToDevConsole),this.storageManager.clearFilePaths().catch(b.default.warnToDevConsole))}},{key:"LocalStateIsValid",value:function(){return!!this.localState&&this.localState.IsValid()}},{key:"GetClientId",value:function(){var e;return null===(e=this.localState)||void 0===e?void 0:e.GetClientId()}},{key:"GetViewState",value:function(){return this.localState.readViewState()}},{key:"GetControlState",value:function(){var e=this.localState&&this.localState.GetControlState();if(null!=e&&""!==e&&"null"!==e)try{var t=(0,k.parseHash)(e);if("_restore"in t){var n=JSON.parse(t._restore);(null==n.timestamp||new Date-new Date(n.timestamp)>=this.FORM_RESTORE_STATE_TIMEOUT_MS)&&(delete t._restore,e=(0,D.sortedParams)(t))}}catch(e){b.default.warnToDevConsole(e)}return e}},{key:"GetTablesResult",value:function(){var e;return null===(e=this.localState)||void 0===e?void 0:e.GetTablesResult()}},{key:"GetTemplateResult",value:function(){var e;return null===(e=this.localState)||void 0===e?void 0:e.GetTemplateResult()}},{key:"GetFromImageCache",value:function(e){var t;return null===(t=this.localState)||void 0===t?void 0:t.GetFromImageCache(e)}},{key:"SyncInfo",get:function(){return this.localState&&this.localState.SyncInfo||{}}},{key:"lastSyncTimeMs",value:function(e){var t=this.SyncInfo.LastSyncAt,n=e&&this.pendingAppModel&&this.pendingAppModel.DataStamp,a=t?new Date(t).getTime():null,r=n?new Date(n).getTime():null;return Math.max(a,r)||null}},{key:"lastSuccessfulSyncTime",value:function(){return this.SyncInfo.LastSuccessfulSyncAt}},{key:"lastSuccessfulSyncTimeMs",value:function(){var e=this.SyncInfo.LastSuccessfulSyncAt;return e?new Date(e).getTime():null}},{key:"lastSyncedWithin",value:function(e){var t=this.lastSuccessfulSyncTimeMs();return null!=t&&Date.now()-t<e}},{key:"lastTableTimestamp",value:function(e){var t=this.SyncInfo.LastSyncTableTimestamps;return null==t?void 0:t[e]}},{key:"lastSyncTableParams",value:function(e){var t;return(null!==(t=this.SyncInfo.LastSyncTableParams)&&void 0!==t?t:{})[e]}}],[{key:"reset",value:function(){_e(new e)}}]),e}();t.default=Me},513954:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.convertImages=void 0;var r=a(n(238416)),i=a(n(593186)),o=a(n(895466)),l=n(318926),u=n(218546),s=a(n(962553)),c=a(n(496486)),d=a(n(948415)),f=n(263198),p=n(351101),h=n(166089),v=n(700482),m=n(149313),g=function(e){return Date.now()-new Date(e).getTime()},y=function(e){return e?Math.floor(g(e)/1e3):void 0},b=function(e,t){var n;return t?(n={},(0,r.default)(n,"was".concat(e,"ThisSession"),function(e){return new Date(e).getTime()>window.AppSheetPageLoadTime}(t)),(0,r.default)(n,"secondsSince".concat(e),y(t)),(0,r.default)(n,"hasSyncedSince".concat(e),function(e){return(0,p.getAppModel)().lastSyncedWithin(g(e))}(t)),n):{}},T=function(e,t){try{return Object.assign(Object.assign(Object.assign({mediaType:t.mediaType(),imageHandleType:t.type(),imageHandleValue:t.value(),imageResolution:(0,p.getAppModel)().appTemplate.imageResolution},b("Captured",t.timestamp())),b("Enqueued",e.timestamp)),{secondsSincePhotoStorageCleared:y(f.JeeneeBrowserAPI.lastClearPhotoStorageTime)})}catch(e){return{getErrorReportParamsFailed:e.message}}},S=function(e,t){for(var n=[],a=[],r=0;r<t.model.Attributes.length;r++){var i=t.model.Attributes[r];null!=i&&i.IsValid&&(e.hasOwnProperty(i.Name)?n.push(e[i.Name]):n.push(null),a.push(!!i.IsSensitive))}return{row:n,pii:a}},A=function(e,t,n,a,r){i.default.AddTraceContext("convertImages");var l=function(a,r){setTimeout((function(){var l=o.default.from(n[a],t.sourceTableName());if(l.isValid()){var u=l.filePath();u?(n[a]=u,i.default.AddTraceContext("filePath",{attrName:a,filePath:u}),r()):(i.default.AddTraceContext("getUrlForSync",{attrName:a}),l.getUrlForSync((function(o,u){if(o)return i.default.AddTraceContext("getUrlForSync errored",{attrName:a}),i.default.ReportErrorOnce(Object.assign({errorMessage:"getUrlForSync errored",nestedErrorMessage:o},T(e,l))),void r(o);var s;(null==u||u.startsWith(f.UNABLE_TO_LOAD_IMAGE_PREFIX))&&i.default.ReportErrorOnce(Object.assign({errorMessage:"getUrlForSync returned bad imageUrl",imageUrl:u},T(e,l))),n[a]=u,i.default.AddTraceContext("getUrlForSync succeeded",{attrName:a}),r(null,{attrName:a,imageHandle:l,tableName:t.sourceTableName(),fileName:(s=n,s[t.keyAttribute().name()]+"."+a)})})))}else i.default.ReportErrorOnce(Object.assign({errorMessage:"Tried to upload invalid ImageHandle",imageHandle:l.toDebugString()},T(e,l))),r()}),0)},u=t.allBaseTableAttributes().filter((function(e){return e.isValid()&&function(e){return c.default.includes(v.imageHandleColumnTypes,e.type())}(e)})).map((function(e){return l.bind(undefined,e.name())}));(0,d.default)(u,(function(e,t){e?r(e):a(c.default.compact(t))}))};t.convertImages=A;var E=function(e,t){var n={};e.forEach((function(e){var a=e.attrName;if(a in t){var r=o.default.from(e.imageHandle);r.setFilePath(t[a]),(0,m.$TSFixMeMaybeNull)(h.AppGlobals.AppModel.syncQueue),h.AppGlobals.AppModel.syncQueue.queuedActions.forEach((function(e){r.equals(e.params.row[a])&&((0,m.$TSFixMeMaybeNull)(h.AppGlobals.AppModel.syncQueue),h.AppGlobals.AppModel.syncQueue.PersistAction(e))})),n[e.tableName]=!0}})),h.AppGlobals.AppModel.ReadFromLocalCache&&c.default.keys(n).forEach((function(e){var t=h.AppGlobals.AppModel.FindRootTable(e);t&&h.AppGlobals.AppModel.WriteTableResult(t)}))},w={SerializeAction:function(e){return JSON.stringify(e.params)},DeSerializeAction:function(e){var t=JSON.parse(e);if(null==t)return null;switch(t.actionType){case"AddTableRow":return new w.AddTableRowAction(t);case"DeleteTableRow":return new w.DeleteTableRowAction(t);case"UpdateTableRow":return new w.UpdateTableRowAction(t)}return null}};w.AddTableRowAction=function(e){var t,n,a=this;this.params=e,e.actionType="AddTableRow",void 0===e.appId&&void 0===e.appName&&(e.appId=h.AppGlobals.AppState.AppTemplate.Id,e.appName=h.AppGlobals.AppState.AppTemplate.Name),void 0===e.appVersion&&(e.appVersion=h.AppGlobals.AppState.AppTemplate.Version),void 0===e.failureCount&&(e.failureCount=0),void 0===e.requestId&&(e.requestId=Math.floor(1e8*Math.random())),void 0===e.timestamp&&(e.timestamp=(new Date).toISOString()),void 0===e.syncToken&&(e.syncToken=null===(n=null===(t=h.AppGlobals.AppModel)||void 0===t?void 0:t.localState)||void 0===n?void 0:n.GetSyncToken()),this.ActionType=function(){return a.params.actionType},this.RequestId=function(){return a.params.requestId},this.Execute=function(e,t){a.params.deleteThisAction?"function"==typeof e&&e():function(e,t,n){i.default.AddTraceContext("DBAddTableRow");var a=h.AppGlobals.AppModel.findTableCollection(e.tableName),r=a.rootTable,o=a.rootTableSchema,s=a.tableDefinition;if(!r||!o||!s)return void n("Table ".concat(e.tableName," not found"));e.tableName=r.name();var c={};for(var d in e.row)e.row.hasOwnProperty(d)&&(c[d]=e.row[d]);var f=function(e,t){h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof n&&n(e,t)};A(e,o,c,(function(n){var a=function(e){e.Success?(e.RowValues&&E(n,e.RowValues),e.ReturnedFromCache&&l.logger.logAppEvent({eventName:u.AppEventName.UsedCachedAddResponse}),h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof t&&t(e.HasWarning?e.ErrorDescription:null)):f(e.ErrorDescription)};h.AppGlobals.AppModel.numOutstandingRequests++;var r=S(c,o),i=null!=e.appId?e.appId:null!=e.appName?e.appName:h.AppGlobals.AppModel.AppTemplate.Id;h.AppGlobals.AppModel.defaultDataProvider.AddTableRow(i,e,r,a,f)}),f)}(a.params,(function(t){"function"==typeof e&&null!=e&&e(t)}),(function(e,n){"function"==typeof t&&null!=t&&t(e,n)}))}},w.DeleteTableRowAction=function(e){var t,n,a=this;this.params=e,e.actionType="DeleteTableRow",void 0===e.appId&&void 0===e.appName&&(e.appId=h.AppGlobals.AppState.AppTemplate.Id,e.appName=h.AppGlobals.AppState.AppTemplate.Name),void 0===e.appVersion&&(e.appVersion=h.AppGlobals.AppState.AppTemplate.Version),void 0===e.failureCount&&(e.failureCount=0),void 0===e.requestId&&(e.requestId=Math.floor(1e8*Math.random())),void 0===e.timestamp&&(e.timestamp=(new Date).toISOString()),void 0===e.syncToken&&(e.syncToken=null===(n=null===(t=h.AppGlobals.AppModel)||void 0===t?void 0:t.localState)||void 0===n?void 0:n.GetSyncToken()),this.ActionType=function(){return a.params.actionType},this.RequestId=function(){return a.params.requestId},this.Execute=function(e,t){a.params.deleteThisAction?"function"==typeof e&&e():function(e,t,n){i.default.AddTraceContext("DBDeleteTableRow");var a=h.AppGlobals.AppModel.findTableCollection(e.tableName),r=a.rootTable,o=a.rootTableSchema,s=a.tableDefinition;if(!r||!o||!s)return void n("Table ".concat(e.tableName," not found"));e.tableName=r.name();var c=function(e,t){h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof n&&n(e,t)},d=function(e){e.Success?(e.ReturnedFromCache&&l.logger.logAppEvent({eventName:u.AppEventName.UsedCachedDeleteResponse}),h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof t&&t(e.HasWarning?e.ErrorDescription:null)):c(e.ErrorDescription)};h.AppGlobals.AppModel.numOutstandingRequests++;var f=S(e.row,o),p=null!=e.appId?e.appId:null!=e.appName?e.appName:h.AppGlobals.AppModel.AppTemplate.Id;h.AppGlobals.AppModel.defaultDataProvider.DeleteTableRow(p,e,f,d,c)}(a.params,(function(t){"function"==typeof e&&null!=e&&e(t)}),(function(e,n){"function"==typeof t&&null!=t&&t(e,n)}))}},w.UpdateTableRowAction=function(e){var t,n,a=this;this.params=e,e.actionType="UpdateTableRow",void 0===e.appId&&void 0===e.appName&&(e.appId=h.AppGlobals.AppState.AppTemplate.Id,e.appName=h.AppGlobals.AppState.AppTemplate.Name),void 0===e.appVersion&&(e.appVersion=h.AppGlobals.AppState.AppTemplate.Version),void 0===e.failureCount&&(e.failureCount=0),void 0===e.requestId&&(e.requestId=Math.floor(1e8*Math.random())),void 0===e.timestamp&&(e.timestamp=(new Date).toISOString()),void 0===e.syncToken&&(e.syncToken=null===(n=null===(t=h.AppGlobals.AppModel)||void 0===t?void 0:t.localState)||void 0===n?void 0:n.GetSyncToken()),this.ActionType=function(){return a.params.actionType},this.RequestId=function(){return a.params.requestId},this.Execute=function(e,t){a.params.deleteThisAction?"function"==typeof e&&e():function(e,t,n){i.default.AddTraceContext("DBUpdateTableRow");var a=s.default.findByName(e.tableName),r=a.table,o=a.tableSchema,c=a.tableDefinition;if(!r||!o||!c)return void n("Table ".concat(e.tableName," not found"));var d={};for(var f in e.row)e.row.hasOwnProperty(f)&&(d[f]=e.row[f]);var p=function(e,t){h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof n&&n(e,t)};A(e,o,d,(function(n){var a=function(e){e.Success?(e.RowValues&&E(n,e.RowValues),e.ReturnedFromCache&&l.logger.logAppEvent({eventName:u.AppEventName.UsedCachedUpdateResponse}),h.AppGlobals.AppModel.numOutstandingRequests--,"function"==typeof t&&t(e.HasWarning?e.ErrorDescription:null)):p(e.ErrorDescription)};h.AppGlobals.AppModel.numOutstandingRequests++;var r=null!=o.sliceDefinition?function(e,t){for(var n=t.sliceDefinition,a=[],r=[],i=0;i<n.Columns.length;i++){var o=n.Columns[i];if(null!=o){e.hasOwnProperty(o)?a.push(e[o]):a.push(null);var l=t.findAttributeByName(o).model;r.push(!!(null==l?void 0:l.IsSensitive))}}return{row:a,pii:r}}(d,o):S(d,o),i=null!=e.appId?e.appId:null!=e.appName?e.appName:h.AppGlobals.AppModel.AppTemplate.Id;h.AppGlobals.AppModel.defaultDataProvider.UpdateTableRow(i,e,r,a,p)}),p)}(a.params,(function(t){"function"==typeof e&&null!=e&&e(t)}),(function(e,n){"function"==typeof t&&null!=t&&t(e,n)}))}};var C=w;t.default=C},959191:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.filterDefaultsToIndexLookup=function(e,t){return e.map((function(e){var n=e.ColumnName,a=e.ColumnValue;return{attribute:t.findAttributeByName(n),value:a}}))},t.filterDefaultsToLookupValues=function(e){if(!(null==e?void 0:e.length))return null;var t,n={},a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){u=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw o}}}}(e);try{for(a.s();!(t=a.n()).done;){var r=t.value,o=r.ColumnName,l=r.ColumnValue;if(n.hasOwnProperty(o)&&n[o]!==l)return null;n[o]=l}}catch(e){a.e(e)}finally{a.f()}return n},t.lookupValuesToFilterDefaults=function(e){return r.default.keys(e).map((function(t){return{ColumnName:t,ColumnValue:e[t]}}))},t.lookupValuesToIndexLookup=function(e,t){return r.default.keys(e).map((function(n){return{attribute:t.findAttributeByName(n),value:e[n]}}))};var r=a(n(496486));function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}},710229:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.TransactionErrorState=void 0;var i=a(n(600861)),o=a(n(856690)),l=a(n(689728)),u=a(n(861655)),s=a(n(994993)),c=a(n(73808)),d=a(n(496486)),f=n(365914),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(593186)),h=a(n(962553)),v=a(n(195508)),m=a(n(385857)),g=a(n(494012)),y=n(557310),b=n(306593),T=n(44617);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,c.default)(e);if(t){var r=(0,c.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,s.default)(this,n)}}var C=p.default.logToDevConsole,O=function(){return y.ReactRootUIConfig.isReactRoot()&&T.dynamicRollouts.includeByOwnerId("ReactAppDeferRefVCs")},_=function(e){(0,u.default)(n,e);var t=w(n);function n(e,a){var r;return(0,o.default)(this,n),(r=t.call(this)).appModel=e,r.transaction=a,r}return(0,l.default)(n,[{key:"isValid",value:function(){return!this.error&&!this.message}},{key:"message",get:function(){var e,t=this;return this.error?this.error:(this.forEach((function(n,a){if(!e){var r=t.appModel.findTableCollection(n),i=r.table,o=r.tableSchema;a.forEach((function(n,a){if(!e){var r=a.message,l=a.invalid,u=a.missingRequired;if(r)e=r;else if(null==l?void 0:l.length){var s,c=l[0],d="This entry is invalid",f=t.appModel.MapActionName(d);if(i&&o){var p=i.lookupTableRow(n,t.transaction);if(p){var h=new m.default(t.appModel,o,p.values),v=o.findAttributeByName(c);if(v){c=v.displayName(h);var g=v.invalidMessageEvalTree();g&&(s=g.run(h))}}}s=s||f!==d?"".concat(c,": ").concat(s||f):"".concat(c," is invalid"),e=s}else if(null==u?void 0:u.length){var y,b=u[0],T="This entry is required",S=t.appModel.MapActionName(T);if(i&&o){var A=i.lookupTableRow(n,t.transaction);if(A){var E=new m.default(t.appModel,o,A.values),w=o.findAttributeByName(b);w&&(b=w.displayName(E))}}y=S!==T?"".concat(b,": ").concat(S):"".concat(b," is required"),e=y}}}))}})),e)}}]),n}(f.NestedStore);t.TransactionErrorState=_;var k=function(){function e(t){var n=this;(0,o.default)(this,e),this.appModel=t,this.updateLog=[],this.transactions=new Map,this.tableCache=new Map,this.tablesToDispose=new Set,this.newRowLookup=new Map;var a=this.transactions,r=function(e){var t=n.getTransaction(e.transactionId);t.started||"START"===e.type||t.start();var a=Object.assign({id:n.updateLog.length},e);return n.updateLog.push(a),a},l=function(e,t,a,r,i){var o=n.findTableCollection(t),l=o.rootTable,u=o.rootTableSchema,s=null==l?void 0:l.lookupTableRow(a,e);if(s&&l&&u){var c=s.stableId,d=l.name(),f=r?u.findAttributeByName(r):void 0,p=f&&s.get(f.name());i({rootTableName:d,rootTable:l,rootTableSchema:u,tableRow:s,attribute:f,stableId:c,currentValue:p})}},u=function(e,t,n,a){var r=n.snapshot(),i=e.getInitialRowValues(t,a)||r,o=e.getRecordsForRow(t,a),l=o.length?void 0:n.validate({usedTransactions:!0,transaction:e}),u=d.default.keyBy(o.map((function(e){return e.columnName})));return{before:r,initialData:i,recordsForRow:o,initialErrorState:l,userEdited:u}},s=function(e,t){if(y.ReactRootUIConfig.isReactRoot())return function(e,t){var a=e.type,r=e.tableName,i=!1;if(["CREATE","UPDATE","DELETE","RECOMPUTE"].includes(a)){C("undoing",e);var o=n.findTableCollection(r).rootTable;if(o&&(i=!0,"CREATE"===a&&o.deleteRowByStableId(e.stableId,t),"DELETE"===a&&o.createRow(e.before,t),"UPDATE"===a||"RECOMPUTE"===a)){var l=e.rowId,u=e.before,s=e.after,c=e.stableId,d=o.lookupTableRow(c,t);if(d)d.resetValues(u);else{(0,p.doWeEverHitThis)("undoDataChanges unable to find row by stableId");var f=s[o.keyAttribute().name()];o.resetRowValues(null!=f?f:l,u,t)}}}return i}(e,t);var a=e.type,r=e.tableName,i=!1;if(["CREATE","UPDATE","DELETE","RECOMPUTE"].includes(a)){C("undoing",e);var o=n.findTableCollection(r),l=o.rootTable,u=o.rootTableSchema;if(l&&u&&(i=!0,"CREATE"===a&&l.deleteRow(e.rowId),"DELETE"===a&&l.createRow(e.before),"UPDATE"===a||"RECOMPUTE"===a)){var s=u.keyAttribute().name(),c=e.rowId,d=e.before,f=e.after[s];l.resetRowValues(null!=f?f:c,d)}}return i},c=function(e,t,a,r){var i=t.refColumnName,o=t.tableName,l=t.stableId;if(t.multiselect){var u=n.findTableCollection(o),s=u.rootTable,c=u.rootTableSchema,f=null==s?void 0:s.lookupTableRow(l,e),p=null==c?void 0:c.findAttributeByName(i);if(f&&"EnumList"===(null==p?void 0:p.type())){var h=f.get(i),v=p.valueFromWireFormat(h);if(Array.isArray(v)){var m=d.default.lastIndexOf(v,r);m>-1?v[m]=a:v.push(a);var g=p.valueToWireFormat(v);e.update(o,l,i,g)}}}else e.update(o,l,i,a)},v=function(e,t,a){var r;if(T.dynamicRollouts.includeByOwnerId("TransactionRecomputeInfluenced")){var o,l=function(n){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n!==t){n.onDataChange(t);var i=n.tableSchema,o=n.tableName,l=n.stableId,u=r?i.virtualAttributesThatDependOn(t.tableName):i.dynamicAttributesThatDependOn(t.tableName,n.isNewRow());u.length&&e.recompute(o,l,{virtualOnly:r,triggeredBy:a.id,theseAttributesAndInfluenced:u})}},u=e.getAffectedRows(),s=t.getReferencedRows(e),c=e.getRecordsOfTypeForRow(t.tableName,t.stableId,"CREATE")[0];if(c&&c.stableReference){var f=c.stableReference,p=f.tableName,h=f.stableId,v=f.referencedTableName,m=f.referencedStableId;o=null!==(r=s.find((function(e){return e.stableId===m&&e.tableName===v})))&&void 0!==r?r:u.find((function(e){return e.stableId===h&&e.tableName===p}))}var g=new Set([].concat((0,i.default)(u),(0,i.default)(s)));o&&g.add(o);var y,b=A(g);try{for(b.s();!(y=b.n()).done;){var S=y.value;l(S,S!==o)}}catch(e){b.e(e)}finally{b.f()}}else for(var E=new Set,w=d.default.concat(e.getAffectedRows(),t.getReferencedRows(e));w.length;){var C=w.pop();if(!E.has(C)){E.add(C);var O=e.logRecords.length;C.onDataChange(t,e,a);var _=e.logRecords.slice(O);n.appModel.onDataChange({logDelta:_,transaction:e})}}},m=function(e,t,n,a){(!O()||!e.currentGroupStartedBy)&&v(e,t,n),a||function(e,t,n){var a=n.before,r=n.after,i=t.keyAttribute.name();if(r&&i in r){var o,l=a&&a[i],u=r[i],s=A(e.getStableReferencesTo(t));try{for(s.s();!(o=s.n()).done;){var d=o.value;c(e,d,u,l)}}catch(e){s.e(e)}finally{s.f()}}}(e,t,n),"stableReference"in n&&t.invalidate()},S=function(e){var t=[],a=[],r=n.getStartRecord(e.id);r&&n.getActiveRecordsPartitionedByStableId(e.id).forEach((function(e,i){var o=n.findTableCollection(e).rootTable,l=o&&o.keyAttribute().name();i.forEach((function(n,i){if(d.default.some(i,(function(e){return!("RECOMPUTE"===e.type&&e.virtualOnly)}))){var o,u,s,c,f=r.appId,p=r.appName,h=r.appVersion,v=r.userSettings,m=d.default.first(i),g=d.default.last(i),y=d.default.uniq(i.map((function(e){return e.tableName}))),b=1===y.length?y[0]:e;if("CREATE"!==m.type||"DELETE"!==g.type)"DELETE"===g.type?(o="DeleteTableRow",u=m.before,s=m.rowId):"CREATE"===m.type?(o="AddTableRow",u=d.default.extend({},g.before,g.after),s=null!=l&&null!=u[l]?u[l]:g.rowId):(o="UpdateTableRow",u=d.default.extend({},g.before,g.after),s=g.rowId),t.push((c={appId:f,appName:p,appVersion:h,userSettings:v,type:o,tableName:b,row:u,rowKey:s},d.default.omitBy(c,d.default.isNil))),a.push(n)}}))}));return{requests:t,stableIds:a}};this.handlers={onStart:function(e){var t;if(!e.started){var a=n.appContext,i=a.appId,o=a.appName,l=a.appVersion,u=a.userSettings;t=r({type:"START",transactionId:e.id,appId:i,appName:o,appVersion:l,userSettings:u})}return t},onStartGroup:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.viewStateKey,a=r({type:"START_GROUP",transactionId:e.id,viewStateKey:n});return C("group ".concat(a.id," was started in ").concat(e.id)+(n?" by ".concat(n):"")),a},onEndGroup:function(e){if(!O()){for(var t,a,i=e.lastRecord,o=i,l=1;o&&(i===o||l>0);){if("END_GROUP"===o.type&&l++,"START_GROUP"===o.type&&0===--l){t=o.id;break}o=n.getPreviousRecord(o)}return null!=t&&(a=r({type:"END_GROUP",transactionId:e.id,ends:t}),C("group ".concat(t," was ended in ").concat(e.id))),a}var u=n.getOpenGroupRecords(e.id)[0];if(null!=u){var s,c=e.activeRecords,d=c.indexOf(u),f=c.slice(d),p=e.getAffectedRows(f),h=r({type:"END_GROUP",transactionId:e.id,ends:u.id}),m=A(p);try{for(m.s();!(s=m.n()).done;){var g=s.value;v(e,g,h)}}catch(e){m.e(e)}finally{m.f()}return C("group ".concat(u.id," was ended in ").concat(e.id)),h}},onCreate:function(e,a,i){var o,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=l.referencedBy,s=l.hasReferenceTo,d=l.rowStateColumnNames,f=n.findTableCollection(a),p=f.rootTable;if(p){var h=e.logRecords.length,v=!1,g=p.createNewRow({initialValues:i,transaction:e,onDynamicValueChanged:function(t,n){u&&t.isKey()&&(c(e,u,n),v=!0)}}),y=g.snapshot(),b=g.validate({usedTransactions:!0,transaction:e}),T=p.name(),S=u?Object.assign(Object.assign({},u),{referencedTableName:T,referencedStableId:g.stableId}):s?Object.assign(Object.assign({},s),{tableName:T,stableId:g.stableId}):void 0;o=r({type:"CREATE",timestamp:Date.now(),transactionId:e.id,rowId:g.keyValue,stableId:g.stableId,initialErrorState:b,tableName:T,rootTableName:T,after:y,stableReference:S,rowStateColumnNames:d}),n.newRowLookup.set(g.stableId,g);var A=e.logRecords.slice(h);t.onDataChange({transaction:e,logDelta:A}),m(e,g,o,v),C("add came through",e.id,y)}return o},onRecompute:function(e,n,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=o.virtualOnly,c=void 0!==s&&s,f=o.theseAttributesAndInfluenced,p=o.triggeredBy;return l(e,n,a,void 0,(function(o){var l=o.rootTableName,s=o.rootTable,h=o.tableRow,v=o.stableId,m=u(e,n,h,v),g=m.before,b=m.initialData,T=m.initialErrorState,S=m.userEdited;y.ReactRootUIConfig.isReactRoot()&&(h=s.getPendingRow(h,e));var A=h.recompute({initialData:b,virtualOnly:c,userEdited:S,transaction:e,theseAttributesAndInfluenced:f}),E=d.default.pickBy(h.snapshot(),(function(e,t){return g[t]!==e}));if(!d.default.isEmpty(E)){var w=s.tableSchema.findAttributesByNames(Object.keys(E)),O=e.logRecords.length;i=r({type:"RECOMPUTE",timestamp:Date.now(),transactionId:e.id,initialErrorState:T,tableName:n,rootTableName:l,rowId:a,stableId:v,before:g,after:E,virtualOnly:c||d.default.every(w,(function(e){return e.isVirtual()})),triggeredBy:p,wasReset:A});var _=e.logRecords.slice(O);t.onDataChange({transaction:e,logDelta:_}),C("recompute came through",e.id,E)}})),i},onUpdate:function(e,n,a,i,o,s,c){var f;return l(e,n,a,i,(function(l){var p=l.rootTableName,h=l.rootTable,v=l.tableRow,g=l.stableId,b=l.attribute,T=l.currentValue;if(b&&T!==o){var S=u(e,n,v,g),A=S.before,E=S.initialData,w=S.recordsForRow,O=S.initialErrorState,_=S.userEdited;_[i]=i,y.ReactRootUIConfig.isReactRoot()&&(v=h.getPendingRow(v,e));var k=0===w.length,R=v.update(b,o,{initialData:E,userEdited:_,updateInfluenced:!k,transaction:e});k&&v.recompute({initialData:E,wasReset:R,userEdited:_,transaction:e});var I=d.default.pickBy(v.snapshot(),(function(e,t){return A[t]!==e}));if(!d.default.isEmpty(I)){var N=e.logRecords.length;f=r({type:"UPDATE",timestamp:Date.now(),transactionId:e.id,initialErrorState:O,tableName:n,rootTableName:p,rowId:a,stableId:g,columnName:i,value:o,before:A,after:I,mechanism:s,wasReset:R,rowStateColumnNames:c});var M=e.logRecords.slice(N);t.onDataChange({transaction:e,logDelta:M}),m(e,v,f),C("update came through",e.id,I)}}})),f},onDelete:function(e,a,i){var o,l=n.findTableCollection(a).rootTable;if(l){var u=l.lookupTableRow(i,e),s=u&&u.snapshot();if(s&&u){var c=u.stableId,d=l.name(),f=e.logRecords.length;o=r({type:"DELETE",timestamp:Date.now(),transactionId:e.id,tableName:d,rootTableName:d,rowId:i,stableId:c,before:s}),y.ReactRootUIConfig.isReactRoot()?l.deleteRowByStableId(c):l.deleteRow(i);var p=e.logRecords.slice(f);t.onDataChange({transaction:e,logDelta:p}),m(e,u,o),C("deleted via transaction",o)}}return o},onUndo:function(e){var a,i;if(e.started){var o=e.lastActiveRecord;if(o&&o!==e.startRecord){var l=null!==(a=o.ends)&&void 0!==a?a:o.triggeredBy;i=r({type:"UNDO",timestamp:Date.now(),transactionId:e.id,undoes:null!=l?l:o.id});var u=s(o,e);if(null!=l)for(;o&&o.id!==l;)u=s(o,e)||u,o=n.getPreviousActiveRecord(o);u&&t.onDataChange({transaction:e}),C("undo finished",i,e.logRecords)}}return i},onAbort:function(e){var i,o=n.getStartRecord(e.id);if(o&&(i=r({type:"ABORT",transactionId:e.id}),!h.default.usePendingChangesStore)){var l=!1,u=e.lastActiveRecord;for(C("ABORT running undoDataChanges");u&&u!==o;)l=s(u,e)||l,u=n.getPreviousActiveRecord(u);l&&t.onDataChange()}return C("aborted transaction",e.id),h.default.usePendingChangesStore||a.delete(e.id),i},onValidate:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getAffectedRows(),r=new _(t,e);return e.closed?(r.error="Transaction is already closed",r):(d.default.compact(a).forEach((function(t){var a,i,o=t.tableName,l=t.stableId,u=e.wasModified(o,l);if(y.ReactRootUIConfig.isReactRoot()){var s=e.getRecordsForRow(o,l).filter((function(e){return"RECOMPUTE"!==e.type})),c=s[s.length-1],f=(null==c?void 0:c.rowStateColumnNames)||[],p=n.appModel.findTableCollection(o).tableSchema,h=(null==p?void 0:p.findAttributesByNames(f))||[];h.length>0&&(i=new b.Paging(h))}var v=t.validate({usedTransactions:!0,transaction:e,enforceStableKey:!t.isNewRow(),paging:i}),m=v;y.ReactRootUIConfig.isReactRoot()&&e.wasCreated(l)?m=null:u&&(m=null!==(a=e.getInitialErrorState(o,l))&&void 0!==a?a:null);var T=g.default.diffErrorState(m,v);if(T){var S=t.keyValue,A=r.for(o).get(S)||{},E=d.default.clone(A);if(T.invalid){var w=A.invalid||[];E.invalid=d.default.uniq(d.default.concat(w,T.invalid))}if(T.missingRequired){var C=A.missingRequired||[];E.missingRequired=d.default.uniq(d.default.concat(C,T.missingRequired))}T.message&&(E.message=T.message),r.for(o).store(S,E)}})),r)},onCommitAsync:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.localOnly,l=void 0!==o&&o;return new Promise((function(i,o){var u=e.validate();if(u.isValid()){if(e.closed)return u.error="Transaction is already closed",void o(new Error(u.message));if(O())for(;e.currentGroupStartedBy;)e.endGroup();var s=S(e),c=s.requests,d=s.stableIds;if(!c.length)return C("committed (NOOP)",e.id,e.logRecords),h.default.usePendingChangesStore||a.delete(e.id),void i(void 0);var p=function(o){d.forEach((function(e){var t=n.newRowLookup.get(e);t&&t.commitRowId()}));var l,u=A(e.affectedRootTables);try{for(u.s();!(l=u.n()).done;){l.value.commitPendingChanges(e)}}catch(e){u.e(e)}finally{u.f()}var s,c=new f.NestedStore,p=A(e.getAffectedRows());try{for(p.s();!(s=p.n()).done;){var v=s.value;c.for(v.tableName).store(v.rowId,v.values)}}catch(e){p.e(e)}finally{p.f()}t.Snapshot(c);var m=r({type:"COMMIT",transactionId:e.id,immediateSync:o});h.default.usePendingChangesStore||a.delete(e.id),C("committed",e.id,e.logRecords),h.default.usePendingChangesStore&&t.onDataChange({logDelta:[m]}),i(m)};l?p():t.AddDeleteOrUpdateTableRows(c,p,(function(e){var t=e.errorMessage;u.error=t,o(new Error(u.message))}),{usedTransactions:!0})}else o(new Error(u.message))}))},onCommit:function(e,i){var o=e.validate();if(o.isValid()){if(e.closed)return o.error="Transaction is already closed",void i(o);if(O())for(;e.currentGroupStartedBy;)e.endGroup();var l=S(e),u=l.requests,s=l.stableIds;if(!u.length)return C("committed (NOOP)",e.id,e.logRecords),h.default.usePendingChangesStore||a.delete(e.id),void i(null);t.AddDeleteOrUpdateTableRows(u,(function(o){s.forEach((function(e){var t=n.newRowLookup.get(e);t&&t.commitRowId()}));var l,u=A(e.affectedRootTables);try{for(u.s();!(l=u.n()).done;){l.value.commitPendingChanges(e)}}catch(e){u.e(e)}finally{u.f()}var c,d=new f.NestedStore,p=A(e.getAffectedRows());try{for(p.s();!(c=p.n()).done;){var v=c.value;d.for(v.tableName).store(v.rowId,v.values)}}catch(e){p.e(e)}finally{p.f()}t.Snapshot(d);var m=r({type:"COMMIT",transactionId:e.id,immediateSync:o});h.default.usePendingChangesStore||a.delete(e.id),C("committed",e.id,e.logRecords),h.default.usePendingChangesStore&&t.onDataChange({logDelta:[m]}),i(null,m)}),(function(e){var t=e.errorMessage;o.error=t,i(o)}),{usedTransactions:!0})}else i(o)}}}return(0,l.default)(e,[{key:"isCurrent",get:function(){return this.appModel.isCurrent}},{key:"newTransaction",value:function(){var e=new v.default(this,this.handlers);return this.transactions.set(e.id,e),e}},{key:"findTableCollection",value:function(e,t){if(null==e){if(t)throw new Error("Could not find table ".concat(e));return{}}var n=this.tableCache,a=this.tablesToDispose,r=this.appModel,i=e.toLowerCase(),o=r.appTemplate.findSchemaForTable(i),l=r.appTemplate.findRootSchemaForTable(i),u=r.appTemplate.findRootTableDefinition(i);if(!o||!l||!u){if(t)throw new Error("Could not find table ".concat(e));return{}}if(!n.has(i)){var s,c=r.FindTable(i);if(!c){if(t)throw new Error("Could not find table ".concat(e));return{}}c.IsSlice&&(s=this.findTableCollection(c.SliceSource).table);var d=new h.default(c,o,u,s,r);n.set(i,d),a.add(d)}var f=n.get(i),p=f&&f.rootTable();return{table:f,tableSchema:o,rootTable:p,rootTableSchema:l,tableDefinition:u}}},{key:"onDataChange",value:function(e,t){this.tableCache.forEach((function(n){n.onDataChange(e,t)}))}},{key:"onTemplateChange",value:function(){this.tableCache.clear()}},{key:"dispose",value:function(){var e=this.tableCache,t=this.tablesToDispose;t.forEach((function(e){e.dispose()})),e.clear(),t.clear()}},{key:"findPendingRow",value:function(e){return this.newRowLookup.get(e)}},{key:"appContext",get:function(){var e=this.appModel;return{appId:e.AppTemplate.Id,appName:e.AppTemplate.Name,appVersion:e.AppTemplate.Version,userSettings:e.GetUserSettings()}}},{key:"getTransaction",value:function(e){return e?this.transactions.get(e):void 0}},{key:"currentTransaction",get:function(){var e=(0,i.default)(this.transactions.values()).filter((function(e){return!e.closed}));if(e.length>1)p.default.ReportErrorOnce({errorMessage:"Transaction Error: get currentTransaction found more than one open transaction"});else if(0===e.length)return this.newTransaction();return e[0]}},{key:"abortCurrentTransaction",value:function(){(0,i.default)(this.transactions.values()).forEach((function(e){e.closed||e.abort()}))}},{key:"getPreviousRecord",value:function(e){if(null!=e){var t=this.updateLog[e.id-1];if(t&&t.transactionId===e.transactionId)return t}}},{key:"getPreviousActiveRecord",value:function(e){for("UNDO"!==(null==e?void 0:e.type)&&(e=this.getPreviousRecord(e));"UNDO"===(null==e?void 0:e.type);){var t=this.getLogRecord(e.undoes);e=this.getPreviousRecord(t)}return e}},{key:"getStartRecord",value:function(e){return this.getLogRecords(e)[0]}},{key:"getLogRecord",value:function(e){return this.updateLog[e]}},{key:"getLogRecords",value:function(e){return this.updateLog.filter((function(t){return t.transactionId===e}))}},{key:"getLastRecord",value:function(e){return d.default.last(this.getLogRecords(e))}},{key:"getOpenGroupRecords",value:function(e){for(var t=[],n=this.getActiveRecords(e).reverse(),a=0,r=0;r<n.length;r++){var i=n[r];"END_GROUP"===i.type?a++:"START_GROUP"===i.type&&(0===a?t.push(i):a--)}return t}},{key:"getActiveRecords",value:function(e){for(var t=this.getLastActiveRecord(e),n=[];t;)n.unshift(t),t=this.getPreviousActiveRecord(t);return n}},{key:"getLastActiveRecord",value:function(e){var t=this.getLastRecord(e);return t&&"UNDO"===t.type?this.getPreviousActiveRecord(t):t}},{key:"getActiveRecordsPartitionedByStableId",value:function(e){var t=this.getActiveRecords(e),n=new f.NestedStore;return t.forEach((function(e){var t=e.rootTableName,a=e.stableId;null!=t&&null!=a&&n.for(t).push(a,e)})),n}}]),e}();t.default=k},700482:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.imageHandleColumnTypes=t.default=t.XY_TYPE=t.VIDEO_TYPE=t.URL_TYPE=t.UNKNOWN_TYPE=t.TIME_TYPE=t.THUMBNAIL_TYPE=t.TEXT_TYPE=t.TABLEREF_TYPE=t.SIGNATURE_TYPE=t.SHOW_TYPE=t.PROGRESSENUM_TYPE=t.PRICE_TYPE=t.PHONE_TYPE=t.PERCENT_TYPE=t.NUMBER_TYPE=t.NAME_TYPE=t.MULTICOLUMNKEY_TYPE=t.LONGTEXT_TYPE=t.LIST_TYPE=t.LATLONG_TYPE=t.IMAGE_TYPE=t.FILE_TYPE=t.ENUM_TYPE=t.ENUMLIST_TYPE=t.EMAIL_TYPE=t.DURATION_TYPE=t.DRAWING_TYPE=t.DECIMAL_TYPE=t.DATE_TYPE=t.DATETIME_TYPE=t.COLORENUM_TYPE=t.CHANGETIMESTAMP_TYPE=t.CHANGELOCATION_TYPE=t.CHANGECOUNTER_TYPE=t.BOOLEAN_TYPE=t.APP_TYPE=t.ADDRESS_TYPE=void 0;var r=a(n(496486)),i={TextType:{Name:"Text"},LongTextType:{Name:"LongText"},BooleanType:{Name:"Yes/No"},NumberType:{Name:"Number",ChartAxisFormat:",.0f"},ChangeCounterType:{Name:"ChangeCounter",ChartAxisFormat:",.0f"},DecimalType:{Name:"Decimal",ChartAxisFormat:",.2f"},PercentType:{Name:"Percent",ChartAxisFormat:",.2f"},PriceType:{Name:"Price",ChartAxisFormat:",.2f"},UrlType:{Name:"Url",IsExternal:!0},FileType:{Name:"File",IsExternal:!0},ImageType:{Name:"Image",IsImage:!0},VideoType:{Name:"Video"},ThumbnailType:{Name:"Thumbnail",IsImage:!0},SignatureType:{Name:"Signature",FullWidth:!0},DrawingType:{Name:"Drawing",IsImage:!0,FullWidth:!0},DateType:{Name:"Date"},DateTimeType:{Name:"DateTime"},ChangeTimestampType:{Name:"ChangeTimestamp"},TimeType:{Name:"Time"},DurationType:{Name:"Duration"},NameType:{Name:"Name"},EmailType:{Name:"Email"},AddressType:{Name:"Address"},LatLongType:{Name:"LatLong"},XYType:{Name:"XY"},ChangeLocationType:{Name:"ChangeLocation"},PhoneType:{Name:"Phone"},AppType:{Name:"App",IsExternal:!0},EnumType:{Name:"Enum"},EnumListType:{Name:"EnumList"},ColorEnumType:{Name:"Color"},ProgressEnumType:{Name:"Progress"},TableRefType:{Name:"Ref"},ListType:{Name:"List"},MultiColumnType:{Name:"MultiColumnKey"}},o=i.TextType.Name;t.TEXT_TYPE=o;var l=i.LongTextType.Name;t.LONGTEXT_TYPE=l;var u=i.BooleanType.Name;t.BOOLEAN_TYPE=u;var s=i.NumberType.Name;t.NUMBER_TYPE=s;var c=i.ChangeCounterType.Name;t.CHANGECOUNTER_TYPE=c;var d=i.DecimalType.Name;t.DECIMAL_TYPE=d;var f=i.PercentType.Name;t.PERCENT_TYPE=f;var p=i.PriceType.Name;t.PRICE_TYPE=p;var h=i.UrlType.Name;t.URL_TYPE=h;var v=i.FileType.Name;t.FILE_TYPE=v;var m=i.ImageType.Name;t.IMAGE_TYPE=m;var g=i.VideoType.Name;t.VIDEO_TYPE=g;var y=i.ThumbnailType.Name;t.THUMBNAIL_TYPE=y;var b=i.SignatureType.Name;t.SIGNATURE_TYPE=b;var T=i.DrawingType.Name;t.DRAWING_TYPE=T;var S=i.DateType.Name;t.DATE_TYPE=S;var A=i.DateTimeType.Name;t.DATETIME_TYPE=A;var E=i.ChangeTimestampType.Name;t.CHANGETIMESTAMP_TYPE=E;var w=i.TimeType.Name;t.TIME_TYPE=w;var C=i.DurationType.Name;t.DURATION_TYPE=C;var O=i.NameType.Name;t.NAME_TYPE=O;var _=i.EmailType.Name;t.EMAIL_TYPE=_;var k=i.LatLongType.Name;t.LATLONG_TYPE=k;var R=i.XYType.Name;t.XY_TYPE=R;var I=i.ChangeLocationType.Name;t.CHANGELOCATION_TYPE=I;var N=i.AddressType.Name;t.ADDRESS_TYPE=N;var M=i.PhoneType.Name;t.PHONE_TYPE=M;var D=i.AppType.Name;t.APP_TYPE=D;var L=i.EnumType.Name;t.ENUM_TYPE=L;var P=i.EnumListType.Name;t.ENUMLIST_TYPE=P;var G=i.ProgressEnumType.Name;t.PROGRESSENUM_TYPE=G;var x=i.ColorEnumType.Name;t.COLORENUM_TYPE=x;var F=i.TableRefType.Name;t.TABLEREF_TYPE=F;var V=i.MultiColumnType.Name;t.MULTICOLUMNKEY_TYPE=V;var U=i.ListType.Name;t.LIST_TYPE=U;var B="Unknown";t.UNKNOWN_TYPE=B;var H="Show";t.SHOW_TYPE=H;var W={init:function(e){return e.TEXT_TYPE=o,e.LONGTEXT_TYPE=l,e.BOOLEAN_TYPE=u,e.NUMBER_TYPE=s,e.CHANGECOUNTER_TYPE=c,e.DECIMAL_TYPE=d,e.PERCENT_TYPE=f,e.PRICE_TYPE=p,e.URL_TYPE=h,e.FILE_TYPE=v,e.IMAGE_TYPE=m,e.VIDEO_TYPE=g,e.THUMBNAIL_TYPE=y,e.SIGNATURE_TYPE=b,e.DRAWING_TYPE=T,e.DATE_TYPE=S,e.DATETIME_TYPE=A,e.CHANGETIMESTAMP_TYPE=E,e.TIME_TYPE=w,e.DURATION_TYPE=C,e.NAME_TYPE=O,e.EMAIL_TYPE=_,e.LATLONG_TYPE=k,e.XY_TYPE=R,e.CHANGELOCATION_TYPE=I,e.ADDRESS_TYPE=N,e.PHONE_TYPE=M,e.APP_TYPE=D,e.ENUM_TYPE=L,e.ENUMLIST_TYPE=P,e.PROGRESSENUM_TYPE=G,e.COLORENUM_TYPE=x,e.TABLEREF_TYPE=F,e.MULTICOLUMNKEY_TYPE=V,e.LIST_TYPE=U,e.UNKNOWN_TYPE=B,e.SHOW_TYPE=H,r.default.keyBy(r.default.values(i),(function(e){return e.Name}))}},j=[m,y,v,T,b,g];t.imageHandleColumnTypes=j;var Y=W;t.default=Y},237136:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modifiesDataTypes=t.modifiedData=void 0;var n=["CREATE","UPDATE","RECOMPUTE","DELETE","UNDO"];t.modifiesDataTypes=n;t.modifiedData=function(e){return n.includes(e.type)}},764685:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.getSyncErrorHandler=function(e,t,n){return function(a,s,c){var d;if(401===s)if(o.default.AddTraceContext("getAppTemplate: 401 Unauthorized"),n){var f="401 Unauthorized: Background sync failed. Please log out and back in.";l.default.syncState.error=f,o.default.warnToDevConsole("aborting background sync due to unauthorized"),r.AppGlobals.AppModel.discardPendingAppModel(),"function"==typeof t&&t(f)}else{var p=null===(d=function(e){try{return JSON.parse(e)}catch(t){return o.default.ReportErrorOnce({errorMessage:"error parsing 401/403 responseText",responseText:e}),null}}(a))||void 0===d?void 0:d.LoginProvider;if(i.default.IsIFrame())return void(null==t||t("Login is required but not supported in iframes."));r.AppGlobals.AppState.SwitchToLoginPage(p,"Fetching app template indicates login is required",e)}else if(403===s){o.default.AddTraceContext("getAppTemplate: 403 FORBIDDEN (access blocked)");var h=a||(0,u.accessDeniedErrorMessage)();r.AppGlobals.AppModel.MatchesAppNameOrId(e)?r.AppGlobals.AppModel.RevokeUserAccess(h):(o.default.AddTraceContext("Clearing actions only"),r.AppGlobals.AppModel.ClearPersistedActions(),r.AppGlobals.ViewManager.ShowErrorScreen(h)),"function"==typeof t&&t(h)}else if(i.default.InMobileWebView()&&200===s&&c)o.default.AddTraceContext("Upgrade required."),r.AppGlobals.ViewManager.ShowUpgradeRequiredScreen(a),$("#FullScreenOverlay").show();else if("function"==typeof t){if(o.default.AddTraceContext("getAppTemplate.errorHandler failureFn, statusCode "+s),a&&a.length>1e3){var v="unknown";if(a.startsWith("<"))v="html";else if(a.startsWith("{"))try{JSON.parse(a),v="json"}catch(e){v="malformed-json"}a=a.slice(0,1e3),o.default.AddTraceContext("RESPONSE TEXT (truncated):"+a),o.default.ReportErrorOnce({errorMessage:"GetAppTemplate ajax errorHandler called",responseType:v,statusCode:s})}t(a)}}};var r=n(166089),i=a(n(571524)),o=a(n(593186)),l=a(n(21870)),u=n(714067)},688291:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.autoSyncInterval=void 0;var i=a(n(364687)),o=a(n(856690)),l=a(n(689728)),u=C(n(593186)),s=a(n(513954)),c=a(n(343625)),d=a(n(571524)),f=n(263198),p=n(629503),h=C(n(21870)),v=n(764685),m=n(166089),g=n(235049),y=n(44617),b=n(557310),T=a(n(819433)),S=n(398171),A=n(892148),E=n(515128);function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(w=function(e){return e?n:t})(e)}function C(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=w(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}var O=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},_=function(){b.ReactRootUIConfig.isReactRoot()?setTimeout((function(){var e,t,n=null!==(e=m.AppGlobals.AppModel.NumDelayedActions())&&void 0!==e?e:0,a=null!==(t=m.AppGlobals.AppModel.NumProcessingActions())&&void 0!==t?t:0;(0,T.default)().dispatch((0,S.setTotalActions)(n+a))})):$("#header").trigger("queueChange")},k=18e5,R=!0===window.APPSHEET_TEST_CONTEXT?1:10;t.autoSyncInterval=R;var I=function(){function e(t){(0,o.default)(this,e),this.queuedActions=[],this._appModel=t,this._repeatFailureLimit=1,this._checkSkipLimit=30,this._autoSyncInterval=R,this._parallelismLimit=1,this._minBackgroundSyncIntervalMs=k,this.initialize()}return(0,l.default)(e,[{key:"appModel",value:function(){return m.AppGlobals.AppModel&&m.AppGlobals.AppModel!==this._appModel&&u.default.ReportErrorOnce({errorMessage:"SyncQueue AppModel mismatch",appSwitched:m.AppGlobals.AppModel.AppTemplate.Id!==this._appModel.AppTemplate.Id}),m.AppGlobals.AppModel||this._appModel}},{key:"initialize",value:function(){try{this.isLocalStorageEnabled=void 0!==window.localStorage}catch(e){this.isLocalStorageEnabled=!1}this.executingActions={},this.queuedActions=[],this.checksSkipped=0,this.lastTryFailCount=0,this.queueStartedApp=null,this.AutomaticUpdateSync=!1}},{key:"Clear",value:function(t){this.queuedActions=[],t&&(e.RemovePersistedActions(m.AppGlobals.AppState.AppTemplate.Name),_())}},{key:"PersistAction",value:function(e){var t;if(this.isLocalStorageEnabled){var n=e.RequestId(),a=y.dynamicRollouts.includeByOwnerId("ClientNoPushDelay")?this._appModel:m.AppGlobals.AppState,r=(null===(t=null==e?void 0:e.params)||void 0===t?void 0:t.appName)||a.AppTemplate.Name,i=s.default.SerializeAction(e),o=r+"_Action"+n;c.default.setItem(o,i)}}},{key:"Enqueue",value:function(e){null==e.params.timeStamp&&(e.params.timeStamp=new Date),this.queuedActions.push(e),this.PersistAction(e),_()}},{key:"Delay",value:function(e){var t,n=e.RequestId();(null!=this.executingActions[n]&&delete this.executingActions[n],this.PersistAction(e),y.dynamicRollouts.includeByOwnerId("ClientNoPushDelay"))?this.Disposed||this.queuedActions.unshift(e):((null===(t=null==e?void 0:e.params)||void 0===t?void 0:t.appName)||m.AppGlobals.AppState.AppTemplate.Name)===this.appModel().AppTemplate.Name&&this.queuedActions.unshift(e)}},{key:"Activate",value:function(e){for(var t=e.RequestId(),n=0;n<this.queuedActions.length;n++)if(this.queuedActions[n].RequestId()===t){var a=this.queuedActions[n];this.queuedActions.splice(n,1),this.executingActions[t]=a;break}}},{key:"Remove",value:function(e){for(var t=e.RequestId(),n=0;n<this.queuedActions.length;n++)if(this.queuedActions[n].RequestId()===t){this.queuedActions.splice(n,1);break}if(this.isLocalStorageEnabled){var a=y.dynamicRollouts.includeByOwnerId("ClientNoPushDelay")?this._appModel:m.AppGlobals.AppState,r=e.params.appName||a.AppTemplate.Name;c.default.removeItem("".concat(r,"_Action").concat(t))}null!=this.executingActions[t]&&delete this.executingActions[t],_()}},{key:"Poll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3*R,n=arguments.length>1?arguments[1]:void 0;if(this.AutomaticUpdateSync){if(this.PollTimeoutId)return;var a=setTimeout((function(){e.ResetFailures(!0);var t=e.appModel().NumProcessingActions()+e.appModel().NumDelayedActions();e.Check(h.default.syncProgressHandle,e.onError,n);var a=R;!e.appModel().InASyncCall&&t>0&&(0,g.isConnected)()&&(a=1);var r=1e3*a*Math.pow(2,Math.min(e.lastTryFailCount,9));r=Math.min(36e5,r),e.lastTryFailCount>0&&(r=Math.max(6e4,r));var i=t>0;e.PollTimeoutId=null,e.Poll(r,i)}),t);this.PollTimeoutId=a}}},{key:"CheckConnectivity",value:function(){if(!(0,g.isConnected)()){if(this.lastTryFailCount=0,this.checksSkipped<30)return this.checksSkipped++,!1;this.checksSkipped=0,(0,g.autoConnect)(),this.ResetFailures()}return!0}},{key:"Check",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.default.syncProgressHandle,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(this.CheckConnectivity()){var a=this.getQueuedActions();if(a.length)for(var r=0;r<a.length;r++){if(this.ActiveCount()>=1)return;var i=a[r];if(null==i){var o="empty serialized action in SyncQueue.Check";u.default.ReportErrorOnce({errorMessage:o}),t&&t(o)}else{var l=this.CheckAction(i,e,t);if(!l)break}}else 0===this.ActiveCount()&&this.CheckBackgroundSync(n,e)}}},{key:"checkForAppSwitch",value:function(e,t){return e.params.appId!==this.appModel().AppTemplate.Id&&(u.default.ReportError({errorMessage:"SyncQueue detected app switch",where:t}),!0)}},{key:"checkActionAsync",value:function(e,t){var n=this;return new Promise((function(a){n.CheckAction(e,t,(function(e,t){a({success:!1,errorMessage:e,httpStatus:t})}),(function(){return a({success:!0})}),!0)}))}},{key:"CheckAction",value:function(e,t,n,a,r){var i=this,o=this.checkForAppSwitch(e,"CheckAction start");return!!(e.params.failureCount<1||r)&&(this.Activate(e),p.Common.StartBackendCall(),e.params.checkCache=!0,u.default.logToDevConsole("syncQueue.Check - Executing action",e.params),e.Execute((function(n){o||(o=i.checkForAppSwitch(e,"CheckAction success")),u.default.AddTraceContext("syncQueue.Check - execute action success",{warningMessage:n}),p.Common.FinishBackendCall(),i.Remove(e),i.checksSkipped=0,i.lastTryFailCount=0,n&&(null==t||t.raiseWarning({message:n})),0!==i.queuedActions.length||o||f.JeeneeBrowserAPI.clearPhotoStorageForApp(e.params.appId,e.params.timestamp),null==a||a()}),(function(a,r){a!==u.SYNC_CANCELED_ERROR_MESSAGE&&i.checkForAppSwitch(e,"CheckAction failure"),u.default.AddTraceContext("syncQueue.Check - execute action failure",{errorMessage:a}),p.Common.FinishBackendCall(),e.params.failureCount++,i.lastTryFailCount++,e.params.checkCache=0===r,i.Delay(e),a&&(null==t||t.raiseError(a)),"function"==typeof n&&n(a,r)})),!0)}},{key:"CheckBackgroundSync",value:function(e,t){var n=(new Date).getTime(),a=window.AppSheetPageLoadTime,r=this.appModel();r&&(a=r.lastSyncTimeMs(!0)||a),e?r.startBackgroundSync({progressHandle:t,initiatedBy:"PushedChanges"}):!d.default.IsIFramePreview()&&n-a>k&&r.startBackgroundSync({progressHandle:t,initiatedBy:"Polling"})}},{key:"ResetFailures",value:function(e){var t=this.queuedActions;e||(this.queuedActions=[]);for(var n=t.length-1;n>=0;n--){var a=t[n];null!=a&&(a.params.failureCount=0,e||this.Delay(a))}}},{key:"DelayedCount",value:function(){return this.queuedActions.length}},{key:"ActiveCount",value:function(){return Object.keys(this.executingActions).length}},{key:"Start",value:function(e){if((!e||this.queueStartedApp!==e)&&(this.initialize(),e))if(this.isLocalStorageEnabled){try{window.localStorage.setItem("__test","trial")}catch(e){return void("QUOTA_EXCEEDED_ERR"===e.name.toUpperCase()&&(this.isLocalStorageEnabled=!1))}this.loadPersistedActions(e),this.queueStartedApp=e,_()}else d.default.IsIFrame()||alert("Warning! HTML5 local storage is disabled. Your app will not work correctly.")}},{key:"Stop",value:function(){null!=this.PollTimeoutId&&clearTimeout(this.PollTimeoutId),this.PollTimeoutId=null}},{key:"applySyncSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.automaticUpdates,a=e.syncOnStart,r=!t&&p.Common.InitializingApp&&(n||a);if(r&&a&&setTimeout((function(){m.AppGlobals.StateChangeHandler.RefreshAppData({preferredUI:h.SyncUI.Blocking,initiatedBy:"AppStart"})})),this.AutomaticUpdateSync=n,this.AutomaticUpdateSync){var i=r&&!a;this.Poll(0,i)}else this.Stop()}},{key:"onError",get:function(){var e=this.appModel().AppTemplate.Id;return(0,v.getSyncErrorHandler)(e,(function(e){e!==u.SYNC_CANCELED_ERROR_MESSAGE&&u.default.ReportErrorOnce({errorMessage:e})}),!0)}},{key:"Disposed",get:function(){return this._appModel.Disposed}},{key:"tryFlushQueue",value:function(e){return O(this,void 0,void 0,i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.flushing||(this.flushing=this._tryFlushQueueFn(e)),t.abrupt("return",this.flushing);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"_tryFlushQueueFn",value:function(e){return O(this,void 0,void 0,i.default.mark((function t(){var n,a,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,t.prev=1;case 2:if(this.Disposed||0!==this.ActiveCount()||!(a=this.getQueuedActions()[0])){t.next=12;break}return t.next=5,this.checkActionAsync(a,e);case 5:if((r=t.sent).success){t.next=10;break}return this.onError(r.errorMessage,r.httpStatus),n=!1,t.abrupt("break",12);case 10:t.next=2;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(1),u.default.ReportErrorOnce({errorMessage:"Unexpected error in tryFlushQueue",error:(0,E.asError)(t.t0)}),n=!1;case 18:return delete this.flushing,t.abrupt("return",n);case 20:case"end":return t.stop()}}),t,this,[[1,14]])})))}},{key:"getQueuedActions",value:function(){return this.queuedActions.sort((function(e,t){var n=e.params.timeStamp,a=t.params.timeStamp;return n<a?-1:n>a?1:0}))}},{key:"loadPersistedActions",value:function(e){try{for(var t=A.WindowWrapper.unsafeLocalStorage,n={},a={},r=0;r<t.length;r++){var i=t.key(r);if(0===i.indexOf(e+"_Action")){var o=t.getItem(i),l=null;if(null==o)u.default.ReportErrorOnce({errorMessage:"empty serialized action in SyncQueue.loadPersistedActions"});else try{l=s.default.DeSerializeAction(o)}catch(e){u.default.ReportErrorOnce({errorMessage:"error deserializing action in SyncQueue.loadPersistedActions",error:e})}null!=l?(l.params.failureCount=0,this.Enqueue(l),n[i]=o):a[i]=!0}}for(var c in a)t.removeItem(c)}catch(e){d.default.IsIFrame()||u.default.ReportErrorOnce({errorMessage:"Caught error in SyncQueue.loadPersistedActions",error:e})}}}],[{key:"RemovePersistedActions",value:function(e){try{for(var t=A.WindowWrapper.unsafeLocalStorage,n={},a=0;a<t.length;a++){var r=t.key(a);(0===r.indexOf(e+"_Action")||0===r.indexOf(e+"_Lookup"))&&(n[r]=!0)}for(var i in n)t.removeItem(i)}catch(e){d.default.IsIFrame()||u.default.ReportErrorOnce({errorMessage:"Caught error in SyncQueue.RemovePersistedActions",error:e})}}}]),e}();t.default=I},195508:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.status=t.default=t.Transaction=void 0;var r=a(n(600861)),i=a(n(856690)),o=a(n(689728)),l=a(n(496486)),u=n(29827),s=a(n(819433)),c=n(646317),d=a(n(962553)),f=n(237136);function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}t.status={PENDING:"PENDING",COMMITTED:"COMMITTED",ABORTED:"ABORTED"};var v=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{id:(0,c.makeGuid)()};(0,i.default)(this,e),this.dataManager=t,this.handlers=n,this._model=a,this._closed=!1}return(0,o.default)(e,[{key:"id",get:function(){return this._model.id}},{key:"closed",get:function(){return this._closed||!this.dataManager.isCurrent}},{key:"isValid",get:function(){return this.validate().isEmpty()}},{key:"started",get:function(){return this.logRecords.length>0}},{key:"modifiedData",get:function(){return l.default.some(this.activeRecords,f.modifiedData)}},{key:"hasUserEdits",get:function(){return l.default.some(this.activeRecords,(function(e){return"UPDATE"===e.type||"END_GROUP"===e.type}))}},{key:"currentGroupHasUserEdits",get:function(){return l.default.some(this.currentGroupActiveRecords,(function(e){return"UPDATE"===e.type||"END_GROUP"===e.type}))}},{key:"lastModifiedTimestamp",get:function(){var e;return null===(e=l.default.findLast(this.logRecords,(function(e){return null!=e.timestamp})))||void 0===e?void 0:e.timestamp}},{key:"toJSON",value:function(){return l.default.cloneDeep(this._model)}},{key:"model",get:function(){return this.toJSON()}},{key:"start",value:function(){return this.closed?null:this.handlers.onStart(this)}},{key:"startGroup",value:function(e){return this.closed?null:this.handlers.onStartGroup(this,e)}},{key:"endGroup",value:function(){return this.closed?null:this.handlers.onEndGroup(this)}},{key:"create",value:function(e,t,n){return this.closed?null:this.handlers.onCreate(this,e,t,n)}},{key:"recompute",value:function(e,t,n){return this.closed?null:this.handlers.onRecompute(this,e,t,n)}},{key:"update",value:function(e,t,n,a,r,i){return this.closed?null:this.handlers.onUpdate(this,e,t,n,a,r,i)}},{key:"delete",value:function(e,t){return this.closed?null:this.handlers.onDelete(this,e,t)}},{key:"undo",value:function(){return this.closed?null:this.handlers.onUndo(this)}},{key:"abort",value:function(){return this.closed?null:(this._closed=!0,this.handlers.onAbort(this))}},{key:"validate",value:function(e){return this.handlers.onValidate(this,e)}},{key:"commit",value:function(e){var t=this;this.handlers.onCommit(this,(function(n,a,r){n||(t._closed=!0),null==e||e(n,a,r)}))}},{key:"commitAsync",value:function(e){var t=this;return this.handlers.onCommitAsync(this,e).then((function(e){return t._closed=!0,e}))}},{key:"getInitialRowValues",value:function(e,t){if(this.dataManager.findTableCollection(e).rootTable){var n=l.default.first(this.getRecordsForRow(e,t));if(n)return"CREATE"===n.type?n.after:n.before}return null}},{key:"getInitialErrorState",value:function(e,t){var n=l.default.find(this.getRecordsForRow(e,t),(function(e){return null!=e.initialErrorState}));return null==n?void 0:n.initialErrorState}},{key:"getResetColumns",value:function(e,t){return l.default.extend.apply(l.default,[{}].concat((0,r.default)(this.getRecordsForRow(e,t).map((function(e){return e.wasReset})))))}},{key:"wasCreated",value:function(e){return null!=this.dataManager.findPendingRow(e)}},{key:"wasModified",value:function(e,t,n){var a=this.getInitialRowValues(e,t);if(!a)return!1;var r=this.dataManager.findTableCollection(e),i=r.rootTable,o=r.rootTableSchema;if(!i||!o)return!1;var u=i.lookupTableRow(t,this),s=(null==u?void 0:u.values)||{},c=this.getResetColumns(e,t);return n?s[n]!==a[n]||!!c[n]:!l.default.isEqual(a,s)||l.default.keys(c).length>0}},{key:"getRecordsOfTypeForRow",value:function(e,t,n){var a=this.dataManager.findTableCollection(e).rootTable;return this.activeRecords.filter((function(e){return e.rootTableName===(null==a?void 0:a.name())&&e.stableId===t&&e.type===n}))}},{key:"getRecordsForRow",value:function(e,t){var n=this.dataManager.findTableCollection(e).rootTable;return this.activeRecords.filter((function(e){return e.rootTableName===(null==n?void 0:n.name())&&e.stableId===t}))}},{key:"logRecords",get:function(){return this.dataManager.getLogRecords(this.id)}},{key:"activeRecords",get:function(){return this.dataManager.getActiveRecords(this.id)}},{key:"startRecord",get:function(){return this.dataManager.getStartRecord(this.id)}},{key:"lastRecord",get:function(){return this.dataManager.getLastRecord(this.id)}},{key:"lastActiveRecord",get:function(){return this.dataManager.getLastActiveRecord(this.id)}},{key:"currentGroupStartedBy",get:function(){var e;return null===(e=this.dataManager.getOpenGroupRecords(this.id)[0])||void 0===e?void 0:e.viewStateKey}},{key:"findGroupStartedBy",value:function(e){return this.dataManager.getOpenGroupRecords(this.id).find((function(t){return t.viewStateKey===e}))}},{key:"owningViewState",get:function(){if(d.default.usePendingChangesStore){var e=(0,s.default)().getState();return(0,u.getViewInPendingTransactionById)(this.id,e)}}},{key:"currentGroupActiveRecords",get:function(){var e=this.activeRecords,t=this.dataManager.getOpenGroupRecords(this.id)[0],n=e.indexOf(t);return n>0?e.slice(n):e}},{key:"affectedRootTableNames",get:function(){return l.default.compact(l.default.uniq(this.activeRecords.map((function(e){return e.rootTableName}))))}},{key:"affectedRootTables",get:function(){var e=this;return l.default.compact(this.affectedRootTableNames.map((function(t){return e.dataManager.findTableCollection(t).rootTable})))}},{key:"stableReferenceRecords",get:function(){return this.activeRecords.filter((function(e){return"CREATE"===e.type&&null!=e.stableReference}))}},{key:"hasStableReverseRef",value:function(e){return this.stableReferenceRecords.filter((function(t){var n=t.stableReference,a=t.stableId;return l.default.isMatch(n,e)&&l.default.isMatch(n,{stableId:a})})).length>0}},{key:"getStableReferencesTo",value:function(e){return this.stableReferenceRecords.filter((function(t){var n=t.stableReference;return n.referencedTableName===e.tableName&&n.referencedStableId===e.stableId})).map((function(e){return e.stableReference}))}},{key:"getAffectedRows",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.activeRecords,a=new Map,r=p(this.affectedRootTables);try{for(r.s();!(e=r.n()).done;){var i=e.value;a.set(i.name(),i)}}catch(e){r.e(e)}finally{r.f()}return l.default.uniq(l.default.compact(n.map((function(e){var n=e.rootTableName,r=e.rowId,i=e.stableId,o=a.get(null!=n?n:"");return null==o?void 0:o.lookupTableRow(null!=i?i:r,t)}))))}},{key:"inNestedTransactionGroup",get:function(){return this.dataManager.getOpenGroupRecords(this.id).length>1}}]),e}();t.Transaction=v;var m=v;t.default=m},397013:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(861655)),l=a(n(994993)),u=a(n(73808)),s=a(n(593302)),c=a(n(496486)),d=a(n(365914)),f=a(n(150198)),p=a(n(189491)),h=n(213082),v=n(515128),m=a(n(593186));function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,l.default)(this,n)}}var y=function(e){return null==e?0:Number(e)||0},b=function(e){(0,o.default)(n,e);var t=g(n);function n(e,a){var i;return(0,r.default)(this,n),(i=t.call(this,e,a)).Operator=e.Op,i}return(0,i.default)(n,[{key:"runEval",value:function(e){if(null===e||2!==e.length)return null!==e&&1===e.length&&"UNARY_MINUS"===this.Operator?"number"===this.resultType().toLowerCase()?this.runNumber(e):this.runDecimal(e):null;switch(this.resultType().toLowerCase()){case"date":case"changetimestamp":case"datetime":return this.runDate(e);case"time":return this.runTime(e);case"duration":return this.runDuration(e);case"list":return this.runList(e);case"number":case"changecounter":return this.runNumber(e);default:return this.runDecimal(e)}}},{key:"runDate",value:function(e){switch(this.Operator){case"DATE_PLUS":return e[1].attribute.yields("Duration")?d.default.addSeconds(f.default.makeDate(e[0].value),d.default.getDurationSecs(d.default.parseDuration(e[1].value))):d.default.addDays(f.default.makeDate(e[0].value),y(e[1].value));case"DATE_MINUS":return e[1].attribute.yields("Duration")?d.default.addSeconds(f.default.makeDate(e[0].value),-1*d.default.getDurationSecs(d.default.parseDuration(e[1].value))):d.default.addDays(f.default.makeDate(e[0].value),-1*y(e[1].value))}return null}},{key:"runTime",value:function(e){switch(this.Operator){case"TIME_PLUS":return e[1].attribute.yields("Duration")?d.default.timeToDate(d.default.dateToTime(d.default.addSeconds(e[0].value,d.default.getDurationSecs(d.default.parseDuration(e[1].value))))):d.default.timeToDate(d.default.dateToTime(d.default.addHours(e[0].value,y(e[1].value))));case"TIME_MINUS":return e[1].attribute.yields("Duration")?d.default.timeToDate(d.default.dateToTime(d.default.addSeconds(e[0].value,-1*d.default.getDurationSecs(d.default.parseDuration(e[1].value))))):d.default.timeToDate(d.default.dateToTime(d.default.addHours(e[0].value,-1*y(e[1].value))))}return null}},{key:"runDuration",value:function(e){switch(this.Operator){case"DURATION_PLUS":return e[0].attribute.yields("Duration")&&e[1].attribute.yields("Duration")?d.default.addDurations(e[0].value,e[1].value):e[0].attribute.yields("Duration")&&e[1].attribute.yields("Number")?d.default.addDurationHours(e[0].value,y(e[1].value)):null;case"DURATION_MINUS":return e[0].attribute.yields("Duration")&&e[1].attribute.yields("Duration")?d.default.diffDurations(e[0].value,e[1].value):e[0].attribute.yields("Duration")&&e[1].attribute.yields("Number")?d.default.subtractDurationHours(e[0].value,y(e[1].value)):e[0].attribute.yields("Time")&&e[1].attribute.yields("Time")?d.default.diffTimes(f.default.makeDate(e[0].value),f.default.makeDate(e[1].value)):e[0].attribute.yields("Date")&&e[1].attribute.yields("Date")?d.default.diffDates(f.default.makeDate(e[0].value),f.default.makeDate(e[1].value)):d.default.diffTimes(f.default.makeDate(e[0].value),f.default.makeDate(e[1].value))}return null}},{key:"runList",value:function(e){switch(this.Operator){case"LIST_PLUS":return null==e[0].value?e[1].value:null==e[1].value?e[0].value:e[0].value.concat(e[1].value);case"LIST_MINUS":if(null==e[0])return null;if(null==e[1])return e[0].values;var t=e[0].value,n=this.children[0].resultAttribute().nestedAttribute(),a=n.basestType(),r=e[1].value,i=this.children[1].resultAttribute().nestedAttribute(),o=i.basestType(),l=c.default.uniq(r).map((function(e){return(0,h.getTypedChildValue)(e,i,a,!1)})),u=c.default.zipObject(t,t.map((function(e){return(0,h.getTypedChildValue)(e,n,o,!1)})));return c.default.uniq(c.default.differenceWith(t,l,(function(e,t){return u[e]===t})))}return null}},{key:"runNumber",value:function(e){var t;switch(this.Operator){case"PLUS":return y(e[0].value)+y(e[1].value);case"MINUS":return y(e[0].value)-y(e[1].value);case"TIMES":return y(e[0].value)*y(e[1].value);case"DIV":return 0===(t=y(e[1].value))?0:1*y(e[0].value)/t;case"MOD":return y(e[0].value)%y(e[1].value);case"UNARY_MINUS":return-1*y(e[0].value)}return null}},{key:"normalizeDecimalValue",value:function(e){var t=this.resultTypeQualifier(),n=t&&null!=t.DecimalDigits?t.DecimalDigits:2;if("number"==typeof n){"Percent"===this.resultType()&&(n+=2);var a=Math.pow(10,n);return Math.round(e*a)/a}return e}},{key:"runDecimal",value:function(e){try{var t=0,n=new s.default(1*y(e[0].value)),a=e.length>1?new s.default(y(e[1].value)):null;switch(this.Operator){case"PLUS":t=Number(n.plus(a).toFixed());break;case"MINUS":t=Number(n.minus(a).toFixed());break;case"TIMES":t=Number(n.times(a).toFixed());break;case"DIV":t=a.eq(0)?0:Number(n.div(a).toFixed());break;case"MOD":t=a.eq(0)?0:Number(n.mod(a).toFixed());break;case"UNARY_MINUS":t=Number(n.times(-1).toFixed())}return t}catch(t){var r=(0,v.asError)(t);return"BigError"===r.name&&"NaN"===r.message||m.default.ReportErrorOnce({errorMessage:"Unexpected error in runDecimal",error:r}),this.runNumber(e)}}}]),n}(p.default);t.default=b},213082:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.getTypedChildValue=b;var i=a(n(856690)),o=a(n(689728)),l=a(n(861655)),u=a(n(994993)),s=a(n(73808)),c=a(n(496486)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(365914)),f=a(n(150198)),p=a(n(189491));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,u.default)(this,n)}}var m=new Date("01/01/1970 00:00:00").getTime(),g=new Date("12/30/1899 00:00:00").getTime(),y=function(e){(0,l.default)(n,e);var t=v(n);function n(e,a){var r;return(0,i.default)(this,n),(r=t.call(this,e,a)).IsAtomic="true"===String(e.IsAtomic),r.BoolType=e.BoolType,r.OperatorName=e.OperatorName,r}return(0,o.default)(n,[{key:"canBeShortCircuited",value:function(e){return this.children.length>1&&!this.IsAtomic&&!(null==e?void 0:e.isFakeContext)}},{key:"meetsShortCircuitCondition",value:function(e){switch(this.BoolType){case"AND":return!1===e;case"OR":return!0===e}return!1}},{key:"runEval",value:function(e,t){switch(this.IsAtomic){case!0:return this.runAtomicBoolean(e,t);case!1:return this.runCompositeBoolean(e)}return null}},{key:"runCompositeBoolean",value:function(e){switch(this.BoolType){case"AND":return e.every((function(e){return Boolean(e.value)}));case"OR":return e.some((function(e){return Boolean(e.value)}));case"NOT":return!e[0].value}return null}},{key:"runEqualsNew",value:function(e,t,n,a){return null===e||""===e||null===n||""===n?e===n:t===a}},{key:"runAtomicBoolean",value:function(e,t){var n,a=null===(n=null==t?void 0:t.appModel)||void 0===n?void 0:n.useConsistentComparisonOperators,r=e[0],i=e[1],o=r.attribute,l=i.attribute,u=b(r.value,o,l.basestType(),a),s=b(i.value,l,o.basestType(),a);if(a){switch(this.OperatorName){case"GreaterThan":return u>s;case"GreaterThanOrEquals":return u>s||this.runEqualsNew(r.value,u,i.value,s);case"LessThan":return u<s;case"LessThanOrEquals":return u<s||this.runEqualsNew(r.value,u,i.value,s);case"Equals":return this.runEqualsNew(r.value,u,i.value,s);case"NotEquals":return!this.runEqualsNew(r.value,u,i.value,s)}return null}switch(this.OperatorName){case"GreaterThan":return u>s;case"GreaterThanOrEquals":return u>=s;case"LessThan":return u<s;case"LessThanOrEquals":return u<=s;case"Equals":return u===s;case"NotEquals":return u!==s}return null}},{key:"getLookupValues",value:function(){return this.IsAtomic?this.getAtomicLookupValues():this.getCompositeLookupValues()}},{key:"getAtomicLookupValues",value:function(){if("Equals"===this.OperatorName&&null!=this.children&&2===this.children.length){var e,t,n={};if("COLUMN"===this.children[0].model.EvalType&&"CONSTANT"===this.children[1].model.EvalType)return e=this.children[0].ColumnName,t=this.children[1].Value,n[e]=d.default.stripRefImageValue(t,this.children[0].model.ResultType),n;if("COLUMN"===this.children[1].model.EvalType&&"CONSTANT"===this.children[0].model.EvalType)return e=this.children[1].ColumnName,t=this.children[0].Value,n[e]=d.default.stripRefImageValue(t,this.children[0].model.ResultType),n}return null}},{key:"getCompositeLookupValues",value:function(){var e;switch(this.BoolType){case"AND":return e=null,this.children.map((function(t){var n=t.getLookupValues();e?n&&(e=c.default.assign(e,n)):e=n})),e;case"OR":case"NOT":return null}return null}}]),n}(p.default);function b(e,t,n,a){var r;if(Array.isArray(e))r=(r=e.map((function(e){return b(e,t.nestedAttribute(),n,a)}))).sort().toString();else{var i=t.basestType();r=function(e,t,n,a){var r;switch(t){case"Date":return!a||null!==e&&""!==e?((r=f.default.makeDate(e)).setHours(0,0,0,0),r.getTime()):m;case"Time":return a?null===e||""===e?g:((r=f.default.makeDate(e)).setFullYear(1899,11,30),r.getTime()):((r=f.default.makeDate(e)).setFullYear(0,0,0),r.getTime());case"DateTime":case"ChangeTimestamp":return!a||null!==e&&""!==e?f.default.makeDate(e).getTime():m;case"Duration":return d.default.getDurationSecs(d.default.parseDuration(e));case"Yes/No":return e;case"Text":if("Yes/No"===n)switch(String(e).toLowerCase()){case"y":case"yes":case"t":case"true":return!0;case"n":case"no":case"f":case"false":return!1}if("Progress"===n)switch(String(e).toLowerCase()){case"empty":return"empty";case"quarter":case"one quarter":return"quarter";case"half":return"half";case"three quarter":case"three quarters":return"three quarter";case"full":return"full"}return null==e?"":String(e).toLowerCase();case"Number":case"Decimal":case"Price":case"Percent":case"ChangeCounter":return Number(e);case"List":case"EnumList":return null==e?"":e.sort().toString().toLowerCase();case"File":case"Image":case"Signature":case"Thumbnail":case"Drawing":return d.default.stripRefImageValue(e,t);case"Url":return e&&"function"==typeof e.indexOf&&0!==e.indexOf("{")?JSON.stringify(f.default.urlValueFromWireFormat(e)).toLowerCase():null==e?"":String(e).toLowerCase();default:return null==e?"":String(e).toLowerCase()}}(e,i,n,a),"Text"!==i&&"Text"!==n||(r=(0,d.toNormalizedString)(r))}return r}t.default=y},17601:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(861655)),l=a(n(994993)),u=a(n(73808)),s=n(888861);function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,l.default)(this,n)}}var d=function(e){(0,o.default)(n,e);var t=c(n);function n(e,a){return(0,r.default)(this,n),t.call(this,e,a)}return(0,i.default)(n,[{key:"ColumnIndex",get:function(){var e;return null!==(e=this.model.ColIndex)&&void 0!==e?e:0}},{key:"ColumnName",get:function(){var e;return null!==(e=this.model.ColName)&&void 0!==e?e:""}},{key:"ContextLevel",get:function(){var e;return null!==(e=this.model.ContextLevel)&&void 0!==e?e:0}},{key:"runEval",value:function(e,t){if(null==t||"function"!=typeof t.getColumnValue)return null;var n=t.getColumnValue(this.ColumnName,this.ColumnIndex,this.ContextLevel);return this.resultAttribute().valueFromWireFormat(n)}},{key:"curryThis",value:function(e){if(!e||"function"!=typeof e.getColumnValue)return this;var t=e.getColumnValue(this.ColumnName,this.ColumnIndex,this.ContextLevel);return null==t?this:(0,s.createConstantValue)(t,this.resultType(),this.resultTypeQualifier())}}],[{key:"is",value:function(e){return"COLUMN"===e.evalType()}}]),n}(a(n(189491)).default);t.default=d},50757:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(441588)),l=a(n(861655)),u=a(n(994993)),s=a(n(73808));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,u.default)(this,n)}}var d=function(e){(0,l.default)(n,e);var t=c(n);function n(e,a){var i;return(0,r.default)(this,n),(i=t.call(this,e,a)).ColumnIndex=e.ColIndex,i.ContextLevel=e.ContextLevel,i.TableName=e.TableName,i.RowListAttrName=e.RowListAttrName,i.RowListAttrIndex=e.RowListAttrIndex,i.MakeDistinct=e.MakeDistinct,i}return(0,i.default)(n,[{key:"runEval",value:function(e,t){var n=this;if(null==t||"function"!=typeof t.getTableColumnSet)return[];var a=this.resultAttribute(),r=a.nestedAttribute()||a,i=this.TableName,o=this.ColumnIndex,l=this.MakeDistinct,u=this.RowListAttrName,s=this.RowListAttrIndex,c=this.ContextLevel,d=r.valuesFromWireFormat(t.getTableColumnSet(i,o,null,l,null,s,u,c)),f=r.basestAttribute().type();return d.map((function(e){return n.handleRefImageValue(e,f,i)}))}},{key:"curryThis",value:function(e){var t;return(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))?null!=this.RowListAttrIndex?null==e.getColumnValue(this.RowListAttrName,this.RowListAttrIndex,this.ContextLevel)?this:this.convertToConstant(e):(0,o.default)((0,s.default)(n.prototype),"curryThis",this).call(this,e):e?this.children&&0!==this.children.filter((function(e){return"CONSTANT"!==e.model.EvalType})).length?this:this.convertToConstant(e):this}}]),n}(a(n(189491)).default);t.default=d},85945:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(861655)),l=a(n(994993)),u=a(n(73808)),s=a(n(189491));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,l.default)(this,n)}}var d=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},f=function(e){(0,o.default)(n,e);var t=c(n);function n(e,a){return(0,r.default)(this,n),t.call(this,e,a)}return(0,i.default)(n,[{key:"Value",get:function(){return null!=this.model.ConstantValue?this.model.ConstantValue:(void 0===this._wireValue&&(this._wireValue=this.resultAttribute().valueToWireFormat(this.NativeValue)),this._wireValue)}},{key:"NativeValue",get:function(){return void 0!==this.model.NativeValue?this.model.NativeValue:(void 0===this._nativeValue&&(this._nativeValue=null,this._nativeValue=this.resultAttribute().valueFromWireFormat(this.Value)),this._nativeValue)}},{key:"runEval",value:function(){return this.NativeValue}},{key:"curryRollout",value:function(){return this}},{key:"toJSON",value:function(){var e;if(void 0===this.model.ConstantValue||void 0!==this.model.NativeValue){var t=this.model,n=(t.NativeValue,d(t,["NativeValue"])),a=null!==(e=n.ConstantValue)&&void 0!==e?e:this.Value;return Object.assign(Object.assign({},n),{ConstantValue:a})}return this.model}}],[{key:"is",value:function(e){return"CONSTANT"===e.evalType()}}]),n}(s.default);t.default=f},98705:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(441588)),l=a(n(861655)),u=a(n(994993)),s=a(n(73808)),c=n(888861),d=a(n(189491)),f=a(n(150198));function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,u.default)(this,n)}}var h=function(e){(0,l.default)(n,e);var t=p(n);function n(e,a){var i;return(0,r.default)(this,n),(i=t.call(this,e,a)).RefColumnIndex=e.RefColumnIndex,i.RefColumnName=e.RefColumnName,i.RemoteColumnIndex=e.RemoteColumnIndex,i.RemoteColumnName=e.RemoteColumnName,i.RemoteTableName=e.RemoteTableName,i}return(0,i.default)(n,[{key:"runEval",value:function(e,t){if(null==t||"function"!=typeof t.getColumnValue||"function"!=typeof t.getTableColumnValue)return null;var n,a,r;if(null!=e&&1===e.length){var i=e[0],o=i.attribute,l=i.value;n=o.valueToWireFormat(l)}else n=t.getColumnValue(this.RefColumnName,this.RefColumnIndex,0);return null==this.RemoteTableName?null:(a=t.getTableColumnValue(this.RemoteTableName,n,this.RemoteColumnName,this.RemoteColumnIndex),r=this.resultAttribute().valueFromWireFormat(a),r=this.handleRefImageValue(r,this.resultAttribute().basestAttribute().type(),this.RemoteTableName))}},{key:"curryThis",value:function(e){var t;if(null!=this.children&&1===this.children.length)return(0,o.default)((0,s.default)(n.prototype),"curryThis",this).call(this,e);if(e&&"function"==typeof e.getColumnValue&&null!=e.getColumnValue(this.RefColumnName,this.RefColumnIndex,0)){if(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))return(0,o.default)((0,s.default)(n.prototype),"curryThis",this).call(this,e);var a=this.run(e),r=f.default.valueToWireFormat(a,this.resultType(),this.resultTypeQualifier());return(0,c.createConstantValue)(r,this.resultType(),this.resultTypeQualifier())}return this}}]),n}(d.default);t.default=h},189491:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.sortByExpensiveRollout=t.default=t.DEFAULT_ASYNC_TIMEOUT=void 0;var r=a(n(918698)),i=a(n(600861)),o=a(n(856690)),l=a(n(689728)),u=a(n(496486)),s=a(n(65706)),c=a(n(593186)),d=a(n(365914)),f=a(n(150198)),p=n(888861),h=n(895466),v=n(166089);function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var y=5e3;function b(e,t){return"value"===e&&"number"==typeof t&&isNaN(t)?"__NaN__":t}t.DEFAULT_ASYNC_TIMEOUT=y;var T=function(e,t){return t.mayBeExpensive-e.mayBeExpensive},S=function(e,t){return Number(e.mayBeExpensive)-Number(t.mayBeExpensive)};t.sortByExpensiveRollout=S;var A=function(e){return e.model},E=function(e){return e.isPure()},w=function(e){return e.columnsReferenced()},C=function(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=a;a.trace&&(n={},r=Object.assign(Object.assign({},a),{trace:n}));var i=e.resultType(),o=e.resultAttribute(),l=e.run(t,r);return l instanceof Promise?l.then((function(e){return{type:i,attribute:o,value:e,trace:n}})):{type:i,attribute:o,value:l,trace:n}},O=function(){function e(t,n){var a=this;(0,o.default)(this,e),this.model=t;var r=n(t);r&&(this.children=r),void 0===t.IsPure&&(t.IsPure=!r||r.every(E)),t.ColumnsReferenced||(t.ColumnsReferenced=r?u.default.flatten(r.map(w)):[]),null!=v.AppGlobals.AppModel&&v.AppGlobals.AppModel.inRollout("fromCacheOrRunEval")||(this.fromCacheOrRunEval=this.isPure()?(0,s.default)({limit:100,makeKey:function(e,t){var n=e.map((function(e){return e.value}));return t&&"PARAM"===a.evalType()&&n.push(t.getInputParameterValue(a.model.Name)),JSON.stringify(n,b)},getTimestamp:function(){var e;return(null===(e=v.AppGlobals.AppModel)||void 0===e?void 0:e.DataStamp)||""},fn:function(e,t,n){return a.runEval(e,t,n)}}):this.runEval.bind(this))}return(0,l.default)(e,[{key:"withCurriedChildren",value:function(e){var t=(0,p.create)(Object.assign(Object.assign({},this.model),{Children:e.map(A)}),(function(){return e})),n=this._resultAttribute;return n&&(t._resultAttribute=n),t}},{key:"isConstant",get:function(){return"CONSTANT"===this.evalType()}},{key:"convertToConstant",value:function(e){var t,n=this.run(e);if(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))return(0,p.createConstantValueNative)(n,this.resultType(),this.resultTypeQualifier());var a=n,r=f.default.valueToWireFormat(a,this.resultType(),this.resultTypeQualifier());if(c.default.Debug()){var i=f.default.valueFromWireFormat(r,this.resultType(),this.resultTypeQualifier());!i&&!a||u.default.isEqual(i,a)||c.default.ReportErrorOnce({errorMessage:"convertToConstant doesn't roundtrip",thisValue:a,thisWireValue:r,sanityCheck:i})}return(0,p.createConstantValue)(r,this.resultType(),this.resultTypeQualifier())}},{key:"runAsync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Promise.resolve(this.run(e,Object.assign({supportsAsync:!0,timeout:y},t)))}},{key:"run",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return null!=this.children&&this.children.length>0?this.runInternalNode(e,t,n):this.runLeafNode(e,t,n)}},{key:"runAndLocalize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.run(e,t,n),r=this.resultAttribute(),i=r.valueToWireFormat(a);return r.localizeWireValue(i)}},{key:"runChildEvals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],a=!1,r=this.children,i=this.canBeShortCircuited(e);i&&this.mayBeExpensive&&(r=r.sort(T));for(var o=0;o<r.length;o++){var l=C(r[o],e,t);if(n.push(l),l instanceof Promise)a=!0;else if(i&&this.meetsShortCircuitCondition(l.value))break}return a?Promise.all(n):n}},{key:"runSelf",value:function(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n=a.noCache?this.runEval(e,t,a,r):this.fromCacheOrRunEval(e,t,a,r),a.trace&&(a.trace.Result=n,a.trace.Source=this.model.SourceExpr,a.trace.ChildTraces=u.default.compact(e.map((function(e){return e.trace})))),n}},{key:"runInternalNode",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.runChildEvals(e,n);return r instanceof Promise?r.then((function(r){return t.runSelf(r,e,n,a)})):this.runSelf(r,e,n,a)}},{key:"runLeafNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.runEval(void 0,e,t,n);return t.trace&&(t.trace.Source=this.model.SourceExpr,t.trace.Result=a),a}},{key:"fromCacheOrRunEval",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.runEval(e,t,n,a)}},{key:"runEval",value:function(e,t,n,a){return null}},{key:"canBeShortCircuited",value:function(e){return!1}},{key:"meetsShortCircuitCondition",value:function(e){return!1}},{key:"source",get:function(){return this.model.SourceExpr}},{key:"hash",get:function(){var e=this._hash;return null==e&&(e=this._hash=d.default.hashCode(this.source||JSON.stringify(this.model))),e}},{key:"mayBeExpensive",get:function(){return Boolean(this.model.MayBeExpensive)}},{key:"isRowList",value:function(){return null!=this.model.RowListAttrIndex||this.model.RowListAttrName}},{key:"isEqualTo",value:function(e){return null!=e&&this.hash===e.hash}},{key:"curry",value:function(e){var t;if(null===(t=e.appModel)||void 0===t?void 0:t.inRollout("curry"))return this.curryRollout(e);var n=(0,p.create)(Object.assign({},this.model));if(null!=this.children)if(n.model.Children=[],this.canBeShortCircuited(e)){var a=this.children;this.mayBeExpensive&&(a=this.children.sort(T));for(var r=[],i=0;i<a.length;i++){var o=a[i].curry(e);if("CONSTANT"===o.evalType()&&this.meetsShortCircuitCondition(o.nativeValue())){r.length=0,r.push(o);break}r.push(o)}n.children=r,n.model.Children=r.map((function(e){return e.model}))}else n.children=this.children.map((function(t,a){var r=t.curry(e);return n.model.Children[a]=r.model,r}));return n.curryThis(e)}},{key:"curryRollout",value:function(e){var t,n=null===(t=this.children)||void 0===t?void 0:t.length;if(null!=this.children&&n){var a,r=this.children,o=this.canBeShortCircuited(e);o&&this.mayBeExpensive&&(a=r=(0,i.default)(this.children).sort(S));for(var l=0;l<n;l++){var u=r[l],s=u.curry(e);if(o&&"CONSTANT"===s.evalType()&&this.meetsShortCircuitCondition(s.nativeValue())){(a=null!=a?a:[]).length=0,a.push(s);break}s!==u&&((a=null!=a?a:(0,i.default)(this.children))[l]=s)}if(a)return this.withCurriedChildren(a).curryThis(e)}return this.curryThis(e)}},{key:"curryThis",value:function(e){return e&&u.default.every(this.children,(function(e){return"CONSTANT"===e.evalType()}))?this.convertToConstant(e):this}},{key:"getLookupValues",value:function(){return null}},{key:"operatorName",value:function(){return this.model.OperatorName}},{key:"evalType",value:function(){return this.model.EvalType}},{key:"colName",value:function(){return this.model.ColName}},{key:"constantValue",value:function(){return this.Value}},{key:"nativeValue",value:function(){return this.NativeValue}},{key:"resultType",value:function(){return this.model.ResultType}},{key:"resultTypeQualifier",value:function(){var e=this.model.ResultTypeQualifier;if("string"==typeof e)try{return JSON.parse(e)}catch(e){return null}return"object"===(0,r.default)(e)?e:null}},{key:"resultAttribute",value:function(){return this._resultAttribute||(this._resultAttribute=new f.default({Name:this.source,Type:this.model.ResultType,TypeAuxData:this.model.ResultTypeQualifier})),this._resultAttribute}},{key:"isThisInCondition",value:function(){return"IN"===this.FunctionName}},{key:"isPure",value:function(){return this.model.IsPure}},{key:"isAtomic",value:function(){return this.model.IsAtomic}},{key:"functionName",value:function(){return this.model.FunctionName}},{key:"boolType",value:function(){return this.model.BoolType}},{key:"toJSON",value:function(){var e;return Object.assign(Object.assign({},this.model),{Children:null===(e=this.children)||void 0===e?void 0:e.map((function(e){return e.toJSON()}))})}},{key:"columnsReferenced",value:function(){return this.model.ColumnsReferenced||[]}},{key:"ancColumnsReferenced",value:function(){return this.model.AncColumnsReferenced}},{key:"tablesReferenced",value:function(){var e;if(!this._tablesReferenced){var t,n=new Set,a=m(null!==(e=this.model.TablesReferenced)&&void 0!==e?e:[]);try{for(a.s();!(t=a.n()).done;){var r=t.value,i=v.AppGlobals.AppModel.findTableCollection(r).rootTable;n.add(i?i.name():r)}}catch(e){a.e(e)}finally{a.f()}this.populateTablesDereferenced(n),this._tablesReferenced=Array.from(n)}return this._tablesReferenced}},{key:"populateTablesDereferenced",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;if(this.RemoteTableName&&e.add(this.RemoteTableName),this.children){var t,n=m(this.children);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.populateTablesDereferenced(e)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"referencedTableTimestamps",value:function(){return this.tablesReferenced().map((function(e){var t,n;return null===(n=null===(t=v.AppGlobals.AppModel)||void 0===t?void 0:t.findTableCollection(e).rootTable)||void 0===n?void 0:n.ownTimestamp}))}},{key:"handleRefImageValue",value:function(e,t,n){switch(t){case"Image":case"Drawing":case"Signature":case"Thumbnail":case"File":e&&!(0,h.isImageHandle)(e)&&"string"==typeof e&&e.length>0&&"http"!==e.substr(0,4)&&"data"!==e.substr(0,4)&&e.indexOf("::")<0&&(e=n+"::"+e)}return e}}],[{key:"makeCompactEvaluatable",value:function(e){var t=function e(t,n){for(var a in t)a!==n||t.FunctionName?"object"===(0,r.default)(t[a])&&e(t[a],n):delete t[a]},n=u.default.cloneDeep(e);return["ColumnsReferenced","TablesReferenced","SourceExpr"].forEach((function(e){return t(n,e)})),function e(t){for(var n in t)t[n]?"object"===(0,r.default)(t[n])&&e(t[n]):delete t[n]}(n),n}}]),e}();t.default=O},565722:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(627424)),o=a(n(600861)),l=a(n(856690)),u=a(n(689728)),s=a(n(441588)),c=a(n(861655)),d=a(n(994993)),f=a(n(73808)),p=a(n(496486)),h=a(n(730381)),v=a(n(888861)),m=a(n(189491)),g=P(n(365914)),y=a(n(783918)),b=a(n(593186)),T=a(n(571524)),S=a(n(190644)),A=a(n(385857)),E=P(n(150198)),w=a(n(440587)),C=P(n(302443)),O=a(n(304878)),_=a(n(498967)),k=a(n(107465)),R=a(n(895466)),I=n(213082),N=n(351101),M=n(946094),D=n(166089);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}function P(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}function G(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,f.default)(e);if(t){var r=(0,f.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,d.default)(this,n)}}var V=["Date","DateTime","ChangeTimestamp"],U=p.default.keyBy(["SELECT","ORDERBY","IF","IFS","ANY","TOP","SWITCH","LINKTOFILTEREDVIEW"]);function B(e){return e?"Url"===e.type?String(e.value):String(e.attribute.valueToWireFormat(e.value)):""}function H(e){var t;return null==e||""===e||0===e.length||e instanceof w.default&&!e.url||!0===(null===(t=(0,N.getAppModel)())||void 0===t?void 0:t.inRollout("curryNativeValue"))&&Array.isArray(e)&&1===e.length&&H(e[0])}var W=function(e){(0,c.default)(a,e);var t=F(a);function a(e,n){var r;return(0,l.default)(this,a),(r=t.call(this,e,n)).FunctionName=e.FunctionName,r}return(0,u.default)(a,[{key:"run",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return U[this.FunctionName]?this.runLazy(e,t,n):(0,s.default)((0,f.default)(a.prototype),"run",this).call(this,e,t,n)}},{key:"runLazy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(this.FunctionName){case"SELECT":return this.runSelect(e,t,n);case"ORDERBY":return this.runOrderBy(e,t,n);case"IF":return this.runIf(e,t);case"IFS":return this.runIfS(e,t);case"SWITCH":return this.runSwitch(e,t);case"ANY":return this.runAny(e,t);case"TOP":return this.runTop(e,t);case"LINKTOFILTEREDVIEW":return this.runLinkToFilteredView(e,t);default:return null}}},{key:"curry",value:function(e){return U[this.FunctionName]?this.curryLazy(e):(0,s.default)((0,f.default)(a.prototype),"curry",this).call(this,e)}},{key:"runEval",value:function(e,t){var n,a,r,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(this.FunctionName){case"_TODAY":case"TODAY":return(r=new Date).setHours(0,0,0,0),r;case"_TIMENOW":case"TIMENOW":return g.default.timeToDate(g.default.dateToTime(new Date));case"NOW":case"_NOW":return(i=new Date).setMilliseconds(0),i;case"UTCNOW":return this.runUtcNow();case"HOUR":return this.runHour(e);case"MINUTE":return this.runMinute(e);case"SECOND":return this.runSecond(e);case"TOTALHOURS":return this.runTotalHours(e);case"TOTALMINUTES":return this.runTotalMinutes(e);case"TOTALSECONDS":return this.runTotalSeconds(e);case"DAY":return this.runDay(e);case"MONTH":return this.runMonth(e);case"YEAR":return this.runYear(e);case"WEEKDAY":return this.runWeekday(e);case"WEEKNUM":return this.runWeeknum(e);case"ISOWEEKNUM":return this.runIsoWeeknum(e);case"DATE":return this.runDate(e);case"TIME":return this.runTime(e);case"DATETIME":return this.runDateTime(e);case"USERNAME":case"_USERNAME":return D.AppGlobals.AppState.UserInformation.Name;case"USEREMAIL":case"_USEREMAIL":return this.runUserEmail(D.AppGlobals.AppState.UserInformation.AuthUserEmail);case"USERROLE":case"_USERROLE":return this.runUserRole(D.AppGlobals.AppState.UserInformation.UserRole);case"USERLOCALE":return navigator.languages?navigator.languages[0]:navigator.language;case"USERTZOFFSET":return(new Date).getTimezoneOffset();case"HERE":case"_HERE":return null!==(n=null==t?void 0:t.getLatLong(o))&&void 0!==n?n:null;case"UNIQUEID":case"_UNIQUE":return this.runUniqueId(e);case"ISBLANK":return this.runIsBlank(e);case"CONCATENATE":return this.runConcatenate(e);case"CONTAINS":return this.runContains(e);case"STARTSWITH":return this.runStartsWith(e);case"ENDSWITH":return this.runEndsWith(e);case"LEN":return this.runLen(e);case"LEFT":return this.runLeft(e);case"RIGHT":return this.runRight(e);case"MID":return this.runMid(e);case"FIND":return this.runFind(e);case"INITIALS":return this.runInitials(e);case"TEXT":return this.runText(e);case"UPPER":return this.runUpper(e);case"LOWER":return this.runLower(e);case"DOMAINOF":return this.runDomainOf(e);case"SUBSTITUTE":return this.runSubstitute(e);case"SPLIT":return this.runSplit(e);case"TRIM":return this.runTrim(e);case"LIST":return this.runList(e);case"SORT":return this.runSort(e);case"INDEX":return this.runIndex(e);case"IN":return(null===(a=null==t?void 0:t.appModel)||void 0===a?void 0:a.inRollout("curryNativeValue"))?this.runInRollout(e,t):this.runIn(e,t);case"COUNT":case"SUM":case"ANY":case"MIN":case"MAX":case"AVERAGE":case"STDEVP":return this.runAggregate(this.FunctionName,e,t);case"ROUND":case"FLOOR":case"CEILING":return this.runMathRounding(this.FunctionName,e);case"LOG":return this.runMathLog(e);case"MOD":return this.runMathMod(e);case"POWER":return this.runMathPower(e);case"ABS":return this.runMathAbs(e);case"SQRT":return this.runMathSqrt(e);case"RANDBETWEEN":return this.runMathRandBetween(e);case"NUMBER":return this.runNumber(e);case"DECIMAL":return this.runDecimal(e);case"HYPERLINK":return this.runHyperlink(e);case"LINKTEXT":return this.runLinkText(e);case"LINKURL":return this.runLinkUrl(e);case"LAT":return this.runLat(e);case"LONG":return this.runLong(e);case"LATLONG":return this.runLatLong(e);case"XY":return this.runXY(e);case"DISTANCE":return this.runDistance(e,t);case"ENCODEURL":return this.runEncodeUrl(e);case"LINKTOFORM":return this.runLinkToForm(e);case"APP":return this.runApp(e);case"CONTEXT":return this.runContext(e,t);case"WORKDAY":return this.runWorkday(e);case"EOMONTH":return this.runEndOfMonth(e);case"EWOMONTH":return this.runEndWeekdayOfMonth(e);case"EOWEEK":return this.runEndOfWeek(e);case"PREDICT":return this.runPredict(e,t);case"OCR":return this.runOcr(e,t,o);case"OCRTEXT":return this.runOcrText(e,t,o);case"UNIQUE":return this.runUnique(e);case"INTERSECT":return this.runIntersect(e);case"EXTRACT":return this.runExtract(e)}return null}},{key:"runExtract",value:function(e){var t=this,n=e[0].value;if(!n)return[];var a=e[1].value;if(!a)return[];var r,i=[];switch(n.toUpperCase()){case"PRICE":case"PRICES":i=(i=y.default.recognizeCurrency(a,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return t._convertRecognizerPrice(e)}));break;case"NUMBER":case"NUMBERS":i=(i=y.default.recognizeNumber(a,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return parseFloat(e.resolution.value)}));break;case"PHONENUMBER":case"PHONENUMBERS":i=(i=y.default.recognizePhoneNumber(a,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return e.resolution.value}));break;case"CHOICE":case"CHOICES":i=(i=y.default.recognizeBoolean(a,y.default.Culture.English)).filter((function(e){return null!=e})).map((function(e){return e.resolution.value}));break;case"DATETIME":case"DATETIMES":i=(i=this._runExtractDateTimes(a,["datetime","date","time","datetimerange","daterange","timerange"])).map((function(e){return t._convertRecognizerDateTime(e)})).flat();break;case"DATE":case"DATES":i=(i=this._runExtractDateTimes(a,["datetime","date","datetimerange","daterange"])).map((function(e){return t._convertRecognizerDateTime(e)})).flat();break;case"DOMAIN":case"DOMAINS":i=(i=(0,o.default)(a.matchAll(/(\w+(?:[-+.]\w+)*@\w+(?:[-.]\w+)*\.\w+(?:[-.]\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]})).map((function(e){var t=e.indexOf("@");return e.substr(t+1)}));break;case"TIME":case"TIMES":i=(i=this._runExtractDateTimes(a,["datetime","time","datetimerange","timerange"])).map((function(e){return t._convertRecognizerDateTime(e)})).flat();break;case"DURATION":case"DURATIONS":for(var l in r=this._runExtractDateTimes(a,["datetimerange","daterange","timerange","duration"])){var u=r[l];if(u.hasOwnProperty("start")&&u.hasOwnProperty("end")){var s=this._convertRecognizerDateTime(u,"start"),c=this._convertRecognizerDateTime(u,"end"),d=g.default.stringifyDuration(g.default.makeDuration((c-s)/1e3));i.push(d)}else if(u.hasOwnProperty("timex")&&u.hasOwnProperty("value")){var f=parseFloat(u.value),p=g.default.stringifyDuration(g.default.makeDuration(f/1e3));i.push(p)}}break;case"EMAIL":case"EMAILS":i=(i=(0,o.default)(a.matchAll(/(\w+(?:[-+.]\w+)*@\w+(?:[-.]\w+)*\.\w+(?:[-.]\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]}));break;case"HASHTAG":case"HASHTAGS":i=(i=(0,o.default)(a.matchAll(/(\#\w+(?:-\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]}));break;case"MENTION":case"MENTIONS":i=(i=(0,o.default)(a.matchAll(/(\@\w+(?:-\w+)*)/g))).filter((function(e){return null!=e})).map((function(e){return e[0]}))}return i}},{key:"_runExtractDateTimes",value:function(e,t){var n=y.default.recognizeDateTime(e,y.default.Culture.English);return n=(n=n.filter((function(e){return null!=e&&null!=e.resolution})).filter((function(e){return t.includes(e.resolution.values[0].type.toLowerCase())})).filter((function(e){return 0===(0,o.default)(e.text.matchAll(/^(\d+)$/g)).map((function(e){return parseInt(e)})).filter((function(e){return e<1900||e>2050})).length}))).map((function(e){return e.resolution.values[0]}))}},{key:"_convertRecognizerPrice",value:function(e){var t=parseFloat(e.resolution.value,10);return"Cent"===e.resolution.unit?t/100:t}},{key:"_convertRecognizerDateTime",value:function(e,t){return t?this._convertSingleRecognizerDateTime(e[t]):e.hasOwnProperty("start")?[this._convertSingleRecognizerDateTime(e.start),this._convertSingleRecognizerDateTime(e.end)]:this._convertSingleRecognizerDateTime(e.value)}},{key:"_convertSingleRecognizerDateTime",value:function(e){var t;if(/\bGMT[-\+]\d{4}$/.test(e))t=new Date(e);else{var n=(0,o.default)(new Date(e).toString().matchAll(/\b(GMT[-\+]\d{4})\b/g));t=n.length>0?new Date(e+" "+n[0]):new Date(e)}if(isNaN(t)&&e.indexOf(":")>-1){var a=new Date,r=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear();return new Date(r+" "+e)}return t}},{key:"runUnique",value:function(e){var t=e[0].value;if(!t)return null;var n=this.children[0].resultAttribute().nestedAttribute(),a=n.basestType();return p.default.uniqBy(t,(function(e){return(0,I.getTypedChildValue)(e,n,a,!1)}))}},{key:"runIntersect",value:function(e){if(!e||2!==e.length)return null;var t=e[0].value,n=e[1].value;if(!t||!n)return null;var a=this.children[0].resultAttribute().nestedAttribute(),r=a.basestType();return p.default.intersectionBy(t,n,(function(e){return(0,I.getTypedChildValue)(e,a,r,!1)}))}},{key:"getInConditionListInformation",value:function(e){if(this.isThisInCondition()){var t=this.children[1],n=t.resultTypeQualifier(),a=t.resultAttribute();return{elementType:n.ElementType,elementTypeQualifier:E.default.parseAuxData(n.ElementTypeQualifier),elementAttribute:a.nestedAttribute(),values:p.default.uniq(this.children[1].run(e)).filter((function(e){return null!=e&&""!==e}))}}return null}},{key:"runUtcNow",value:function(){var e=new Date,t=e.getTimezoneOffset();return(0,h.default)(e).add(t,"m").toDate()}},{key:"runHour",value:function(e){var t=e[0].value;return g.default.parseDuration(t).hours}},{key:"runMinute",value:function(e){var t=e[0].value,n=g.default.parseDuration(t);return n.mins*(n.isNegative?-1:1)}},{key:"runSecond",value:function(e){var t=e[0].value,n=g.default.parseDuration(t);return n.secs*(n.isNegative?-1:1)}},{key:"runTotalHours",value:function(e){var t=g.default.parseDuration(e[0].value),n=t.hours,a=t.mins,r=t.secs;return(t.isNegative?-1:1)*(Math.abs(n)+a/60+r/3600)}},{key:"runTotalMinutes",value:function(e){var t=g.default.parseDuration(e[0].value),n=t.hours,a=t.mins,r=t.secs;return(t.isNegative?-1:1)*(60*Math.abs(n)+a+r/60)}},{key:"runTotalSeconds",value:function(e){var t=g.default.parseDuration(e[0].value),n=t.hours,a=t.mins,r=t.secs;return(t.isNegative?-1:1)*(3600*Math.abs(n)+60*a+r)}},{key:"runDay",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getDate():0}},{key:"runMonth",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getMonth()+1:0}},{key:"runYear",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getFullYear():0}},{key:"runWeekday",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?new Date(t).getDay()+1:null}},{key:"runWeeknum",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?g.default.getWeek(new Date(t)):null}},{key:"runIsoWeeknum",value:function(e){var t=e[0].value;return e[0].attribute.yieldsOneOf(V)&&null!=t&&""!==t?(0,h.default)(new Date(t)).isoWeek():null}},{key:"runDate",value:function(e){var t=e[0].value;if(t){var n=new Date(t);if(n&&!isNaN(n))return n.setHours(0,0,0,0),n}return null}},{key:"runDateTime",value:function(e){var t=e[0].value;if(t){var n=new Date(t);if(n&&!isNaN(n))return n}return null}},{key:"runTime",value:function(e){var t=e[0].value;if(t){var n=new Date(t);return n&&!isNaN(n)?g.default.timeToDate(g.default.dateToTime(n)):g.default.timeToDate(t)}return null}},{key:"runUserEmail",value:function(e){var t=(0,M.getPreviewAsEmail)();return t||e}},{key:"runUserRole",value:function(e){var t;try{if(null===(t=window.parent)||void 0===t?void 0:t.getPreviewAsRole){var n=window.parent.getPreviewAsRole();if(n)return n}}catch(e){}return e}},{key:"runValueInList",value:function(e,t,n){var a=t.value,r=t.attribute,i=e.value,o=e.attribute;if(null!=i&&null!=a){var l,u=Array.isArray(a)?a:[a],s=o.basestType(),c=r.basestType(),d=r.nestedAttribute(),f=d.allNestedTypes(),h=(0,I.getTypedChildValue)(i,o,c,!1),v=[s,d.type(),f,a,n],m=this._typedListValueCacheKey,g=null!=m;if(g)for(var y=0;y<v.length;y++)p.default.isEqual(v[y],m[y])||(g=!1);if(!g){if(n){l=new Set;var b,T=G(u);try{for(T.s();!(b=T.n()).done;){var S=b.value;l.add((0,I.getTypedChildValue)(S,d,s,!1))}}catch(e){T.e(e)}finally{T.f()}}else l=u.map((function(e){return(0,I.getTypedChildValue)(e,d,s,!1)}));this._cachedTypedListValue=l,this._typedListValueCacheKey=v}return(l=this._cachedTypedListValue)instanceof Set?l.has(h):l.includes(h)}return!1}},{key:"runListInList",value:function(e,t,n){var a=this,r=e.value;if(null!=r&&null!=t.value){var i=Array.isArray(r)?r:[r],o=e.attribute.nestedAttribute(),l={type:o.type(),attribute:o};return p.default.every(i.map((function(e){return l.value=e,a.runValueInList(l,t,n)})))}return!1}},{key:"runIn",value:function(e,t){var n,a=e[0],r=e[1],i=null===(n=null==t?void 0:t.appModel)||void 0===n?void 0:n.inRollout("valueInListSet");return a.attribute.isListType()&&!r.attribute.nestedAttribute().isListType()?this.runListInList(a,r,i):this.runValueInList(a,r,i)}},{key:"runInRollout",value:function(e,t){var n,a=e[0],r=a.attribute,i=e[1],o=i.attribute.nestedAttribute(),l=r.isListType(),u=!l,s=o.isListType(),c=!s,d=null===(n=null==t?void 0:t.appModel)||void 0===n?void 0:n.inRollout("valueInListSet");if(u&&s){for(var f=o;f.nestedAttribute().isListType();)f=f.nestedAttribute();var h=p.default.extend({},i,{attribute:f,value:p.default.flattenDeep(i.value)});return this.runValueInList(a,h,d)}return l&&c?this.runListInList(a,i,d):this.runValueInList(a,i,d)}},{key:"runAggregate",value:function(e,t,n){var a,r=t[0].value,i=this.children[0].resultAttribute().nestedAttribute(),o=null==i?void 0:i.type().toLowerCase();if(r&&Array.isArray(r)&&r.length>0)switch(e){case"COUNT":return r.length;case"SUM":return"duration"===o?(0,g.sumDurations)(r):(null==i?void 0:i.isDecimalType())&&(null===(a=null==n?void 0:n.appModel)||void 0===a?void 0:a.inDynamicRolloutByOwnerId("ClientDecimalSum"))?(0,g.sumDecimals)(r):(0,g.sumNumbers)(r);case"MIN":return p.default.min(r);case"MAX":return p.default.max(r);case"AVERAGE":return r.reduce((function(e,t){return e+t}),0)/(r.length||1);case"STDEVP":var l=r.reduce((function(e,t){return e+t}),0)/(r.length||1),u=r.reduce((function(e,t){return e+Math.pow(Math.abs(t-l),2)}),0)/(r.length||1);return Math.sqrt(u)}else switch(e){case"COUNT":case"AVERAGE":case"STDEVP":return 0;case"SUM":return"duration"===o?g.default.stringifyDuration(g.default.makeDuration(0)):0;case"MIN":case"MAX":switch(o){case"number":case"percent":case"decimal":case"price":case"changecounter":return 0;case"duration":return g.default.stringifyDuration(g.default.makeDuration(0));default:return null}default:return null}return null}},{key:"runMathRounding",value:function(e,t){var n=t[0].value;if(null!=n&&""!==n){var a=Number(n);switch(e){case"ROUND":return Math.round(a);case"FLOOR":return Math.floor(a);case"CEILING":return Math.ceil(a)}}return null}},{key:"runMathLog",value:function(e){var t=e[0].value;if(null!=t){var n=Number(t),a=10;if(e.length>1){var r=e[1].value;null!=r&&(a=Number(r))}var i=0;try{i=Math.log(n)/Math.log(a)}catch(e){i=NaN}return isNaN(i)?0:i}return null}},{key:"runMathMod",value:function(e){var t=e[0].value,n=e[1].value;if(null!=t&&null!=n){var a=Number(t),r=Number(n);return 0===r?0:a%r}return null}},{key:"runMathPower",value:function(e){var t=e[0].value,n=e[1].value;if(null!=t&&null!=n){var a=Number(t),r=Number(n);return Math.pow(a,r)}return null}},{key:"runMathAbs",value:function(e){var t=e[0].value;if(null!=t){var n=Number(t);return Math.abs(n)}return null}},{key:"runMathSqrt",value:function(e){var t=e[0].value;if(null!=t){var n=Number(t);return Math.sqrt(n)}return null}},{key:"runMathRandBetween",value:function(e){var t=e[0].value,n=e[1].value;if(null!=t&&null!=n){var a=Number(t),r=Number(n);return r<=a?a:Math.floor(Math.random()*(r+1-a))+a}return null}},{key:"runLen",value:function(e){var t=e[0].value;return null===t?0:t.hasOwnProperty("length")?t.length:String(t).length}},{key:"runNumber",value:function(e){var t=e[0].value;if(!t)return null;var n=Math.round(Number(t));return isNaN(n)?null:n}},{key:"runDecimal",value:function(e){var t=e[0].value;if(!t)return null;var n=Number(t);return isNaN(n)?null:n}},{key:"runLeft",value:function(e){var t=e[0].value,n=e[1].value;return t&&n?String(t).substr(0,Number(n)):null}},{key:"runRight",value:function(e){var t=e[0].value,n=e[1].value;return t&&n?String(t).substr(String(t).length-Number(n)):null}},{key:"runMid",value:function(e){if(!p.default.isArray(e)||3!==e.length)return null;var t=e[0].value?String(e[0].value):"",n=e[1].value,a=e[2].value;return p.default.isInteger(n)&&p.default.isInteger(a)?n<=0||n>t.length?null:t.substr(n-1,a):null}},{key:"runFind",value:function(e){var t=e[0].value,n=e[1].value;return null==t||null==n?0:String(n).indexOf(String(t))+1}},{key:"runInitials",value:function(e){var t=e[0].value;return t?String(t).split(/\s+/).filter((function(e){return e})).map((function(e){return e[0]})).join(""):null}},{key:"runTrim",value:function(e){var t=e[0].value;if(!t)return null;try{return String(t).replace(/(^ +)|( +$)|( +(?= ))/g,"")}catch(e){return t}}},{key:"runText",value:function(e){var t,n=e[0].value;if(!n&&0!==n)return null;if(2===e.length&&"string"==typeof(null===(t=e[1])||void 0===t?void 0:t.value))return function(e,t){var n=t.replace(/[YMDHS]/g,(function(e){return e.toLowerCase()})),a=/(AM\/PM)|(A\/P)/gi;a.test(n)||(n=n.replace(/h/g,"H"));var r=n.replace(a,"A").replace(/[^ymdhHs0A]+/g,(function(e){return"[".concat(e,"]")})).replace(/y/g,"Y").replace(/(^|[^d])(d{1,2})(?!d)/g,(function(e,t,n){return"".concat(t).concat(n.toUpperCase())})).replace(/0/g,"S").replace(/m/g,"M").replace(/(M{1,2})(?=[^dhHy]*s)/g,(function(e){return e.toLowerCase()})).replace(/([hH][^M]*)(M{1,2})/g,(function(e,t,n){return"".concat(t).concat(n.toLowerCase())})),i=e.format(r);return/(A\/P)/gi.test(t)&&(i=e.hour()>=12?i.replace("PM","P"):i.replace("AM","A")),i}((0,h.default)(n),e[1].value);var a=B(e[0]);return e[0].attribute.localizeWireValue(a,{noRefLabel:!0})}},{key:"runApp",value:function(e){return this.runText(e)}},{key:"runContext",value:function(e,t){var a,r,i,o,l,u,s,c,d,f,h,v=B(e[0]).toLowerCase(),m=null,g=null,y=null===(a=t.uiContext)||void 0===a?void 0:a.viewStateKey;if(y){var b=(0,n(673275).getUIStateByKey)(y);m=b.Root,g=b.ControlName||""}else m=null===(i=null===(r=null===window||void 0===window?void 0:window.AppState)||void 0===r?void 0:r.CurrentUIState)||void 0===i?void 0:i.Root,g=(null===(l=null===(o=null===window||void 0===window?void 0:window.AppState)||void 0===o?void 0:o.CurrentUIState)||void 0===l?void 0:l.ControlName)||"";switch(v){case"host":return T.default.InMobileWebView()?"Device":"Browser";case"view":return g;case"viewtype":switch(m){case"fastTable":return"table";case"google-map":return"map";default:return m||""}case"device":return p.default.isFunction(null===(u=null==t?void 0:t.appModel)||void 0===u?void 0:u.GetClientId)?t.appModel.GetClientId():"";case"table":return null===(s=null==t?void 0:t.tableSchema)||void 0===s?void 0:s.sourceTableName();case"appname":return null===(d=null===(c=t.appModel)||void 0===c?void 0:c.appTemplate)||void 0===d?void 0:d.name();case"owneremail":return null===(h=null===(f=t.appModel)||void 0===f?void 0:f.appTemplate)||void 0===h?void 0:h.ownerEmail}return null}},{key:"runUpper",value:function(e){if(!e[0].value)return null;var t=B(e[0]);return t?t.toUpperCase():t}},{key:"runLower",value:function(e){if(!e[0].value)return null;var t=B(e[0]);return t?t.toLowerCase():t}},{key:"runDomainOf",value:function(e){if(!e[0].value)return null;var t=B(e[0]),n=t.lastIndexOf("@");return n<0?null:t?t.substring(n+1).toLowerCase():t}},{key:"runSubstitute",value:function(e){var t=e[0].value;if(!t)return null;var n=e[1].value;if(!n)return t;var a=e[2].value;return a||(a=""),t="string"==typeof t?t:B(e[0]),n="string"==typeof n?n:B(e[1]),a="string"==typeof a?a:B(e[2]),t.replace(new RegExp(g.default.regexEscape(n),"g"),a)}},{key:"runSplit",value:function(e){if(0===e.length)return null;var t=String(e[0].value),n=[];1===e.length?n=[" "]:n=e.slice(1).map((function(e){return e.value})).filter((function(e){return e}));var a,r=[t],i=G(n);try{var o=function(){var e=a.value;r=r.flatMap((function(t){return"string"==typeof t?t.split(e):Array.isArray(t)?t:[t]}))};for(i.s();!(a=i.n()).done;)o()}catch(e){i.e(e)}finally{i.f()}return r}},{key:"runConcatenate",value:function(e){return e.reduce((function(e,t){return e+B(t)}),"")}},{key:"runHyperlink",value:function(e){var t=B(e[0]),n=B(e[1]);return new w.default(t,n)}},{key:"runLinkText",value:function(e){var t=e[0].value.linkText||"";return String(t)}},{key:"runLinkUrl",value:function(e){var t=e[0].value.url||"";return String(t)}},{key:"runLat",value:function(e){var t=e[0].value;return(null==t?void 0:t.latitude)?t.latitude:(null==t?void 0:t.x)?t.x:null!==C.default.fromString(t)?C.default.fromString(t).latitude:0}},{key:"runLong",value:function(e){var t=e[0].value;return(null==t?void 0:t.longitude)?t.longitude:(null==t?void 0:t.y)?t.y:null!==C.default.fromString(t)?C.default.fromString(t).longitude:0}},{key:"runLatLong",value:function(e){var t=e[0].value,n=e[1].value;return new C.default(t,n)}},{key:"runXY",value:function(e){var t=e[0].value,n=e[1].value;return new O.default(t,n)}},{key:"runDistance",value:function(e){if(2!==e.length)return 0;var t=e[0],n=e[1];if(!t.attribute.yieldsOneOf(["LatLong","ChangeLocation"])||!n.attribute.yieldsOneOf(["LatLong","ChangeLocation"]))return 0;var a=e[0].value||C.defaultLatLong,r=e[1].value||C.defaultLatLong;return S.default.kmDistance(a.latitude,a.longitude,r.latitude,r.longitude)}},{key:"runEncodeUrl",value:function(e){if(1!==e.length)return"";var t=e[0],n=t.attribute,a=t.value,r=n.valueToWireFormat(a);return(n.isImageType()||"File"===n.type())&&(r=(0,g.getTableFileQueryParsed)(r).fileName||r||""),encodeURIComponent(r)}},{key:"runLinkToForm",value:function(e){var t=window.encodeURIComponent(e[0].value||""),n="",a=[];e.length%2==0?(n=window.encodeURIComponent(p.default.last(e).value||""),a=p.default.slice(e,1,e.length-1)):a=p.default.slice(e,1,e.length);var r=a.filter((function(e,t){return t%2==0})),o=a.filter((function(e,t){return t%2==1})),l={};return p.default.zip(r,o).forEach((function(e){var t=(0,i.default)(e,2),n=t[0],a=t[1],r=n.attribute.valueToWireFormat(n.value),o=a.attribute.valueToWireFormat(a.value);l[r]=o})),n+"#control="+t+"&defaults="+window.encodeURIComponent(JSON.stringify(l))}},{key:"runContains",value:function(e){var t=e[0].value,n=e[1].value;return null!=t&&null!=n&&(t=String(t),!((n=String(n)).length>t.length)&&t.toLowerCase().indexOf(n.toLowerCase())>=0)}},{key:"runStartsWith",value:function(e){var t=B(e[0]),n=B(e[1]);return t.toLowerCase().startsWith(n.toLowerCase())}},{key:"runEndsWith",value:function(e){var t=B(e[0]),n=B(e[1]);return t.toLowerCase().endsWith(n.toLowerCase())}},{key:"runUniqueId",value:function(e){if(null==e){var t=/^\d+[eE]\d{1,6}$/,n=/^0+\d*$/,a="";do{a=g.default.uuid(8,16).toLowerCase()}while(a.match(t)||a.match(n));return a}return"packeduuid"===String(e[0].value).toLowerCase()?g.default.uuid(22):"uuid"!==String(e[0].value).toLowerCase()||e.length>1?null:g.default.uuid()}},{key:"runIsBlank",value:function(e){return H(e[0].value)}},{key:"runList",value:function(e){return null==e?[]:e.map((function(e){return e.value}))}},{key:"runWorkday",value:function(e){if(!p.default.isArray(e))return null;if(e.length<2||e.length>3)return null;var t=e[0].value,n=e[1].value,a=[];3===e.length&&(a=p.default.compact(e[2].value).map((function(e){return e.valueOf()})));if(!p.default.isDate(t))return null;if(!p.default.isNumber(n))return null;if(!a.every(p.default.isNumber))return null;for(var r=n<0?-1:1,i=Math.abs(n),o=new Date(t),l=0;l<i;l++)do{o.setDate(o.getDate()+r)}while(6===o.getDay()||0===o.getDay()||a.indexOf(o.valueOf())>=0);return o}},{key:"runEndOfMonth",value:function(e){var t=e[0].value,n=e[1].value,a=(0,h.default)(t).add(n,"M").endOf("month").toDate();return a.setHours(0,0,0,0),a}},{key:"runEndWeekdayOfMonth",value:function(e){var t=e[0].value,n=e[1].value,a=(0,h.default)(t).add(n,"M").endOf("month").toDate();return 0===a.getDay()?a.setDate(a.getDate()-2):6===a.getDay()&&a.setDate(a.getDate()-1),a.setHours(0,0,0,0),a}},{key:"runEndOfWeek",value:function(e){var t=(0,h.default)(e[0].value),n=this.runWeekday(e.slice(0,1)),a=t.add(7,"d").add(0-n,"d").toDate();return a.setHours(0,0,0,0),a}},{key:"runOcr",value:function(e,t,n){var a=t.appModel.appTemplate,r=e[0].value,i=a.findOcrModel(r);if(!i)return b.default.ReportErrorOnce({errorMessage:"could not find OCR model"}),null;var o=a.findOcrExtractor(r);if(!o)return b.default.ReportErrorOnce({errorMessage:"could not find OCR extractor"}),null;var l=e[1].value,u=i.table(),s=R.default.from(l,u),c=e[2].value;if(o.hasCachedValue(s)){var d=o.getCachedValue(s);return d.success()?d.getExtractedValue(c):(b.default.ReportErrorOnce({errorMessage:"unable to run OCR extractor",nestedErrorMessage:d.errorMessage()}),null)}return o.extract(s).then((function(e){if(e.success()){var t=e.getExtractedValue(c);n.asyncCallback(t)}else b.default.ReportErrorOnce({errorMessage:"unable to run OCR extractor",nestedErrorMessage:e.errorMessage()})})).catch((function(e){b.default.ReportErrorOnce({errorMessage:"Error caught in OCR extractor",error:e})})),null}},{key:"runOcrText",value:function(e,t,n){var a=t.appModel.appTemplate.ocrTextExtractor(),r=t.tableSchema.sourceTableName(),i=e[0].value,o=R.default.from(i,r);if(a.hasCachedValue(o)){var l=a.getCachedValue(o);return l.success()?l.getExtractedValue("_Text"):(b.default.ReportErrorOnce({errorMessage:"unable to run OCRTEXT extractor",nestedErrorMessage:l.errorMessage()}),null)}return a.extract(o,r).then((function(e){if(e.success()){var t=e.getExtractedValue("_Text");n.asyncCallback(t)}else b.default.ReportErrorOnce({errorMessage:"unable to run OCRTEXT extractor",nestedErrorMessage:e.errorMessage()})})).catch((function(e){b.default.ReportErrorOnce({errorMessage:"Error caught in OCRTEXT extractor",error:e})})),null}},{key:"runPredict",value:function(e,t){var n=e[0].value,a=t.appModel.appTemplate.findPredictor(n);if(!a)return b.default.ReportErrorOnce({errorMessage:"expected predictor"}),null;var r=new k.default(t,[t.rowData]);return a.predict(r)[0]}},{key:"runSort",value:function(e){if(null==e)return[];var t=e[0].attribute.nestedAttribute(),n=!1;2===e.length&&(n=e[1].value);var a=[].concat(e[0].value);return _.default.sort(a,(function(e,a){var r=t.valueComparer(E.ValueFormat.Native)(e,a);return 0!==r?n?-1*r:r:0})),a}},{key:"runIndex",value:function(e){var t=e[0],n=e[1];if(null!=t.value&&null!=n.value){var a=Array.isArray(t.value)?t.value:null,r=Number(n.value);if(a&&a.length>=r&&r>0)return a[r-1]}return null}},{key:"runIf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.children[0].run(e,t);return n?this.children[1].run(e,t):this.children[2].run(e,t)}},{key:"runIfS",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0;n<this.children.length;n+=2){var a=this.children[n].run(e,t);if(a&&n+1<this.children.length)return this.children[n+1].run(e,t)}return null}},{key:"runSwitch",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.children[0],a=n.run(e,t),r=n.resultAttribute(),i=r.basestType(),o=function(e,t){var n=t.basestType();return(0,I.getTypedChildValue)(a,r,n,!1)===(0,I.getTypedChildValue)(e,t,i,!1)},l=1;l<this.children.length-2;l+=2){var u=this.children[l],s=u.run(e,t),c=u.resultAttribute();if(o(s,c))return this.children[l+1].run(e,t)}return this.children[this.children.length-1].run(e,t)}},{key:"runLinkToFilteredView",value:function(e){if(null==e)return null;var t=e.appModel.appTemplate,n=String(this.children[0].Value),a=t.findControl(n);if(!a)return null;var r=a.TableOrFolderName,i=t.findRootSchemaForTable(r),o=e.makeNestedContext(i),l=this.children[1].curry(o),u=m.default.makeCompactEvaluatable(l),s=encodeURIComponent(n),c=JSON.stringify(u);return"#control="+s+"&filter="+encodeURIComponent(c)}},{key:"runSelect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null==e||"function"!=typeof e.getTableColumnSet)return[];var r=this.children[0],i=r.TableName,o=r.RowListAttrName,l=r.RowListAttrIndex,u=r.ColumnIndex,s=r.ContextLevel,c=this.children[1],d=3===this.children.length&&this.children[2].run(e,n),f=a.maxEntries,p=this.resultAttribute(),h=p.nestedAttribute(),v=e.getTableColumnSet(i,u,c,d,f,l,o,s).map((function(e){return(h||p).valueFromWireFormat(e)})),m=h.basestAttribute().type();return v.map((function(e){return t.handleRefImageValue(e,m,i)}))}},{key:"runOrderBy",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null==e||"function"!=typeof e.sortData)return[];var a=this.children[0].resultAttribute(),r=a.nestedAttribute(),i=null==r?void 0:r.referencedTableName(),o=this.children[0].run(e,t);if(null==o)return null;if(0===o.length)return[];for(var l=[],u=1;u<this.children.length;u+=2)l.push({sortExpression:this.children[u],descending:u+1<this.children.length&&this.children[u+1].run(e,t)});return e.sortData(o,i,l,n.maxEntries)}},{key:"runAny",value:function(e,t){var n=this.children[0].run(e,t,{maxEntries:1});return n.length>0?n[0]:null}},{key:"runTop",value:function(e,t){var n=this.children[1].run(e,t),a=this.children[0].run(e,t,{maxEntries:n});return a?a.slice(0,n):null}},{key:"curryLazy",value:function(e){var t;switch(this.FunctionName){case"SELECT":return(null===(t=e.appModel)||void 0===t?void 0:t.inRollout("currySelect"))?this.currySelectRollout(e):this.currySelect(e);case"ORDERBY":return this.curryOrderBy(e);default:return(0,s.default)((0,f.default)(a.prototype),"curry",this).call(this,e)}}},{key:"currySelect",value:function(e){var t=!0,n=this.children[2]&&this.children[2].curry(e);if(this.children[0].RowListAttrIndex)t=!1;else if(n&&"CONSTANT"!==n.evalType())t=!1;else{var a=this.makeFakeFilterContext(e,"");"CONSTANT"!==this.children[1].curry(a).evalType()&&(t=!1)}return t?this.convertToConstant(e):n?v.default.create(p.default.extend({},this.model,{Children:[this.children[0].model,this.children[1].model,n.model]})):this}},{key:"currySelectRollout",value:function(e){var t=(0,i.default)(this.children,3),n=t[0],a=t[1],r=t[2],l=n.TableName,u=e.appModel.findTableCollection(l).tableSchema;if(null==u)return this;var s=e.makeNestedContext(u),c=a.curry(s),d=null==r?void 0:r.curry(e),f=this;if(c!==a||d!==r){var p=(0,o.default)(this.children);p[1]=c,d&&(p[2]=d),f=this.withCurriedChildren(p)}var h=n.RowListAttrName,v=n.RowListAttrIndex,m=n.RowListContextLevel,g=null!=h&&null!=v,y=g?e.getColumnValue(h,v,m):void 0,b=!g||null!=y,T=null==d||d.isConstant;if(b&&T){var S=this.makeFakeFilterContext(e,"");if(c.curry(S).isConstant)return f.convertToConstant(e)}return f}},{key:"makeFakeFilterContext",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=new A.default(e.appModel,e.tableSchema);return(null===(t=e.appModel)||void 0===t?void 0:t.inRollout("currySelect"))&&a.setParentContext(e),a.getColumnValue=function(t,a,r){return 0===r?n:e.getColumnValue(t,a,r-1)},a.isFakeContext=!0,a}},{key:"currySelectFilterOnly",value:function(e){var t=this.makeFakeFilterContext(e,null);return this.children[1].curry(t)}},{key:"curryOrderBy",value:function(e){var t=v.default.create(p.default.extend({},this.model));return t.model.Children=[],null!=this.children&&(t.children=this.children.map((function(n,a){var r=a%2==0?n.curry(e):n;return t.model.Children[a]=r.model,r}))),t.children.map((function(e,t){return t%2!=0||"CONSTANT"===e.model.EvalType})).every((function(e){return e}))?this.convertToConstant(e):t}},{key:"curryThis",value:function(e){var t;return(null===(t=null==e?void 0:e.appModel)||void 0===t?void 0:t.inRollout("curryNativeValue"))?(0,s.default)((0,f.default)(a.prototype),"curryThis",this).call(this,e):this.children&&0!==this.children.filter((function(e){return"CONSTANT"!==e.model.EvalType})).length?this:this.convertToConstant(e)}}]),a}(m.default);t.default=W},426204:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(861655)),l=a(n(994993)),u=a(n(73808));function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,l.default)(this,n)}}var c=function(e){(0,o.default)(n,e);var t=s(n);function n(e,a){var i;return(0,r.default)(this,n),(i=t.call(this,e,a)).Name=e.Name,i}return(0,i.default)(n,[{key:"runEval",value:function(e,t){var n;if(null!=t){var a=t.getInputParameterValue(this.Name);if(null!==a)return a}return null===(n=e[0])||void 0===n?void 0:n.value}}]),n}(a(n(189491)).default);t.default=c},888861:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.create=A,t.createAnd=G,t.createColFilter=M,t.createColumnLookup=E,t.createColumnSet=O,t.createCompositeBoolean=P,t.createConcatenate=F,t.createConstantValue=w,t.createConstantValueNative=C,t.createEquals=R,t.createFilter=I,t.createIn=N,t.createIsBlank=k,t.createKeyInListFilter=D,t.createNot=_,t.createOr=x,t.createRefsFilter=V,t.createSelect=L,t.default=void 0,t.getFilterDefaults=B,t.getFilterDefaultsAndFullyMapped=U;var r=a(n(627424)),i=a(n(600861)),o=a(n(496486)),l=a(n(593186)),u=a(n(565722)),s=a(n(85945)),c=a(n(17601)),d=a(n(98705)),f=a(n(397013)),p=a(n(213082)),h=a(n(50757)),v=a(n(426204)),m=n(166089);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var b={FUNCTION:u.default,CONSTANT:s.default,COLUMN:c.default,DEREF:d.default,ARITHMETIC:f.default,BOOLEAN:p.default,COLUMNSET:h.default,PARAM:v.default};function T(e){return A(e)}function S(e){var t;return null===(t=e.Children)||void 0===t?void 0:t.map(T)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,n=e.EvalType,a=b[n];return a?new a(e,t):(l.default.warnToDevConsole("No evaluation tree class found for ",n),null)}function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return A({ResultType:t.type(),ResultTypeQualifier:t.auxData(),EvalType:"COLUMN",ColName:t.name(),ColIndex:e.findAttributeIndex(t.name()),ColumnsReferenced:[e.findAttributeIndex(t.name())],ContextLevel:n})}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return A({ResultType:t,ResultTypeQualifier:n,EvalType:"CONSTANT",ConstantValue:e})}function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return A({ResultType:t,ResultTypeQualifier:n,EvalType:"CONSTANT",NativeValue:e})}function O(e,t,n,a){return A({ResultType:"List",ResultTypeQualifier:t.isKey()?{ElementType:"Ref",ElementTypeQualifier:JSON.stringify({ReferencedType:t.type(),ReferencedTableName:e.tableOrSliceName(),ReferencedTypeQualifier:t.auxDataString()})}:{ElementType:t.type(),ElementTypeQualifier:t.auxDataString()},EvalType:"COLUMNSET",IsPure:!0,ColIndex:e.findAttributeIndex(t.name()),ColName:t.name(),TableName:e.tableOrSliceName(),RowListAttrName:null==n?void 0:n.name(),RowListAttrIndex:a})}function _(e){return A({ResultType:"Yes/No",EvalType:"BOOLEAN",BoolType:"NOT",IsAtomic:!1,Children:[e.model]})}function k(e){return A({ResultType:"Yes/No",EvalType:"FUNCTION",FunctionName:"ISBLANK",Children:[e.model]})}function R(e,t,n){return A({ResultType:"Yes/No",EvalType:"BOOLEAN",OperatorName:"Equals",IsAtomic:!0,Children:[e.model,t.model],SourceExpr:n})}function I(e,t){return null!=e&&null!=t?R(w(e,t.resultType(),t.resultTypeQualifier()),t):null}function N(e,t,n){return A({ResultType:"Yes/No",EvalType:"FUNCTION",FunctionName:"IN",Children:[e.model,t.model],SourceExpr:n})}function M(e,t,n){var a;return n&&null!=n.name()&&null!=e?n&&"EnumList"===n.type()&&""!==e?N(w(e,null!==(a=n.nestedType())&&void 0!==a?a:"Text",n.baseTypeQualifier()),E(t,n)):R(w(e,n.basestType(),n.baseTypeQualifier()),E(t,n)):null}function D(e,t,n){return n instanceof u.default&&"SELECT"===n.FunctionName?A(n.children[1].model):N(A({ResultType:e,ResultTypeQualifier:t,EvalType:"COLUMN",ColName:"_THISROW"}),n)}function L(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return A({ResultType:e.resultType(),ResultTypeQualifier:e.resultTypeQualifier(),EvalType:"FUNCTION",FunctionName:"SELECT",Children:[e.model,t.model,w(n?"Y":"N","Yes/No").model],SourceExpr:a})}function P(e,t){var n=o.default.compact(e),a=o.default.map(n,"model");switch(n.length){case 0:return null;case 1:return n[0];default:return A({ResultType:"Yes/No",EvalType:"BOOLEAN",BoolType:t,IsAtomic:!1,Children:a})}}function G(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return P(t,"AND")}function x(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return P(t,"OR")}function F(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return A({ResultType:"Text",EvalType:"FUNCTION",FunctionName:"CONCATENATE",Children:o.default.map(t,"model")})}function V(e,t,n){var a=[];o.default.forEach(e,(function(e,r){var i=t.refAttributesToTable(r).filter((function(e){return n.findTableCollection(e.referencedTableName(),!0).tableSchema.name()!==t.name()}));i.length&&a.push({refAttribute:i[0],columnValue:e})}));var r=a.map((function(e){var n=e.refAttribute;return M(e.columnValue,t,n)}));return G.apply(void 0,(0,i.default)(r))}function U(e){var t,n=[],a=!1;if(null==e?void 0:e.children)if(null===(t=m.AppGlobals.AppModel)||void 0===t?void 0:t.inRollout("curryNativeValue")){if("BOOLEAN"===e.evalType()&&e.isAtomic()&&"Equals"===e.operatorName()){var i=function(e){var t,n=g(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(c.default.is(a)&&0===a.ContextLevel)return a}}catch(e){n.e(e)}finally{n.f()}}(e.children),o=function(e){var t,n=g(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(s.default.is(a))return a}}catch(e){n.e(e)}finally{n.f()}}(e.children);i&&o&&(n.push({ColumnName:i.colName(),ColumnValue:o.constantValue()}),a=!0)}else if("BOOLEAN"===e.evalType()&&!e.isAtomic()&&"AND"===e.boolType()){a=!0;for(var l=0;l<e.children.length;l++){var u=U(e.children[l]),d=(0,r.default)(u,2),f=d[0],p=d[1];n=n.concat(f),a=a&&p}}}else{var h=e.model;if("BOOLEAN"===h.EvalType&&h.IsAtomic&&"Equals"===h.OperatorName)"COLUMN"===h.Children[0].EvalType&&"CONSTANT"===h.Children[1].EvalType?(n.push({ColumnName:h.Children[0].ColName,ColumnValue:h.Children[1].ConstantValue}),a=!0):"COLUMN"===h.Children[1].EvalType&&"CONSTANT"===h.Children[0].EvalType&&(n.push({ColumnName:h.Children[1].ColName,ColumnValue:h.Children[0].ConstantValue}),a=!0);else if("FUNCTION"===h.EvalType&&"IN"===h.FunctionName)"COLUMN"===h.Children[1].EvalType&&"CONSTANT"===h.Children[0].EvalType&&(n.push({ColumnName:h.Children[1].ColName,ColumnValue:h.Children[0].ConstantValue}),a=!0);else if("BOOLEAN"===h.EvalType&&!h.IsAtomic&&"AND"===h.BoolType){a=!0;for(var v=0;v<e.children.length;v++){var y=U(e.children[v]),b=(0,r.default)(y,2),T=b[0],S=b[1];n=n.concat(T),a=a&&S}}}return[n,a]}function B(e){return U(e)[0]}var H=Object.assign(Object.assign({},b),{create:A,createColumnLookup:E,createColumnSet:O,createSelect:L,createConstantValue:w,createConstantValueNative:C,createEquals:R,createNot:_,createIn:N,createIsBlank:k,createFilter:I,createColFilter:M,createKeyInListFilter:D,createCompositeBoolean:P,createAnd:G,createOr:x,createConcatenate:F,createRefsFilter:V,getFilterDefaults:B,getFilterDefaultsAndFullyMapped:U});t.default=H},32913:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(593186)),u=function(){function e(t){var n=t.timeoutSec;(0,r.default)(this,e),o.default.isNumber(n)?this.cacheTimeoutSec=n:this.cacheTimeoutSec=30,this.cache={}}return(0,i.default)(e,[{key:"makeRequestKey",value:function(e){return e.resolve()}},{key:"addToCache",value:function(e,t){var n=this;this.cache[e]={timestamp:new Date,object:{promise:t,value:null}},t&&t.then((function(t){n.cache[e]&&(n.cache[e].object.value=t)})).catch((function(e){return l.default.ReportErrorOnce({errorMessage:"Error in addToCache",error:e})})),this.cleanupCache()}},{key:"getFromCache",value:function(e){return this.cache[e]?this.tryEvict(e)?null:this.cache[e].object:null}},{key:"tryEvict",value:function(e){if(!this.cache[e])return!1;var t=this.cache[e],n=new Date,a=t.timestamp;return(n.getTime()-a.getTime())/1e3>this.cacheTimeoutSec&&(delete this.cache[e],!0)}},{key:"cleanupCache",value:function(){var e=this;o.default.keys(this.cache).forEach((function(t){return e.tryEvict(t)}))}}]),e}();t.default=u},747286:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=function(){function e(t){(0,r.default)(this,e),this._model=t}return(0,i.default)(e,[{key:"success",value:function(){return this._model.Success}},{key:"errorMessage",value:function(){return this._model.ErrorMessage}},{key:"getExtractedValue",value:function(e){return this.success()?this._model.Extraction[e]:null}}]),e}();t.default=o},738628:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(747286)),u=a(n(32913)),s=n(34531),c=function(){function e(t){var n=t.appId,a=t.ocrModel,i=t.cacheTimeoutSec,l=t.extractFn;(0,r.default)(this,e),this.appId=n,this.ocrModel=a,this.cache=new u.default({timeoutSec:i}),o.default.isFunction(l)?this.extractFn=l:this.extractFn=s.makeOcrRequest,this.makeRequest=this.makeRequest.bind(this)}return(0,i.default)(e,[{key:"extract",value:function(e){var t=this;return(0,s.getImageData)(e).then((function(){return t.extractHelper(e)}))}},{key:"extractHelper",value:function(e){var t=this.cache.makeRequestKey(e),n=this.cache.getFromCache(t);if(n)return n.promise;var a=(0,s.getImageData)(e).then(this.makeRequest);return this.cache.addToCache(t,a),a}},{key:"hasCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),n=this.cache.getFromCache(t);return!!(null==n?void 0:n.value)}},{key:"getCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),n=this.cache.getFromCache(t);return n?n.value:null}},{key:"makeRequest",value:function(e){var t=this.appId,n=this.ocrModel.name(),a=this.extractFn(t,n,e);return Promise.resolve(a).then((function(e){return new l.default(e)}))}}]),e}();t.default=c},455842:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"name",value:function(){return this.model.Name}},{key:"table",value:function(){return this.model.Table}}]),e}();t.default=o},81873:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=a(n(747286)),u=a(n(32913)),s=n(34531),c=function(){function e(t){var n=t.appId,a=t.cacheTimeoutSec,i=t.extractFn;(0,r.default)(this,e),this.appId=n,this.cache=new u.default({timeoutSec:a}),o.default.isFunction(i)?this.extractFn=i:this.extractFn=s.makeOcrTextRequest,this.makeRequest=this.makeRequest.bind(this)}return(0,i.default)(e,[{key:"extract",value:function(e,t){var n=this;return(0,s.getImageData)(e).then((function(){return n.extractHelper(e,t)}))}},{key:"extractHelper",value:function(e,t){var n=this,a=this.cache.makeRequestKey(e),r=this.cache.getFromCache(a);if(r)return r.promise;var i=(0,s.getImageData)(e).then((function(e){return n.makeRequest(e,t)}));return this.cache.addToCache(a,i),i}},{key:"hasCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),n=this.cache.getFromCache(t);return!!(null==n?void 0:n.value)}},{key:"getCachedValue",value:function(e){var t=this.cache.makeRequestKey(e),n=this.cache.getFromCache(t);return n?n.value:null}},{key:"makeRequest",value:function(e,t){var n=this.appId,a=this.extractFn(n,e,t);return Promise.resolve(a).then((function(e){return new l.default(e)}))}}]),e}();t.default=c},34531:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getImageData=function(e){return new Promise((function(t,n){e.getBase64OrWebUrl((function(e,a){e?n(e):t(a)}))}))},t.makeOcrRequest=function(e,t,n){var o={ImageData:n},l="/api/template/".concat(e,"/ocrExtract/").concat(t);return(0,i.ajaxPost)(l,o,{contentType:"json"}).then((function(e){return e=e||{},a.logger.logEvent(new r.OcrEvent(e.Success)),e}))},t.makeOcrTextRequest=function(e,t,n){var o={ImageData:t},l="/api/template/".concat(e,"/ocrText/").concat(n);return(0,i.ajaxPost)(l,o,{contentType:"json"}).then((function(e){return e=e||{},a.logger.logEvent(new r.OcrTextEvent(e.Success)),e}))};var a=n(318926),r=n(804758),i=n(635672)},308048:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=function(){function e(){(0,r.default)(this,e),this.columnNames=[],this._columnValues={}}return(0,i.default)(e,[{key:"addColumn",value:function(e,t){this.columnNames.push(e),this._columnValues[e]=t}},{key:"columnValues",value:function(e){return this._columnValues[e]}},{key:"createBagOfWords",value:function(e,t){var n=this;if(null!=this.columnNames){for(var a=[],r=function(t){var r=[];e.forEach((function(e){r.push(n._columnValues[e.model.Name][t])})),a.push(r.join(" "))},i=0;i<this._columnValues[this.columnNames[0]].length;i++)r(i);this.addColumn(t,a)}}}]),e}();t.default=o},944589:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(308048)),l=function(){function e(t){(0,r.default)(this,e),this._colDefs=t}return(0,i.default)(e,[{key:"buildFrom",value:function(e){var t=this._colDefs,n=new o.default,a=e.rows,r=e.singleDataContext;return t.forEach((function(e){var t=e.name(),i=e.formulaEvalTree(),o=[];a.forEach((function(e){r.rowData=e;var t=i.run(r);o.push(t)})),n.addColumn(t,o)})),n}}]),e}();t.default=l},372502:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=function(){function e(t){(0,r.default)(this,e),this.name=t}return(0,i.default)(e,[{key:"columnName",value:function(){return this.name}},{key:"standardize",value:function(e){return e}}]),e}();t.default=o},663207:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ALL_TEXT_FEATURES=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(888861));t.ALL_TEXT_FEATURES="all_text_features";var l=function(){function e(t){(0,r.default)(this,e),this.model=t,this._evalTreeLookup={}}return(0,i.default)(e,[{key:"evalTreeLookup",value:function(e){if(!this._evalTreeLookup[e]){var t=this.model.ExprLookup||{};try{this._evalTreeLookup[e]=o.default.create(t[e])}catch(t){console.warn("Failed to create ExprEvalTree for "+e)}}return this._evalTreeLookup[e]}},{key:"formulaEvalTree",value:function(){return this.evalTreeLookup("Formula")}},{key:"name",value:function(){return this.model.Name}},{key:"type",value:function(){return this.model.Type}}]),e}();t.default=l},116898:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(947787)),l=function(){function e(){(0,r.default)(this,e)}return(0,i.default)(e,null,[{key:"create",value:function(e,t){if("SUPERVISED"===e)return new o.default(t);throw Error("Unknown model type")}}]),e}();t.default=l},973289:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(116898)),l=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"name",value:function(){return this.model.Name}},{key:"modelType",value:function(){return this.model.ModelType}},{key:"settings",value:function(){return this._settings||(this._settings=o.default.create(this.modelType(),this.model.Settings)),this._settings}},{key:"colDefs",value:function(){return this.settings().allDefinitions()}},{key:"inputColDefs",value:function(){return this.settings().inputDefinitions()}},{key:"outputColDef",value:function(){return this.settings().outputDefinition()}},{key:"predictorReady",value:function(){var e=this.model;return!e.NeedsTraining&&e.Id&&(e.JobId||e.TrainOperationName)}},{key:"id",value:function(){return this.model.Id}},{key:"isLegacy",value:function(){return null==this.model.TrainOperationName}}]),e}();t.default=l},317473:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(805491)),l=a(n(736306)),u=a(n(372502)),s=n(663207),c=function(){function e(t,n){if((0,r.default)(this,e),this.model=t,this.legacy=n,n)this._vocabAssets=t.vocab_assets.map((function(e){return new o.default(e)})),this._stdAssets=t.standardizer_assets.map((function(e){return new l.default(e)})),this._internalColumnNames={};else{for(var a in this._bagOfWords=t.InputProcessing.ApplyBagOfWords,this._assets=new Map,this._internalColumnNames=t.InternalColumnNames,t.InputProcessing.ColumnProcessing){var i=t.InputProcessing.ColumnProcessing[a];1===i.Encoding||2===i.Encoding?this._assets.set(a,new o.default({col_name:a,tokens:i.OrderedVocabulary})):3===i.Encoding?this._assets.set(a,new l.default({col_name:a,mean:i.Mean,std:i.Stdev})):this._assets.set(a,new u.default(a))}1===t.OutputProcessing.Transform&&this._assets.set("output_column",new o.default({col_name:"output_column",tokens:t.OutputProcessing.OutputValues}))}}return(0,i.default)(e,[{key:"getVocabAsset",value:function(e){return this.legacy?this._vocabAssets.find((function(t){return t.columnName()===e})):this._assets.get(e)}},{key:"getStandardizerAsset",value:function(e){return this.legacy?this._stdAssets.find((function(t){return t.columnName()===e})):this._assets.get(e)}},{key:"hasInternalColumnNames",value:function(){return!!this._internalColumnNames&&Object.keys(this._internalColumnNames).length>0}},{key:"getInternalColumnName",value:function(e){if(e===s.ALL_TEXT_FEATURES)return e;var t=this._internalColumnNames[e];if(void 0===t)throw new Error("column not found");return t}}]),e}();t.default=c},985341:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(364687)),i=a(n(856690)),o=a(n(689728)),l=n(635672),u=a(n(317473)),s=a(n(944589)),c=a(n(738181)),d=a(n(593186)),f=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},p=function(){function e(t){var n=t.predictiveModel,a=t.modelAssets,r=t.tfjsModel,o=t.tf;(0,i.default)(this,e),this.tf=o,this.predictiveModel=n,this.tfjsModel=r,this.modelAssets=a,this.legacy=n.isLegacy(),this.vectorizer=new c.default(n,a);var l=this.predictiveModel.settings().inputDefinitions();this.datasetBuilder=new s.default(l),this.predict=this.predict.bind(this),this.inputTensors=this.inputTensors.bind(this),this.tensorLength=this.tensorLength.bind(this)}return(0,o.default)(e,[{key:"predict",value:function(e){var t=this.tfjsModel;try{var n=this.inputTensors(e),a=t.predict(n);return this.vectorizer.predictionsToValues(a)}catch(e){return d.default.ReportErrorOnce({errorMessage:"Error running predictive model"}),""}}},{key:"inputTensors",value:function(e){var t=this,n=this.datasetBuilder.buildFrom(e),a=this.vectorizer.vectorize(n);return this.legacy?this.tf.tensor2d(a):a.map((function(e){return t.tf.tensor2d(e,[1,t.tensorLength(e)])}))}},{key:"tensorLength",value:function(e){return Array.isArray(e)?e.length:1}}],[{key:"fromDefinition",value:function(t,a){return f(this,void 0,void 0,r.default.mark((function i(){var o,s,c,d,p,h,v,m,g;return r.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all([n.e("vendors-node_modules_tensorflow_tfjs_dist_index_js"),n.e("_4434-_126c-_a298-_181a-_19e2")]).then(n.t.bind(n,843081,23));case 2:return o=i.sent,s=t.Id,c=a.id(),d="/predictiveModels/".concat(s,"/").concat(c,"/tfjs/model.json"),p="/predictiveModels/".concat(s,"/").concat(c,"/assets.json"),h="/api/template/".concat(s,"/trainingJobInfo/").concat(c),i.next=10,new Promise((function(e,t){!function n(a){return f(this,void 0,void 0,r.default.mark((function i(){var o,u,s;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,l.ajaxGet)(h);case 2:(o=r.sent).Success||t("Failed to fetch predictive model ".concat(a," status")),u=o.TrainingJobInfo,"ERROR"!==(s=u.TrainingStatus)&&"FINISHED"!==s?(5e3,setTimeout(n,5e3,a)):e(void 0);case 7:case"end":return r.stop()}}),i)})))}(c)}));case 10:return i.next=12,o.loadLayersModel(d);case 12:return v=i.sent,i.next=15,(0,l.ajaxGet)(p);case 15:return m=i.sent,g=new u.default(m,a.isLegacy()),i.abrupt("return",new e({predictiveModel:a,modelAssets:g,tfjsModel:v,tf:o}));case 18:case"end":return i.stop()}}),i)})))}}]),e}();t.default=p},736306:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"columnName",value:function(){return this.model.col_name}},{key:"mean",value:function(){return this.model.mean}},{key:"std",value:function(){return this.model.std}},{key:"standardize",value:function(e){var t=this.mean(),n=this.std();return n<=0?0:(e-t)/n}}]),e}();t.default=o},947787:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(663207)),l=function(){function e(t){(0,r.default)(this,e),this.model=t}return(0,i.default)(e,[{key:"type",value:function(){return this.model.Type}},{key:"inputDefinitions",value:function(){return this._inputDefs||(this._inputDefs=this.model.InputDefinitions.map((function(e){return new o.default(e)}))),this._inputDefs}},{key:"outputDefinition",value:function(){return this._outputDef||(this._outputDef=new o.default(this.model.OutputDefinition)),this._outputDef}},{key:"allDefinitions",value:function(){var e=this.inputDefinitions();return e.push(this.outputDefinition()),e}}]),e}();t.default=l},738181:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(856690)),o=a(n(689728)),l=a(n(496486)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(663207));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}var c=function(){function e(t,n){(0,i.default)(this,e),this.predictiveModel=t,this.assets=n,this.legacy=t.isLegacy()}return(0,o.default)(e,[{key:"vectorize",value:function(e){var t=this,n=this.predictiveModel.settings().inputDefinitions(),a={};if(!this.legacy&&this.assets._bagOfWords){var r=[],i=[];n.forEach((function(e){"TEXT"===e.model.Type?i.push(e):r.push(e)})),i.length>0&&(r.push(new u.default({Name:u.ALL_TEXT_FEATURES,Type:"TEXT"})),e.createBagOfWords(i,u.ALL_TEXT_FEATURES)),n=r}n.forEach((function(n){var r=n.name(),i=e.columnValues(r).map((function(e){return t.createValues(n,e)}));a[r]=i}));var o=l.default.max(l.default.values(a).map((function(e){return e.length})));if(this.legacy){for(var s=[],c=function(e){var t=[];n.forEach((function(n){var r=n.name(),i=a[r][e];t=t.concat(i)})),s.push(t)},d=0;d<o;d++)c(d);return s}var f=[];return n.forEach((function(e){for(var t=[],n=0;n<o;n++){var r=e.name(),i=a[r][n];t=t.concat(i)}f.push(t)})),f}},{key:"predictionsToValues",value:function(e){switch(this.predictiveModel.outputColDef().type()){case"BOOLEAN":return this.booleanToResults(e);case"NUMERIC":return this.numericToResults(e);case"CATEGORICAL":return this.categoricalToResults(e);default:return[]}}},{key:"booleanToResults",value:function(e){var t=e.dataSync();return Array.from(t).map((function(e){return e>.5}))}},{key:"numericToResults",value:function(e){var t=e.dataSync();return Array.from(t)}},{key:"categoricalToResults",value:function(e){var t=e.argMax(1).dataSync(),n=Array.from(t),a="output_column",r=this.predictiveModel.outputColDef();this.legacy&&r&&null!=r.model.Name&&(a=r.model.Name);var i=this.assets.getVocabAsset(a).tokens();return n.map((function(e){return i[e]}))}},{key:"createValues",value:function(e,t){switch(e.type()){case"NUMERIC":return[this.standardize(e,t)];case"CATEGORICAL":return this.oneHotEncode(e,t);case"BOOLEAN":return this.booleanEncode(e,t);case"TEXT":return this.countTermVector(e,t);default:return[]}}},{key:"normalize",value:function(e){return null==e?this.legacy?this.zeros(1):"[UNK]":String(e||"").toLowerCase().trim()}},{key:"zeros",value:function(e){return l.default.times(e,l.default.constant(0))}},{key:"countTermVector",value:function(e,t){var n=this.normalizeName(e),a=this.assets.getVocabAsset(n).tokens(),r=this.zeros(500);return this.normalize(t).split(/[^a-z0-9]/).forEach((function(e){var t=a.indexOf(e);t<0||t>=500||r[t]++})),r}},{key:"oneHotEncode",value:function(e,t){var n=this.normalizeName(e),a=this.assets.getVocabAsset(n).tokens(),r=this.zeros(a.length),i=this.normalize(t),o=a.indexOf(i);return o>=0&&(r[o]=1),r}},{key:"booleanEncode",value:function(e,t){return this.legacy?[1*t]:null==t?[1,0,0]:t?[0,0,1]:[0,1,0]}},{key:"standardize",value:function(e,t){if(null==t)return this.zeros(1);var n=this.normalizeName(e);return this.assets.getStandardizerAsset(n).standardize(t)}},{key:"normalizeName",value:function(e){var t,n=e.name();return this.legacy?n:(null===(t=this.assets)||void 0===t?void 0:t.hasInternalColumnNames())?this.assets.getInternalColumnName(n):n.replace(/[^A-Za-z0-9_.\-/]+/gi,"_")}}]),e}();t.default=c},805491:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(496486)),l=function(){function e(t){(0,r.default)(this,e),this.model=t,this._lookup={},this.buildLookup()}return(0,i.default)(e,[{key:"buildLookup",value:function(){var e=this._lookup;this.tokens().forEach((function(t,n){e[t]=n}))}},{key:"tokenIndex",value:function(e){var t=this._lookup[e];return o.default.isNumber(t)?t:-1}},{key:"tokens",value:function(){return this.model.tokens}},{key:"columnName",value:function(){return this.model.col_name}}]),e}();t.default=l},249825:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicRolloutContainer=void 0,t.isDevBuild=l;var r=a(n(600861)),i=a(n(856690)),o=a(n(689728));function l(){return null==window.AppSheetJSVersion||window.AppSheetJSVersion.endsWith("-dev")}var u=function(){function e(){(0,i.default)(this,e),this.ownerDynamicRollouts=new Set,this.userDynamicRollouts=new Set}return(0,o.default)(e,[{key:"getStorageFormat",value:function(){return{ownerDynamicRollouts:(0,r.default)(this.ownerDynamicRollouts),userDynamicRollouts:(0,r.default)(this.userDynamicRollouts)}}},{key:"restoreFromStorage",value:function(e){var t=e.ownerDynamicRollouts,n=void 0===t?[]:t,a=e.userDynamicRollouts,r=void 0===a?[]:a;this.ownerDynamicRollouts=new Set(n),this.userDynamicRollouts=new Set(r)}},{key:"update",value:function(e){var t=this,n=e.upstreamAppSheetJSVersion,a=e.ownerDynamicRollouts,r=e.userDynamicRollouts;n===window.AppSheetJSVersion||l()?(this.ownerDynamicRollouts=new Set(a),this.userDynamicRollouts=new Set(r)):(this.ownerDynamicRollouts=new Set(a.filter((function(e){return t.ownerDynamicRollouts.has(e)}))),this.userDynamicRollouts=new Set(r.filter((function(e){return t.userDynamicRollouts.has(e)}))))}},{key:"byOwner",value:function(e){return this.ownerDynamicRollouts.has(e)}},{key:"byUser",value:function(e){return this.userDynamicRollouts.has(e)}}]),e}();t.DynamicRolloutContainer=u},169457:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ReactAppUrlHandlerInstance=t.ReactAppUrlHandler=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(280129)),l=n(398171),u=a(n(819433)),s=n(397866),c=n(287024);var d={setHash:function(e){window.location.hash=e},get prefixedHash(){return window.location.hash},get unprefixedHash(){return this.prefixedHash.substring(1)},registerHashChangeCallback:function(e){window.addEventListener("hashchange",e)}},f=function(){function e(){var t=this;(0,r.default)(this,e),this.hashInterface=d,this.lastHashSeen="",this.hashHandlers=new Map,this.onHashChange=function(){var e=t.hashInterface.unprefixedHash;e!==t.lastHashSeen&&t.applyHash(e)},this.getCurrentHashState=function(){return t.parse(t.hashInterface.unprefixedHash)}}return(0,i.default)(e,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;this.hashInterface=e,this.hashInterface.registerHashChangeCallback(this.onHashChange)}},{key:"parse",value:function(e){var t={};try{var n=o.default.parse(e);return Object.assign(Object.assign({},t),n)}catch(e){return t}}},{key:"applyHash",value:function(e){var t=(0,u.default)(),n=t.dispatch,a=t.getState;this.lastHashSeen=e;var r=this.parse(e),i=!1;this.hashHandlers.forEach((function(t,n){var o=t.beforeHashToSlice;o&&(i||(i=o(a()[n],r,e)))})),i||(!function(e){return!Object.keys(e).includes("viewStack")&&!!Object.keys(e).length}(r)?n((0,c.replaceStateForHashMiddleware)(r)):n((0,s.navigateToLegacyHash)("#".concat(e))))}},{key:"register",value:function(e,t){this.hashHandlers.set(e,t)}},{key:"unprefixedHash",get:function(){return this.hashInterface.unprefixedHash}},{key:"updateHash",value:function(e){var t={};this.hashHandlers.forEach((function(n,a){n.sliceToHash(t,e[a])}));var n=o.default.stringify(t,{encode:!1}),a=new URL("".concat(location.origin,"#").concat(n)).hash.substring(1);this.lastHashSeen=a,this.hashInterface.setHash(a)}}]),e}();t.ReactAppUrlHandler=f;var p=new f;t.ReactAppUrlHandlerInstance=p;var h=function(e){return function(t){return function(n){t(n);var a=e.getState();(0,l.getAppModelLastUpdated)(a)&&p.updateHash(e.getState())}}};t.default=h},287024:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceStateForHashMiddleware=void 0;var a=(0,n(829829).createAction)("replaceStateForHashMiddleware");t.replaceStateForHashMiddleware=a},613834:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(829829),r=n(287024),i=function(e,t){var i=e.initialState;return n(169457).ReactAppUrlHandlerInstance.register(e.name,t),(0,a.createSlice)({name:e.name,initialState:i,reducers:e.reducers,extraReducers:function(n){n.addCase(r.replaceStateForHashMiddleware,(function(e,n){t.hashToSlice(e,n.payload)})),e.extraReducers instanceof Function&&e.extraReducers(n)}})};t.default=i},907673:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Proxy(e,g)};var r=a(n(23279)),i=n(351101),o=n(398171),l=n(994885),u=n(449456),s=a(n(819433)),c=n(95483),d=n(692479),f=n(166089),p=n(557310),h=n(21870),v=n(289276),m=(0,r.default)((function(e){return(0,s.default)().dispatch((0,o.setDataLastUpdated)(e))}),200),g={get:function(e,t){var n,a,r,m,g,y;if(!0===window.APPSHEET_TEST_CONTEXT&&!p.ReactRootUIConfig.isReactRoot())return e[t];switch(t){case"dataStamp":return(0,o.getDataModelLastUpdated)((0,s.default)().getState());case"sideMenuOpen":return(0,l.getSideMenuOpen)((0,s.default)().getState());case"hashState":var b=(0,c.getTopStack)((0,s.default)().getState()).identifier;return{general:{ControlName:"Control"===b.Type?b.Name:void 0}};case"isWideScreen":return(null===(n=null===document||void 0===document?void 0:document.body)||void 0===n?void 0:n.clientWidth)>768;case"setAppTemplate":return function(){};case"headerHeight":case"drawerOpenWidth":case"drawerCloseWidth":return 0;case"widescreenBreakpoint":return 768;case"windowWidth":return null!==(r=null===(a=null===document||void 0===document?void 0:document.body)||void 0===a?void 0:a.clientWidth)&&void 0!==r?r:0;case"windowHeight":return null!==(g=null===(m=null===document||void 0===document?void 0:document.body)||void 0===m?void 0:m.clientHeight)&&void 0!==g?g:0;case"footerEntries":var T=(0,o.getAppModelHook)((0,s.default)().getState()),S=(null===(y=null==T?void 0:T.appTemplate)||void 0===y?void 0:y.viewControls())||[],A=function(e){return f.AppGlobals.AppModel.POSITIONS_ORDERED.indexOf(e)};return S.filter((function(e){return e.IsValid&&e.Position!==f.AppGlobals.AppModel.POSITION_MENU&&e.Position!==f.AppGlobals.AppModel.POSITION_REF})).sort((function(e,t){return A(e.Position)-A(t.Position)}));case"syncQueueCount":return(0,i.getAppModel)().NumDelayedActions()+(0,i.getAppModel)().NumProcessingActions();case"syncState":return{get initiatedBy(){return(0,o.getSyncInitiatedBy)((0,s.default)().getState())},get ui(){return(0,o.getSyncUI)((0,s.default)().getState())},get visibility(){var e,t=null!==(e=(0,o.getSyncUI)((0,s.default)().getState()))&&void 0!==e?e:h.SyncUI.Hidden;return h.SyncUI[t]},get notification(){var e;return null!==(e=(0,o.getSyncNotification)((0,s.default)().getState()))&&void 0!==e?e:void 0},get error(){var e;return null!==(e=(0,o.getSyncErrorMessage)((0,s.default)().getState()))&&void 0!==e?e:void 0},set error(e){(0,s.default)().dispatch((0,o.setSyncErrorMessage)(null!=e?e:null))}};case"syncProgressHandle":return(0,v.getReactAppSyncProgressHandle)();case"setCachingProgress":return function(e){return(0,s.default)().dispatch((0,u.setOfflineCacheProgress)(e))};case"totalFilesToCache":return(0,u.getCacheProgress)((0,s.default)().getState()).totalFilesToCache;case"filesCached":return(0,u.getCacheProgress)((0,s.default)().getState()).filesCached;case"filesWithError":return(0,u.getCacheProgress)((0,s.default)().getState()).filesWithError;case"showResetDash":return!1;case"navigateToPreviousHashState":return function(){(0,s.default)().dispatch((0,d.popView)())}}return e[t]},set:function(e,t,n){if(!0===window.APPSHEET_TEST_CONTEXT&&!p.ReactRootUIConfig.isReactRoot())return e[t]=n,!0;switch(t){case"dataStamp":return m(n),!0;case"sideMenuOpen":return(0,s.default)().dispatch((0,l.setSideMenuOpen)(n)),!0;case"headerHeight":return!0}return e[t]=n,!0}}},783252:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SPECIFIC_STATE_NAME_MAP=void 0;t.SPECIFIC_STATE_NAME_MAP={card:"ListUIState",table:"FastTableUIState",fastTable:"FastTableUIState",dashboard:"DashboardUIState",search:"SearchUIState",deck:"DeckUIState",gallery:"GalleryUIState",slideshow:"SlideshowUIState",detail:"SlideshowUIState",map:"MapUIState","google-map":"MapUIState",chart:"GraphUIState",graph:"GraphUIState",form:"FormUIState",onboarding:"OnboardingUIState",calendar:"CalendarUIState"}},673275:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.generateFilterExpressions=v,t.getCurrentUIState=void 0,t.getUIStateByKey=function(e){var t=(0,c.default)().getState(),n=(0,u.getViewStack)(t),a=y(t),r=(0,u.getSearchTerm)(t),i=(0,u.getGlobalUserDefinedFilters)(t);return m(e?(0,h.findViewStackEntry)(n,e):a,r,i)};var r=a(n(579500)),i=a(n(496486)),o=n(829829),l=n(173399),u=n(95483),s=n(398171),c=a(n(819433)),d=n(783252),f=n(319598),p=a(n(888861)),h=n(29827);function v(e){var t,n=[],a=(0,f.getFilterQuery)(e.Root,e.TableName||void 0,e.UserDefinedFilters).toExpression();n.push(a);try{if(null==e?void 0:e.filterExprString){var r=JSON.parse(e.filterExprString);n.push(p.default.create(r))}}catch(e){}return null!==(t=p.default.createAnd.apply(p.default,n))&&void 0!==t?t:void 0}function m(e,t,n){var a,o,u=(0,l.mapViewStackToControl)(e),s=u.control,c=u.navState,f=u.action,p=f?d.SPECIFIC_STATE_NAME_MAP[f]:null,h=p?(a={},(o={})[p]=o[p]||{},o[p].get=function(){var e=i.default.cloneDeep(null!=c?c:{});return e.UserDefinedFilters=n,e.Root=f,null!=c&&(e.FilterExpr=v(c)),e},(0,r.default)(a,o),a):void 0;return Object.assign({Root:f,ControlName:null==s?void 0:s.Name,SearchTerm:t},h)}var g,y=function(e){var t,n=(0,u.getViewStackGroups)(e),a=n.focusedViewGroup;return null!==(t=n.formViews[0])&&void 0!==t?t:a[a.length-1]};function b(){return(0,o.createSelector)([y,u.getSearchTerm,u.getGlobalUserDefinedFilters,s.getAppModelLastUpdated],m)}t.getCurrentUIState=function(){return g||(g=b()),g.apply(void 0,arguments)}},95483:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.getViewStackGroups=t.getViewStack=t.getTopStack=t.getSyncRequestDataStamp=t.getSearchTerm=t.getIsInExpandMode=t.getGlobalUserDefinedFilters=t.getFocusedViewGroup=t.getFocusedView=t.breakViewStackIntoGroups=t.STACKABLE_VIEW_TYPES=t.FULLSCREEN_VIEW_TYPES=void 0;var r=a(n(496486)),i=n(829829),o=n(166089),l=n(557310);function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var c=["slideshow","detail","form","onboarding"];t.STACKABLE_VIEW_TYPES=c;var d=["map","dashboard"];function f(e,t){var n=t.identifier;return"Control"===n.Type?e.FindControl(n.Name):void 0}function p(e,t){var n,a=t.identifier;return"Control"===a.Type?null===(n=f(e,t))||void 0===n?void 0:n.Action:a.Action}t.FULLSCREEN_VIEW_TYPES=d;var h=function(e){return e.uiState.viewStack};t.getViewStack=h;var v=function(e){return e.uiState.focusedView};t.getFocusedView=v;var m=function(e){return e.uiState.isInExpandMode};t.getIsInExpandMode=m;t.getSyncRequestDataStamp=function(e){return e.uiState.syncRequestDataStamp};var g=function(e,t,n,a){var i,o,l;if(!e)return{parentViewGroups:[],focusedViewGroup:[],formViews:[]};var s=r.default.findLastIndex(t,(function(e){return!!e.parentEntriesHidden}));s>0&&(t=t.slice(s));var h=t.findIndex((function(t,n){return"form"===p(e,t)&&0!==n})),v=t,m=[];-1!==h&&(v=t.slice(0,h),m=t.slice(h));var g,y=[],b=[y],T=u(v);try{for(T.s();!(g=T.n()).done;){var S=g.value,A=p(e,S),E=n||d.includes(p(e,S))||"Full screen"===(null===(o=null===(i=f(e,S))||void 0===i?void 0:i.ViewDefinition)||void 0===o?void 0:o.DesktopSplitMode),w=!E&&!c.includes(A);E?(b.push([S]),y=[],b.push(y)):w&&y.length?(y=[S],b.push(y)):y.push(S)}}catch(e){T.e(e)}finally{T.f()}var C=(b=b.filter((function(e){return e.length}))).findIndex((function(e){return e.some((function(e){return e.viewStateKey===a}))}));return-1===C&&(C=b.length-1),{parentViewGroups:b.slice(0,C),focusedViewGroup:null!==(l=b[C])&&void 0!==l?l:[],formViews:m}};t.breakViewStackIntoGroups=g;var y=(0,i.createSelector)([function(){return o.AppGlobals.AppModel},h,m,v],g);t.getViewStackGroups=y;var b=(0,i.createSelector)([y],(function(e){return e.focusedViewGroup}));t.getFocusedViewGroup=b;t.getTopStack=function(e){if(!l.ReactRootUIConfig.isInDesktopExperience())return e.uiState.viewStack[e.uiState.viewStack.length-1];var t=y(e).focusedViewGroup;return t[t.length-1]};t.getSearchTerm=function(e){return e.searchState.searchTerm};t.getGlobalUserDefinedFilters=function(e){return e.searchState.userDefinedFilters}},29827:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createViewStateSelector=function(e,t){return function(n){var a=(0,l.getViewStack)(n),r=u(a,e),i=a[r];return t(i,r,n)}},t.findViewStackEntry=function(e,t){return e[u(e,t)]},t.findViewStackIndex=u,t.getControlName=function(e){var t=e.identifier;return"Control"===t.Type?t.Name:null},t.getInSelectionMode=void 0,t.getMutableState=s,t.getSelectedRowIds=t.getPendingTransaction=void 0,t.getTableName=function(e){var t,n=(0,r.getAppModel)(),a=e.identifier;if("View"===a.Type)return a.TableName;var i=null==n?void 0:n.FindControl(a.Name);return null!==(t=null==i?void 0:i.TableOrFolderName)&&void 0!==t?t:void 0},t.getViewInPendingTransactionById=t.getViewInPendingTransaction=t.getViewInEditMode=void 0,t.getViewLabel=function(e,t){var n,a,r,o,l,u,s=e.identifier;if("View"===s.Type)return s.TableName;var c=null!==(n=s.Name.replace(/_/g," "))&&void 0!==n?n:"View";if(!t)return c;var d=t.FindControl(s.Name);if(!d)return c;var f=t.appTemplate.getView(d.Name);if(!f)return c;var p=t.dataManager.getTransaction(null===(a=e.mutableState)||void 0===a?void 0:a.transactionId),h=f.table(),v=t.findTableCollection(h),m=v.rootTable,g=v.rootTableSchema,y=null!==(o=null===(r=e.mutableState)||void 0===r?void 0:r.RowKey)&&void 0!==o?o:null===(l=e.mutableState)||void 0===l?void 0:l.row;if(f.hasDisplayName()){var b=y?null===(u=null==m?void 0:m.lookupTableRow(y,p))||void 0===u?void 0:u.values:void 0;return f.displayName(t,g,b,{viewStateKey:e.viewStateKey})}var T=f.name().replace(/_/g," ")||c;if(!h)return T;if(!m||!g||!y)return T;var S=m.labelTextForId(y,p);if(!S)return T;var A=g.labelBasicAttribute();if("Enum"===(null==A?void 0:A.type())||"EnumList"===(null==A?void 0:A.type())){return(0,i.getLabelValueFromRefRow)({attribute:A,value:S})}return S},t.getViewStackIndex=void 0,t.getViewType=d,t.isBehindFormOverlay=void 0;var a=n(496486),r=n(351101),i=n(178314),o=n(398171),l=n(95483);function u(e,t){var n=e.findIndex((function(e){return e.viewStateKey===t}));if(-1===n){var a=e.map((function(e){return e.viewStateKey})).join(", ");throw new Error('failed to find viewStack entry with key "'.concat(t,'", the view stack has the following keys: ').concat(a))}return n}function s(e){var t;return null!==(t=e.mutableState)&&void 0!==t?t:{}}t.getViewStackIndex=function(e,t){return t};var c=function(e){return s(e).selected};t.getSelectedRowIds=c;function d(e){var t,n=(0,r.getAppModel)(),a=e.identifier;if("View"===a.Type)return a.Action;var i=null==n?void 0:n.FindControl(a.Name);return null!==(t=null==i?void 0:i.Action)&&void 0!==t?t:void 0}t.getInSelectionMode=function(){return Array.isArray(c.apply(void 0,arguments))};t.getPendingTransaction=function(e,t,n){var a=(0,o.getAppModelHook)(n);return null==a?void 0:a.dataManager.getTransaction(s(e).transactionId)};t.getViewInEditMode=function(e){return e.uiState.viewStack.find((function(e){return!!e.mutableState.isInEditMode}))};t.getViewInPendingTransaction=function(e){return e.uiState.viewStack.find((function(e){return null!=e.mutableState.transactionId}))};t.getViewInPendingTransactionById=function(e,t){return t.uiState.viewStack.find((function(t){return t.mutableState.transactionId===e}))};t.isBehindFormOverlay=function(e,t,n){return(0,a.some)(n.uiState.viewStack,(function(e,n){return n>t&&"form"===d(e)}))}},398171:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.setTotalActions=t.setSyncTotalActions=t.setSyncProgressPercentage=t.setSyncProgress=t.setSyncErrorMessage=t.setNonRecoverableErrorMsg=t.setIsOnline=t.setDataLastUpdated=t.onSyncStart=t.onSyncError=t.onSyncComplete=t.getSyncUI=t.getSyncTotalActions=t.getSyncStatusText=t.getSyncSeverity=t.getSyncProgressPercentage=t.getSyncNotification=t.getSyncInitiatedBy=t.getSyncIcon=t.getSyncErrorMessage=t.getNonRecoverableErrorMsg=t.getIsOnline=t.getIsLiveAppSynced=t.getIsLiveApp=t.getInSync=t.getDataModelLastUpdated=t.getAppModelLastUpdated=t.getAppModelHook=t.default=t.appModelStateSlice=void 0;var r=n(829829),i=n(351101),o=n(692479),l=a(n(571524)),u=n(629503),s=n(21870),c=a(n(819433)),d={nonRecoverableErrorMsg:null,appLastUpdated:null,dataLastUpdated:null,syncProgressPercentage:null,syncProgress:null,syncErrorMessage:null,syncInitiatedBy:null,syncNotification:null,syncUI:null,isOnline:!0,isLiveApp:!1,isLiveAppSynced:!1,syncTotalActions:0},f=(0,r.createSlice)({name:"appModelState",initialState:d,reducers:{setIsOnline:function(e,t){e.isOnline=t.payload},setTotalActions:function(e,t){e.syncTotalActions=t.payload},setDataLastUpdated:function(e,t){e.dataLastUpdated=t.payload},setNonRecoverableErrorMsg:function(e,t){e.nonRecoverableErrorMsg=t.payload},setSyncProgressPercentage:function(e,t){e.syncProgressPercentage=t.payload},setSyncProgress:function(e,t){e.syncProgress=t.payload},setSyncTotalActions:function(e,t){e.syncTotalActions=t.payload},setSyncErrorMessage:function(e,t){e.syncErrorMessage=t.payload},onSyncStart:function(e,t){var n,a;e.syncProgressPercentage=0,e.syncInitiatedBy=t.payload.initiatedBy,e.syncUI=null!==(n=t.payload.preferredUI)&&void 0!==n?n:s.SyncUI.Subtle,e.syncNotification=null!==(a=t.payload.notification)&&void 0!==a?a:null},onSyncComplete:function(e){e.syncProgressPercentage=null,e.syncErrorMessage=null,e.syncInitiatedBy=null,e.syncUI=null,e.syncNotification=null},onSyncError:function(e,t){e.syncProgressPercentage=null,e.syncErrorMessage=t.payload,e.syncInitiatedBy=null,e.syncUI=null,e.syncNotification=null}},extraReducers:function(e){e.addCase(o.appModelUpdated,(function(e,t){var n,a=(0,i.getAppModel)().appTemplateModel;e.appLastUpdated=Date.now(),document.title=a.ShortName||"",$(".DeepHeader .AppInfo .AppName").text(a.Title||""),$(".DeepHeader .AppInfo .AppVersion").text(a.Version||""),$("#AppDetails").attr("href",(null===(n=a.Behavior.Description)||void 0===n?void 0:n.AboutUrl)||""),l.default.IsAndroidBrowser()||l.default.InAndroidWebView()||($('link[rel="shortcut icon"]').attr("href",u.Common.FlexImageUrl(a.Presentation.LogoUrl)||""),$('link[rel="icon"]').attr("href",u.Common.FlexImageUrl(a.Presentation.LogoUrl)||""))})).addCase(o.appModelUnloaded,(function(){return Object.assign({},d)}))}});t.appModelStateSlice=f;var p=f.actions,h=p.setNonRecoverableErrorMsg,v=p.setDataLastUpdated,m=p.setSyncProgressPercentage,g=p.setSyncProgress,y=p.onSyncStart,b=p.onSyncComplete,T=p.onSyncError,S=p.setIsOnline,A=p.setTotalActions,E=p.setSyncTotalActions,w=p.setSyncErrorMessage;t.setSyncErrorMessage=w,t.setSyncTotalActions=E,t.setTotalActions=A,t.setIsOnline=S,t.onSyncError=T,t.onSyncComplete=b,t.onSyncStart=y,t.setSyncProgress=g,t.setSyncProgressPercentage=m,t.setDataLastUpdated=v,t.setNonRecoverableErrorMsg=h;t.getAppModelHook=function(e){return e.appModel.appLastUpdated?(0,i.getAppModel)():null};t.getAppModelLastUpdated=function(e){return e.appModel.appLastUpdated};t.getDataModelLastUpdated=function(e){return e.appModel.dataLastUpdated};t.getNonRecoverableErrorMsg=function(e){return e.appModel.nonRecoverableErrorMsg};t.getSyncProgressPercentage=function(e){return e.appModel.syncProgressPercentage};t.getSyncErrorMessage=function(e){return e.appModel.syncErrorMessage};t.getSyncInitiatedBy=function(e){return e.appModel.syncInitiatedBy};t.getSyncNotification=function(e){return e.appModel.syncNotification};t.getSyncUI=function(e){return e.appModel.syncUI};t.getInSync=function(e){return null!=e.appModel.syncProgressPercentage};t.getIsOnline=function(e){return e.appModel.isOnline};t.getIsLiveApp=function(e){return e.appModel.isLiveApp};t.getIsLiveAppSynced=function(e){return e.appModel.isLiveAppSynced};t.getSyncTotalActions=function(e){return e.appModel.syncTotalActions};t.getSyncSeverity=function(e){return e.appModel.isOnline?e.appModel.syncErrorMessage?"Error":e.appModel.syncTotalActions?"Warning":"Info":"Offline"};t.getSyncStatusText=function(){var e,t=(0,c.default)().getState().appModel;return t.isOnline?null!=t.syncProgressPercentage?"Syncing":(null===(e=(0,i.getAppModel)())||void 0===e?void 0:e.lastSyncedWithin(3e3))?"SyncedRecently":"":"Offline"};t.getSyncIcon=function(e){return e.appModel.isOnline?e.appModel.syncErrorMessage?"Error":e.appModel.isLiveAppSynced?"LiveAppSynced":e.appModel.isLiveApp?"LiveAppNotSynced":"":"Offline"};var C=f.reducer;t.default=C},695882:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.updateCurrentAppForAppLoadThunk=t.pushCurrentAppForAppLoadThunk=t.popCurrentAppForAppLoadThunk=t.getPreviousAppHook=t.getInvokingAppsHook=t.getCurrentAppHook=t.default=t.appStackSlice=void 0;var r=a(n(593186)),i=a(n(613834)),o=n(369332),l=a(n(819433)),u=n(166089),s=(0,i.default)({name:"appStackState",initialState:{appStack:[{Id:"c37bc8a4-6b53-4e71-812c-2348072cbf2e",Name:"AppGallery-10305",DisplayName:"App Gallery"}]},reducers:{pushCurrentAppForAppLoadThunk:function(e,t){e.appStack.push(t.payload)},popCurrentAppForAppLoadThunk:function(e){e.appStack.length>1&&e.appStack.pop()},updateCurrentAppForAppLoadThunk:function(e,t){e.appStack.length>0?e.appStack[e.appStack.length-1]=t.payload:(e.appStack.push(t.payload),r.default.warnToDevConsole("appStack empty when attempting to update CurrentApp in appStackStateSlice"))}}},{hashToSlice:function(){},sliceToHash:function(e,t){e.appName=t.appStack[t.appStack.length-1].Name},beforeHashToSlice:function(e,t,n){var a=e.appStack,r=a[a.length-1];return!(u.AppGlobals.IsInAppsheetTestContext||!(null==r?void 0:r.Name)||!t.appName||(null==r?void 0:r.Name)===t.appName)&&((0,l.default)().dispatch((0,o.reactAppLoadAppAction)({appName:t.appName,unprefixedHash:n})),!0)}});t.appStackSlice=s;var c=s.actions,d=c.pushCurrentAppForAppLoadThunk,f=c.popCurrentAppForAppLoadThunk,p=c.updateCurrentAppForAppLoadThunk;t.updateCurrentAppForAppLoadThunk=p,t.popCurrentAppForAppLoadThunk=f,t.pushCurrentAppForAppLoadThunk=d;t.getCurrentAppHook=function(e){var t;return null!==(t=e.appStackState.appStack[e.appStackState.appStack.length-1])&&void 0!==t?t:null};t.getPreviousAppHook=function(e){var t;return null!==(t=e.appStackState.appStack[e.appStackState.appStack.length-2])&&void 0!==t?t:null};t.getInvokingAppsHook=function(e){var t=e.appStackState.appStack.slice(0,e.appStackState.appStack.length-1);return t.length>0?t:e.appStackState.appStack.slice(0)};var h=s.reducer;t.default=h},250617:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelEditMode=void 0,t.checkForUnsavedChanges=c,t.startEditMode=t.setPendingTransaction=t.saveAndCloseEditMode=t.mutateViewInEditMode=void 0;var r=a(n(364687)),i=n(166089),o=n(980574),l=n(515128),u=n(692479),s=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))};t.saveAndCloseEditMode=function(e){return function(t){return s(void 0,void 0,void 0,r.default.mark((function n(){return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,i.AppGlobals.AppModel.dataManager.currentTransaction.commitAsync();case 3:return t((0,u.mutateView)({ViewState:{isInEditMode:!1,transactionId:void 0},ViewStateKey:e})),n.abrupt("return",!0);case 7:return n.prev=7,n.t0=n.catch(0),t((0,o.showFailedToSave)((0,l.asError)(n.t0).message)),n.abrupt("return",!1);case 11:case"end":return n.stop()}}),n,null,[[0,7]])})))}};t.cancelEditMode=function(e){return function(t){i.AppGlobals.AppModel.dataManager.abortCurrentTransaction(),t((0,u.mutateView)({ViewState:{isInEditMode:!1,transactionId:void 0},ViewStateKey:e}))}};function c(e){var t=function(){var t=n(397930),a=t.checkForUnsavedChangesThunk,r=e.apply(void 0,arguments),i=a(r);return i.onConfirmAction=r,i};return t.onConfirm=e,t}t.setPendingTransaction=function(e,t){return(0,u.mutateView)({ViewState:{transactionId:t},ViewStateKey:e})};var d=function(e){return function(t){var n=i.AppGlobals.AppModel.dataManager.currentTransaction;n.startGroup({viewStateKey:e}),t((0,u.mutateView)({ViewStateKey:e,ViewState:{isInEditMode:!0,transactionId:n.id}}))}};t.mutateViewInEditMode=d;var f=c(d);t.startEditMode=f},835288:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.EditorEmulatorId=void 0;var a,r=n(673275),i=n(783252);t.EditorEmulatorId=a,function(e){e.TableName="EmulatorTableName",e.ViewName="EmulatorViewName"}(a||(t.EditorEmulatorId=a={}));var o=function(e){return function(t){return function(n){t(n);var o=(0,r.getCurrentUIState)(e.getState()),l=window.parent.document.getElementById(a.ViewName),u=window.parent.document.getElementById(a.TableName);if(l&&(l.textContent=(null==o?void 0:o.ControlName)||(null==o?void 0:o.Root)||""),u){var s=o.Root||"",c=o[i.SPECIFIC_STATE_NAME_MAP[s]];u.textContent=(null==c?void 0:c.TableName)||""}}}};t.default=o},994885:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSideMenuOpen=t.setAboutPageOpen=t.getSideMenuOpen=t.getAboutPageOpen=t.default=t.ReactAppLayoutChromeStateSlice=void 0;var a=(0,n(829829).createSlice)({name:"layoutChromeState",initialState:{isSideMenuOpen:!1,isAboutPageOpen:!1},reducers:{setSideMenuOpen:function(e,t){e.isSideMenuOpen=t.payload},setAboutPageOpen:function(e,t){e.isAboutPageOpen=t.payload}}});t.ReactAppLayoutChromeStateSlice=a;var r=a.actions,i=r.setSideMenuOpen,o=r.setAboutPageOpen;t.setAboutPageOpen=o,t.setSideMenuOpen=i;t.getSideMenuOpen=function(e){return e.layoutChromeState.isSideMenuOpen};t.getAboutPageOpen=function(e){return e.layoutChromeState.isAboutPageOpen};var l=a.reducer;t.default=l},369332:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.reactAppLoadInvokingAppAction=t.reactAppLoadAppAction=t.chooseStartControl=void 0;var r=a(n(364687)),i=n(695882),o=n(692479),l=a(n(593186)),u=n(166089),s=n(398171),c=a(n(351101)),d=n(469534),f=a(n(956073)),p=n(717696),h=n(250617),v=n(173399),m=n(629503),g=n(169457),y=n(737351),b=n(263198),T=n(386350),S=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},A=function(){var e,t=u.AppGlobals.AppModel,n=t.appTemplateModel.Presentation.Controls,a=t.appTemplateModel.Presentation.DefaultStartView,r=t.appTemplateModel.Presentation.ExprLookup;(null==r?void 0:r.StartView)&&(a=t.RunExpression(r.StartView));var i=[t.POSITION_FAR_LEFT,t.POSITION_LEFT,t.POSITION_RIGHT,t.POSITION_FAR_RIGHT,t.POSITION_CENTER,t.POSITION_MENU],o=n.filter((function(e){return e.IsValid&&i.includes(e.Position)})).sort((function(e,t){return i.indexOf(e.Position)-i.indexOf(t.Position)}));return a||(null===(e=o[0])||void 0===e?void 0:e.Name)};t.chooseStartControl=A;var E=function(e,t){return S(void 0,void 0,void 0,r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c.default.reset(),n=new Promise((function(e,t){u.AppGlobals.AppModel.Initialize(void 0,e,t)})),t.next=4,n.then((function(t){if(!t.IsRunnable)throw"The ".concat(t.ShortName," app is in an invalid state. Please contact the app creator.");(0,y.installOrUpdateServiceWorker)(),b.JeeneeBrowserAPI.setCurrentApp(t),(0,p.recordAppStartMetrics)(),m.Common.InitializingApp=!0,u.AppGlobals.AppModel.OnAppTemplateLoad(t),b.JeeneeBrowserAPI.OnAppTemplateLoad(t),m.Common.InitializingApp=!1,e((0,v.updateAppStartControl)(A())),e((0,i.updateCurrentAppForAppLoadThunk)({Name:u.AppGlobals.AppModel.AppTemplate.Name,Id:u.AppGlobals.AppModel.AppTemplate.Id,Version:u.AppGlobals.AppModel.AppTemplate.Version,DisplayName:u.AppGlobals.AppModel.AppTemplate.ShortName})),(0,f.default)(t),(0,d.maybeSubscribeToPunctual)(t),(0,T.sendEditorMessage)("app-initialized",{appId:t.Id})})).catch((function(t){l.default.warnToDevConsole("Error loading app,",t),e((0,s.setNonRecoverableErrorMsg)(t))}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))},w=(0,h.checkForUnsavedChanges)((function(){return function(e,t){return S(void 0,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e((0,o.appModelUnloaded)()),e((0,i.popCurrentAppForAppLoadThunk)()),t.next=4,E(e);case 4:e((0,o.appModelUpdated)());case 5:case"end":return t.stop()}}),t)})))}}));t.reactAppLoadInvokingAppAction=w;var C=(0,h.checkForUnsavedChanges)((function(e){var t=e.appName,n=e.appId,a=e.appVersion,l=e.unprefixedHash;return function(e,u){return S(void 0,void 0,void 0,r.default.mark((function u(){return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e((0,o.appModelUnloaded)()),r.next=3,e((0,i.pushCurrentAppForAppLoadThunk)({Id:n,Name:t,Version:a}));case 3:return r.next=5,E(e);case 5:l&&g.ReactAppUrlHandlerInstance.applyHash(l),e((0,o.appModelUpdated)());case 7:case"end":return r.stop()}}),u)})))}}));t.reactAppLoadAppAction=C},334304:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(649431),r=n(318926),i=function(){return function(e){return function(t){e(t),r.logger.logEvent(new a.ReduxActionEvent(t.type))}}};t.default=i},980574:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFailedToSave=t.reactAppModalCallbackAction=t.confirmDiscard=void 0;var a=n(351101),r=n(362556);t.reactAppModalCallbackAction=function(e,t){return function(n,a){null==e||e(),t&&n((0,r.closeMessageModal)())}};t.confirmDiscard=function(e){return(0,r.openMessageModal)({title:(0,a.mapActionName)("Discard changes?"),message:(0,a.mapActionName)("Any edits will be lost"),buttons:[{name:(0,a.mapActionName)("Continue editing"),dismiss:!0},{name:(0,a.mapActionName)("Discard"),callback:e,dismiss:!0}]})};t.showFailedToSave=function(e){return(0,r.openMessageModal)({title:(0,a.mapActionName)("Unable to save changes"),message:e,buttons:[{name:(0,a.mapActionName)("OK"),dismiss:!0}]})}},362556:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFormModalError=t.setMessageModalIsProcessing=t.openMessageModal=t.openFormModal=t.getModalState=t.default=t.closeMessageModal=t.closeFormModal=t.ReactAppModalSlice=void 0;var a=(0,n(829829).createSlice)({name:"modal",initialState:{},reducers:{openMessageModal:function(e,t){e.messageModal=t.payload},setMessageModalIsProcessing:function(e,t){e.messageModal&&(e.messageModal.processing=t.payload)},closeMessageModal:function(e){return Object.assign(Object.assign({},e),{messageModal:void 0})},openFormModal:function(e,t){e.formModal=t.payload},showFormModalError:function(e,t){e.formModal&&(e.formModal.errorMessage=t.payload)},closeFormModal:function(e){return Object.assign(Object.assign({},e),{formModal:void 0})}}});t.ReactAppModalSlice=a;var r=a.actions,i=r.openMessageModal,o=r.setMessageModalIsProcessing,l=r.closeMessageModal,u=r.openFormModal,s=r.showFormModalError,c=r.closeFormModal;t.closeFormModal=c,t.showFormModalError=s,t.openFormModal=u,t.closeMessageModal=l,t.setMessageModalIsProcessing=o,t.openMessageModal=i;t.getModalState=function(e){return e.modal};var d=a.reducer;t.default=d},449456:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setOfflineCacheProgress=t.offlineCacheProgressSlice=t.getCacheProgress=t.default=void 0;var a=n(829829),r=n(692479),i={totalFilesRequested:null,totalFilesToCache:null,filesCached:null,filesWithError:null},o=(0,a.createSlice)({name:"offlineCacheProgress",initialState:i,reducers:{setOfflineCacheProgress:function(e,t){Object.assign(e,t.payload)}},extraReducers:function(e){e.addCase(r.appModelUnloaded,(function(e){return Object.assign(e,i)}))}});t.offlineCacheProgressSlice=o;var l=o.actions.setOfflineCacheProgress;t.setOfflineCacheProgress=l;t.getCacheProgress=function(e){return e.offlineCacheProgress};var u=o.reducer;t.default=u},966488:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.setUserDefinedFilters=t.setSearchTerm=t.searchStateSlice=t.default=void 0;var r=n(692479),i=n(351101),o=a(n(613834));function l(e,t){"newViewStack"===t.type&&(e.searchTerm="",e.tableNameToFilterOn=null);var n=t.payload.Identifier;if("Control"===n.Type){var a=(0,i.getAppModel)().FindControl(n.Name);(null==a?void 0:a.TableOrFolderName)!==e.tableNameToFilterOn&&(e.userDefinedFilters=[],e.tableNameToFilterOn=null,e.searchTerm=null)}}var u={searchTerm:null,userDefinedFilters:[],tableNameToFilterOn:null},s=(0,o.default)({name:"searchState",initialState:u,reducers:{setSearchTerm:function(e,t){e.searchTerm=t.payload.searchTerm,e.tableNameToFilterOn=t.payload.tableNameToFilterOn||null},setUserDefinedFilters:function(e,t){e.userDefinedFilters=t.payload.userDefinedFilters,e.tableNameToFilterOn=t.payload.tableNameToFilterOn}},extraReducers:function(e){e.addCase(r.pushView.onConfirm,l).addCase(r.newViewStack.onConfirm,l).addCase(r.appModelUnloaded,(function(){return Object.assign({},u)}))}},{hashToSlice:function(e,t){e.searchTerm=t.searchTerm||null,e.tableNameToFilterOn=t.tableNameToFilterOn||null,e.userDefinedFilters=t.userDefinedFilters||[]},sliceToHash:function(e,t){var n;t.searchTerm&&(e.searchTerm=t.searchTerm),t.tableNameToFilterOn&&(e.tableNameToFilterOn=t.tableNameToFilterOn),(null===(n=t.userDefinedFilters)||void 0===n?void 0:n.length)>0&&(e.userDefinedFilters=t.userDefinedFilters)}});t.searchStateSlice=s;var c=s.actions,d=c.setSearchTerm,f=c.setUserDefinedFilters;t.setUserDefinedFilters=f,t.setSearchTerm=d;var p=s.reducer;t.default=p},692479:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceView=t.pushView=t.popView=t.newViewStack=t.mutateView=t.isViewIdentifierEqual=t.focusView=t.appModelUpdated=t.appModelUnloaded=void 0;var a=n(829829),r=n(250617),i=(0,a.createAction)("appModelUpdated");t.appModelUpdated=i;var o=(0,a.createAction)("appModelUnloaded");t.appModelUnloaded=o;t.isViewIdentifierEqual=function(e,t){return"Control"===e.Type&&"Control"===t.Type?e.Name===t.Name:"View"===e.Type&&"View"===t.Type&&(e.Action===t.Action&&e.TableName===t.TableName)};var l=(0,r.checkForUnsavedChanges)((0,a.createAction)("popView"));t.popView=l;var u=(0,r.checkForUnsavedChanges)((0,a.createAction)("pushView"));t.pushView=u;var s=(0,r.checkForUnsavedChanges)((0,a.createAction)("newViewStack"));t.newViewStack=s;var c=(0,a.createAction)("replaceView");t.replaceView=c;var d=(0,a.createAction)("mutateView");t.mutateView=d;var f=(0,a.createAction)("focusView");t.focusView=f},819433:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.setStoreForTesting=t.generateStore=t.default=void 0;var r=n(829829),i=a(n(398171)),o=a(n(695882)),l=a(n(173399)),u=a(n(315437)),s=a(n(966488)),c=a(n(169457)),d=a(n(835288)),f=a(n(449456)),p=a(n(571524)),h=a(n(994885)),v=n(557310),m=a(n(362556)),g=n(166089),y=a(n(593186)),b=a(n(334304)),T=function(e,t){var n=e.preloadedState;return(0,r.configureStore)({reducer:{appModel:i.default,userInformation:u.default,uiState:l.default,appStackState:o.default,searchState:s.default,offlineCacheProgress:f.default,layoutChromeState:h.default,modal:m.default},middleware:function(e){return e({serializableCheck:{ignoredActions:["modal/openMessageModal"],ignoredPaths:["modal.config.buttons"]}}).concat(null!=t?t:[])},preloadedState:n})};t.generateStore=T;var S=null;t.setStoreForTesting=function(e){S=e};var A=function(){if(S)return S;if(!v.ReactRootUIConfig.isReactRoot())return y.default.ReportErrorOnce({errorMessage:"Attempted access redux store in non-reactroot."}),null;var e=[];return p.default.IsEditorIFramePreview()?e.push(d.default):g.AppGlobals.IsInAppsheetTestContext?e.push(c.default):e.push(c.default,b.default),S=T({},e)};t.default=A},289276:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.reactAppSyncAction=t.reactAppDiscardUnsyncedChangesAction=t.getReactAppSyncProgressHandle=void 0;var r=a(n(364687)),i=a(n(496486)),o=n(166089),l=a(n(455127)),u=n(398171),s=n(250617),c=n(692479),d=a(n(819433)),f=n(44617),p=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,d.default)().dispatch;return new l.default({onProgress:function(t){t.percentDone&&e((0,u.setSyncProgressPercentage)(t.percentDone))},onStart:function(t){var n=i.default.omit(t,["progressHandle"]);e((0,u.onSyncStart)(n))},onFinish:function(){e((0,u.onSyncComplete)()),e(c.appModelUpdated)},onWarning:function(e){},onError:function(t){e((0,u.onSyncError)(t)),e((0,u.setSyncProgressPercentage)(null))},close:function(){},onSyncingStatus:function(e){}})};t.getReactAppSyncProgressHandle=h;var v=(0,s.checkForUnsavedChanges)((function(e){return function(t,n){return p(void 0,void 0,void 0,r.default.mark((function n(){var a,i,l,u;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=o.AppGlobals.AppModel,i=h(t),f.dynamicRollouts.includeByOwnerId("ReactAppFormSyncFix")){n.next=6;break}a.SyncData(i,e,(function(){}),(function(){})),n.next=13;break;case 6:return i.start(e),n.next=9,a.syncQueue.tryFlushQueue(i);case 9:l=n.sent,u=!1,l&&(u=a.startBackgroundSync(Object.assign({progressHandle:i},e))),u||i.finish();case 13:case"end":return n.stop()}}),n)})))}}));t.reactAppSyncAction=v;var m=(0,s.checkForUnsavedChanges)((function(e){return function(t,n){return p(void 0,void 0,void 0,r.default.mark((function n(){var a;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(a=o.AppGlobals.AppModel).ClearPersistedActions(),a.ClearLocalState(),t(v(e));case 4:case"end":return n.stop()}}),n)})))}}));t.reactAppDiscardUnsyncedChangesAction=m},173399:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.collapseView=t.closeView=t.ReactAppUIStateSlice=void 0,t.deserializeMutableState=I,t.expandView=void 0,t.generateViewStateKey=T,t.getControlForIdentifier=C,t.mapViewStackToControl=t.isChildFormTransition=void 0,t.resetViewStateKeysForTests=function(){b=0},t.serializeMutableState=R,t.updateAppStartControl=t.setSyncRequestDataStamp=void 0;var r=a(n(600861)),i=a(n(627424)),o=a(n(150361)),l=a(n(639693)),u=a(n(288306)),s=a(n(535937)),c=a(n(610928)),d=n(351101),f=n(692479),p=a(n(613834)),h=a(n(593186)),v=n(166089),m=n(95483),g=n(250617),y=n(29827),b=0;function T(e){return b++,"Control"===e.Type?"".concat(e.Name,"-").concat(b):"".concat(e.Action,"-").concat(e.TableName.replace(/\s/g,"_"),"-").concat(b)}var S={viewStack:[],isInExpandMode:!1},A=function(e,t){return function(e){var t;return"type"in e&&"pushView"===e.type&&!!(null===(t=e.payload.ViewState)||void 0===t?void 0:t.referenceRelationship)}(e)||function(e,t){var n,a;return"type"in e&&"popView"===e.type&&!!(null===(a=null===(n=(0,c.default)(t.viewStack))||void 0===n?void 0:n.mutableState)||void 0===a?void 0:a.referenceRelationship)}(e,t)};t.isChildFormTransition=A;var E=function(e,t){var n,a,r,i=v.AppGlobals.AppModel;if(null==i?void 0:i.appTemplateModel.IsValid){var o=i.appTemplateModel.Presentation.Controls,u=new Set;if(e.viewStack=(0,l.default)(e.viewStack.map((function(e){var t=e.mutableState.transactionId;if(t){if(null==i.dataManager.getTransaction(t)){if(u.has(t))return null;delete e.mutableState.isInEditMode,delete e.mutableState.transactionId}u.add(t)}var n=e.identifier;if("Control"===n.Type){if(null==o.find((function(e){return e.Name===n.Name})))return null}else if(null==i.FindTable(n.TableName))return null;return e}))),0===e.viewStack.length){var s=t?(0,y.getControlName)(t):void 0,c=s?o.filter((function(e){return e.Name!==s})):void 0,d={Type:"Control",Name:(null!==(r=null!==(a=null!==(n=null==c?void 0:c.find((function(t){return t.Name===e.startControl})))&&void 0!==n?n:null==c?void 0:c[0])&&void 0!==a?a:o.find((function(t){return t.Name===e.startControl})))&&void 0!==r?r:o[0]).Name},f={viewStateKey:T(d),identifier:d,mutableState:{}};e.viewStack=[f],e.focusedView=f.viewStateKey,e.isInExpandMode=!1}}};function w(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new Error("UIStateSlice reducer is recovering from a bad state");try{t=(0,o.default)(e)}catch(n){t=e}setTimeout((function(){h.default.ReportError(Object.assign(Object.assign({},n),{state:t,error:a,errorMessage:a.message}))}),0),E(e)}function C(e){var t,n=(0,d.getAppModel)();if("Control"===e.Type)return null!==(t=n.FindControl(e.Name))&&void 0!==t?t:void 0;if("View"===e.Type)return n.FindControlsForTable(e.TableName,e.Action,!1)[0];throw new Error("Bad identifier. Expected ControlIdentifier | ViewIdentifier, got ".concat(e))}function O(e,t){var n;if(!t)return{};var a=(0,d.getAppModel)().NavStateForView(e,null!==(n=e.TableOrFolderName)&&void 0!==n?n:"");return(0,s.default)(t,(function(e,t){return a[t]!==e}))}var _=["isInEditMode","ShowLegend","showActionBar","interactiveMode","showTabs","UseCardLayout"],k=["MaxNestedRows","Zoom","CurrentLat","CurrentLng"];function R(e){for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var r=(0,i.default)(a[n],2),o=r[0],l=r[1];_.includes(o)?t[o]=!0===l?"true":void 0:t[o]=l}return t}function I(e){for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var r=(0,i.default)(a[n],2),o=r[0],l=r[1];if(_.includes(o))"true"===l&&(t[o]=!0),"false"===l&&(t[o]=!1);else if(k.includes(o)){var u=Number(l);isNaN(u)||(t[o]=u)}else t[o]=l}return t}function N(e){var t,n=null===(t=(0,m.breakViewStackIntoGroups)((0,d.getAppModel)(),e.viewStack,e.isInExpandMode,e.focusedView).focusedViewGroup.at(-1))||void 0===t?void 0:t.viewStateKey,a=e.viewStack.findIndex((function(e){return e.viewStateKey===n}));e.viewStack=e.viewStack.slice(0,a+1)}function M(e){var t=e.viewStack.pop();e.viewStack.length?e.focusedView=e.viewStack[e.viewStack.length-1].viewStateKey:E(e,t),e.viewStack.length<2&&(e.isInExpandMode=!1)}function D(e,t){var n=(0,d.getAppModel)(),a=t.payload.ViewState,r=t.payload.Identifier,i=C(r);if(i)a=O(i,a),r={Type:"Control",Name:i.Name};else if("Control"===r.Type||null==n.FindTable(r.TableName))return void w(e,{action:t});var o=T(r),l={viewStateKey:o,identifier:r,mutableState:null!=a?a:{}};e.viewStack=[l],e.focusedView=o,e.isInExpandMode=!1}function L(e,t){var n,a,i,o=(0,d.getAppModel)(),l=t.payload.ViewState,u=null,s=t.payload.Identifier,c=e.viewStack.findIndex((function(e){return"form"===(0,y.getViewType)(e)})),p=void 0;c>=0&&!A(t,e)?p=c-1:t.payload.ViewStateKey&&(p=e.viewStack.findIndex((function(e){return e.viewStateKey===t.payload.ViewStateKey})));var h=void 0!==p?e.viewStack[p]:void 0;t.payload.RetainFilter&&h&&(l=Object.assign({filterExprString:h.mutableState.filterExprString},l));var v=C(s);if(v)l=O(v,l),u=v.Action,s={Type:"Control",Name:v.Name};else{if("Control"===s.Type||null==(null==o?void 0:o.FindTable(s.TableName)))return void w(e,{action:t});u=s.Action}var m,g={viewStateKey:T(s),identifier:s,mutableState:null!=l?l:{},parentEntriesHidden:null!==(i=null===(a=null===(n=t.payload)||void 0===n?void 0:n.options)||void 0===a?void 0:a.hideParentEntries)&&void 0!==i?i:void 0},b=e.viewStack.find((function(e){return(0,f.isViewIdentifierEqual)(e.identifier,g.identifier)&&e.mutableState.RowKey===g.mutableState.RowKey&&e.mutableState.filterExprString===g.mutableState.filterExprString})),S=e.viewStack.findIndex((function(e){return(0,f.isViewIdentifierEqual)(e.identifier,g.identifier)}));b?(m=b.viewStateKey,b.mutableState=Object.assign(Object.assign({},b.mutableState),l)):-1===S||void 0!==p&&p<S?void 0!==p?(e.viewStack=e.viewStack=[].concat((0,r.default)(e.viewStack.slice(0,p+1)),[g]),m=g.viewStateKey):(e.viewStack=[].concat((0,r.default)(e.viewStack),[g]),m=g.viewStateKey):(e.viewStack=[].concat((0,r.default)(e.viewStack.slice(0,S)),[g]),m=g.viewStateKey),"form"!==u&&(e.focusedView=m,N(e))}function P(e,t){var n,a,r=(0,d.getAppModel)(),i=t.payload;if(!i.ViewStateKey)throw new Error("changeViewReducer called without a ViewStateKey. Dispatch replaceView actions with useViewStateDispatch or provide a ViewStateKey manually.");var o=e.viewStack.findIndex((function(e){return e.viewStateKey===i.ViewStateKey})),l="replaceView"===t.type?i.ViewState:Object.assign(Object.assign({},e.viewStack[o].mutableState),i.ViewState),u=e.viewStack[o].identifier;if("View"===u.Type){if(null==(null==r?void 0:r.FindTable(u.TableName)))return void w(e,{action:t});e.viewStack[o].mutableState=l}else{var s=null!==(n=r.FindControl(u.Name))&&void 0!==n?n:void 0;if(!s)return void w(e,{action:t});e.viewStack[o].mutableState=O(s,l)}(null===(a=i.options)||void 0===a?void 0:a.discardChildren)&&(e.viewStack=e.viewStack.slice(0,o+1))}function G(e,t){e.viewStack.find((function(e){return e.viewStateKey===t.payload}))?(e.focusedView=t.payload,N(e)):w(e,{action:t})}var x=(0,u.default)((function(e){var t;if(!e)return{control:null,navState:null};var n=(0,d.getAppModel)(),a=e.identifier,r=null,i=e.mutableState,o=null,l=null;if("Control"===a.Type){r=n.FindControl(a.Name);var u=n.NavStateForView(r,null!==(t=null==r?void 0:r.TableOrFolderName)&&void 0!==t?t:"");i=Object.assign(Object.assign({controlGroupBy:null==u?void 0:u.GroupBy},u),i),o=null==r?void 0:r.TableOrFolderName,l=null==r?void 0:r.Action}else o=a.TableName,l=a.Action;return{control:r,tableName:o,action:l,navState:i}}));t.mapViewStackToControl=x;var F=(0,p.default)({name:"uiState",initialState:S,reducers:{closeView:function(e,t){var n=e.viewStack.findIndex((function(e){return e.viewStateKey===t.payload}));n>=0&&(n<=e.viewStack.findIndex((function(t){return t.viewStateKey===e.focusedView}))&&(e.focusedView=e.viewStack[n-1].viewStateKey),e.viewStack.splice(n),1===e.viewStack.length&&(e.isInExpandMode=!1))},expandView:function(e,t){var n=e.viewStack.find((function(e){return e.viewStateKey===t.payload}));n&&(e.focusedView=null==n?void 0:n.viewStateKey,e.isInExpandMode=!0,N(e))},collapseView:function(e,t){var n,a=(0,d.getAppModel)();if(-1!==e.viewStack.findIndex((function(e){return e.viewStateKey===t.payload}))){e.focusedView=t.payload,e.isInExpandMode=!1;var r=(0,m.breakViewStackIntoGroups)(a,e.viewStack,e.isInExpandMode,e.focusedView).focusedViewGroup;e.focusedView=null===(n=r.at(-1))||void 0===n?void 0:n.viewStateKey}},updateAppStartControl:function(e,t){e.startControl=t.payload},setSyncRequestDataStamp:function(e,t){e.syncRequestDataStamp=t.payload}},extraReducers:function(e){e.addCase(f.popView.onConfirm,M).addCase(f.pushView.onConfirm,L).addCase(f.newViewStack.onConfirm,D).addCase(f.replaceView,P).addCase(f.mutateView,P).addCase(f.focusView,G).addCase(f.appModelUpdated,(function(e){x.cache.clear&&x.cache.clear(),E(e)})).addCase(f.appModelUnloaded,(function(){return x.cache.clear&&x.cache.clear(),Object.assign({},S)}))}},{hashToSlice:function(e,t){var n,a=(t.viewStack||[]).map((function(e){if(!e.identifier)return null;var t={identifier:e.identifier,mutableState:I(e.mutableState||{}),viewStateKey:e.viewStateKey||T(e.identifier)};return void 0!==e.parentEntriesHidden&&(t.parentEntriesHidden=e.parentEntriesHidden),t})).filter((function(e){return null!=e}));t.at&&(e.syncRequestDataStamp=Math.min(Date.now(),new Date(t.at).valueOf())),e.viewStack=a,e.focusedView=null===(n=a[a.length-1])||void 0===n?void 0:n.viewStateKey,E(e)},sliceToHash:function(e,t){var n=t.viewStack.map((function(e){return Object.assign(Object.assign({},e),{mutableState:R(e.mutableState),viewStateKey:void 0})}));e.viewStack=n}});t.ReactAppUIStateSlice=F;var V=F.actions,U=V.expandView,B=V.collapseView,H=V.updateAppStartControl,W=V.setSyncRequestDataStamp;t.setSyncRequestDataStamp=W,t.updateAppStartControl=H,t.collapseView=B,t.expandView=U;var j=(0,g.checkForUnsavedChanges)(F.actions.closeView);t.closeView=j;var Y=F.reducer;t.default=Y},315437:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userInformationSlice=t.getUserInformationHook=t.default=void 0;var a=n(829829),r=(0,n(27401).ReadUserInfoFromUStore)(),i=(0,a.createSlice)({name:"userInformation",initialState:r,reducers:{}});t.userInformationSlice=i;t.getUserInformationHook=function(e){return e.userInformation};var o=i.reducer;t.default=o},397930:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.checkForUnsavedChangesThunk=void 0;var r=a(n(364687)),i=n(197170),o=n(29827),l=n(398171),u=n(692479),s=n(250617),c=n(980574),d=n(173399),f=n(44617),p=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))};t.checkForUnsavedChangesThunk=function(e){return function(t,n){return p(void 0,void 0,void 0,r.default.mark((function a(){var h,v,m,g,y,b,T,S;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(h=n(),v=(0,l.getAppModelHook)(h),m=(0,o.getViewInPendingTransaction)(h),g="type"in e&&(0,d.isChildFormTransition)(e,h.uiState),!v||!m||g){a.next=22;break}if(y=m.viewStateKey,b=function(){return p(void 0,void 0,void 0,r.default.mark((function n(){return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(0,i.batch)((function(){t((0,s.cancelEditMode)(y)),t(e)}));case 1:case"end":return n.stop()}}),n)})))},T=f.dynamicRollouts.includeByOwnerId("ReactAppFormSyncFix"),S=T?(0,o.getPendingTransaction)(m,0,h):v.dataManager.currentTransaction,!T||S&&!S.closed){a.next=13;break}t(e),a.next=20;break;case 13:if(!(null==S?void 0:S.hasUserEdits)){a.next=18;break}t((0,u.focusView)(m.viewStateKey)),t((0,c.confirmDiscard)(b)),a.next=20;break;case 18:return a.next=20,b();case 20:a.next=23;break;case 22:t(e);case 23:case"end":return a.stop()}}),a)})))}}},397866:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.navigateToLegacyHash=void 0;var r=a(n(364687)),i=a(n(627424)),o=a(n(365914)),l=n(695882),u=n(369332),s=n(759265),c=n(783252),d=a(n(593186)),f=n(173399),p=n(692479),h=n(75212),v=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))};t.navigateToLegacyHash=function(e,t){return function(n,a){return v(void 0,void 0,void 0,r.default.mark((function v(){var m,g,y,b,T,S,A,E,w,C,O,_,k,R,I,N;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(y=e.split("#"),b=(0,i.default)(y,2),T=b[0],S=b[1],A=(0,h.parseHash)(S),E=T||A.appName||A.appId,w=o.default.isGuid(E),C=w?void 0:E,O=w?E:"AppGallery-10305"===C?"c37bc8a4-6b53-4e71-812c-2348072cbf2e":void 0,_=(0,l.getCurrentAppHook)(a()),!(E&&E!==(null==_?void 0:_.Id)&&E!==(null==_?void 0:_.Name)||A.version&&A.version!==(null==_?void 0:_.Version))){r.next=13;break}return r.next=11,n((0,u.reactAppLoadAppAction)({appName:C,appId:O,unprefixedHash:null!=S?S:""}));case 11:r.next=23;break;case 13:if(k=(0,s.hashStringToUIState)("#"+S,t),(null==(R=null==k?void 0:k[c.SPECIFIC_STATE_NAME_MAP[k.Root]])?void 0:R.FilterExpr)&&(R.filterExprString=JSON.stringify(R.FilterExpr.toJSON()),delete R.FilterExpr),R){r.next=19;break}return d.default.errorToDevConsole(new Error("Failed to decode hash in StateReflector.SwitchApp(".concat(JSON.stringify(e),", ").concat(t,")"))),r.abrupt("return");case 19:k.syncRequestDataStamp&&n((0,f.setSyncRequestDataStamp)(k.syncRequestDataStamp)),I=k.ControlName,N=I?{Type:"Control",Name:I}:{Type:"View",Action:null!==(m=R.Root)&&void 0!==m?m:"",TableName:null!==(g=R.TableName)&&void 0!==g?g:""},n(t?(0,p.pushView)({Identifier:N,ViewState:R,ViewStateKey:t}):(0,p.newViewStack)({Identifier:N,ViewState:R}));case 23:case"end":return r.stop()}}),v)})))}}},759265:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.hashStringToUIState=t.getSpecificUIStateFromHash=void 0;var r,i,o,l,u=a(n(627424)),s=a(n(600861)),c=a(n(238416)),d=a(n(150361)),f=n(351101),p=a(n(888861)),h=a(n(593186)),v=n(75212),m=n(783252),g=n(166089),y={card:"card",table:"fastTable",dashboard:"dashboard",deck:"deck",gallery:"gallery",slideshow:"detail",detail:"detail",map:"google-map",chart:"graph",form:"form",search:"search",calendar:"calendar",onboarding:"onboarding",iframe:"iframe"};!function(e){e.CategoryColumn="_categoryColumn",e.CurrentLat="_currentLat",e.CurrentLng="_currentLng",e.DefaultCalendarView="_defaultCalendarView",e.Defaults="defaults",e.EndDateColumn="_endDateColumn",e.EndTimeColumn="_endTimeColumn",e.Filter="filter",e.Group="group",e.LabelColumn="_labelColumn",e.MapColumn="mapcolumn",e.MapType="mapType",e.QuickEdit="quickedit",e.Row="row",e.Selected="selected",e.SelectedColumn="_selectedColumn",e.SelectedTable="_selectedTable",e.Sort="sort",e.StartDateColumn="_startDateColumn",e.StartTimeColumn="_startTimeColumn",e.Table="table",e.UserDefinedFilters="userfilters",e.Zoom="_zoom"}(i||(i={})),function(e){e.Filter="_filterExpr",e.Group="_groupBy",e.Row="_row",e.Sort="_sortBy",e.Table="_table"}(o||(o={})),function(e){e.CategoryColumn="categoryColumn",e.CurrentLat="CurrentLat",e.CurrentLng="CurrentLng",e.DefaultCalendarView="defaultCalendarView",e.DefaultValues="DefaultValues",e.EndDateColumn="endDateColumn",e.EndTimeColumn="endTimeColumn",e.FilterExpr="FilterExpr",e.GroupBy="GroupBy",e.Image="image",e.LabelColumn="labelColumn",e.MapColumn="MapCol",e.MapType="MapType",e.QuickEdit="isInEditMode",e.RowKey="RowKey",e.Selected="selected",e.SelectedColumn="SelectedColumn",e.SelectedTable="SelectedTable",e.SortBy="SortBy",e.StartDateColumn="startDateColumn",e.StartTimeColumn="startTimeColumn",e.TableName="TableName",e.UserDefinedFilters="UserDefinedFilters",e.Zoom="Zoom"}(l||(l={}));var b=(r={},(0,c.default)(r,o.Row,l.RowKey),(0,c.default)(r,o.Table,l.TableName),(0,c.default)(r,o.Filter,l.FilterExpr),(0,c.default)(r,o.Group,l.GroupBy),(0,c.default)(r,o.Sort,l.SortBy),(0,c.default)(r,i.Defaults,l.DefaultValues),(0,c.default)(r,i.Filter,l.FilterExpr),(0,c.default)(r,i.Group,l.GroupBy),(0,c.default)(r,i.QuickEdit,l.QuickEdit),(0,c.default)(r,i.Row,l.RowKey),(0,c.default)(r,i.Selected,l.Selected),(0,c.default)(r,i.Sort,l.SortBy),(0,c.default)(r,i.Table,l.TableName),(0,c.default)(r,i.MapColumn,l.MapColumn),(0,c.default)(r,i.UserDefinedFilters,l.UserDefinedFilters),(0,c.default)(r,i.StartDateColumn,l.StartDateColumn),(0,c.default)(r,i.EndDateColumn,l.EndDateColumn),(0,c.default)(r,i.StartTimeColumn,l.StartTimeColumn),(0,c.default)(r,i.EndTimeColumn,l.EndTimeColumn),(0,c.default)(r,i.LabelColumn,l.LabelColumn),(0,c.default)(r,i.CategoryColumn,l.CategoryColumn),(0,c.default)(r,i.DefaultCalendarView,l.DefaultCalendarView),(0,c.default)(r,i.CurrentLat,l.CurrentLat),(0,c.default)(r,i.CurrentLng,l.CurrentLng),(0,c.default)(r,i.SelectedTable,l.SelectedTable),(0,c.default)(r,i.SelectedColumn,l.SelectedColumn),(0,c.default)(r,i.Zoom,l.Zoom),(0,c.default)(r,i.MapType,l.MapType),r),T=new Set([].concat((0,s.default)(Object.values(o)),(0,s.default)(Object.values(i)))),S=new Set([i.Selected,i.Defaults,i.Group,i.Sort,i.QuickEdit,i.UserDefinedFilters,o.Group,o.Sort]),A=function(e){try{return JSON.parse(e)}catch(t){return h.default.warnToDevConsole(t),e}},E=function(e,t){for(var n=(0,d.default)(t),a=0,r=Object.entries(e);a<r.length;a++){var o=(0,u.default)(r[a],2),l=o[0],s=o[1];if(T.has(l)){var c=b[l],f=S.has(l)?A(s):s;void 0!==f&&(n[c]=f)}}if(i.Filter in e){var h=A(e[i.Filter]);n.FilterExpr=p.default.create(h)}return n};t.getSpecificUIStateFromHash=E;t.hashStringToUIState=function(e,t){var n,a,r;if(e){var i=(0,f.getAppModel)(),o=(0,v.parseHash)(e),l={};l.ControlName=null!==(n=o.view)&&void 0!==n?n:o.control;var u=o.page||(null===(a=i.FindControl(l.ControlName))||void 0===a?void 0:a.Action)||"table";l.Root=y[u]||u,l.DataStamp=i.DataStamp,l.SearchTerm=o.search,o.at&&(l.syncRequestDataStamp=Math.min(Date.now(),new Date(o.at).valueOf()));var s=null!==(r=o.table)&&void 0!==r?r:o._table;if(s&&!l.ControlName){var c=i.FindControlsForTable(s,u,!1);"map"===u&&o.mapcolumn&&(c=c.filter((function(e){var t=i.appTemplate.getViewDefinition(e.Name);return!!t&&(o.mapcolumn===t.MapColumn||s===t.SecondaryTable&&o.mapcolumn===t.SecondaryColumn)}))),c.length&&(l.ControlName=c[0].Name)}var d=E(o,l);if(d.isInEditMode&&t){var p=g.AppGlobals.AppModel.dataManager.currentTransaction;p.startGroup({viewStateKey:t}),d.transactionId=p.id}return l[m.SPECIFIC_STATE_NAME_MAP[u]]=d,l}return null}},956073:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=i.default.applyQueryTheme(e.Presentation.DisplayTheme);r.AppGlobals.ViewManager.theme.setTheme(t,e);var n=r.AppGlobals.AppModel.appTemplate.normalizedFontSize();null!=n&&$("html, body").css("font-size","".concat(n,"px"));if(!window.APPSHEET_TEST_CONTEXT&&null!=e.Presentation.FontFamily){var a=$("body").css("font-family");a&&!a.startsWith(e.Presentation.FontFamily)&&$("body").css("font-family",'"'+e.Presentation.FontFamily+'", '+a)}};var r=n(166089),i=a(n(266522))},717696:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.recordAppStartMetrics=function(){var e;s.appStartsMetric.record(d),l.logger.logAppEvent({eventName:u.AppEventName.AppStart,duplicateOnBackend:!0}),r.default.isFunction(window.ga)&&window.ga("send",{hitType:"event",eventCategory:"App",eventAction:"AppStart",eventLabel:null===(e=l.logger.getScenario())||void 0===e?void 0:e.scenarioName});var t=(0,i.default)();window.APP_START_TIME=t.toISOString();var n=t.subtract(window.AppSheetPageLoadTime,"ms").valueOf();s.appStartMsMetric.record(n,d)},t.recordBootstrapMetrics=function(){var e=(0,i.default)().subtract(window.AppSheetPageLoadTime,"ms").valueOf();s.appBootstrapMsMetric.record(e,d)};var r=a(n(496486)),i=a(n(730381)),o=a(n(571524)),l=n(318926),u=n(218546),s=n(354632),c=n(557310),d={Device:o.default.GetMetricDevice(),Platform:c.ReactRootUIConfig.isReactRoot()?"react root":"legacy"}},665684:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setWhitelabelRequestStatus=t.setWelcomeModal=t.setWaitingOnServer=t.setWaitingOnEmulatorIframeToLoad=t.setSignificantChange=t.setShowSystemTasks=t.setShowSystemRefViews=t.setShowSystemActions=t.setShowSaveButton=t.setShowLinkedProcesses=t.setShowLinkedEvents=t.setPopup=t.setOpenAdvancedSettings=t.setLocation=t.setKeepFormSectionOpen=t.setIsAppOutOfDate=t.setInNewExpressionAssistant=t.setInNewEditorLayout=t.setHistoryLimit=t.setGenAiNoticeModalSeen=t.setExpressionTabIndex=t.setExperimentVariant=t.setExpandAll=t.setEntityFilter=t.setEmulatorIsSyncing=t.setCompactEntities=t.setChatAppStep=t.setAppServiceAccountEmail=t.setAppGcpProjectType=t.setAppGcpProjectResponse=t.setAppGcpProjectLinked=t.setAppGcpProject=t.openEditorSettings=t.onHashChange=t.mergeRightPanelSettings=t.loadingSuggestions=t.hideSuggestedNextStep=t.hideSuggestedAppReference=t.editorSettingsActionTypes=t.doneLoadingSuggestions=t.dismissAutomationSettingsCallout=t.closePopup=t.clearEntityFilter=t.alwaysHideWelcomeModal=void 0;var n={SET_APP_GCP_PROJECT:"SET_APP_GCP_PROJECT",SET_APP_GCP_PROJECT_LINKED:"SET_APP_GCP_PROJECT_LINKED",SET_APP_GCP_PROJECT_TYPE:"SET_APP_GCP_PROJECT_TYPE",SET_APP_GCP_PROJECT_RESPONSE:"SET_APP_GCP_PROJECT_RESPONSE",SET_APP_SERVICE_ACCOUNT_EMAIL:"SET_APP_SERVICE_ACCOUNT_EMAIL",SET_CHAT_APP_STEP:"SET_CHAT_APP_STEP",SET_IS_APP_OUT_OF_DATE:"SET_IS_APP_OUT_OF_DATE",SET_IN_NEW_EDITOR_LAYOUT:"SET_IN_NEW_EDITOR_LAYOUT",SET_IN_NEW_EXPRESSION_ASSISTANT:"SET_IN_NEW_EXPRESSION_ASSISTANT",SET_LOCATION:"SET_LOCATION",OPEN_EDITOR_SETTINGS:"OPEN_EDITOR_SETTINGS",SET_OPEN_ADVANCED_SETTINGS:"SET_OPEN_ADVANCED_SETTINGS",SET_EXPAND_ALL:"SET_EXPAND_ALL",SET_COMPACT_ENTITIES:"SET_COMPACT_ENTITIES",SET_ENTITY_FILTER:"SET_ENTITY_FILTER",CLEAR_ENTITY_FILTER:"CLEAR_ENTITY_FILTER",SET_SHOW_SYSTEM_ACTIONS:"SET_SHOW_SYSTEM_ACTIONS",SET_SHOW_LINKED_EVENTS:"SET_SHOW_LINKED_EVENTS",SET_SHOW_LINKED_PROCESSES:"SET_SHOW_LINKED_PROCESSES",SET_SHOW_SYSTEM_TASKS:"SET_SHOW_SYSTEM_TASKS",SET_SHOW_SYSTEM_REFVIEWS:"SET_SHOW_SYSTEM_REFVIEWS",SET_HISTORY_LIMIT:"SET_HISTORY_LIMIT",SET_SIGNIFICANT_CHANGE:"SET_SIGNIFICANT_CHANGE",SET_KEEP_FORMSECTION_OPEN:"SET_KEEP_FORMSECTION_OPEN",SET_WAITING_ON_SERVER:"SET_WAITING_ON_SERVER",SET_WAITING_ON_EMULATOR_IFRAME_TO_LOAD:"SET_WAITING_ON_EMULATOR_IFRAME_TO_LOAD",SET_EMULATOR_IS_SYNCING:"SET_EMULATOR_IS_SYNCING",SHOW_SAVE_BUTTON:"SHOW_SAVE_BUTTON",SET_POPUP:"SET_POPUP",CLOSE_POPUP:"CLOSE_POPUP",LOADING_SUGGESTIONS:"LOADING_SUGGESTIONS",DONE_LOADING_SUGGESTIONS:"DONE_LOADING_SUGGESTIONS",MERGE_RIGHT_PANEL_SETTINGS:"MERGE_RIGHT_PANEL_SETTINGS",SET_WHITELABEL_REQUEST_STATUS:"SET_WHITELABEL_REQUEST_STATUS",DISMISS_AUTOMATION_SETTINGS_CALLOUT:"DISMISS_AUTOMATION_SETTINGS_CALLOUT",SET_ALWAYS_HIDE_WELCOME_MODAL:"SET_ALWAYS_HIDE_WELCOME_MODAL",SET_WELCOME_MODAL:"SET_WELCOME_MODAL",ADD_DISMISSED_SUGGESTED_NEXT_STEP:"ADD_DISMISSED_SUGGESTED_NEXT_STEP",SET_EXPERIMENT_INFO:"SET_EXPERIMENT_INFO",SET_EXPRESSION_TAB_INDEX:"SET_EXPRESSION_TAB_INDEX",ON_HASH_CHANGE:"ON_HASH_CHANGE",ADD_DISMISSED_APP_REFERENCE:"ADD_DISMISSED_APP_REFERENCE",SET_GEN_AI_NOTICE_MODAL_SEEN:"SET_GEN_AI_NOTICE_MODAL_SEEN"};t.editorSettingsActionTypes=n;t.setAppGcpProject=function(e,t){return{type:n.SET_APP_GCP_PROJECT,appId:e,projectId:t}};t.setAppGcpProjectLinked=function(e,t){return{type:n.SET_APP_GCP_PROJECT_LINKED,appId:e,projectLinked:t}};t.setAppGcpProjectType=function(e,t){return{type:n.SET_APP_GCP_PROJECT_TYPE,appId:e,isAutoProject:t}};t.setAppGcpProjectResponse=function(e,t){return{type:n.SET_APP_GCP_PROJECT_RESPONSE,appId:e,response:t}};t.setAppServiceAccountEmail=function(e,t){return{type:n.SET_APP_SERVICE_ACCOUNT_EMAIL,appId:e,serviceAccountEmail:t}};t.setChatAppStep=function(e,t){return{type:n.SET_CHAT_APP_STEP,appId:e,value:t}};t.setLocation=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0;return window.reloadBackupSuggestions&&window.reloadBackupSuggestions(),{type:n.SET_LOCATION,value:e,clear:t,replace:a}};t.openEditorSettings=function(e){return{type:n.OPEN_EDITOR_SETTINGS,value:e}};t.setOpenAdvancedSettings=function(e){return{type:n.SET_OPEN_ADVANCED_SETTINGS,value:e}};t.setExpandAll=function(e){return{type:n.SET_EXPAND_ALL,value:e}};t.setCompactEntities=function(e){return{type:n.SET_COMPACT_ENTITIES,value:e}};t.setEntityFilter=function(e,t){return{type:n.SET_ENTITY_FILTER,path:e,value:t}};t.clearEntityFilter=function(e){return{type:n.CLEAR_ENTITY_FILTER,path:e}};t.setShowSystemActions=function(e){return{type:n.SET_SHOW_SYSTEM_ACTIONS,value:e}};t.setShowSystemRefViews=function(e){return{type:n.SET_SHOW_SYSTEM_REFVIEWS,value:e}};t.setShowLinkedEvents=function(e){return{type:n.SET_SHOW_LINKED_EVENTS,value:e}};t.setShowLinkedProcesses=function(e){return{type:n.SET_SHOW_LINKED_PROCESSES,value:e}};t.setShowSystemTasks=function(e){return{type:n.SET_SHOW_SYSTEM_TASKS,value:e}};t.setHistoryLimit=function(e){return{type:n.SET_HISTORY_LIMIT,value:e}};t.setSignificantChange=function(e){return{type:n.SET_SIGNIFICANT_CHANGE,value:e}};t.setKeepFormSectionOpen=function(e){return{type:n.SET_KEEP_FORMSECTION_OPEN,value:e}};t.setWaitingOnServer=function(e){return{type:n.SET_WAITING_ON_SERVER,value:e}};t.setWaitingOnEmulatorIframeToLoad=function(e){return{type:n.SET_WAITING_ON_EMULATOR_IFRAME_TO_LOAD,value:e}};t.setEmulatorIsSyncing=function(e){return{type:n.SET_EMULATOR_IS_SYNCING,value:e}};t.setShowSaveButton=function(e){return{type:n.SHOW_SAVE_BUTTON,value:e}};t.setIsAppOutOfDate=function(e){return{type:n.SET_IS_APP_OUT_OF_DATE,value:e}};t.setPopup=function(e,t,a,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return{type:n.SET_POPUP,value:e,popupType:t,path:a,duration:r,goBackPath:i,showSave:o}};t.closePopup=function(){return{type:n.CLOSE_POPUP}};t.loadingSuggestions=function(){return{type:n.LOADING_SUGGESTIONS}};t.doneLoadingSuggestions=function(){return{type:n.DONE_LOADING_SUGGESTIONS}};t.mergeRightPanelSettings=function(e){return{type:n.MERGE_RIGHT_PANEL_SETTINGS,value:e}};t.setWhitelabelRequestStatus=function(e){return{type:n.SET_WHITELABEL_REQUEST_STATUS,value:e}};t.dismissAutomationSettingsCallout=function(e){return{type:n.DISMISS_AUTOMATION_SETTINGS_CALLOUT,value:e}};t.alwaysHideWelcomeModal=function(e){return{type:n.SET_ALWAYS_HIDE_WELCOME_MODAL,value:e}};t.setWelcomeModal=function(e){return{type:n.SET_WELCOME_MODAL,value:e}};t.setExperimentVariant=function(e,t,a){return{type:n.SET_EXPERIMENT_INFO,experimentId:e,variantId:t,hasBeenActivated:a}};t.setExpressionTabIndex=function(e,t){return{type:n.SET_EXPRESSION_TAB_INDEX,expressionTabIndex:e,expressionTabIsOpen:t}};t.hideSuggestedNextStep=function(e){var t=e.appId,a=e.suggestionId;return{type:n.ADD_DISMISSED_SUGGESTED_NEXT_STEP,appId:t,suggestionId:a}};t.hideSuggestedAppReference=function(e){var t=e.appId,a=e.suggestionId;return{type:n.ADD_DISMISSED_APP_REFERENCE,appId:t,suggestionId:a}};t.onHashChange=function(e){return{type:n.ON_HASH_CHANGE,value:e}};t.setInNewEditorLayout=function(e){return{type:n.SET_IN_NEW_EDITOR_LAYOUT,value:e}};t.setInNewExpressionAssistant=function(e){return{type:n.SET_IN_NEW_EXPRESSION_ASSISTANT,value:e}};t.setGenAiNoticeModalSeen=function(){return{type:n.SET_GEN_AI_NOTICE_MODAL_SEEN}}},160647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setReadyToBroadcast=t.setPathToBroadcast=t.setIdToBroadcast=t.setHoveredElement=t.setEmulatorMode=t.setCurrentAppComponent=t.getHoveredElement=t.getEmulatorMode=t.editingEmulatorReducer=t.INITIAL_EDITING_EMULATOR_STATE=void 0;var a=n(829829),r={emulatorMode:n(780146).DEFAULT_EMULATOR_MODE,hoveredElement:null,currentAppComponent:null,broadcasting:{pathToBroadcast:null,componentIdToBroadcast:null,readyToBroadcast:!0}};t.INITIAL_EDITING_EMULATOR_STATE=r;var i=(0,a.createSlice)({name:"editingEmulator",initialState:r,reducers:{setEmulatorMode:function(e,t){e.emulatorMode=t.payload.mode},setHoveredElement:function(e,t){e.hoveredElement=t.payload},setCurrentAppComponent:function(e,t){e.currentAppComponent=t.payload.component},setPathToBroadcast:function(e,t){e.broadcasting.pathToBroadcast=t.payload},setIdToBroadcast:function(e,t){e.broadcasting.componentIdToBroadcast=t.payload},setReadyToBroadcast:function(e,t){e.broadcasting.readyToBroadcast=t.payload}}});t.getHoveredElement=function(e){return e.editingEmulator.hoveredElement};t.getEmulatorMode=function(e){return e.editingEmulator.emulatorMode};var o=i.reducer;t.editingEmulatorReducer=o;var l=i.actions,u=l.setEmulatorMode,s=l.setHoveredElement,c=l.setCurrentAppComponent,d=l.setPathToBroadcast,f=l.setIdToBroadcast,p=l.setReadyToBroadcast;t.setReadyToBroadcast=p,t.setIdToBroadcast=f,t.setPathToBroadcast=d,t.setCurrentAppComponent=c,t.setHoveredElement=s,t.setEmulatorMode=u},780146:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_EMULATOR_MODE=void 0;t.DEFAULT_EMULATOR_MODE="edit"},629503:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.Common=void 0;var i=a(n(856690)),o=a(n(689728)),l=a(n(496486));n(671734),n(222820);var u,s=a(n(112368)),c=a(n(571524)),d=n(318926),f=n(881219),p=n(218546),h=n(737351),v=a(n(593186)),m=n(365914),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=I(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(351101)),y=n(895466),b=n(714067),T=n(429815),S=n(862858),A=n(263198),E=a(n(440587)),w=n(469534),C=n(166089),O=n(386350),_=a(n(27401)),k=n(717696),R=n(44617);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(I=function(e){return e?n:t})(e)}t.Common=u;var N="";$(document).on("mouseup","a",(function(e){N=e.currentTarget.href,setTimeout((function(){N=null}),500)}));var M=window.onbeforeunload?window.onbeforeunload:function(){};window.onbeforeunload=function(){u.IsPopupUrl(N)||(M.call(window),v.default.AddTraceContext("BeforeWindowUnload"),d.logger.endAllScenarios({result:S.ScenarioResult.Abandon,abandonReason:S.ScenarioAbandonReason.UserNavigatedAway}))};var D=window.onfocus?window.onfocus:function(){};window.onfocus=function(){D.call(window),window.QuiesceApp=!1,v.default.AddTraceContext("AfterWindowLoad")};var L=function(){function e(){(0,i.default)(this,e),this.InitializingApp=!1,this.RunningInTestFramework=!1,this.PrivilegedUsers={25410:!0,25411:!0},this.imageCache={},this.uploadRequests={},this.awaitingUploadRequests={}}return(0,o.default)(e,[{key:"rescaleCanvas",value:function(e){var t=parseInt($(e).attr("width"),10)/$(e).width();e.getContext("2d").setTransform(t,0,0,t,0,0)}},{key:"StartBackendCall",value:function(){$("#header").trigger("startBackendCall.appsheet")}},{key:"FinishBackendCall",value:function(){$("#header").trigger("finishBackendCall.appsheet")}},{key:"IsPopupUrl",value:function(e){if("string"!=typeof e)return!1;var t=e.toLowerCase();return 0===t.indexOf("mailto:")||0===t.indexOf("tel:")||0===t.indexOf("sms:")}},{key:"Show1TrackHelp",value:function(e,t){var n=this;if($("#GetStartedList").hide(),e){var a=$("#"+t);a.dialog({create:function(e){$(e.target).parent().css("position","fixed")},open:function(){$("#FullScreenOverlay").show(),n.FixDialogPosition(a)},close:function(){$("#FullScreenOverlay").hide()},zIndex:10005,position:"center",width:500,title:$("#"+t).attr("dialogTitle")})}}},{key:"FixDialogPosition",value:function(e,t){var n=e.outerWidth(),a=e.outerHeight();n<=1&&(n=t),a<=1&&(a=500);var r=e.offset(),i=$(window);if(r.left<i.scrollLeft()||r.left+n>i.scrollLeft()+i.width()){var o=i.width()/2-n/2;"absolute"===e.parents(".ui-dialog").css("position")&&(o+=i.scrollLeft()),e.parents(".ui-dialog").css("left",o)}if(r.top<i.scrollTop()||r.top+a>i.scrollTop()+i.height()){var l=i.height()/2-a/2;"absolute"===e.parents(".ui-dialog").css("position")&&(l+=i.scrollTop()),e.parents(".ui-dialog").css("top",l)}}},{key:"BeginOfflineCaching",value:function(){C.AppGlobals.ViewManager.ShowStorageInProgress()}},{key:"FinishedCachingCallback",value:function(){C.AppGlobals.ViewManager.HideStorageInProgress()}},{key:"FlexImageUrl",value:function(e,t){var n,a,r;if(!e)return" ";if("string"!=typeof e)return(0,y.isImageHandle)(e)?null!==(n=y.ImageHandle.from(e).getUrlForImgSrc())&&void 0!==n?n:" ":e instanceof E.default?null!==(a=e.url)&&void 0!==a?a:" ":(v.default.ReportErrorOnce({errorMessage:"Unexpected imageUrl type in FlexImageUrl",stringified:null===(r=JSON.stringify(e))||void 0===r?void 0:r.slice(0,100)}),e);if("data:"===e.substr(0,5))return e;var i=e.includes("?")?"&":"?",o=b.GETIMAGEURL_PATTERN.test(e)||b.GETREMOTEIMAGEURL_PATTERN.test(e);if(/\.svg($|[\?#])|format=svg/.test(e)||e.indexOf("quickchart.io")>0||e.indexOf("drive.google.com")>0||e.indexOf("placeholder.pics")>0||e.indexOf("robohash.org")>0||e.indexOf("avataaars.io")>0||e.indexOf("pixelixe.com")>0)return e;if(!(!o&&e.indexOf("jeenee")<0&&e.indexOf("appsheetios")<0&&e.indexOf(b.REMOTE_URL_BASE)<0&&e.indexOf("gettablefileurl")<0&&e.indexOf(b.CLOUDFLARE_URL_BASE)<0&&e.indexOf("content.force.com")<0&&e.indexOf("via.placeholder.com")<0))return 0===e.indexOf(b.CLOUDFLARE_URL_BASE)?(e.indexOf("&w=")<0&&(e+="".concat(i,"w=").concat(null!=t?t:600)),e):e.indexOf("gettablefileurl")>0?e+="".concat(i,"resizeImage=true&imageWidth=").concat(null!=t?t:600):o?(e.indexOf("width=")<0&&(e+="".concat(i,"width=").concat(null!=t?t:600)),e):e.toLowerCase().indexOf("fsimage")>=0?(0===e.indexOf("http://")&&(e=e.replace("http://","https://")),e):(0,m.normalizeTextIconUrl)(e);try{return b.GETREMOTEIMAGEURL_BASE+"?url="+encodeURIComponent(decodeURIComponent(e))+"&width="+(null==t?600:t)}catch(t){return e}}},{key:"InitializeApp",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{this.InitializingApp=!0,C.AppGlobals.AppState.Initialize(n,r),C.AppGlobals.AppState.AppTemplate={Id:e,Name:n,Version:r},C.AppGlobals.ViewManager.Initialize(),window.InputHandler.Initialize(),A.JeeneeBrowserAPI.notifyJavaScriptLoaded(),A.JeeneeBrowserAPI.setNativeLocalizationStrings&&A.JeeneeBrowserAPI.setNativeLocalizationStrings([]),C.AppGlobals.AppState.UserInformation.Id!==C.AppGlobals.AppState.GuestUserInformation.Id&&(s.default.IsAndroidAppWithMinVersion()&&!c.default.IsUnsupportedAndroidVersion()?window.JeeneeAndroid.setOnTokenRefreshListener("JeeneeBrowserAPI.onNewNotificationToken('{0}')"):s.default.IsAndroidAppWithMinVersion(10.5)&&!c.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.setOnTokenRefreshListener("JeeneeBrowserAPI.onNewNotificationToken('{0}', '{1}', '{2}')"),s.default.IsIOSAppWithMinVersion(10.6)?A.JeeneeBrowserAPI.setOnTokenRefreshListenerIOS({listener:"JeeneeBrowserAPI.onNewNotificationToken('{0}', '{1}', '{2}')"}):s.default.IsIOSAppWithMinVersion(9.9)&&$.ajax({type:"POST",async:!1,url:"/jeenee_new?method=setOnTokenRefreshListener",data:{listener:"JeeneeBrowserAPI.onNewNotificationToken('{0}')"}}));var i=function(){v.default.AddTraceContext("Common.fetchDataAndStart",{appId:e,appName:n}),(0,f.abortOutstandingCalls)(),C.AppGlobals.AppModel.discardPendingAppModel(),c.default.IsAndroid4()&&$("body").addClass("IsAndroid4");C.AppGlobals.ViewManager.ShowDataLoadModal({syncOrStartup:"startup",hideUI:!1},(function(e){C.AppGlobals.AppModel.Initialize(e,(function(e){v.default.AddTraceContext("Common.appTemplateSuccess",{appName:e.Name}),(0,h.installOrUpdateServiceWorker)(),A.JeeneeBrowserAPI.setCurrentApp(e),(0,w.maybeSubscribeToPunctual)(e),StateReflector.Initialize(),null!=e&&(e.IsRunnable?(C.AppGlobals.AppModel.OnAppTemplateLoad(e),a&&C.AppGlobals.AppState.SetLocationHash(a),A.JeeneeBrowserAPI.OnAppTemplateLoad(e),C.AppGlobals.ViewManager.OnAppTemplateLoad(e,!0),C.AppGlobals.AppState.OnAppTemplateLoad(e),C.AppGlobals.AppModel.IsWhitelabelApp()||C.AppGlobals.AppState.SetLastRunApp(e.Name)):C.AppGlobals.ViewManager.ShowErrorScreen("The "+e.ShortName+" app is in an invalid state. Please contact the app creator."),n&&(0,k.recordAppStartMetrics)()),t.InitializingApp=!1,(0,O.sendEditorMessage)("app-initialized",{appId:e.Id})}),(function(e){if(!(window.ignoreAbort&&e&&e.indexOf("abort")>=0))throw C.AppGlobals.ViewManager.ShowErrorScreen("The "+n+" app did not load successfully. Please contact the app creator.",e),t.InitializingApp=!1,C.AppGlobals.AppState.SetLastRunApp(null),n&&d.logger.logAppEvent({eventName:p.AppEventName.AppStart}),new Error("Error initializing AppModel: "+(e||""))}))}))};try{i()}catch(e){v.default.AddTraceContext("ERROR in fetchDataAndStart - retrying with new AppModel"),C.AppGlobals.AppModel.ClearTemplateData(),_.default.clearUserRollouts(),g.default.reset(),i()}}catch(e){this.InitializingApp=!1,C.AppGlobals.AppState.SetLastRunApp(null)}}},{key:"EvaluateExtensionMethod",value:function(e,t,n){if("AppGallery-10305"!==C.AppGlobals.AppState.AppTemplate.Name)return n(!1,null);if("chooseControl"===e){if(!l.default.isNil(t)&&!l.default.isNil(t.controls)){for(var a=null,r=null,i=null,o=0;o<t.controls.length;o++)switch(t.controls[o].Name){case"Public":i=t.controls[o];break;case"My Apps":a=t.controls[o];break;case"Shared":r=t.controls[o]}if(!l.default.isNil(a)&&0<a._rowCount)return n(!0,a.Name);if(!l.default.isNil(r)&&0<r._rowCount)return n(!0,r.Name);if(!l.default.isNil(i)&&0<i._rowCount)return n(!0,i.Name)}return n(!1,null)}return n(!1,null)}},{key:"MemWarning",value:function(e){v.default.warnToDevConsole(e)}},{key:"processFileInputHandle",value:function(e,t,n){var a=e.file,r="WebFileReader"===e.type();if(null!=a){var i=function(e){"function"==typeof n&&n("Error with filereader: "+e.target.error.message),setTimeout((function(){throw e.target.error}),0)},o=e.preferredWidth||(0,T.getMaxImageResolution)();if(r||o===b.NO_RESIZE_WIDTH){var l=new FileReader;l.onloadend=function(e){t(e.target.result)},l.onerror=i,l.readAsDataURL(a)}else try{$.canvasResize(a,{width:o,height:0,crop:!1,quality:90,callback:function(e){t(e)},onError:i,disableSubsamplingDetection:R.dynamicRollouts.includeByOwnerId("DisableSubsamplingDetectionInCanvasResize")})}catch(e){"function"==typeof n&&n("An error occurred during image resize: "+e.toString())}}else t((0,A.missingImageError)("The selected image could not be found."))}},{key:"makeFileInputHandle",value:function(e,t,n){var a=String(Math.floor(1e6*Math.random()+1)),r=y.ImageHandle.from({type:t?"WebFileReader":"WebImageReader",value:a,preferredWidth:n});return r.setFileInput(e),r}},{key:"registerUploadRequest",value:function(e,t){t&&e&&("function"==typeof this.awaitingUploadRequests[e]?(this.awaitingUploadRequests[e](t),delete this.awaitingUploadRequests[e]):this.uploadRequests[e]=t)}},{key:"unregisterUploadRequest",value:function(e){var t=this.uploadRequests;e&&setTimeout((function(){delete t[e]}),6e4)}},{key:"awaitUploadRequest",value:function(e,t){var n=this.uploadRequests[e];n?(t(n),delete this.uploadRequests[e]):this.awaitingUploadRequests[e]=t}},{key:"finishImageRead",value:function(e,t){e?t?t.value()?"function"==typeof e.CallbackFn&&e.CallbackFn(t):v.default.ReportError({errorMessage:"finishImageRead was called with null imageHandle.value"}):v.default.ReportError({errorMessage:"finishImageRead was called with null imageHandle"}):v.default.ReportError({errorMessage:"finishImageRead was called with null uploadRequest"})}},{key:"processImage",value:function(e,t,n){var a,r=this;if(e.isBlank())t("");else{var i=function(n,a){if(n&&!n.startsWith(A.UNABLE_TO_LOAD_IMAGE_PREFIX))return a||r.setCachedImage(e,n),void t(n);var i=r.getCachedImage(e);i?(v.default.ReportError({errorMessage:"Common.imageCache avoided losing an image",imageHandleType:e.type()}),t(i)):t(n)};switch(e.type()){case"WebFileReader":case"WebImageReader":var o=C.AppGlobals.AppModel.GetFromImageCache(e.value());o?i(o,!0):this.processFileInputHandle(e,i,n);break;case"Url":case"Data":i(null!==(a=e.value())&&void 0!==a?a:"");break;case"IOS":A.JeeneeBrowserAPI.getBase64DataIOS(e,i);break;case"Android":A.JeeneeBrowserAPI.getBase64DataAndroid(e,i)}}}},{key:"setCachedImage",value:function(e,t){e=y.ImageHandle.from(e);var n=(0,g.getAppModel)().inDynamicRolloutByOwnerId("ClientSkipCommonImageCache");switch(e.type()){case"IOS":case"Android":n||(this.imageCache[e.value()]=t);break;case"Data":case"Url":break;case"WebFileReader":case"WebImageReader":n||(this.imageCache[e.value()]=t),C.AppGlobals.AppModel.AddToImageCache(e.value(),t)}}},{key:"getCachedImage",value:function(e){e=y.ImageHandle.from(e);var t=this.imageCache[e.value()];if(t)return t;switch(e.type()){case"IOS":case"Android":case"Data":case"Url":break;case"WebFileReader":case"WebImageReader":return C.AppGlobals.AppModel.GetFromImageCache(e.value())}return null}}]),e}();t.Common=u=new L},422339:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultProvider=void 0,t.initializeDefaultProvider=function(){JeeneeNamespace.DefaultProvider=f};var r=a(n(689728)),i=a(n(856690)),o=a(n(190644)),l=a(n(571524)),u=a(n(593186)),s=n(431335),c=a(n(496486)),d=n(166089),f=(0,r.default)((function e(){var t=this;(0,i.default)(this,e),this._get=function(e,t,n,a,r){$.getJSONUnsigned(e,t,(function(t,a){c.default.isNil(t)||!t.LoginRequired?c.default.isFunction(n)&&n(t,a):d.AppGlobals.AppState.SwitchToLoginPage(t.LoginProvider," GET from "+e+" response indicates that login is required")}),(function(e,t){c.default.isFunction(a)&&a(e,t)}),r)},this._post=function(e,t,n,a){$.postJSON(e,t,(function(t){c.default.isNil(t)||!t.LoginRequired?c.default.isFunction(n)&&n(t):d.AppGlobals.AppState.SwitchToLoginPage(t.LoginProvider," POST to "+e+" response indicates that login is required")}),(function(e,t){c.default.isFunction(a)&&a(e,t)}))},this._postPromise=function(e,n){return new Promise((function(a,r){t._post(e,n,a,(function(e,t){var n=new Error(e);n.statusCode=t,r(n)}))}))},this.ReadTable=function(e,n,a,r,i,l,u,f){var p,h,v=null!==(h=null===(p=null===o.default||void 0===o.default?void 0:o.default.lastPosition)||void 0===p?void 0:p.coords)&&void 0!==h?h:{},m=v.latitude,g=v.longitude,y=null!=m&&null!=g?o.default.stringifyLatLng(m,g):null,b=d.AppGlobals.AppModel?d.AppGlobals.AppModel.GetUserSettings(e):null,T={providerName:r,tableName:a,nestedPath:l,tzOffset:(new Date).getTimezoneOffset(),locale:navigator.languages?navigator.languages[0]:navigator.language,settings:b?JSON.stringify(b):null,version:n,location:y},S=d.AppGlobals.AppModel.FindTable(a),A=encodeURIComponent(e),E="/api/template/".concat(A,"/tableV2");t._get(E,T,(function(e,t){if(304===t)"function"==typeof u&&u(a,S.Rows,S.Timestamp,S.ETag);else if(c.default.isNil(e))c.default.isFunction(f)&&f("Empty table");else if(e.Success){var n=s.CSV.parse(e.DataSet);"function"==typeof u&&u(c.default.isNil(i)?a:i,n,e.Timestamp)}else c.default.isFunction(f)&&f(e.ErrorDescription)}),(function(e,t){c.default.isFunction(f)&&f(e,t)}),(function(e){c.default.isNil(S)||e.setRequestHeader("If-Modified-Since",S.Timestamp)}))},this.makeQueryString=function(e){var t,n=d.AppGlobals.AppModel,a=o.default&&o.default.lastPosition||{},r=o.default?o.default.stringifyLatLng(a.lat,a.lng):null;n&&"function"==typeof n.NeedsUsageScopesConsent&&n.NeedsUsageScopesConsent()&&(r="");var i=e.userSettings||(n&&"function"==typeof n.GetUserSettings?n.GetUserSettings():null),u=l.default&&l.default.IsIFramePreview(),s="?tzOffset="+(new Date).getTimezoneOffset()+"&settings="+encodeURIComponent(JSON.stringify(i))+"&apiLevel="+((null==n?void 0:n.API_LEVEL)||1)+"&isPreview="+u+"&checkCache="+!!e.checkCache+"&locale="+(navigator.languages?navigator.languages[0]:navigator.language)+"&location="+encodeURIComponent(r)+"&appTemplateVersion="+e.appVersion+"&localVersion="+((null===(t=null==n?void 0:n.AppTemplate)||void 0===t?void 0:t.Version)||"")+"&timestamp="+encodeURIComponent(e.timestamp||"")+"&requestStartTime="+encodeURIComponent((new Date).toISOString())+"&lastSyncTime="+encodeURIComponent(n&&"function"==typeof n.lastSuccessfulSyncTime&&n.lastSuccessfulSyncTime()||"")+"&appStartTime="+encodeURIComponent(window.APP_START_TIME||"")+"&dataStamp="+encodeURIComponent((null==n?void 0:n.DataStamp)||"")+"&clientId="+(n&&"function"==typeof n.GetClientId&&n.GetClientId()||"")+"&build="+window.AppSheetJSBuild+"&requestId="+e.requestId;return e.mechanism&&(s+="&mechanism="+encodeURIComponent(e.mechanism)),e.viewName&&(s+="&viewName="+encodeURIComponent(e.viewName)),e.actionName&&(s+="&actionName="+encodeURIComponent(e.actionName)),e.syncToken&&(s+="&syncToken="+encodeURIComponent(e.syncToken)),s},this.AddTableRow=function(e,n,a,r,i){u.default.AddTraceContext("DefaultDataProvider.AddTableRow",{requestId:n.requestId}),t._post("/api/template/"+encodeURIComponent(e)+"/table/"+encodeURIComponent(n.tableName)+"/row"+t.makeQueryString(n),a,r,i)},this.UpdateTableRow=function(e,n,a,r,i){u.default.AddTraceContext("DefaultDataProvider.UpdateTableRow",{requestId:n.requestId}),t._post("/api/template/"+encodeURIComponent(e)+"/table/"+encodeURIComponent(n.tableName)+"/row/update"+t.makeQueryString(n),a,r,i)},this.DeleteTableRow=function(e,n,a,r,i){u.default.AddTraceContext("DefaultDataProvider.DeleteTableRow",{requestId:n.requestId}),t._post("/api/template/"+encodeURIComponent(e)+"/table/"+encodeURIComponent(n.tableName)+"/row/delete"+t.makeQueryString(n),a,r,i)},this.RecordRecoveryData=function(e,n){var a="/api/template/".concat(encodeURIComponent(e),"/recovery");return t._postPromise(a,n)}}));t.DefaultProvider=f},796326:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.NETWORK_ERROR_MESSAGE=void 0,t.getAjaxErrorString=l,t.initializeJsonHelpers=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onAjaxResult,n=void 0===t?function(e){}:t,a=e.onPostResult,r=void 0===a?function(e){}:a,u=e.isConnected,s=void 0===u?function(){return!0}:u,c=e.autoDisconnect,d=void 0===c?function(){}:c;function f(e,t){$.getJSONUnsigned("/api/refreshtoken",null,(function(t){window.VerifiedAjaxPostToken=t.token,e()}),t)}$.getJSONUnsigned=function(e,t,a,r,u){if(s()){var c=OneTrackProtocol+"//"+OneTrackHost+e;$.ajax({url:c,dataType:"json",data:t,beforeSend:u,success:function(e,t,r){n(e),"function"==typeof a&&a(e,r.status)},error:function(t,a,u){if(n(t),"function"==typeof r){var s=l(t,a,u);s===o&&d(),r(s,t.status)}i.default.ReportJqueryAjaxError("get",e,t,a,u)}})}else"function"==typeof r&&r("Not connected")},$.postJSONAsync=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Promise((function(i){$.postJSON(e,t,(function(e,t){return i({success:!0,response:e,httpStatus:t})}),(function(e,t){return i({success:!1,responseText:e,httpStatus:t})}),n,a,r)}))},$.postJSON=function(e,t,n,a,u){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(s()){var h=OneTrackProtocol+"//"+OneTrackHost+e;window.verifiedAjaxPost({url:h,type:"post",processData:!1,data:JSON.stringify(t),timeout:3e5,contentType:"application/json",beforeSend:u,success:function(i,o,l){(null==i?void 0:i.TokenIsInvalid)&&0===c?f((function(){$.postJSON(e,t,n,a,u,c+1,p)}),a):(r(i),"function"==typeof n&&n(i,l.status))},error:function(r,s,f){if("function"==typeof a){var h=l(r,s,f);if(h===o){if(2===p){var v=null!=r?r:{},m=v.readyState,g=v.status,y=v.statusText;i.default.ReportError({errorMessage:"NETWORK_ERROR",textStatus:s,errorThrown:f,readyState:m,status:g,statusText:y,tokenRetryCount:c,networkErrorRetryCount:p})}if(p<2)return void setTimeout((function(){$.postJSON(e,t,n,a,u,c,p+1)}),1e3);d()}else i.default.ReportJqueryAjaxError("post",e,r,s,f);a(h,r.status)}}})}else"function"==typeof a&&a("Not connected")}},t.isSuccessResponse=t.isFailureResponse=void 0,t.printableJSON=function e(t,n){var a="";if(null==t)return a;if(n>3)return"";"object"===(0,r.default)(t)?(a+="{ \n",$.each(t,(function(t,r){a+=u(n)+String(t)+":\t"+e(r,n+1)+"\n"})),a+=u(n)+" } \n"):a+=null!=t&&"function"==typeof t.substring?t.substring(0,500):t;return a};var r=a(n(918698)),i=a(n(593186));t.isSuccessResponse=function(e){return!0===e.success};t.isFailureResponse=function(e){return!1===e.success};var o="Network error. Please check connectivity and try again.";t.NETWORK_ERROR_MESSAGE=o;function l(e,t,n){return null!=e.responseText&&e.responseText.length>0?e.responseText:"timeout"===n?"__:Connection timed out. Please wait a moment and try again.":null!=n&&n.length>0&&"error"!==n?"__:"+n:null!=t&&t.length>0&&"error"!==t?"__:"+t:o}function u(e){for(var t="",n=0;n<e;n++)t+="\t";return t}},249633:(e,t,n)=>{"use strict";var a=n(564836),r=n(918698);Object.defineProperty(t,"__esModule",{value:!0}),t.UserSettings=t.NativeProvider=t.AppSuggestions=t.AppSettings=void 0,t.initializeNativeProvider=function(){JeeneeNamespace.NativeProvider=S};var i=a(n(689728)),o=a(n(856690)),l=a(n(496486)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n(593186)),s=a(n(150198)),c=n(318926),d=n(804758),f=n(149313),p=n(714067),h=n(365914);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function m(e,t){var n;if(null===(n=null==e?void 0:e.AppTemplate)||void 0===n?void 0:n.AppData){var a=e.AppTemplate.AppData.DataSets;return l.default.find(a,t)}}function g(e,t){var n={};return t.forEach((function(t){var a=new s.default(t),r=e[t.Name],i=a.valueFromWireFormat(r);n[t.Name]=i})),n}var y=(0,i.default)((function e(t){var n=this;(0,o.default)(this,e),this._appWithoutPreview=null,this._suggestionsTableDefn=function(){return m(n._appModel,(function(e){return"native"===e.ProviderName&&"_Internal_SuggestionsTable"===e.Name}))},this._suggestionsSchema=function(){var e=n._suggestionsTableDefn();return e?n._appModel.FindSchema(e.SchemaName):null},this._isValid=function(){return n._appModel&&n._suggestionsTableDefn()&&n._suggestionsSchema()},this.HasTable=function(e){var t=n._suggestionsTableDefn();return n._isValid()&&t.Name===e},this.Update=function(e){if(n._isValid()){var t=e.tableName,a=e.row,r=e.oldRow,i=n._suggestionsTableDefn(),o=n._suggestionsSchema();if(t===i.Name){(0,f.$TSFixMeMaybeNull)(o);var l=g(a,o.Attributes),u=g(r,o.Attributes),s=!u.Accepted&&l.Accepted,c=!u.Previewing&&l.Previewing,d=!u.Rejected&&l.Rejected;s?n._acceptSuggestion(a):c?n._previewSuggestion(a):d&&n._rejectSuggestion(a)}}},this._getNonPreviewApp=function(){return l.default.cloneDeep(n._appWithoutPreview||n._appModel.AppTemplate)},this._updateSettings=function(e){e.Presentation.Controls.forEach((function(e){e.Settings=JSON.stringify(e.ViewDefinition)}))},this._rejectSuggestion=function(e){var t=n._getSuggestion(e);c.logger.logEvent(new d.AppSuggestionEvent("reject",t.Descriptor.Category));var a=n._getNonPreviewApp();n._appModel.setAppTemplate(a)},this._acceptSuggestion=function(e){var t=n._getSuggestion(e);c.logger.logEvent(new d.AppSuggestionEvent("accept",t.Descriptor.Category));var a=n._getNonPreviewApp();t.Commands.forEach((function(e){n._applyCommand(e,a)})),n._updateSettings(a),n._appModel.setAppTemplate(a),n._appWithoutPreview=l.default.cloneDeep(a)},this._previewSuggestion=function(e){var t=n._getSuggestion(e);c.logger.logEvent(new d.AppSuggestionEvent("preview",t.Descriptor.Category)),n._appWithoutPreview||(n._appWithoutPreview=l.default.cloneDeep(n._appModel.AppTemplate));var a=n._getNonPreviewApp();t.Commands.forEach((function(e){n._applyCommand(e,a)})),n._updateSettings(a),n._appModel.setAppTemplate(a)},this._getSuggestion=function(e){var t=e.SerializedSuggestion;try{return JSON.parse(t)}catch(t){return n._reportError("Failed to deserialize commands for "+e.SuggestionId),{Commands:[],Descriptor:{}}}},this._applyCommand=function(e,t){var a,r=e.Type,i=e.Path.ExpressionString,o=n._getValue(e);switch(r){case"ADD":if(a=l.default.get(t,i),!l.default.isArray(a))return void n._reportError("Expected array at '"+i+"'");a.push(o);break;case"CHANGE":l.default.set(t,i,o);break;default:n._reportError("Unexpected command type: "+r)}},this._getValue=function(e){if(!e)return null;var t=e.Value;if(!t)return t;var n=t.$type;return n&&String(n).startsWith("System.Collections.Generic.List")?t.$values:t},this._reportError=function(e){u.default.ReportError({errorMessage:e})},this._appModel=t}));t.AppSuggestions=y;var b=(0,i.default)((function e(t,n){var a=this;(0,o.default)(this,e),this._settingsTableDefn=function(){return m(a._appModel,(function(e){return"native"===e.ProviderName&&e.Name&&e.Name.startsWith("Settings_")}))},this._settingsSchema=function(){var e=a._settingsTableDefn();return e?a._appModel.FindSchema(e.SchemaName):null},this._isValid=function(){return a._appModel&&a._settingsTableDefn()&&a._settingsSchema()},this._objectPathCols=function(){var e=a._settingsSchema();return(0,f.$TSFixMeMaybeNull)(e),l.default.chain(e.Attributes).filter((function(e){return e.Name.endsWith("_ObjectPath")})).keyBy((function(e){return e.Name.replace("_ObjectPath","")})).value()},this._objectValueCols=function(){var e=a._settingsSchema();return(0,f.$TSFixMeMaybeNull)(e),l.default.chain(e.Attributes).filter((function(e){return e.Name.endsWith("_ObjectValue")})).keyBy((function(e){return e.Name.replace("_ObjectValue","")})).value()},this.HasTable=function(e){return a._isValid()&&e===a._settingsTableDefn().Name},this.Update=function(e){if(a._isValid()){var t=a._getSettingsChanges(e);a._stateReflector.ChangeAndRedisplay(t,!1,!0)}},this._getSettingsChanges=function(e){var t=e.row,n=a._appModel,r=a._objectPathCols(),i=a._objectValueCols();return l.default.keys(r).map((function(e){var a,o=r[e],l=i[e],u=t[l.Name],c=new s.default(l);if("Ref"===l.Type){var d=c.referencedTableName(),p=n.findTableCollection(d),h=p.table,v=p.tableSchema,m=h&&h.findRow(u);if(m)(0,f.$TSFixMeMaybeNull)(v),a=v.findAttributeByName("ObjectValue").valueFromWireFormat(m.ObjectValue)}else a=c.valueFromWireFormat(u);return{ObjectPath:t[o.Name],ObjectValue:a}}))},this._appModel=t,this._stateReflector=n||window.StateReflector}));t.AppSettings=b;var T=(0,i.default)((function e(t,n){var a=this;(0,o.default)(this,e),this._settingsTableDefn=function(){return m(a._appModel,(function(e){return"native"===e.ProviderName&&e.Name&&e.Name.startsWith(p.USER_SETTINGS_TABLE_NAME)}))},this._settingsSchema=function(){var e=a._settingsTableDefn();return e?a._appModel.FindSchema(e.SchemaName):null},this._isValid=function(){return a._appModel&&a._settingsTableDefn()&&a._settingsSchema()},this.HasTable=function(e){return a._isValid()&&e===a._settingsTableDefn().Name},this.Update=function(e){a._isValid()&&(a._localUserSettings=e.row,e.nextSteps.immediateSync=!0,e.nextSteps.enqueueChanges=!1)},this._appModel=t,this._stateReflector=n||window.StateReflector}));t.UserSettings=T;var S=(0,i.default)((function e(t){var n=this;(0,o.default)(this,e),this.Name="native",this._getTableManager=function(e){return l.default.find(n._tableManagers,(function(t){return t&&"function"==typeof t.HasTable&&t.HasTable(e)}))},this.OnLocalUpdateRow=function(e){if(e){(0,h.isUserSettingsTable)(e.tableName)||(0,u.doWeEverHitThis)("Unexpected native table update: ".concat(e.tableName));var t=n._getTableManager(e.tableName);return t?(e.nextSteps.updateAppTemplate=!0,t.Update(e)):void 0}},this.AppModel=t,this._tableManagers=[new b(t),new y(t),new T(t)]}));t.NativeProvider=S},946094:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.StatePropsThatDontImplyNavigation=t.StateModel=void 0,t.getPreviewAsEmail=function(){var e;try{if(null===(e=window.parent)||void 0===e?void 0:e.getPreviewAsEmail)return window.parent.getPreviewAsEmail();var t=(0,y.parseUrlQuery)();if(t.hasOwnProperty("previewAs"))return t.previewAs}catch(e){}return""},t.initializeStateModel=function(){JeeneeNamespace.StateModel=Q,JeeneeNamespace.Controllers=[]};var r=a(n(238416)),i=a(n(856690)),o=a(n(689728)),l=a(n(600861)),u=a(n(496486)),s=a(n(836808)),c=n(672023),d=a(n(571524)),f=a(n(180818)),p=a(n(112368)),h=a(n(593186)),v=a(n(143249)),m=a(n(365914)),g=a(n(498967)),y=n(646317),b=a(n(343625)),T=a(n(888861)),S=a(n(150198)),A=a(n(962553)),E=n(319598),w=n(307827),C=n(714067),O=n(263198),_=n(351101),k=n(75212),R=a(n(190644)),I=n(892148),N=n(166089),M=n(149313),D=n(557310),L=n(783252),P=n(864510);t.StatePropsThatDontImplyNavigation=["RowKey","selected","FilterExpr","UserDefinedFilters","UserDefinedFilterExpression"];var G={PAGE_PARAM:"page",TABLE_PARAM:"table",ROW_PARAM:"row",FILTER_PARAM:"filter",USER_DEFINED_FILTERS_PARAM:"userfilters",DEFAULTS_PARAM:"defaults",SORT_PARAM:"sort",GROUP_PARAM:"group",SELECTED_PARAM:"selected",QUICKEDIT_PARAM:"quickedit",VFE_FOCUSCOLUMN_PARAM:"vfe_focuscolumn",VFE_TIMESTAMP_PARAM:"vfe_ts",FreshControllerState:function(e){if(e||(e={}),e.TableName&&e.RefKeyAttr&&e.RefKeyValue){h.default.warnToDevConsole("View was initialized with RefKeyAttr/RefKeyValue, something needs migrating",e);var t=N.AppGlobals.AppModel.FindTableDefinition(e.TableName);if(!t)return;var n=N.AppGlobals.AppModel.FindSchema(t.SchemaName);if(!n)return;var a=n.Attributes.find((function(t){var n;return t&&t.IsValid&&t.Name.toLowerCase()===(null===(n=e.RefKeyAttr)||void 0===n?void 0:n.toLowerCase())}));e.FilterExpr=T.default.createColFilter(e.RefKeyValue,n,a?new S.default(a):void 0)}if(e.SortAttr&&!e.SortBy){h.default.warnToDevConsole("View was initialized with SortAttr, (likely the apptemplate is using old view options) ",e);var r=A.default.findByName(e.TableName).tableSchema;if(!r)return;var i=g.default.findSortInfo(r,e.SortAttr);(null==i?void 0:i.attribute)&&i.attribute.name()&&(e.SortBy=[{Column:i.attribute.name(),Order:i.inverted?"Descending":"Ascending"}])}return e.ItemId&&(e.RowKey=e.ItemId),e.isPopulated=!1,u.default.pick(e,["TableName","RowKey","FilterExpr","DefaultValues","GroupBy","SortBy","isPopulated"])},HashStateToControllerState:function(e,t){if("_table"in e&&(t.TableName=e._table),"_row"in e&&(t.RowKey=e._row),"_filterExpr"in e)try{var n=JSON.parse(e._filterExpr);t.FilterExpr=T.default.create(n)}catch(e){}if("_groupBy"in e)try{t.GroupBy=JSON.parse(e._groupBy)}catch(e){}if("_sortBy"in e)try{t.SortBy=JSON.parse(e._sortBy)}catch(e){}if(this.TABLE_PARAM in e&&(t.TableName=e[this.TABLE_PARAM]),this.ROW_PARAM in e&&(t.RowKey=e[this.ROW_PARAM]),this.SELECTED_PARAM in e)try{t.selected=JSON.parse(e[this.SELECTED_PARAM])}catch(e){}var a=[];if(this.FILTER_PARAM in e)try{var r=JSON.parse(e[this.FILTER_PARAM]);a.push(T.default.create(r))}catch(e){}if(this.USER_DEFINED_FILTERS_PARAM in e&&"dashboard"!==e[this.PAGE_PARAM])try{t.UserDefinedFilters=JSON.parse(e[this.USER_DEFINED_FILTERS_PARAM]);var i=(0,E.getFilterQuery)(null==t?void 0:t.Root,null==t?void 0:t.TableName,null==t?void 0:t.UserDefinedFilters).toExpression();a.push(i),t.UserDefinedFilterExpression=i}catch(e){h.default.ReportError({errorMessage:"Error in HashStateToControllerState",error:e})}if(t.FilterExpr=T.default.createAnd.apply(T.default,a),this.DEFAULTS_PARAM in e)try{var o=JSON.parse(e[this.DEFAULTS_PARAM]);t.DefaultValues=o}catch(e){}if(this.GROUP_PARAM in e)try{t.GroupBy=JSON.parse(e[this.GROUP_PARAM])}catch(e){}if(this.SORT_PARAM in e)try{t.SortBy=JSON.parse(e[this.SORT_PARAM])}catch(e){}if(this.QUICKEDIT_PARAM in e)try{t.QuickEdit=JSON.parse(e[this.QUICKEDIT_PARAM])}catch(e){}if(this.VFE_FOCUSCOLUMN_PARAM in e)try{t.vfeFocusColumn=e[this.VFE_FOCUSCOLUMN_PARAM]}catch(e){}if(this.VFE_TIMESTAMP_PARAM in e)try{t.vfeTimestamp=e[this.VFE_TIMESTAMP_PARAM]}catch(e){}},ControllerStateToHashState:function(e,t){var n;null!=e.TableName&&(t[this.TABLE_PARAM]=e.TableName),null!=e.RowKey&&(t[this.ROW_PARAM]=e.RowKey),null!=e.selected&&(t[this.SELECTED_PARAM]=e.selected);var a=e.FilterExpr,r=e.UserDefinedFilterExpression;if(null!=r&&null!=a){var i=null!==(n=a.children)&&void 0!==n?n:[];e.UserDefinedFilterExpression.isEqualTo(a)?a=null:"AND"===a.BoolType&&i.length&&(a=T.default.createAnd.apply(T.default,(0,l.default)(i.filter((function(e){return!e.isEqualTo(r)})))))}Array.isArray(e.UserDefinedFilters)&&e.UserDefinedFilters.length>0&&(t[this.USER_DEFINED_FILTERS_PARAM]=JSON.stringify(e.UserDefinedFilters)),null!=a&&(t[this.FILTER_PARAM]=JSON.stringify(a)),null!=e.DefaultValues&&(t[this.DEFAULTS_PARAM]=JSON.stringify(e.DefaultValues)),null!=e.GroupBy&&(t[this.GROUP_PARAM]=JSON.stringify(e.GroupBy)),null!=e.SortBy&&(t[this.SORT_PARAM]=JSON.stringify(e.SortBy)),null!=e.QuickEdit&&(t[this.QUICKEDIT_PARAM]=JSON.stringify(e.QuickEdit)),null!=e.vfeFocusColumn&&(t[this.VFE_FOCUSCOLUMN_PARAM]=e.vfeFocusColumn),null!=e.vfeTimestamp&&(t[this.VFE_TIMESTAMP_PARAM]=e.vfeTimestamp)},PopulateControllerStateFromControl:function(e,t,n){if(t&&(t.isPopulated=!0,e)){var a=N.AppGlobals.AppModel.NavStateForView(e,t.TableName);a&&(t.TableName||(t.TableName=a.TableName),t.TableName===a.TableName&&(t.RowKey||(t.RowKey=a.RowKey),t.FilterExpr||(t.FilterExpr=a.FilterExpr),t.GroupBy||(t.GroupBy=a.GroupBy),t.SortBy||(t.SortBy=a.SortBy),"function"==typeof n&&n(a)))}}},x="card",F="table",V="dashboard",U="search",B="deck",H="gallery",W="slideshow",j="detail",Y="chart",q="form",K="calendar",z="onboarding",J="iframe",Q=function(){function e(){var t;(0,i.default)(this,e),this.STATE_CHANGE_FORWARD=1,this.STATE_CHANGE_BACKWARD=2,this.CHANGE_MODE_PUSH="push",this.CHANGE_MODE_PUSH_RETAIN_SEARCH="push-retain-search",this.CHANGE_MODE_REPLACE="replace",this.CHANGE_MODE_REPLACE_BACK="replaceback",this.CHANGE_MODE_RESET="reset",this.SHOW_DRILLDOWN=x,this.SHOW_FASTTABLE=F,this.SHOW_DASHBOARD=V,this.SHOW_SEARCH=U,this.SHOW_DECK=B,this.SHOW_GALLERY=H,this.SHOW_SLIDESHOW=W,this.SHOW_DETAIL=j,this.SHOW_MAP="map",this.SHOW_CHART=Y,this.SHOW_FORM=q,this.SHOW_CALENDAR=K,this.SHOW_ONBOARDING=z,this.SHOW_IFRAME=J,this.CloseAfterNextSync=!1,this.GuestUserInformation={Id:0,Name:"Guest",AuthUserId:"guest",AuthUserEmail:"guest",AuthSource:"native",UserRole:"User"},this.SamplesUserInformation={Id:1,Name:"Justin A. Sample",AuthUserId:"sample",AuthUserEmail:"justin@sample.com",AuthSource:"native",UserRole:"User"},this.ControllerLookup=(t={},(0,r.default)(t,x,"card"),(0,r.default)(t,F,"fastTable"),(0,r.default)(t,V,"dashboard"),(0,r.default)(t,B,"deck"),(0,r.default)(t,H,"gallery"),(0,r.default)(t,W,"detail"),(0,r.default)(t,j,"detail"),(0,r.default)(t,"map","google-map"),(0,r.default)(t,Y,"graph"),(0,r.default)(t,q,"form"),(0,r.default)(t,U,"search"),(0,r.default)(t,K,"calendar"),(0,r.default)(t,z,"onboarding"),(0,r.default)(t,J,"iframe"),t),this.KnownStates={},this.NavigationStack=[],this.InvokingAppArray=[{displayName:"App Gallery",appName:C.APP_GALLERY_NAME,appId:C.APP_GALLERY_ID}],this.DefaultStateDefinition=G,this.ForceWipeUserData=!1,this.ForceRefreshAppDefinition=!1,this.UserInformation=void 0,this.CurrentUIState=void 0,this.AppTemplate=void 0,this.inAppStartup=!1,this.freshAppTemplateLoad=!1,this.removePageParameterRollout=!1,this.ReadUserInfoFromUStore(),void 0!==window.OTURLParams.wipe&&(this.ForceWipeUserData=!0),void 0!==window.OTURLParams.refresh&&(this.ForceRefreshAppDefinition=!0);for(var n=0;n<JeeneeNamespace.Controllers.length;n++){var a=JeeneeNamespace.Controllers[n];if(null==a)throw new Error("Invalid controller "+n);this.KnownStates[a.Name]=new a.StateDefinition}this.GoogleMapStateDef=this.KnownStates[this.ControllerLookup[this.SHOW_MAP]]}return(0,o.default)(e,[{key:"isLegacyAuthSource",value:function(){return"linkedin"===this.UserInformation.AuthSource||"native"===this.UserInformation.AuthSource}},{key:"getPreviousNavigationStackItem",value:function(){if(this.NavigationStack.length>=2){var e=this.NavigationStack[this.NavigationStack.length-2];return this.ParseStateFromHash(e.HashState)}return null}},{key:"getPreviousGroupByArray",value:function(e){return e&&(null==e?void 0:e.FastTableUIState)?e.FastTableUIState.GroupBy:null}},{key:"getPreviousGroupByColumnName",value:function(e){e||(e=this.getPreviousNavigationStackItem());var t=this.getPreviousGroupByArray(e);return t&&t.length>0?t[0].Column:null}},{key:"GetLastRunApp",value:function(){var e=b.default.getItem("LastRunApp");return null!=e&&""!==e&&"null"!==e?e:null}},{key:"SetLastRunApp",value:function(e){b.default.setItem("LastRunApp",e)}},{key:"Initialize",value:function(e,t){this.ReadUserInfoFromUStore(),N.AppGlobals.ViewManager.Clear(this.PreviousUIState),this.PreviousUIState=this.CurrentUIState,this.CurrentUIState={AppTemplateName:e},N.AppGlobals.ViewManager.Clear(this.PreviousUIState),this.PreviousUIState={},this.NavigationStack=[],this.AppTemplate={Name:e,Version:t},this.inAppStartup=!0}},{key:"SetDataContext",value:function(e){this.NavigationStack&&this.NavigationStack.length>0?this.NavigationStack[this.NavigationStack.length-1].DataContext=e:h.default.logToDevConsole("Setting data context with an empty nav stack!")}},{key:"DebugPrint",value:function(){var e="\t AppTemplate:: "+(this.AppTemplate&&this.AppTemplate.Name);return e+="\t UserInfo:: Id= "+this.UserInformation.Id+"\n",e+="\t UIState:: "+JSON.stringify(this.CurrentUIState)+"\n",e+="\t Location:: "+I.WindowWrapper.location+"\n"}},{key:"SetActiveControl",value:function(e,t,n){if(null!=e){"slideshow"===e.Action&&(e.Action="detail");var a=(0,_.getAppModel)(),r=a.FindTable(e.TableOrFolderName);if(null!=r){N.AppGlobals.AppState.ActiveControl=e;var i=t(e,a.NavStateForView(e,r.Name));"form"===e.Action||n?N.AppGlobals.AppState.PushState(i):N.AppGlobals.AppState.ResetState(i)}}}},{key:"AugmentCurrentState",value:function(e,t){var n=this.NavigationStack.length;if(n>0){var a=this.NavigationStack[n-1],r=this.ParseHash(a.HashState);r[e]!==t&&(r[e]=t,a.HashState=(0,y.sortedParams)(r),this.SetLocationHash(a.HashState,N.AppGlobals.AppState.CHANGE_MODE_REPLACE))}}},{key:"AugmentCurrentStateWithSearch",value:function(e,t){t=t||{};var n=this.NavigationStack.length;if(n>0){var a=this.NavigationStack[n-1],r=this.ParseHash(a.HashState);r.search!==e&&(r.search=e,a.HashState=(0,y.sortedParams)(r),t.updateHash&&this.SetLocationHash(a.HashState,N.AppGlobals.AppState.CHANGE_MODE_REPLACE))}}},{key:"GetCurrentStateSelection",value:function(){var e=this.NavigationStack.length;if(e>0){var t=this.NavigationStack[e-1],n=this.ParseHash(t.HashState).selected;if(!n)return null;try{return JSON.parse(n)}catch(e){return null}}return null}},{key:"AugmentCurrentStateWithSelection",value:function(e){var t=this.NavigationStack.length;if(t>0){var n=this.NavigationStack[t-1],a=this.ParseHash(n.HashState);a.selected=JSON.stringify(e);var r=(0,y.sortedParams)(a);this.SetLocationHash(r,N.AppGlobals.AppState.CHANGE_MODE_REPLACE)}}},{key:"ChoosePreviousState",value:function(e){this.StateChangeDirection=this.STATE_CHANGE_BACKWARD;var t=N.AppGlobals.AppState.CurrentUIState.Root;this.NavigationStack.pop();var n=this.NavigationStack[this.NavigationStack.length-1],a=(null==n?void 0:n.HashState)||"",r=this.ParseHash(a),i=r.page;if(""!==a&&(null!=i&&"empty"!==i||r.view))n.AppTemplateName!==N.AppGlobals.AppModel.AppTemplate.Name?this.PushState({Root:"empty"}):(n.scrollTop&&(this.restoreScrollPosition=n.scrollTop),this.SetWindowHash(n.HashState));else if("form"===t)if(e)this.ActiveControl=null,this.ResetState({});else{var o,l,u,s,c;N.AppGlobals.AppModel.AppTemplate.Presentation.Controls.filter((function(e){return e.IsValid&&"form"!==e.Action&&null!=N.AppGlobals.AppModel.DisplayActions[e.Action]})).forEach((function(e){e.Name===N.AppGlobals.AppModel.AppTemplate.Presentation.DefaultStartView&&(o=e),e.Position===N.AppGlobals.AppModel.POSITION_LEFT&&(l=e),e.Position===N.AppGlobals.AppModel.POSITION_RIGHT&&(u=e),e.Position===N.AppGlobals.AppModel.POSITION_CENTER&&(s=e),e.Position===N.AppGlobals.AppModel.POSITION_MENU&&(c=e)}));var d=o||l||u||s||c;d?N.AppGlobals.AppState.SetActiveControl(d,InputHandler.rootStateForControl):(this.ActiveControl=null,this.ResetState({Root:"empty"}))}else this.ActiveControl=null,this.ResetState({Root:"empty"})}},{key:"ComputeStringHash",value:function(e){return c.sha256.hmac("1234567890",""+e).substr(0,6)}},{key:"InvokingAppVisibilityMode",value:function(){var e,t=u.default.last(this.InvokingAppArray);return(null==t?void 0:t.appId)!==C.APP_GALLERY_ID?"visible":d.default.IsEditorIFramePreview()?"disabled":p.default.IsWhitelabelBrowser()||(null===(e=N.AppGlobals.AppModel)||void 0===e?void 0:e.IsWhitelabelApp())?"hidden":"visible"}},{key:"SwitchToLoginPage",value:function(e,t,n){if(t&&h.default.logToDevConsole("Switching to login page: "+t),d.default.IsIFrame())h.default.ReportErrorOnce({errorMessage:"Unexpected SwitchToLoginPage from iframe preview"});else{this.ClearUserInfoInUStore(),window.QuiesceApp=!0,null!=N.AppGlobals.ViewManager&&N.AppGlobals.ViewManager.ShowLoginInfoPage();var a=this.GetLocationHash();a.indexOf("mainprotocol")<0&&(null!=a&&""!==a&&(a+="&"),a+="_mainprotocol="+OneTrackProtocol);var r="?returnUrl="+encodeURIComponent(I.WindowWrapper.location.pathname+I.WindowWrapper.location.search);null!=e&&e.length>0&&(r+="&provider="+e),n&&(r+="&appId="+n),null!=p.default.IsIOSAppWithMinVersion&&p.default.IsIOSAppWithMinVersion(6.3)&&O.JeeneeBrowserAPI.clearCookiesIOS(),null!=p.default.IsAndroidAppWithMinVersion&&p.default.IsAndroidAppWithMinVersion(6.4)&&!d.default.IsUnsupportedAndroidVersion()&&window.JeeneeAndroid.clearCookies(),R.default.removeAllListeners(),I.WindowWrapper.location.href="//"+I.WindowWrapper.location.host+"/Account/Login"+r+"#"+a}}},{key:"SaveUserInfoToUStore",value:function(){if(1!==this.UserInformation.Id){var e=new Date,t=m.default.addDays(e,28),n={UserInfo:this.UserInformation,ExpiryTime:t},a=JSON.stringify(n);b.default.setItem("JeeneeUserInfo",a)}}},{key:"SaveUserRole",value:function(e){this.UserInformation.UserRole=e,null!=(0,P.readUserInfoFromCookie)()?(0,P.updateUserInfoCookie)(this.UserInformation):this.SaveUserInfoToUStore()}},{key:"ReadUserInfoFromUStore",value:function(){var e=(0,P.readUserInfoFromCookie)();if(null==e){var t=b.default.getItem("JeeneeUserInfo");if(null==t||""===t||"null"===t){var n=s.default.get("STARTWITHTOKEN");if(n){var a=(0,y.parseQuery)(n);this.UserInformation={Id:a.id,Name:a.name,AuthUserId:a.email,AuthUserEmail:a.email,AuthSource:"native"}}else this.SetGuestUser()}else{var r=JSON.parse(t);null!=r.UserInfo.AuthTokenExpiryTime&&(r.UserInfo.AuthTokenExpiryTime=new Date(r.UserInfo.AuthTokenExpiryTime+" UTC")),this.UserInformation=r.UserInfo}}else this.UserInformation=e}},{key:"SetGuestUser",value:function(){this.UserInformation=this.GuestUserInformation}},{key:"SetSamplesUser",value:function(){this.UserInformation=this.SamplesUserInformation}},{key:"ClearUserInfoInUStore",value:function(){b.default.setItem("JeeneeUserInfo",null),this.DeleteCookie()}},{key:"IsAuthenticatedUser",value:function(e){var t=this.UserInformation;return null!=t&&"Id"in t&&"Name"in t&&"AuthUserId"in t&&"AuthUserEmail"in t&&(0!==t.Id||!e)}},{key:"DeleteCookie",value:function(){s.default.remove(""),(0,P.removeUserInfoCookie)()}},{key:"GetLocationHash",value:function(){return this.ExtractHashFromUrl(I.WindowWrapper.location.href)}},{key:"ExtractHashFromUrl",value:function(e){return e.split("#")[1]||""}},{key:"SetCurrentTemplate",value:function(e){this.AppTemplate.Id!==e.Id&&(this.AppTemplate.Id=e.Id),this.AppTemplate.Name!==e.Name&&(this.AppTemplate.Name=e.Name)}},{key:"LogUserIdentity",value:function(e){try{if(0!==this.UserInformation.Id){var t=e.Behavior.AuthRequired?this.UserInformation.Id.toString():null;null!=f.default.LogNewUser&&f.default.LogNewUser(t),t?f.default.identify(t,{$email:this.UserInformation.AuthUserEmail,$last_login:new Date,$name:this.UserInformation.Name,$username:this.UserInformation.Id,AuthSource:this.UserInformation.AuthSource,AuthUserId:this.UserInformation.AuthUserEmail}):null!=f.default.ForgetUserIdentity&&f.default.ForgetUserIdentity(null)}}catch(e){h.default.warnToDevConsole(e)}}},{key:"OnAppTemplateLoad",value:function(e){h.default.AddTraceContext("AppState.OnAppTemplateLoad",{Id:e.Id,Name:e.Name}),this.inAppStartup=!1,this.freshAppTemplateLoad=!0,this.LogUserIdentity(e),this.SetCurrentTemplate(e),this.removePageParameterRollout=v.default.get("removePageParameter").includeByOwner(e),w.onAppTemplateLoadCallbacks.run()}},{key:"SetLocationHash",value:function(e,t){var n,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.freshAppTemplateLoad&&(this.freshAppTemplateLoad=!1),this.inAppStartup)this.inAppStartup=!1;else{var r={HashState:e,AppTemplateName:N.AppGlobals.AppModel.AppTemplate.Name};if("reset"===t||0===this.NavigationStack.length)this.NavigationStack=[r];else if(t===N.AppGlobals.AppState.CHANGE_MODE_REPLACE||t===N.AppGlobals.AppState.CHANGE_MODE_REPLACE_BACK)this.NavigationStack[this.NavigationStack.length-1]=r;else{var i,o,l=$(".ActivePage").data("reactView");if((null===(n=null==l?void 0:l.component)||void 0===n?void 0:n.getScrollContainer)&&(o=null==(i=l.component.getScrollContainer())?void 0:i.scrollTop),o){var u=this.NavigationStack[this.NavigationStack.length-1];u&&(u.scrollTop=o)}this.NavigationStack.push(r)}}this.StateChangeDirection=t===N.AppGlobals.AppState.CHANGE_MODE_REPLACE_BACK?this.STATE_CHANGE_BACKWARD:this.STATE_CHANGE_FORWARD,a&&this.SetWindowHash(e)}},{key:"SetWindowHash",value:function(e){if(d.default.IsIFramePreview()){var t=(null===parent||void 0===parent?void 0:parent.window)?parent.window.pageYOffset:0;I.WindowWrapper.location.replace(I.WindowWrapper.location.href.split("#")[0]+"#"+e),(null===parent||void 0===parent?void 0:parent.window)&&parent.window.scrollTo(parent.window.pageXOffset,t)}else I.WindowWrapper.location.hash=e}},{key:"ComputeHash",value:function(e){var t,n,a={},r=e;if(null!=r){null==r.Root||this.removePageParameterRollout&&null!=r.ControlName||(a.page=r.Root),null!=r.ControlName&&(a.view=r.ControlName),null!=r.AppTemplateName&&(a.appName=r.AppTemplateName),null!=r.SearchTerm&&(a.search=r.SearchTerm),null!=r.MinDataStamp&&(a.at=r.MinDataStamp);var i=null===(t=this.GetSpecificState(r))||void 0===t?void 0:t.UserDefinedFilters;null!=i&&(a[this.DefaultStateDefinition.USER_DEFINED_FILTERS_PARAM]=JSON.stringify(i));var o=N.AppGlobals.AppState.KnownStates[r.Root];void 0!==o?"function"==typeof o.FillStateObject&&o.FillStateObject(r,a):D.ReactRootUIConfig.isReactRoot()&&G.ControllerStateToHashState(null!==(n=r[L.SPECIFIC_STATE_NAME_MAP[r.Root]])&&void 0!==n?n:{},a)}return(0,y.sortedParams)(a)}},{key:"MutateState",value:function(e,t,n,a){if(null==this.UserInformation||null==this.UserInformation.Id)return alert("Unauthenticated user ---- cannot proceed. Login as a valid user."),void this.SwitchToLoginPage(null,"user information not available",this.AppTemplate.Id);t===N.AppGlobals.AppState.CHANGE_MODE_PUSH_RETAIN_SEARCH&&(e.SearchTerm=N.AppGlobals.AppState.CurrentUIState.SearchTerm,t=N.AppGlobals.AppState.CHANGE_MODE_PUSH),e.SearchTerm||StateReflector.EndSearch(!0);var r=this.CurrentUIState?this.GetSpecificState(this.CurrentUIState):null,i=e?this.GetSpecificState(e):null,o=(null==r?void 0:r.TableName)===(null==i?void 0:i.TableName),l=Boolean((null==r?void 0:r.UserDefinedFilters)&&!(null==i?void 0:i.UserDefinedFilters)),u="dashboard"===(null==e?void 0:e.Root);o&&l&&i&&!u&&(i.UserDefinedFilters=null==r?void 0:r.UserDefinedFilters),e.AppTemplateName=this.AppTemplate.Name;var s=this.ComputeHash(e);this.ChangeRawUrlHash(s,t,n)}},{key:"PushState",value:function(e,t){this.MutateState(e,t?N.AppGlobals.AppState.CHANGE_MODE_PUSH_RETAIN_SEARCH:N.AppGlobals.AppState.CHANGE_MODE_PUSH)}},{key:"ReplaceState",value:function(e,t){this.MutateState(e,t?N.AppGlobals.AppState.CHANGE_MODE_REPLACE_BACK:N.AppGlobals.AppState.CHANGE_MODE_REPLACE)}},{key:"ResetState",value:function(e,t){this.MutateState(e,N.AppGlobals.AppState.CHANGE_MODE_RESET,t)}},{key:"PushViewForResult",value:function(e,t,n,a,r,i,o){var l=this.NavigationStack[this.NavigationStack.length-1];l&&(l.pendingResult={context:e,requestId:t}),this.PushView(n,a,r,i,o)}},{key:"ReturnResult",value:function(e){var t=this.NavigationStack[this.NavigationStack.length-2];if(null==t?void 0:t.pendingResult){var n=t.pendingResult.context;n&&"function"==typeof n.onPushViewResult&&n.onPushViewResult(t.pendingResult.requestId,e),delete t.pendingResult}}},{key:"PushView",value:function(e,t,n,a,r,i){var o=i||(a?N.AppGlobals.AppState.CHANGE_MODE_PUSH_RETAIN_SEARCH:N.AppGlobals.AppState.CHANGE_MODE_PUSH);if(n.TableName){var l=r;if(!l){var u=N.AppGlobals.AppModel.FindControlsForTable(n.TableName,e,t);u.length&&(l=u[0])}if(l){var s=N.AppGlobals.AppModel.FindTable(n.TableName);if(s){var c=N.AppGlobals.AppModel.NavStateForView(l,s.Name),d=this.ExtendAppState(c,n),f=InputHandler.rootStateForControl(l,d);return void this.MutateState(f,o)}}var p=N.AppGlobals.AppState.KnownStates[e].CreateRootState(n);this.MutateState(p,o)}else h.default.warnToDevConsole("No TableName was given to MutateView",n)}},{key:"ExtendAppState",value:function(e,t){var n=u.default.pick(t,["ItemId","GroupBy","SortBy","FilterExpr","DefaultValues","CurrentLat","CurrentLng","RefKeyAttr","RefKeyValue","RowKey","detailContentColumn"]);return u.default.extend(u.default.clone(t),e,n)}},{key:"IsTopLevel",value:function(){return this.NavigationStack.length<=1}},{key:"ChangeRawUrlHash",value:function(e,t,n){this.GetLocationHash()!==e?this.SetLocationHash(e,t,n):$("#header").trigger("staterefresh")}},{key:"ResetCurrentUIState",value:function(){var e=this.GetLocationHash(),t=this.SetCurrentUIStateFromHash(e),n=(0,_.getAppModel)();if(e&&!this.NavigationStack.length){var a={HashState:e,AppTemplateName:n.AppTemplate.Name};this.NavigationStack=[a]}return t}},{key:"ParseHash",value:function(e){return(0,k.parseHash)(e)}},{key:"SetCurrentUIStateFromHash",value:function(e){return this.PreviousUIState=this.CurrentUIState,e?(this.CurrentUIState=this.ParseStateFromHash(e),this.CurrentUIState):null}},{key:"ParseStateFromHash",value:function(e){var t={};if(!e)return null;var n=this.ParseHash(e);if(t.Hash=e,t.DataStamp=AppModel.DataStamp,null!=n.view?t.ControlName=n.view:null!=n.control?t.ControlName=n.control:null!=n._control&&(t.ControlName=n._control),t.Root=n.page,null!=n._page&&(t.Root=n._page),"slideshow"===t.Root&&(t.Root="detail"),n.table&&!t.ControlName){var a=N.AppGlobals.AppModel.FindControlsForTable(n.table,t.Root,!1);"map"===t.Root&&n.mapcolumn&&(a=a.filter((function(e){var t=N.AppGlobals.AppModel.appTemplate.getViewDefinition(e.Name);return!!t&&(n.mapcolumn===t.MapColumn||n.table===t.SecondaryTable&&n.mapcolumn===t.SecondaryColumn)}))),a.length&&(t.ControlName=a[0].Name)}if(!t.Root&&(t.Root=this.SHOW_FASTTABLE,t.ControlName)){var r=N.AppGlobals.AppModel.FindControl(t.ControlName);r&&((0,M.$TSFixMeMaybeNull)(r.Action),t.Root=this.ControllerLookup[r.Action])}t.Root&&this.ControllerLookup[t.Root]&&(t.Root=this.ControllerLookup[t.Root]),t.SearchTerm=n.search,null!=n._searchTerm&&(t.SearchTerm=n._searchTerm),null!=n.appName&&(t.AppTemplateName=n.appName),null!=n._appName&&(t.AppTemplateName=n._appName),null!=n.at&&(t.MinDataStamp=n.at);var i=N.AppGlobals.AppState.KnownStates[t.Root];return void 0!==i&&("function"==typeof i.ResetUIState&&i.ResetUIState(t),"function"==typeof i.ProcessStateObject&&i.ProcessStateObject(t,n)),t}},{key:"GetSpecificState",value:function(e){var t,n=N.AppGlobals.AppState.KnownStates[null!==(t=e.Root)&&void 0!==t?t:""];return void 0!==n&&"function"==typeof n.GetSpecificState?n.GetSpecificState(e):null}},{key:"SetPendingFormState",value:function(e,t){this.pendingFormState=e,this.pendingFormCancelFn=t}},{key:"ClearPendingFormState",value:function(){delete this.pendingFormState,delete this.pendingFormCancelFn}}]),e}();t.StateModel=Q},851353:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.contentHovered=function(e){var t;return v(this,void 0,void 0,r.default.mark((function n(){return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(p.default.maybeLog("App Editor Link - From App","emulator-interaction-event","hover",e),!h.dynamicRollouts.includeByUserId("EERenderOutlinesInApp")){n.next=5;break}(null===(t=window.parent)||void 0===t?void 0:t.reduxStore)&&window.parent.reduxStore.dispatch({type:"editingEmulator/setHoveredElement",payload:e}),n.next=7;break;case 5:return n.next=7,g().postMessage({name:"emulator-interaction-event",event:"hover",data:e});case 7:case"end":return n.stop()}}),n)})))},t.disconnectBroadcastChannel=function(){return v(this,void 0,void 0,r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=4;break}return e.next=3,m.close();case 3:m=null;case 4:case"end":return e.stop()}}),e)})))},t.handleReflectChangeEvent=T,t.isDesktopEmulator=t.isAnyEmulator=void 0,t.listenForEditorEvents=function(e){b()&&(t=new URL(c.WindowWrapper.location.toString()),(n=new URLSearchParams(t.search)).delete("preview"),t.search=n.toString(),c.WindowWrapper.history.replaceState({},"",t.toString()));var t,n;g(e).addEventListener("message",(function(e){var t,n,a,r,i,o;switch(e.name){case"reflect-change":p.default.maybeLog("App Editor Link - From Editor",e.name,{Id:null===(n=null===(t=e.data)||void 0===t?void 0:t.appTemplate)||void 0===n?void 0:n.Id,Version:null===(r=null===(a=e.data)||void 0===a?void 0:a.appTemplate)||void 0===r?void 0:r.Version,LastModified:null===(o=null===(i=e.data)||void 0===i?void 0:i.appTemplate)||void 0===o?void 0:o.LastModified}),T(e);break;case"sync-requested":p.default.maybeLog("App Editor Link - From Editor",e.name),window.StateReflector.RefreshAppData({initiatedBy:"Editor"});break;case"reload-emulator":p.default.maybeLog("App Editor Link - From Editor",e.name),function(e){var t=e.data.version,n=location.href,a=new URL(n);a.searchParams.set("preview","2"),t&&(a.searchParams.set("version",t),n=a.toString());n===location.href?c.WindowWrapper.location.reload():c.WindowWrapper.location.href=n}(e);break;case"toggle-edit":p.default.maybeLog("App Editor Link - From Editor",e.name,e.data),function(e){e.data.enable?f.default.attach():f.default.detach()}(e);break;case"highlight-item":p.default.maybeLog("App Editor Link - From Editor",e.name,e.data),f.default.highlightItem(e.data.id)}}))},t.sendEmulatorPingMessage=function(e){return v(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p.default.maybeLog("App Editor Link - From App",e),t.next=3,g().postMessage({name:e});case 3:case"end":return t.stop()}}),t)})))};var r=a(n(364687)),i=n(938437),o=a(n(819433)),l=n(692479),u=n(557310),s=n(759265),c=n(892148),d=n(276891),f=a(n(713903)),p=a(n(890468)),h=n(44617),v=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},m=null;function g(e){var t="app-editor-".concat(e);return null!=m?m:m=new i.BroadcastChannel(t)}var y=function(){return new URLSearchParams(c.WindowWrapper.location.search).get("preview")===d.PreviewType.Authenticated};t.isAnyEmulator=y;var b=function(){return y()&&window===window.top};function T(e){var t=e.data,n=t.appTemplate,a=t.deepLink,r=t.dataByName;if(u.ReactRootUIConfig.isReactRoot()){if(window.StateReflector.UpdateAppTemplate(n,null,r),a){var i=(0,s.hashStringToUIState)(a);(0,o.default)().dispatch((0,l.newViewStack)({Identifier:{Type:"Control",Name:i.ControlName}}))}}else window.StateReflector.UpdateAppTemplate(n,a,r)}t.isDesktopEmulator=b},161822:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.broadcastChangeToApp=function(e,t,n){return s(this,void 0,void 0,r.default.mark((function a(){var i;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=f(),a.next=3,i.postMessage({name:"reflect-change",data:{appTemplate:e,deepLink:t,dataByName:n}});case 3:case"end":return a.stop()}}),a)})))},t.broadcastEmulatorEditMode=function(e){return s(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f().postMessage({name:"toggle-edit",data:{enable:"edit"===e}});case 2:case"end":return t.stop()}}),t)})))},t.broadcastHighlightItem=function(e){return s(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f().postMessage({name:"highlight-item",data:{id:e}});case 2:case"end":return t.stop()}}),t)})))},t.broadcastReloadEmulator=function(e){return s(this,void 0,void 0,r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f(),t.next=3,n.postMessage({name:"reload-emulator",data:{version:e}});case 3:case"end":return t.stop()}}),t)})))},t.broadcastSyncEmulator=function(){return s(this,void 0,void 0,r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f(),e.next=3,t.postMessage({name:"sync-requested",data:null});case 3:case"end":return e.stop()}}),e)})))},t.disconnectBroadcastChannel=function(){return s(this,void 0,void 0,r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=4;break}return e.next=3,c.close();case 3:c=null;case 4:case"end":return e.stop()}}),e)})))},t.getBroadcastChannelForTestingOnly=function(){return f()},t.isCloningApp=function(){try{return window.parent.isCloning}catch(e){}return!1},t.listenForAppEvents=function(e){return s(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:f().addEventListener("message",(function(t){switch(t.name){case"emulator-interaction-event":if("hover"===t.event)e.dispatch((0,o.setHoveredElement)(t.data));break;case l.EmulatorPingEventName.SyncSucceeded:case l.EmulatorPingEventName.SyncFailed:e.dispatch((0,u.setEmulatorIsSyncing)(!1))}}));case 1:case"end":return t.stop()}}),t)})))};var r=a(n(364687)),i=n(938437),o=n(160647),l=n(276891),u=n(665684),s=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},c=null,d=window.APP_ID;function f(){var e="app-editor-".concat(window.APP_ID);return d===window.APP_ID||(c=null,d=window.APP_ID),null!=c?c:c=new i.BroadcastChannel(e)}},713903:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(856690)),i=a(n(689728)),o=a(n(364687)),l=a(n(496486)),u=n(166089),s=n(851353),c=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function l(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}u((a=a.apply(e,t||[])).next())}))},d="\n  [data-vfe-active]::after {\n    background-color: rgba(41, 98, 255);\n    opacity: 0;\n    animation-duration: ".concat(1e3,"ms;\n    animation-name: highlight;\n    animation-iteration-count: ").concat(2,';\n    display: block;\n    content: "";\n    position: absolute;\n    right: -10px;\n    top: 0;\n    left: -10px;\n    bottom: 0;\n    z-index: 1000;\n  }\n\n  [data-vfe-active-testing]::after {\n    opacity: 0.2;\n    animation: none;\n  }\n  \n  @keyframes highlight {\n    from {\n      opacity: 0;\n    }\n    15% {\n      opacity: 0.2;\n      box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7);\n    }\n    50% {\n      opacity: 0.2;\n      box-shadow: 0 0 0 10px rgba(0, 0, 0, 0);\n    }\n    65% {\n      opacity: 0;\n    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);\n    }\n    to {\n      opacity: 0;\n    }\n  }\n'),f=function(e){return new Promise((function(t){return setTimeout(t,e)}))},p=function(e,t){return c(void 0,void 0,void 0,o.default.mark((function n(){var a,r;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=Date.now();case 1:if(!(Date.now()-a<t)){n.next=9;break}return n.next=4,f(50);case 4:if(null,!(r=e())){n.next=7;break}return n.abrupt("return",r);case 7:n.next=1;break;case 9:return n.abrupt("return",null);case 10:case"end":return n.stop()}}),n)})))},h=function(e){return c(void 0,void 0,void 0,o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){setTimeout((function(){var n=Object.assign(Object.assign({},u.AppGlobals.AppState.CurrentUIState),{FormUIState:Object.assign(Object.assign({},u.AppGlobals.AppState.CurrentUIState.FormUIState),{vfeFocusColumn:e,vfeTimestamp:Date.now()})});u.AppGlobals.AppState.ReplaceState(n),t(null)}))})));case 1:case"end":return t.stop()}}),t)})))},v=new(function(){function e(){var t=this;(0,r.default)(this,e),this.isAttached=!1,this.highlightStylesheetEle=null,this.lastHoveredEle=null,this.focusFn=null,this.onMouseOver=function(e){for(var n=e.target;null!=n&&(!n.hasAttribute("data-vfe-interactive")||"true"!==n.getAttribute("data-vfe-interactive"));)n=n.parentElement;if(n!==t.lastHoveredEle){var a=n?t.generateContext(n):null;t.contentHovered(a),t.lastHoveredEle=n}},this.contentHovered=l.default.debounce((function(e){(0,s.contentHovered)(e)}),100),this.recalculateActiveElement=l.default.debounce((function(){var e=t.lastHoveredEle?t.generateContext(t.lastHoveredEle):null;t.contentHovered(e)}),50),this.highlightItem=function(e){return c(t,void 0,void 0,o.default.mark((function t(){var n,a,r,i,l,s;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.highlightStylesheetEle||(this.attachHighlightStylesheet(),a=this.focusFn=HTMLElement.prototype.focus,HTMLElement.prototype.focus=function(e){window.document.activeElement!==window.document.body&&a.call(this,e)}),e.control?u.AppGlobals.AppState.CurrentUIState.ControlName!==e.control&&(r="#control=".concat(encodeURIComponent(e.control)),u.AppGlobals.StateChangeHandler.SwitchApp(r)):e.root&&e.table&&(u.AppGlobals.AppState.CurrentUIState.Root===e.root&&(null===(n=u.AppGlobals.AppState.CurrentUIState.FormUIState)||void 0===n?void 0:n.TableName)===e.table||(i="#table=".concat(encodeURIComponent(e.table))+"&page=".concat(encodeURIComponent(e.root)),u.AppGlobals.StateChangeHandler.SwitchApp(i))),s=null,s=(l=function(){return e.column?document.querySelector('[data-vfe-column="'.concat(e.column,'"]')):e.control?document.querySelector('[data-vfe-control="'.concat(e.control,'"]')):null})()){t.next=10;break}return t.next=7,h(e.column);case 7:return t.next=9,p(l,1e3);case 9:s=t.sent;case 10:if(s){t.next=12;break}return t.abrupt("return",!1);case 12:return void 0!==s.scrollIntoViewIfNeeded?s.scrollIntoViewIfNeeded():s.scrollIntoView(),s.setAttribute("data-vfe-active","1"),window.APPSHEET_TEST_CONTEXT&&s.setAttribute("data-vfe-active-testing","1"),t.next=17,f(2e3);case 17:return s.removeAttribute("data-vfe-active"),t.abrupt("return",!0);case 19:case"end":return t.stop()}}),t,this)})))}}return(0,i.default)(e,[{key:"generateContext",value:function(e){for(var t,n,a,r,i,o,l=e,u=null,s=void 0,c=void 0,d=void 0,f=void 0,p=void 0,h=void 0;l;)!u&&l.hasAttribute("data-vfe-interactive")&&(u=l),s=l.hasAttribute("data-vfe-column")&&void 0===s?null!==(t=l.getAttribute("data-vfe-column"))&&void 0!==t?t:void 0:s,c=l.hasAttribute("data-vfe-table")&&void 0===c?null!==(n=l.getAttribute("data-vfe-table"))&&void 0!==n?n:void 0:c,d=l.hasAttribute("data-vfe-control")&&void 0===d?null!==(a=l.getAttribute("data-vfe-control"))&&void 0!==a?a:void 0:d,f=l.hasAttribute("data-vfe-root")&&void 0===f?null!==(r=l.getAttribute("data-vfe-root"))&&void 0!==r?r:void 0:f,p=l.hasAttribute("data-vfe-action")&&void 0===p?null!==(i=l.getAttribute("data-vfe-action"))&&void 0!==i?i:void 0:p,h=l.hasAttribute("data-vfe-context")&&void 0===h?null!==(o=l.getAttribute("data-vfe-context"))&&void 0!==o?o:void 0:h,l=l.parentElement;if(null==u)return null;var v=$(u);return{id:{column:s,table:c,control:d,root:f,action:p,context:h},loc:Object.assign(Object.assign({},v.offset()),{width:v.outerWidth(!0),height:v.outerHeight(!0)})}}},{key:"attachHighlightStylesheet",value:function(){this.highlightStylesheetEle||(this.highlightStylesheetEle=document.createElement("style"),this.highlightStylesheetEle.textContent=d,document.head.appendChild(this.highlightStylesheetEle))}},{key:"attach",value:function(){this.isAttached||(this.isAttached=!0,document.addEventListener("mouseover",this.onMouseOver,!0),document.addEventListener("scroll",this.recalculateActiveElement,!0),document.addEventListener("animationend",this.recalculateActiveElement),document.addEventListener("transitionend",this.recalculateActiveElement))}},{key:"detach",value:function(){this.isAttached&&(this.isAttached=!1,document.removeEventListener("mouseover",this.onMouseOver,!0),document.removeEventListener("scroll",this.recalculateActiveElement,!0),document.removeEventListener("animationend",this.recalculateActiveElement),document.removeEventListener("transitionend",this.recalculateActiveElement),this.focusFn&&(HTMLElement.prototype.focus=this.focusFn,this.focusFn=null))}}]),e}());t.default=v},276891:(e,t)=>{"use strict";var n,a;Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewType=t.EmulatorPingEventName=void 0,t.PreviewType=n,function(e){e.Anonymous="1",e.Authenticated="2"}(n||(t.PreviewType=n={})),t.EmulatorPingEventName=a,function(e){e.SyncFailed="sync-failed-event",e.SyncSucceeded="sync-succeeded-event"}(a||(t.EmulatorPingEventName=a={}))},399713:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Drz=void 0,t.getDrz=function(){if("eu.appsheet.com"===r.WindowWrapper.location.hostname)return a.EU;return a.GLOBAL};var a,r=n(892148);t.Drz=a,function(e){e.EU="EU",e.GLOBAL="GLOBAL"}(a||(t.Drz=a={}))},287375:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setModals=t.setModalInProgress=t.pushModal=t.popModal=t.clearModalsUntil=t.ModalSettingsActionTypes=void 0;var n={PUSH_MODAL:"PUSH_MODAL",POP_MODAL:"POP_MODAL",SET_MODALS:"SET_MODALS",SET_MODAL_IN_PROGRESS:"SET_MODAL_IN_PROGRESS",CLEAR_MODALS_UNTIL:"CLEAR_MODALS_UNTIL"};t.ModalSettingsActionTypes=n;t.pushModal=function(e){return Object.assign({type:n.PUSH_MODAL},e)};t.popModal=function(){return{type:n.POP_MODAL}};t.setModals=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{modals:[]},t=e.modals;return{type:n.SET_MODALS,modals:t}};t.clearModalsUntil=function(e){return{type:n.CLEAR_MODALS_UNTIL,predicate:e}};t.setModalInProgress=function(e){return{type:n.SET_MODAL_IN_PROGRESS,value:e}}},235049:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autoConnect=function(){n=!0},t.autoDisconnect=function(){n=!1},t.isConnected=function(){return n};var n=!0},84690:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeHref=function(e){if(function(e){return/^[^:]*([/?#]|$)/.test(e)}(e=(e||"").trim()))return e;var t=e.indexOf(":"),n=e.slice(0,t).toLowerCase();if(!n||/[^a-z]/.test(n)||i.has(n))return"http"+e.slice(t);o.has(n)||r.default.ReportErrorOnce({errorMessage:"Unknown scheme in sanitizeHref",scheme:n,href:e});return e};var r=a(n(593186));var i=new Set(["javascript"]),o=new Set(["comgooglemapsurl","deapp","http","https","intent","mailto","oneqa","sms","tel","whatsapp"])},149313:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$TSFixMeMaybeNull=function(e){}},882901:(e,t,n)=>{"use strict";var a=n(564836);Object.defineProperty(t,"__esModule",{value:!0}),t.addIsOpen=function(e,t){var n;return Object.assign(Object.assign({},e),{isOpen:(null===(n=r.default.get(t,e._path,{}))||void 0===n?void 0:n.isOpen)||!1})};var r=a(n(496486))},894002:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addIsOpen",{enumerable:!0,get:function(){return r.addIsOpen}}),Object.defineProperty(t,"isEntityEmbedded",{enumerable:!0,get:function(){return i.isEntityEmbedded}}),Object.defineProperty(t,"openReferenceModal",{enumerable:!0,get:function(){return a.openReferenceModal}});var a=n(871198),r=n(882901),i=n(40011)},871198:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openReferenceModal=void 0;var a=n(287375);t.openReferenceModal=function(e,t,n){n.length>0&&(e.stopPropagation(),t((0,a.pushModal)({component:"REFERENCE_LINKS_MODAL",subtitle:"The following processes and bots use this component. Edits to the component may break the following instances.",skipStyleReset:!0,hideHeaderCloseButton:!0,props:{references:n},modalProps:{maxWidth:"sm"}})))}},40011:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEntityEmbedded=void 0;t.isEntityEmbedded=function(e){return"LOCAL"===e||"PROCESS"===e}},161171:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionSettingsOption=void 0,t.ExpressionSettingsOption=n,function(e){e[e.Legacy=0]="Legacy",e[e.Consistent=1]="Consistent"}(n||(t.ExpressionSettingsOption=n={}))},506871:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.NumberDivisionOption=void 0,t.NumberDivisionOption=n,function(e){e[e.Number=0]="Number",e[e.Decimal=1]="Decimal"}(n||(t.NumberDivisionOption=n={}))},417751:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateModeEnum=void 0,t.UpdateModeEnum=n,function(e){e[e.READ_ONLY=0]="READ_ONLY",e[e.UPDATES_ONLY=1]="UPDATES_ONLY",e[e.ADDS_ONLY=2]="ADDS_ONLY",e[e.ADDS_AND_UPDATES=3]="ADDS_AND_UPDATES",e[e.DELETES_ONLY=4]="DELETES_ONLY",e[e.UPDATES_AND_DELETES=5]="UPDATES_AND_DELETES",e[e.ADDS_AND_DELETES=6]="ADDS_AND_DELETES",e[e.ALL_CHANGES=7]="ALL_CHANGES",e[e.UNASSIGNED=8]="UNASSIGNED"}(n||(t.UpdateModeEnum=n={}))},222820:()=>{"use strict";!function(e){var t="canvasResize",n={newsize:function(e,t,n,a,r){var i=r?"h":"";if(n&&e>n||a&&t>a){var o=e/t;(o>=1||0===a)&&n&&!r?(e=n,t=n/o>>0):r&&o<=n/a?(e=n,t=n/o>>0,i="w"):(e=a*o>>0,t=a)}return{width:e,height:t,cropped:i}},dataURLtoBlob:function(e){for(var t=e.split(",")[0].split(":")[1].split(";")[0],n=atob(e.split(",")[1]),a=new ArrayBuffer(n.length),r=new Uint8Array(a),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);var o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;return o?((o=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)).append(a),o.getBlob(t)):o=new Blob([a],{type:t})},detectSubsampling:function(e){var t=e.width;if(t*e.height>1048576){var n=document.createElement("canvas");n.width=n.height=1;var a=n.getContext("2d");return a.drawImage(e,1-t,0),0===a.getImageData(0,0,1,1).data[3]}return!1},rotate:function(e,t){var n={1:{90:6,180:3,270:8},2:{90:7,180:4,270:5},3:{90:8,180:1,270:6},4:{90:5,180:2,270:7},5:{90:2,180:7,270:4},6:{90:3,180:8,270:1},7:{90:4,180:5,270:2},8:{90:1,180:6,270:3}};return n[e][t]?n[e][t]:e},transformCoordinate:function(e,t,n,a){switch(a){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var r=e.getContext("2d");switch(a){case 1:default:break;case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,n),r.rotate(Math.PI);break;case 4:r.translate(0,n),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-n);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-n),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}},detectVerticalSquash:function(e,t,n){var a=document.createElement("canvas");a.width=1,a.height=n;var r=a.getContext("2d");r.drawImage(e,0,0);for(var i=r.getImageData(0,0,1,n).data,o=0,l=n,u=n;u>o;){0===i[4*(u-1)+3]?l=u:o=u,u=l+o>>1}var s=u/n;return 0===s?1:s},callback:function(e){return e}},a={width:300,height:0,crop:!1,quality:80,callback:n.callback,disableSubsamplingDetection:!1};function r(n,r){this.file=n,this.options=e.extend({},a,r),this._defaults=a,this._name=t,this.init()}r.prototype={init:function(){var t=this,a=this.file,r=new FileReader;r.onloadend=function(r){var i=r.target.result,o=new Image;o.onload=function(r){e(o).exifLoadFromDataURL((function(){var r=e(o).exif("Orientation")[0]||1,i=document.querySelector("img");i&&("from-image"===getComputedStyle(i).imageOrientation&&(r=1));var l=(r=n.rotate(r,t.options.rotate))>=5&&r<=8?n.newsize(o.height,o.width,t.options.width,t.options.height,t.options.crop):n.newsize(o.width,o.height,t.options.width,t.options.height,t.options.crop),u=o.width,s=o.height,c=l.width,d=l.height,f=document.createElement("canvas"),p=f.getContext("2d");p.save(),n.transformCoordinate(f,c,d,r),!t.options.disableSubsamplingDetection&&n.detectSubsampling(o)&&(u/=2,s/=2);var h=1024,v=document.createElement("canvas");v.width=v.height=h;for(var m=v.getContext("2d"),g=0;g<s;){for(var y=g+h>s?s-g:h,b=0;b<u;){var T=b+h>u?u-b:h;m.clearRect(0,0,h,h),m.drawImage(o,-b,-g);var S=Math.floor(b*c/u),A=Math.ceil(T*c/u),E=Math.floor(g*d/s/1),w=Math.ceil(y*d/s/1);p.drawImage(v,0,0,T,y,S,E,A,w),b+=h}g+=h}p.restore(),v=m=null;var C=document.createElement("canvas");C.width="h"===l.cropped?d:c,C.height="w"===l.cropped?c:d;var O="h"===l.cropped?.5*(d-c):0,_="w"===l.cropped?.5*(c-d):0;if(C.getContext("2d").drawImage(f,O,_,c,d),"image/png"===a.type)var k=C.toDataURL(a.type);else k=C.toDataURL("image/jpeg",.01*t.options.quality);t.options.callback(k,c,d)}))},o.src=i},"function"==typeof t.options.onError&&(r.onerror=t.options.onError),r.readAsDataURL(a)}},e[t]=function(e,t){if("string"==typeof e)return n[e](t);new r(e,t)}}(jQuery)},671734:(e,t,n)=>{"use strict";var a,r,i,o=n(564836)(n(918698));a=function(e,t,n){var a=e,r=t||0,i=0;this.getRawData=function(){return a},"string"==typeof e&&(i=n||a.length,this.getByteAt=function(e){return 255&a.charCodeAt(e+r)}),this.getLength=function(){return i},this.getSByteAt=function(e){var t=this.getByteAt(e);return t>127?t-256:t},this.getShortAt=function(e,t){var n=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return n<0&&(n+=65536),n},this.getSShortAt=function(e,t){var n=this.getShortAt(e,t);return n>32767?n-65536:n},this.getLongAt=function(e,t){var n=this.getByteAt(e),a=this.getByteAt(e+1),r=this.getByteAt(e+2),i=this.getByteAt(e+3),o=t?(((n<<8)+a<<8)+r<<8)+i:(((i<<8)+r<<8)+a<<8)+n;return o<0&&(o+=4294967296),o},this.getSLongAt=function(e,t){var n=this.getLongAt(e,t);return n>2147483647?n-4294967296:n},this.getStringAt=function(e,t){for(var n=[],a=e,r=0;a<e+t;a++,r++)n[r]=String.fromCharCode(this.getByteAt(a));return n.join("")},this.getCharAt=function(e){return String.fromCharCode(this.getByteAt(e))},this.toBase64=function(){return window.btoa(a)},this.fromBase64=function(e){a=window.atob(e)}},r=function(){function e(){var e=null;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e}function t(t,n,r,i,o,l){var u=e();if(u){var s=0;i&&!o&&(s=i[0]);var c=0;i&&(c=i[1]-i[0]+1),n&&(void 0!==u.onload?u.onload=function(){"200"==u.status||"206"==u.status||"0"==u.status?(this.binaryResponse=new a(this.responseText,s,c),this.fileSize=l||this.getResponseHeader("Content-Length"),n(this)):r&&r(),u=null}:u.onreadystatechange=function(){4==u.readyState&&("200"==u.status||"206"==u.status||"0"==u.status?(this.binaryResponse=new a(u.responseBody,s,c),this.fileSize=l||this.getResponseHeader("Content-Length"),n(this)):r&&r(),u=null)}),u.open("GET",t,!0),u.overrideMimeType&&u.overrideMimeType("text/plain; charset=x-user-defined"),i&&o&&u.setRequestHeader("Range","bytes="+i[0]+"-"+i[1]),u.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),u.send(null)}else r&&r()}return function(n,a,r,i){i?function(t,n,a){var r=e();r?(n&&(void 0!==r.onload?r.onload=function(){"200"==r.status?n(this):a&&a(),r=null}:r.onreadystatechange=function(){4==r.readyState&&("200"==r.status?n(this):a&&a(),r=null)}),r.open("HEAD",t,!0),r.send(null)):a&&a()}(n,(function(e){var o,l,u=parseInt(e.getResponseHeader("Content-Length"),10),s=e.getResponseHeader("Accept-Ranges");o=i[0],i[0]<0&&(o+=u),l=o+i[1]-1,t(n,a,r,[o,l],"bytes"==s,u)})):t(n,a,r)}}(),i={},function(){function e(e){return!!e.exifdata}function t(e){if(255!=e.getByteAt(0)||216!=e.getByteAt(1))return!1;for(var t=2,n=e.getLength();t<n;){if(255!=e.getByteAt(t))return!1;var a=e.getByteAt(t+1);if(22400==a)return u(e,t+4,e.getShortAt(t+2,!0));if(225==a)return u(e,t+4,e.getShortAt(t+2,!0));t+=2+e.getShortAt(t+2,!0)}}function n(e,t,n,a,r){for(var i=e.getShortAt(n,r),o={},u=0;u<i;u++){var s=n+12*u+2,c=a[e.getShortAt(s,r)];o[c]=l(e,s,t,0,r)}return o}function l(e,t,n,a,r){var i=e.getShortAt(t+2,r),o=e.getLongAt(t+4,r),l=e.getLongAt(t+8,r)+n;switch(i){case 1:case 7:if(1==o)return e.getByteAt(t+8,r);for(var u=o>4?l:t+8,s=[],c=0;c<o;c++)s[c]=e.getByteAt(u+c);return s;case 2:var d=o>4?l:t+8;return e.getStringAt(d,o-1);case 3:if(1==o)return e.getShortAt(t+8,r);for(u=o>2?l:t+8,s=[],c=0;c<o;c++)s[c]=e.getShortAt(u+2*c,r);return s;case 4:if(1==o)return e.getLongAt(t+8,r);for(s=[],c=0;c<o;c++)s[c]=e.getLongAt(l+4*c,r);return s;case 5:if(1==o)return e.getLongAt(l,r)/e.getLongAt(l+4,r);for(s=[],c=0;c<o;c++)s[c]=e.getLongAt(l+8*c,r)/e.getLongAt(l+4+8*c,r);return s;case 9:if(1==o)return e.getSLongAt(t+8,r);for(s=[],c=0;c<o;c++)s[c]=e.getSLongAt(l+4*c,r);return s;case 10:if(1==o)return e.getSLongAt(l,r)/e.getSLongAt(l+4,r);for(s=[],c=0;c<o;c++)s[c]=e.getSLongAt(l+8*c,r)/e.getSLongAt(l+4+8*c,r);return s}}function u(e,t,a){if("Exif"!=e.getStringAt(t,4))return!1;var r,o=t+6;if(18761==e.getShortAt(o))r=!1;else{if(19789!=e.getShortAt(o))return!1;r=!0}if(42!=e.getShortAt(o+2,r))return!1;if(8!=e.getLongAt(o+4,r))return!1;var l=n(e,o,o+8,i.TiffTags,r);if(l.ExifIFDPointer){var u=n(e,o,o+l.ExifIFDPointer,i.Tags,r);for(var s in u){switch(s){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":u[s]=i.StringValues[s][u[s]];break;case"ExifVersion":case"FlashpixVersion":u[s]=String.fromCharCode(u[s][0],u[s][1],u[s][2],u[s][3]);break;case"ComponentsConfiguration":u[s]=i.StringValues.Components[u[s][0]]+i.StringValues.Components[u[s][1]]+i.StringValues.Components[u[s][2]]+i.StringValues.Components[u[s][3]]}l[s]=u[s]}}if(l.GPSInfoIFDPointer){var c=n(e,o,o+l.GPSInfoIFDPointer,i.GPSTags,r);for(var s in c)"GPSVersionID"===s&&(c[s]=c[s][0]+"."+c[s][1]+"."+c[s][2]+"."+c[s][3]),l[s]=c[s]}return l}i.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},i.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},i.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},i.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},i.getData=function(n,a){return!!n.complete&&(e(n)?a&&a():function(e,n){r(e.src,(function(a){console.log("BINARY",a.binaryResponse);var r=t(a.binaryResponse);e.exifdata=r||{},n&&n()}))}(n,a),!0)},i.getDataFromDataURL=function(n,r){return!!n.complete&&(e(n)?r&&r():function(e,n){var r=atob(e.src.split(",")[1]),i=t(new a(r,0,r.length));e.exifdata=i||{},n&&n()}(n,r),!0)},i.getTag=function(t,n){if(e(t))return t.exifdata[n]},i.getAllTags=function(t){if(!e(t))return{};var n=t.exifdata,a={};for(var r in n)n.hasOwnProperty(r)&&(a[r]=n[r]);return a},i.pretty=function(t){if(!e(t))return"";var n=t.exifdata,a="";for(var r in n)n.hasOwnProperty(r)&&("object"==(0,o.default)(n[r])?a+=r+" : ["+n[r].length+" values]\r\n":a+=r+" : "+n[r]+"\r\n");return a},i.readFromBinaryFile=function(e){return t(e)},jQuery((function(){for(var e,t,n,a=document.getElementsByTagName("img"),r=0;r<a.length;r++)"true"==a[r].getAttribute("exif")&&(a[r].complete?i.getData(a[r]):(e=a[r],t="load",n=function(){i.getData(this)},e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)))})),jQuery.fn.exifLoad=function(e){return this.each((function(){i.getData(this,e)}))},jQuery.fn.exifLoadFromDataURL=function(e){return this.each((function(){return i.getDataFromDataURL(this,e),!0}))},jQuery.fn.exif=function(e){var t=[];return this.each((function(){t.push(i.getTag(this,e))})),t},jQuery.fn.exifAll=function(){var e=[];return this.each((function(){e.push(i.getAllTags(this))})),e},jQuery.fn.exifPretty=function(){var e=[];return this.each((function(){e.push(i.pretty(this))})),e}}()},674823:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;for(var n=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],a={},r=0;r<n.length;r++)for(var i=n[r].letters,o=0;o<i.length;o++)a[i[o]]=n[r].base;var l=/[^\u0000-\u007E]/g,u=function(e){return a[e]||e},s=function(e){return l.test(e)?e.replace(l,u):e};t.default=s},175042:()=>{},200199:()=>{}}]);
//# sourceMappingURL=/cloud-sources/prod/5ae3633a8e6f073334bf55d647f1a77c372a8509adf2f618f105356690244e2e.map/